{"version":3,"sources":["js/helpers/TextToConstraint.js","components/Menu.js","js/enums/ActionsEnum.js","components/TextInput.js","components/Top.js","js/enums/CamerasEnum.js","js/helpers/ArrayHelpers.js","js/renderers/TopoRenderer2D.js","js/enums/SurfacesEnum.js","js/renderers/DesignRenderer2D.js","js/Display2DView.js","js/enums/ObjectsEnum.js","js/Display2DController.js","js/helpers/Helpers.js","components/Draw.js","js/renderers/EditTopoRenderer2D.js","js/TopoView.js","components/Topo.js","components/Surface.js","js/CameraPathController.js","js/renderers/TopoRenderer3D.js","js/renderers/DesignRenderer3D.js","js/CameraPathView.js","components/CameraPath.js","components/ChoosePath.js","components/DisplayWalkthrough.js","components/MainPage.js","debugging/DebuggingConstraints.js","debugging/Debugging3D.js","js/sessionAPI/Monitor.js","js/sessionAPI/Cube.js","js/sessionAPI/Roof.js","js/sessionAPI/Tree.js","js/sessionAPI/Design.js","js/sessionAPI/Topo.js","js/sessionAPI/U5Session.js","App.js","js/sessionAPI/U5SessionFactory.js","index.js","js/sessionAPI/Constraint.js"],"names":["__webpack_require__","d","__webpack_exports__","parseText","compromise__WEBPACK_IMPORTED_MODULE_0__","compromise__WEBPACK_IMPORTED_MODULE_0___default","n","nlp","plugin","words","less than","fewer than","more than","greater than","building","structure","no","reverseMap","map","reverse","Object","keys","forEach","key","synonym","COMPS_REVERSE","===",">","<",">=","<=","PROPS_REVERSE","area","height","distToAccess","TYPES_REVERSE","Structure","0","1","2","REPLACE_REVERSE","getResult","doc","has","getValue","numbers","values","value","length","i","toString","getProp","prop","getType","type","getComp","comp","getFn","result","fn","text","console","log","cleanText","toLowerCase","replace","trim","normalize","out","word","replacement","RegExp","concat","display","item","tags","join","constraintData","JSON","stringify","Menu","buttonElements","_this$props","this","props","actions","onClick","action","push","react_default","a","createElement","label","e","preventDefault","style","id","React","PureComponent","ActionsEnum","STEPOUT","STEPIN","ADDCUBE","REMOVE","ROTATELT","ROTATERT","ADDTREE","ADD_ROOF_NORTH","ADD_ROOF_SOUTH","WALKTHRU","SPEAK_CONSTRAINT","INCREASE_HEIGHT","DECREASE_HEIGHT","SOLID_SURFACE","PARTITION_SURFACE","TRANSPARENT_SURFACE","NO_SURFACE","HAS_ACCESS","NO_ACCESS","ADD_ROOF_WEST","ADD_ROOF_EAST","isAdd","includes","TextInput","state","handleKeyDown","event","keyCode","_this","handleSubmit","handleChange","actualVal","target","setState","onSubmit","input","document","getElementById","addEventListener","focus","removeEventListener","autoComplete","spellCheck","onChange","Top","textMessages","onMessage","newMessage","prevState","toConsumableArray","componentDidUpdate","scrollElement","window","requestAnimationFrame","container","undefined","scrollTop","scrollHeight","onSpeak","session","monitor","addConstraint","getMessages","slice","_this2","poll","setTimeout","textInput","TextInput_TextInput","messageElements","message","className","overflow","CamerasEnum","NORTH","EAST","SOUTH","WEST","TOP","BOTTOM","getSafe","arr","x","y","getSafe3D","z","getCellContext3D","position","w","s","t","b","getCornerContext2x2","topLeft","topRight","bottomLeft","bottomRight","getEmpty2DArray","rows","columns","defaultValue","arguments","Array","j","getEmpty3DArray","TopoRenderer2D","stage","classCallCheck","draw","topoSlice","cornerX","cornerY","line","createjs","Shape","graphics","beginStroke","SETTINGS","color","setStrokeStyle","stroke","front","_s","slicedToArray","startHeight","endHeight","h","r","moveTo","lineTo","endStroke","setStrokeDash","back","_s2","addChild","SurfacesEnum","freeze","SOLID","TRANS","PART","NONE","DesignRenderer2D","drawSlice","camera","isDashed","row","cell","constructor","name","drawCube","drawRoof","drawFoliage","drawTrunk","drawGridPoints","point","contextX","contextY","drawRect","drawCircle","circle","cube","drawLeft","drawTop","drawRight","drawBottom","surfaces","_drawCubeSquare","shape","sx","dx","sy","dy","roof","direction","_drawRoofSquare","_drawRoofSlantLeft","_drawRoofSlantRight","obj","hasSideSurface","foliage","trunk","Error","Display2DView","canvas","sliceIndex","isBackgroundDashed","removeAllChildren","topo","getSlice","topoRenderer","drawBackground","design","getBackgroundSlices","designRenderer","currentSlice","update","drawTopCompressedView","allSlices","zMax","masterSlice","xMax","yMax","_loop","_loop2","topObj","clear","_drawTopoSlice","_drawSlice","draw2D","_drawGridPoints","Stage","ObjectsEnum","CUBE","ROOF","TRUNK","FOLIAGE","PERSON","Display2DController","cameraView","addListener","view","views","removeListener","toRemove","filter","doAction","clickX","clickY","modifier","modelPosition","getRelativePosition","previousSlice","nextSlice","addObject","removeObject","rotateLeft","EDITTOPO","setTopoHeight","setSurface","object","add","updateViews","remove","side","surface","_setSliceYAxis","slices","_setSliceXAxis","_setSliceZAxis","north","_setCamera","south","east","west","top","bottom","rotateRight","v","gridSize","getGridPointInModelSpace","_SETTINGS2","Math","floor","Draw","controller","wire","isWired","handleClick","offsetX","offsetY","_SETTINGS","width","Component","EditTopoRenderer2D","drawSquare","num","Text","TopoView","renderer","getAt","Topo","decrease","increase","Surface","edge","_SETTINGS3","normalizedY","xRound","xRemainder","yRound","yRemainder","tDist","bDist","lDist","rDist","max","min","getClosestEdgeInModelSpace","CameraPathController","onWalkthroughEnd","run","path","animateCameraPath","p","nextP","setCameraPosition","TopoRenderer3D","scene","corners","adjustedCorners","cornerPoint","adjustedCornerPoint","_getAdjustedPoint","mark","downPoint","_addLine","leftPoint","p0","p1","geometry","THREE","vertices","material","DesignRenderer3D","objects","lines","_getCubeFaces","positionAdj","_getRoof","rotation","PI","center","wireframe","position2","CameraPathView","children","designRenderer3D","getAll","topoRenderer3D","topoCorners","getCorners","render","hasPosition","_this$getAdjustedPoin","getAdjustedPoint","np","lookAt","background","antialias","setPixelRatio","setSize","appendChild","domElement","CameraPath","ChoosePath","hasStart","onSelectStart","onSelectEnd","DisplayWalkthrough","start","doWalkthrough","end","calculatePath","CameraPath_CameraPath","ChoosePath_ChoosePath","MainPage","displayType","onMenuClick","clearConstraints","location","reload","getDisplay","_this$state","Draw_Draw","DisplayWalkthrough_DisplayWalkthrough","Topo_Topo","Surface_Surface","getActions","float","padding","Top_Top","Menu_Menu","DebuggingConstraints","constraints","systemConstraints","buildings","getStringsFromConstraints","c","parseInt","_monitor","_design","_buildings","getObjects","_this3","left","wordWrap","border","fontSize","whiteSpace","marginTop","Debugging3D","size","nextRotation","origins","d1","lastCameraView","lastNumObjects","lastTotalHeight","numObjects","_objects","totalHeight","_topo","heights","reduce","total","right","margin","onMouseDown","Monitor","messages","constraint","Constraint","create","newConstraints","old","isSameType","checkDesign","conflicts","checkConflicts","incompatibilities","checkIncompatibilities","newMessages","isViolated","jsonStr","parse","thaw","json","Cube","cubeData","hookAfterInsert","context","hookBeforeRemove","sideCardinal","hasAccessToOutside","hasAccessInDirection","Roof","roofData","Foliage","Trunk","Design","newObject","foliagePosition","_setCell","_getCell","getCardinalSide","sharedWallNeighbor","cardinalDirection","getOppositeDirection","getBuildings","calculateAttributes","calculateObjectAttributes","calculateAccess","findBuildings","calculateBuildingAttributes","gh","ground","noBase","Infinity","accessPoints","checkAccess","dist","nextDist","buildingAttributes","floating","maxDistToAccess","part","buildingParts","buildingIndex","nextIndex","floodFillBuildings","neighborPosition","ySlice","xSlice","zSlice","_getYSlice","Array2D","hflip","_getXSlice","_getZSlice","vflip","backgroundSliceIndex","backgroundSliceIndices","_addCube","fill","pos","mod","objectsPacked","objectData","objectsUnpacked","heightsView","transpose","cornersLength","U5Session","onUpdate","save","xyz","meta","xy","ice","localStorage","setItem","_id","getIDList","ids","getItem","split","get","_setIDList","last","pop","newSession","_getNextID","test","currentID","App","debug","MainPage_MainPage","DebuggingConstraints_DebuggingConstraints","Debugging3D_Debugging3D","ReactDOM","App_App","data","_Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__","objectsOfType","propValues","calculatedValue","sum","calculatedResult","eval","otherConstraint","possibleConstraints","hasError","hasMatch","possibility"],"mappings":"yFAAAA,EAAAC,EAAAC,EAAA,sBAAAC,IAAA,IAAAC,EAAAJ,EAAA,IAAAK,EAAAL,EAAAM,EAAAF,GAaAG,IAAIC,OAXW,CACbC,MAAO,CACLC,YAAa,cACbC,aAAc,cACdC,YAAa,cACbC,eAAgB,cAChBC,SAAY,OACZC,UAAa,OACbC,GAAM,gBAgCV,SAASC,EAAWC,GAClB,IAAMC,EAAU,GAOhB,OANAC,OAAOC,KAAKH,GAAKI,QAAQ,SAAAC,GACNL,EAAIK,GACZD,QAAQ,SAAAE,GACfL,EAAQK,GAAWD,MAGhBJ,EAIT,IAAMM,EAAgBR,EApBR,CACZS,MAAO,CAAC,SAAU,QAClBC,IAAK,CAAC,UAAW,OAAQ,SAAU,SAAU,SAAU,QAAS,YAAa,OAAQ,UAAW,WAChGC,IAAK,CAAC,QAAS,OAAQ,UAAW,UAAW,QAAS,QAAS,QAAS,WACxEC,KAAM,CAAC,UAAW,MAAO,WAAY,QAAS,YAC9CC,KAAM,CAAC,UAAW,MAAO,UAAW,OAAQ,UAAW,cAgBnDC,EAAgBd,EA3BR,CACZe,KAAM,CAAC,OAAQ,iBAAkB,KAAM,QAAS,QAAS,aAAc,OAAQ,UAAW,UAAW,SACrGC,OAAQ,CAAC,OAAQ,SAAU,YAAa,SAAU,UAAW,UAAW,OAAQ,UAAW,QAAS,MAAO,UAC3GC,aAAc,CAAC,SAAU,QAAS,WAAY,UAAW,OAAQ,QAAS,OAAQ,MAAO,UAyBrFC,EAAgBlB,EAnCR,CACZmB,UAAW,CAAC,YAAa,WAAY,aAAc,YAAa,QAAS,OAAQ,WAAY,UAAW,UACxGC,EAAG,CAAC,OAAQ,OAAQ,OAAQ,QAAS,QAAS,QAAS,YACvDC,EAAG,CAAC,OAAQ,QAAS,SAAU,WAAY,UAAW,QAAS,SAC/DC,EAAG,CAAC,OAAQ,QAAS,OAAQ,QAAS,SAAU,SAAU,YAgCtDC,EAAkBvB,EAzCR,CAEdD,GAAI,CAAC,MAAO,UA+DRyB,EAAY,SAAAC,GAAG,OAAKA,EAAIC,IAAI,OAE5BC,EAAW,SAAAF,GACf,IAAMG,EAAUH,EAAII,SAASD,UACzBE,EAAQ,KACZ,GAAIF,EAAQG,OAAS,EAAG,CAEtB,IADA,IAAIC,EAAI,GACAJ,EAAQI,IAAMA,EAAIJ,EAAQG,OAAS,GACzCC,GAAK,EAEPF,EAAQF,EAAQI,GAAGC,WAErB,OAAOH,GAGHI,EAAU,SAAAT,GA2Bd,IAAIU,EAAO,KAQX,OAPiBhC,OAAOC,KAAKU,GACpBT,QAAQ,SAAAC,GACXmB,EAAIC,IAAIpB,KACV6B,EAAOrB,EAAcR,MAIlB6B,GAGHC,EAAU,SAAAX,GAed,IAAIY,EAAO,IAOX,OANiBlC,OAAOC,KAAKc,GACpBb,QAAQ,SAAAC,GACXmB,EAAIC,IAAIpB,KACV+B,EAAOnB,EAAcZ,MAGlB+B,GAGHC,EAAU,SAAAb,GACd,IAAIc,EAAO,KAOX,OANiBpC,OAAOC,KAAKI,GACpBH,QAAQ,SAAAC,GACXmB,EAAIC,IAAIpB,KACViC,EAAO/B,EAAcF,MAGlBiC,GAGHC,EAAQ,SAACC,EAAQF,GACrB,IAAIG,EAAK,KAkBT,OAjBKD,EASU,MAATF,GAAyB,OAATA,EAClBG,EAAK,MACa,MAATH,GAAyB,OAATA,EACzBG,EAAK,MACa,QAATH,IACTG,EAAK,OAbM,MAATH,GAAyB,OAATA,EAClBG,EAAK,MACa,MAATH,GAAyB,OAATA,EACzBG,EAAK,MACa,QAATH,IACTG,EAAK,OAWFA,GAGM,SAASxD,EAAUyD,GAChCC,QAAQC,IAAI,kBAAoBF,GAGhC,IAAIG,EAAYH,EAAKI,cAAcC,QAAQ,6BAA6B,IAAIC,OAG5EH,EAAYxD,IAAIwD,GAAWI,YAAYC,MAGvChD,OAAOC,KAAKmB,GAAiBlB,QAAQ,SAAA+C,GACnC,IAAMC,EAAc9B,EAAgB6B,GACpCN,EAAYA,EAAUE,QAAQ,IAAIM,OAAJ,GAAAC,OAAcH,EAAd,KAAuB,KAAzC,GAAAG,OAAkDF,EAAlD,QAGdT,QAAQC,IAAI,iBAAmBC,GAE/B,IAAMrB,EAAMnC,IAAIwD,GAIVU,EADM/B,EAAI0B,IAAI,QACAlD,IAAI,SAAAwD,GAAI,UAAAF,OAAQE,EAAKd,KAAb,MAAAY,OAAsBE,EAAKC,KAAKC,KAAK,KAArC,OAA8CA,KAAK,IAC/Ef,QAAQC,IAAI,QAAUW,GAEtB,IAAMf,EAASjB,EAAUC,GACnBK,EAAQH,EAASF,GACjBY,EAAOD,EAAQX,GACfU,EAAOD,EAAQT,GACfc,EAAOD,EAAQb,GAIfmC,EAAiB,CAAEjB,OAAMF,SAAQC,GAF5BF,EAAMC,EAAQF,GAEkBF,OAAMF,OAAMI,OAAMT,SAa7D,OAFAc,QAAQC,IAAR,wBAAAU,OAAoCM,KAAKC,UAAUF,KAE5CA,wNCzOYG,mLASjB,IAAMC,EAAiB,GADhBC,EAG8BC,KAAKC,MAAlCC,EAHDH,EAGCG,QAASC,EAHVJ,EAGUI,QAASC,EAHnBL,EAGmBK,OAmB1B,OAlBIF,GACFA,EAAQ/D,QAAQ,SAAAoD,GACdO,EAAeO,KACbC,EAAAC,EAAAC,cAAA,UACErC,KAAK,SACL/B,IAAKmD,EAAKkB,MACVN,QAAS,SAAAO,GACPA,EAAEC,iBACFR,EAAQZ,IAEVqB,MAAO,CAAEtB,QAAS,UAEjBC,EAAKkB,OAASlB,EAAKsB,KAAOT,EAAOS,GAAK,IAAM,QAOnDP,EAAAC,EAAAC,cAAA,WACGV,UAhCyBgB,IAAMC,uBCuBzBC,EA3BK,CAClBC,QAAS,CAAEJ,GAAI,EAAGJ,MAAO,YACzBS,OAAQ,CAAEL,GAAI,EAAGJ,MAAO,YACxBU,QAAS,CAAEN,GAAI,EAAGJ,MAAO,YACzBW,OAAQ,CAAEP,GAAI,EAAGJ,MAAO,YACxBY,SAAU,CAAER,GAAI,EAAGJ,MAAO,YAC1Ba,SAAU,CAAET,GAAI,EAAGJ,MAAO,YAC1Bc,QAAS,CAAEV,GAAI,EAAGJ,MAAO,YACzBe,eAAgB,CAAEX,GAAI,EAAGJ,MAAO,YAChCgB,eAAgB,CAAEZ,GAAI,EAAGJ,MAAO,YAChCiB,SAAU,CAAEb,GAAI,EAAGJ,MAAO,YAE1BkB,iBAAkB,CAAEd,GAAI,GAAIJ,MAAO,SACnCmB,gBAAiB,CAAEf,GAAI,GAAIJ,MAAO,YAClCoB,gBAAiB,CAAEhB,GAAI,GAAIJ,MAAO,YAClCqB,cAAe,CAAEjB,GAAI,GAAIJ,MAAO,YAChCsB,kBAAmB,CAAElB,GAAI,GAAIJ,MAAO,YACpCuB,oBAAqB,CAAEnB,GAAI,GAAIJ,MAAO,YACtCwB,WAAY,CAAEpB,GAAI,GAAIJ,MAAO,UAC7ByB,WAAY,CAAErB,GAAI,GAAIJ,MAAO,YAC7B0B,UAAW,CAAEtB,GAAI,GAAIJ,MAAO,YAC5B2B,cAAe,CAAEvB,GAAI,GAAIJ,MAAO,YAChC4B,cAAe,CAAExB,GAAI,GAAIJ,MAAO,YAEhC6B,MAAO,SAAAlC,GAAM,MAAI,CAAC,EAAG,EAAG,EAAG,EAAG,GAAI,IAAImC,SAASnC,EAAOS,MClBnC2B,6MAKnBC,MAAQ,CACN7E,MAAO,MAaT8E,cAAgB,SAAAC,GACQ,KAAlBA,EAAMC,SACRC,EAAKC,eAECH,EAAMC,WAMhBG,aAAe,SAAAJ,GACb,IAIMK,EAJML,EAAMM,OAAOrF,MAKzBiF,EAAKK,SAAS,CAAEtF,MAAOoF,OAGzBF,aAAe,YAIbK,EAHqBN,EAAK5C,MAAlBkD,UACUN,EAAKJ,MAAf7E,OAGRiF,EAAKK,SAAS,CAAEtF,MAAO,yFAjCvBoC,KAAKoD,MAAQC,SAASC,eAAe,SACrCtD,KAAKoD,MAAMG,iBAAiB,UAAWvD,KAAK0C,eAC5C1C,KAAKoD,MAAMI,uDAIXxD,KAAKoD,MAAMK,oBAAoB,UAAWzD,KAAK0C,gDA8BxC,IACC9E,EAAUoC,KAAKyC,MAAf7E,MAER,OACE0C,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,SAAOrC,KAAK,OAAO0C,GAAG,QAAQ6C,aAAa,MAAMC,WAAW,QAAQ/F,MAAOA,EAAOgG,SAAU5D,KAAK+C,uBAnDlEjC,IAAMC,eCGxB8C,6MAMnBpB,MAAQ,CACNqB,aAAc,MAchBC,UAAY,SAAAC,GACVnB,EAAKK,SAAS,SAAAe,GAAS,MAAK,CAAEH,aAAY,GAAAzE,OAAApD,OAAAiI,EAAA,EAAAjI,CAAMgI,EAAUH,cAAhB,CAA8BE,UAG1EG,mBAAqB,WACnBtB,EAAKuB,mBAGPA,cAAgB,WACdC,OAAOC,sBAAsB,WAC3B,IAAMC,EAAYlB,SAASC,eAAe,qBACxBkB,IAAdD,IACFA,EAAUE,UAAYF,EAAUG,aAAe,UAKrDC,QAAU,SAAAlG,GAAQ,IACRmG,EAAY/B,EAAK5C,MAAjB2E,QAERA,EAAQC,QAAQC,cAAcrG,GAE9B,IAAMqF,EAAec,EAAQC,QAAQE,cACrClC,EAAKK,SAAS,CAAEY,aAAcA,EAAakB,8FAlCzB,IAAAC,EAAAjF,KACV4E,EAAY5E,KAAKC,MAAjB2E,SAEK,SAAPM,IACJ,IAAMpB,EAAec,EAAQC,QAAQE,cACrCE,EAAK/B,SAAS,CAAEY,iBAChBqB,WAAWD,EAAM,KAEnBA,oCA6BO,IACC9E,EAAWJ,KAAKC,MAAhBG,OACA0D,EAAiB9D,KAAKyC,MAAtBqB,aAEJsB,EAAY,KAEZhF,IAAWY,EAAYW,mBACzByD,EAAa9E,EAAAC,EAAAC,cAAC6E,EAAD,CAAWlC,SAAUnD,KAAK2E,WAGzC,IAAMW,EAAkBxB,EAAa/H,IAAI,SAAAwJ,GAAO,OAC9CjF,EAAAC,EAAAC,cAAA,OAAKgF,UAAU,YAAYpJ,IAAKmJ,GAAUA,KAG5C,OACEjF,EAAAC,EAAAC,cAAA,OAAKK,GAAG,eAAeD,MAAO,CAAE6E,SAAU,SAAU3I,OAAQ,SACxDwI,EACAF,UAhEuBtE,IAAMC,sBCCxB2E,EATK,CAClBC,MAAO,EACPC,KAAM,EACNC,MAAO,EACPC,KAAM,EACNC,IAAK,EACLC,OAAQ,GCHV,SAASC,EAAQC,EAAKC,EAAGC,GACvB,OAAID,GAAK,GAAKD,EAAIrI,OAAS,GAAKqI,EAAI,GAAGrI,QAAUsI,EAAID,EAAI,GAAGrI,QAAUuI,GAAK,GAAKA,EAAIF,EAAIrI,OAC/EqI,EAAIE,GAAGD,GAET,KAGT,SAASE,EAAUH,EAAKC,EAAGC,EAAGE,GAC5B,OAAIJ,EAAIrI,OAAS,GAAKqI,EAAI,GAAGrI,QAAUqI,EAAI,GAAG,GAAGrI,QAC1CsI,GAAK,GAAKA,EAAID,EAAI,GAAG,GAAGrI,QACxBuI,GAAK,GAAKA,EAAIF,EAAI,GAAGrI,QACrByI,GAAK,GAAKA,EAAIJ,EAAIrI,OAChBqI,EAAII,GAAGF,GAAGD,GAEZ,KA2BF,SAASI,EAAiBL,EAAKM,GAAU,IACtCL,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACd,MAAO,CACLG,EAAGJ,EAAUH,EAAKC,EAAI,EAAGC,EAAGE,GAC5BnL,EAAGkL,EAAUH,EAAKC,EAAGC,EAAI,EAAGE,GAC5B5F,EAAG2F,EAAUH,EAAKC,EAAI,EAAGC,EAAGE,GAC5BI,EAAGL,EAAUH,EAAKC,EAAGC,EAAI,EAAGE,GAC5BK,EAAGN,EAAUH,EAAKC,EAAGC,EAAGE,EAAI,GAC5BM,EAAGP,EAAUH,EAAKC,EAAGC,EAAGE,EAAI,IASzB,SAASO,EAAoBX,EAAKC,EAAGC,GAC1C,MAAO,CACLU,QAASb,EAAQC,EAAKC,EAAI,EAAGC,GAC7BW,SAAUd,EAAQC,EAAKC,EAAGC,GAC1BY,WAAYf,EAAQC,EAAKC,EAAI,EAAGC,EAAI,GACpCa,YAAahB,EAAQC,EAAKC,EAAGC,EAAI,IAU9B,SAASc,EAAgBC,EAAMC,GAEpC,IAFkE,IAArBC,EAAqBC,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,GAAAA,UAAA,GAAN,KACtDpB,EAAM,IAAIqB,MAAMJ,GACbrJ,EAAI,EAAGA,EAAIqJ,EAAMrJ,GAAK,EAAG,CAChCoI,EAAIpI,GAAK,IAAIyJ,MAAMH,GACnB,IAAK,IAAII,EAAI,EAAGA,EAAIJ,EAASI,GAAK,EAChCtB,EAAIpI,GAAG0J,GAAKH,EAGhB,OAAOnB,EAGF,SAASuB,EAAgBtB,EAAGC,EAAGE,GAGpC,IAFA,IAAMJ,EAAM,IAAIqB,MAAMjB,GAEbxI,EAAI,EAAGA,EAAIoI,EAAIrI,OAAQC,GAAK,EACnCoI,EAAIpI,GAAKoJ,EAAgBd,EAAGD,EAAG,MAGjC,OAAOD,cC3FYwB,EACnB,SAAAA,EAAYC,GAAO,IAAA9E,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA0H,GAAA1H,KAInB6H,KAAO,SAAAC,GACL,IACIC,EACAC,EAFEC,EAAO,IAAIC,WAASC,MAK1BJ,EAAU,EACVE,EAAKG,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAClEX,EAAUY,MAAMvM,QAAQ,SAAAuK,GAAK,IAAAiC,EAAA1M,OAAA2M,EAAA,EAAA3M,CACQyK,EADR,GACnBmC,EADmBF,EAAA,GACNG,EADMH,EAAA,GAE3BX,EAAUM,SAASS,EAAI,EAAKF,EAAcP,SAASU,EACnDf,EAAKG,SAASa,OAAOlB,EAASC,GAC9BD,GAAWO,SAASU,EACpBhB,EAAUM,SAASS,EAAI,EAAKD,EAAYR,SAASU,EACjDf,EAAKG,SAASc,OAAOnB,EAASC,KAEhCC,EAAKG,SAASe,YAGdpB,EAAU,EACVE,EAAKG,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAClER,EAAKG,SAASgB,cAAc,CAAC,EAAG,GAAI,GACpCtB,EAAUuB,KAAKlN,QAAQ,SAAAuK,GAAK,IAAA4C,EAAArN,OAAA2M,EAAA,EAAA3M,CACSyK,EADT,GAClBmC,EADkBS,EAAA,GACLR,EADKQ,EAAA,GAE1BtB,EAAUM,SAASS,EAAI,EAAKF,EAAcP,SAASU,EACnDf,EAAKG,SAASa,OAAOlB,EAASC,GAC9BD,GAAWO,SAASU,EACpBhB,EAAUM,SAASS,EAAI,EAAKD,EAAYR,SAASU,EACjDf,EAAKG,SAASc,OAAOnB,EAASC,KAEhCC,EAAKG,SAASe,YAEdtG,EAAK8E,MAAM4B,SAAStB,IAnCpBjI,KAAK2H,MAAQA,GCCF6B,EAPMvN,OAAOwN,OAAO,CACjCC,MAAO,EACPC,MAAO,EACPC,KAAM,EACNC,KAAM,ICGaC,EACnB,SAAAA,EAAYnC,GAAO,IAAA9E,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA8J,GAAA9J,KAUnB+J,UAAY,SAACC,EAAQhF,GAA4B,IAArBiF,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAC/CzE,EAAKmH,OAASA,EACd,IAAK,IAAI5D,EAAI,EAAGA,EAAIpB,EAAMnH,OAAQuI,GAAK,EAErC,IADA,IAAM8D,EAAMlF,EAAMoB,GACTD,EAAI,EAAGA,EAAI+D,EAAIrM,OAAQsI,GAAK,EAAG,CACtC,IAAMgE,EAAOD,EAAI/D,GAEjB,GAAIgE,EACF,OAAQA,EAAKC,YAAYC,MACvB,IAAK,OACHxH,EAAKyH,SAASH,EAAMH,EAAQnH,EAAK8E,MAAOxB,EAAGC,EAAG6D,GAC9C,MACF,IAAK,OACHpH,EAAK0H,SAASJ,EAAMH,EAAQnH,EAAK8E,MAAOxB,EAAGC,EAAG6D,GAC9C,MACF,IAAK,UAEEA,GACHpH,EAAK2H,YAAYR,EAAQnH,EAAK8E,MAAOxB,EAAGC,EAAG6D,GAE7C,MACF,IAAK,QAEEA,GACHpH,EAAK4H,UAAUT,EAAQnH,EAAK8E,MAAOxB,EAAGC,EAAG6D,MAlCpCjK,KAiDnB0K,eAAiB,SAAA1F,GACf,IAAK,IAAIoB,EAAI,EAAGA,EAAIpB,EAAMnH,OAAQuI,GAAK,EAErC,IADA,IAAM8D,EAAMlF,EAAMoB,GACTD,EAAI,EAAGA,EAAI+D,EAAIrM,OAAQsI,GAAK,EAAG,CACtC,IAAMwE,EAAQ,IAAIzC,WAASC,MACrByC,GAAYzE,EAAI,IAAOmC,SAASU,EAChC6B,EAAWvC,SAASS,GAAM3C,EAAI,IAAOkC,SAASU,EAEpD2B,EAAMvC,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,OAAS,GAAGqC,SAASF,EAAUC,EAAU,GAAI,GAChHhI,EAAK8E,MAAM4B,SAASoB,KA1DP3K,KAoEnB+K,WAAa,SAAC5E,EAAGC,GACf,IAAM4E,EAAS,IAAI9C,WAASC,MAE5B6C,EAAO5C,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QACpE,IAAMV,GAAY5B,EAAI,IAAOmC,SAASU,EAAK,EACrChB,EAAUM,SAASS,GAAM3C,EAAI,KAAQkC,SAASU,EAAK,EACzDgC,EAAO5C,SAAS2C,WAAWhD,EAASC,EAAsB,GAAbM,SAASU,GAEtDnG,EAAK8E,MAAM4B,SAASyB,IA5EHhL,KA+EnBsK,SAAW,SAACW,EAAMjB,EAAQrC,EAAOxB,EAAGC,GAAwB,IACtD8E,EAAUC,EAASC,EAAWC,EADGpB,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAEpDZ,EAAIuE,EAAKK,SAEf,OAAQtB,GACN,KAAKtE,EAAYC,MACfuF,EAAWxE,EAAED,IAAM+C,EAAaE,MAChCyB,EAAUzE,EAAEC,IAAM6C,EAAaE,MAC/B0B,EAAY1E,EAAEhG,IAAM8I,EAAaE,MACjC2B,EAAa3E,EAAEE,IAAM4C,EAAaE,MAClC,MACF,KAAKhE,EAAYG,MACfqF,EAAWxE,EAAEhG,IAAM8I,EAAaE,MAChCyB,EAAUzE,EAAEC,IAAM6C,EAAaE,MAC/B0B,EAAY1E,EAAED,IAAM+C,EAAaE,MACjC2B,EAAa3E,EAAEE,IAAM4C,EAAaE,MAClC,MACF,KAAKhE,EAAYE,KACfsF,EAAWxE,EAAEvL,IAAMqO,EAAaE,MAChCyB,EAAUzE,EAAEC,IAAM6C,EAAaE,MAC/B0B,EAAY1E,EAAEA,IAAM8C,EAAaE,MACjC2B,EAAa3E,EAAEE,IAAM4C,EAAaE,MAClC,MACF,KAAKhE,EAAYI,KACfoF,EAAWxE,EAAEA,IAAM8C,EAAaE,MAChCyB,EAAUzE,EAAEC,IAAM6C,EAAaE,MAC/B0B,EAAY1E,EAAEvL,IAAMqO,EAAaE,MACjC2B,EAAa3E,EAAEE,IAAM4C,EAAaE,MAClC,MACF,KAAKhE,EAAYK,IACfmF,EAAWxE,EAAED,IAAM+C,EAAaE,MAChCyB,EAAUzE,EAAEvL,IAAMqO,EAAaE,MAC/B0B,EAAY1E,EAAEhG,IAAM8I,EAAaE,MACjC2B,EAAa3E,EAAEA,IAAM8C,EAAaE,MAClC,MACF,KAAKhE,EAAYM,OACfkF,EAAWxE,EAAED,IAAM+C,EAAaE,MAChCyB,EAAUzE,EAAEA,IAAM8C,EAAaE,MAC/B0B,EAAY1E,EAAEhG,IAAM8I,EAAaE,MACjC2B,EAAa3E,EAAEvL,IAAMqO,EAAaE,MAClC,MACF,QACE,OAGJ7G,EAAK0I,gBAAgB5D,EAAOxB,EAAGC,EAAG6D,EAAUiB,EAAUC,EAASC,EAAWC,IA5HzDrL,KA+HnBuL,gBAAkB,SAAC5D,EAAOxB,EAAGC,GAA8F,IAA3F6D,EAA2F3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAAzE4D,IAAyE5D,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,KAAAA,UAAA,GAAxD6D,IAAwD7D,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,KAAAA,UAAA,GAAxC8D,IAAwC9D,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,KAAAA,UAAA,GAAtB+D,IAAsB/D,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,KAAAA,UAAA,GACnHkE,EAAQ,IAAItD,WAASC,MAC3BqD,EAAMpD,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAEnE,IAAMgD,EAAMtF,EAAImC,SAASU,EAAK,EACxB0C,EAAKpD,SAASU,EACd2C,EAAKrD,SAASS,EAAK3C,EAAIkC,SAASU,EAAK,EACrC4C,GAAMtD,SAASU,EAEjBiB,GACFuB,EAAMpD,SAASgB,cAAc,CAAC,EAAG,GAAI,GAGnC8B,GACFM,EAAMpD,SAASa,OAAOwC,EAAIE,GAAIzC,OAAOuC,EAAIE,EAAKC,GAE5CT,GACFK,EAAMpD,SAASa,OAAOwC,EAAIE,EAAKC,GAAI1C,OAAOuC,EAAKC,EAAIC,EAAKC,GAEtDR,GACFI,EAAMpD,SAASa,OAAOwC,EAAKC,EAAIC,EAAKC,GAAI1C,OAAOuC,EAAKC,EAAIC,GAEtDN,GACFG,EAAMpD,SAASa,OAAOwC,EAAKC,EAAIC,GAAIzC,OAAOuC,EAAIE,GAGhDhE,EAAM4B,SAASiC,IAzJExL,KA4JnBuK,SAAW,SAACsB,EAAM7B,EAAQrC,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAC1D,OAAQ0C,GACN,KAAKtE,EAAYC,MACQ,MAAnBkG,EAAKC,WAAwC,MAAnBD,EAAKC,UACjCjJ,EAAKkJ,gBAAgBpE,EAAOxB,EAAGC,EAAG6D,GACN,MAAnB4B,EAAKC,UACdjJ,EAAKmJ,mBAAmBH,EAAMlE,EAAOxB,EAAGC,EAAG6D,GACf,MAAnB4B,EAAKC,WACdjJ,EAAKoJ,oBAAoBJ,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAE9C,MACF,KAAKvE,EAAYG,MACQ,MAAnBgG,EAAKC,WAAwC,MAAnBD,EAAKC,UACjCjJ,EAAKkJ,gBAAgBpE,EAAOxB,EAAGC,EAAG6D,GACN,MAAnB4B,EAAKC,UACdjJ,EAAKmJ,mBAAmBH,EAAMlE,EAAOxB,EAAGC,EAAG6D,GACf,MAAnB4B,EAAKC,WACdjJ,EAAKoJ,oBAAoBJ,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAE9C,MACF,KAAKvE,EAAYE,KACQ,MAAnBiG,EAAKC,WAAwC,MAAnBD,EAAKC,UACjCjJ,EAAKkJ,gBAAgBpE,EAAOxB,EAAGC,EAAG6D,GACN,MAAnB4B,EAAKC,UACdjJ,EAAKoJ,oBAAoBJ,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAChB,MAAnB4B,EAAKC,WACdjJ,EAAKmJ,mBAAmBH,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAE7C,MACF,KAAKvE,EAAYI,KACQ,MAAnB+F,EAAKC,WAAwC,MAAnBD,EAAKC,UACjCjJ,EAAKkJ,gBAAgBpE,EAAOxB,EAAGC,EAAG6D,GACN,MAAnB4B,EAAKC,UACdjJ,EAAKoJ,oBAAoBJ,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAChB,MAAnB4B,EAAKC,WACdjJ,EAAKmJ,mBAAmBH,EAAMlE,EAAOxB,EAAGC,EAAG6D,GAE7C,MACF,KAAKvE,EAAYK,IACjB,KAAKL,EAAYM,OACfnD,EAAKkJ,gBAAgBpE,EAAOxB,EAAGC,EAAG6D,KApMrBjK,KA0MnB+L,gBAAkB,SAACpE,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAC7CkE,EAAQ,IAAItD,WAASC,MAC3BqD,EAAMpD,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAEnE,IAAMgD,EAAMtF,EAAImC,SAASU,EAAK,EACxB0C,EAAKpD,SAASU,EACd2C,EAAKrD,SAASS,EAAK3C,EAAIkC,SAASU,EAAK,EACrC4C,GAAMtD,SAASU,EAEjBiB,GACFuB,EAAMpD,SAASgB,cAAc,CAAC,EAAG,GAAI,GAGvCoC,EAAMpD,SAAS0C,SAASW,EAAIE,EAAID,EAAIE,GACpCjE,EAAM4B,SAASiC,IAxNExL,KAgOnBgM,mBAAqB,SAACE,EAAKvE,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GACrDuE,EAAO,IAAI3D,WAASC,MAEtB8B,GACF4B,EAAKzD,SAASgB,cAAc,CAAC,EAAG,GAAI,GAGtC,IAAIrB,EAAW5B,EAAImC,SAASU,EAAK,EAC7BhB,EAAUM,SAASS,EAAK3C,EAAIkC,SAASU,EAAK,EAC9C6C,EAAKzD,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAClEoD,EAAKzD,SAASa,OAAOlB,EAASC,GAC9BD,GAAWO,SAASU,EACpBhB,GAAWM,SAASU,EACpB6C,EAAKzD,SAASc,OAAOnB,EAASC,GAE1BkE,EAAIC,iBACNN,EAAKzD,SAASa,OAAOlB,EAASC,GAC9BA,GAAWM,SAASU,EACpB6C,EAAKzD,SAASc,OAAOnB,EAASC,IAEhC6D,EAAKzD,SAASe,YAEdxB,EAAM4B,SAASsC,IAtPE7L,KA8PnBiM,oBAAsB,SAACC,EAAKvE,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GACtDuE,EAAO,IAAI3D,WAASC,MAEtB8B,GACF4B,EAAKzD,SAASgB,cAAc,CAAC,EAAG,GAAI,GAGtC,IAAIrB,EAAW5B,EAAImC,SAASU,EAAK,EAC7BhB,EAAUM,SAASS,GAAM3C,EAAI,GAAKkC,SAASU,EAAK,EACpD6C,EAAKzD,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAClEoD,EAAKzD,SAASa,OAAOlB,EAASC,GAC9BD,GAAWO,SAASU,EACpBhB,GAAWM,SAASU,EACpB6C,EAAKzD,SAASc,OAAOnB,EAASC,GAE1BkE,EAAIC,iBACNpE,GAAWO,SAASU,EACpBhB,GAAWM,SAASU,EACpB6C,EAAKzD,SAASa,OAAOlB,EAASC,GAC9BA,GAAWM,SAASU,EACpB6C,EAAKzD,SAASc,OAAOnB,EAASC,IAEhC6D,EAAKzD,SAASe,YAEdxB,EAAM4B,SAASsC,IAtRE7L,KA8RnBwK,YAAc,SAACR,EAAQrC,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GACjD8E,EAAU,IAAIlE,WAASC,MAEzB8B,GACFmC,EAAQhE,SAASgB,cAAc,CAACd,SAASG,OAAQ,GAAI,GAGvD2D,EAAQhE,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QACrE,IAAMV,GAAY5B,EAAI,IAAOmC,SAASU,EAAK,EACrChB,EAAUM,SAASS,GAAM3C,EAAI,KAAQkC,SAASU,EAAK,EACzDoD,EAAQhE,SAAS2C,WAAWhD,EAASC,EAAsB,GAAbM,SAASU,GAEvDrB,EAAM4B,SAAS6C,IA1SEpM,KAmTnByK,UAAY,SAACT,EAAQrC,EAAOxB,EAAGC,GAAwB,IAArB6D,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAC/C+E,EAAQ,IAAInE,WAASC,MAEvB8B,GACFoC,EAAMjE,SAASgB,cAAc,CAAC,EAAG,GAAI,GAGvCiD,EAAMjE,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QACnE,IAAMV,GAAY5B,EAAI,IAAOmC,SAASU,EAAK,EACrChB,EAAUM,SAASS,EAAK3C,EAAIkC,SAASU,EAAK,EAGhD,OAAQgB,GACN,KAAKtE,EAAYC,MACjB,KAAKD,EAAYG,MACjB,KAAKH,EAAYI,KACjB,KAAKJ,EAAYE,KAEfyG,EAAMjE,SAASa,OAAOlB,EAASC,GAASkB,OAAOnB,EAASC,EAAUM,SAASU,GAC3E,MACF,KAAKtD,EAAYK,IACjB,KAAKL,EAAYM,OAEf,MACF,QACE,MAAM,IAAIsG,MAAJ,UAAAjN,OAAoB2K,EAApB,wBAGVrC,EAAM4B,SAAS8C,IA9UfrM,KAAK2H,MAAQA,GCCI4E,EACnB,SAAAA,EAAYC,EAAQ5H,GAAS,IAAA/B,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAuM,GAAAvM,KAe7B6H,KAAO,SAACmC,EAAQyC,GAA0C,IAA9BC,IAA8BpF,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,KAAAA,UAAA,GAExDzE,EAAK8E,MAAMgF,oBAGX,IAAM7E,EAAYjF,EAAK+B,QAAQgI,KAAKC,SAAS7C,EAAQyC,IACjD3E,GACFjF,EAAKiK,aAAajF,KAAKC,GAIrBjF,EAAKkK,iBACkBlK,EAAK+B,QAAQoI,OAAOC,oBAAoBjD,EAAQyC,GACxDtQ,QAAQ,SAAAuK,GAAC,OAAI7D,EAAKqK,eAAenD,UAAUC,EAAQtD,EAAGgG,KAIzE,IAAMS,EAAetK,EAAK+B,QAAQoI,OAAOH,SAAS7C,EAAQyC,GAC1D5J,EAAKqK,eAAenD,UAAUC,EAAQmD,GAGtCtK,EAAKqK,eAAexC,eAAeyC,GAGnCtK,EAAK8E,MAAMyF,UAvCgBpN,KA6C7BqN,sBAAwB,WAEtBxK,EAAK8E,MAAMgF,oBAEX,IAAMW,EAAYzK,EAAK+B,QAAQoI,OAAOC,oBAAoBvH,EAAYK,IAAKuC,SAASiF,MAEpFD,EAAUtR,UAIV,IADA,IAAMwR,EAActG,EAAgBoB,SAASmF,KAAMnF,SAASoF,KAAM,MATtCC,EAAA,SAUnBvH,GACP,IAX0B,IAAAwH,EAAA,SAWjBzH,GACP,IAAI0H,EAAS,KACbP,EAAUnR,QAAQ,SAAA6I,GAChB,IAAMkH,EAAMlH,EAAMoB,GAAGD,GACjB+F,IACF2B,EAAS3B,KAGbsB,EAAYpH,GAAGD,GAAK0H,GARb1H,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EAAGyH,EAAlCzH,IADFC,EAAI,EAAGA,EAAIkC,SAASoF,KAAMtH,GAAK,EAAGuH,EAAlCvH,GAaTvD,EAAKqK,eAAenD,UAAUrE,EAAYK,IAAKyH,GAG/C3K,EAAK8E,MAAMyF,UAvEgBpN,KA2E7BoN,OAAS,WACPvK,EAAK8E,MAAMyF,UA5EgBpN,KAgF7B8N,MAAQ,WACNjL,EAAK8E,MAAMgF,oBACX9J,EAAK8E,MAAMyF,UAlFgBpN,KAyF7B+N,eAAiB,SAAAjG,GACf,IAEIE,EAFEC,EAAO,IAAIC,WAASC,MACtBJ,EAAU,EAEdE,EAAKG,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QAGlEX,EAAU3L,QAAQ,SAAAuK,GAAK,IACbmC,EAA2BnC,EAA3BmC,YAAaC,EAAcpC,EAAdoC,UACrBd,EAAUM,SAASS,EAAI,EAAKF,EAAcP,SAASU,EACnDf,EAAKG,SAASa,OAAOlB,EAASC,GAC9BD,GAAWO,SAASU,EACpBhB,EAAUM,SAASS,EAAI,EAAKD,EAAYR,SAASU,EACjDf,EAAKG,SAASc,OAAOnB,EAASC,KAEhCC,EAAKG,SAASe,YAEdtG,EAAK8E,MAAM4B,SAAStB,IA1GOjI,KAmH7BgO,WAAa,SAAChE,EAAQhF,GAA4B,IAArBiF,EAAqB3C,UAAAzJ,OAAA,QAAA2G,IAAA8C,UAAA,IAAAA,UAAA,GAChDzE,EAAKmH,OAASA,EACd,IAAK,IAAI5D,EAAI,EAAGA,EAAIpB,EAAMnH,OAAQuI,GAAK,EAErC,IADA,IAAM8D,EAAMlF,EAAMoB,GACTD,EAAI,EAAGA,EAAI+D,EAAIrM,OAAQsI,GAAK,EAAG,CACtC,IAAMgE,EAAOD,EAAI/D,GAEbgE,GACFA,EAAK8D,OAAOjE,EAAQnH,EAAK8E,MAAOxB,EAAGC,EAAG6D,KA3HjBjK,KAqI7BkO,gBAAkB,SAAAlJ,GAChB,IAAK,IAAIoB,EAAI,EAAGA,EAAIpB,EAAMnH,OAAQuI,GAAK,EAErC,IADA,IAAM8D,EAAMlF,EAAMoB,GACTD,EAAI,EAAGA,EAAI+D,EAAIrM,OAAQsI,GAAK,EAAG,CACtC,IAAMwE,EAAQ,IAAIzC,WAASC,MACrByC,GAAYzE,EAAI,IAAOmC,SAASU,EAChC6B,EAAWvC,SAASS,GAAM3C,EAAI,IAAOkC,SAASU,EAEpD2B,EAAMvC,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,OAAS,GAAGqC,SAASF,EAAUC,EAAU,GAAI,GAChHhI,EAAK8E,MAAM4B,SAASoB,KA9IG3K,KAwJ7B+K,WAAa,SAAC5E,EAAGC,GACf,IAAM4E,EAAS,IAAI9C,WAASC,MAE5B6C,EAAO5C,SAASC,YAAYC,SAASC,OAAOC,eAAeF,SAASG,QACpE,IAAMV,GAAY5B,EAAI,IAAOmC,SAASU,EAAK,EACrChB,EAAUM,SAASS,GAAM3C,EAAI,KAAQkC,SAASU,EAAK,EACzDgC,EAAO5C,SAAS2C,WAAWhD,EAASC,EAAsB,GAAbM,SAASU,GAEtDnG,EAAK8E,MAAM4B,SAASyB,IA/JpBhL,KAAK4E,QAAUA,EACf5E,KAAK2H,MAAQ,IAAIO,WAASiG,MAAM3B,GAChCxM,KAAKkN,eAAiB,IAAIpD,EAAiB9J,KAAK2H,OAChD3H,KAAK8M,aAAe,IAAIpF,EAAe1H,KAAK2H,OAE5C3H,KAAK+M,gBAAiB,GCRXqB,EARK,CAClBC,KAAM,EACNC,KAAM,EACNC,MAAO,EACPC,QAAS,EACTC,OAAQ,GCEWC,EACnB,SAAAA,EAAY9J,EAAS+J,GAAY,IAAA9L,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA0O,GAAA1O,KAejC4O,YAAc,SAAAC,GAAI,OAAIhM,EAAKiM,MAAMzO,KAAKwO,IAfL7O,KAiBjC+O,eAAiB,SAAAC,GAAQ,OAAInM,EAAKiM,MAAMG,OAAO,SAAAJ,GAAI,OAAIA,IAASG,KAjB/BhP,KAmBjCkP,SAAW,SAAC9O,EAAQ+O,EAAQC,EAAQC,GAClC,IAAMC,EAAgBzM,EAAK0M,oBAAoBJ,EAAQC,GAEvD,OAAQhP,GACN,KAAKY,EAAYC,QACf4B,EAAK2M,gBACL,MACF,KAAKxO,EAAYE,OACf2B,EAAK4M,YACL,MACF,KAAKzO,EAAYG,QACf0B,EAAK6M,UAAUJ,EAAelB,EAAYC,MAC1C,MACF,KAAKrN,EAAYI,OACfyB,EAAK8M,aAAaL,GAClB,MACF,KAAKtO,EAAYK,SACfwB,EAAK+M,aACL,MACF,KAAK5O,EAAYO,QACfsB,EAAK6M,UAAUJ,EAAelB,EAAYG,OAC1C,MACF,KAAKvN,EAAYqB,cACfQ,EAAK6M,UAAUJ,EAAelB,EAAYE,KAAM,KAChD,MACF,KAAKtN,EAAYoB,cACfS,EAAK6M,UAAUJ,EAAelB,EAAYE,KAAM,KAChD,MACF,KAAKtN,EAAYQ,eACfqB,EAAK6M,UAAUJ,EAAelB,EAAYE,KAAM,KAChD,MACF,KAAKtN,EAAYS,eACfoB,EAAK6M,UAAUJ,EAAelB,EAAYE,KAAM,KAChD,MACF,KAAKtN,EAAY6O,SACfhN,EAAKiN,cAAcR,GACnB,MACF,KAAKtO,EAAYiB,WACfY,EAAKkN,WAAWlN,EAAK8L,WAAW3E,OAAQsF,EAAeD,EAAU7F,EAAaK,MAC9E,MACF,KAAK7I,EAAYc,cACfe,EAAKkN,WAAWlN,EAAK8L,WAAW3E,OAAQsF,EAAeD,EAAU7F,EAAaE,OAC9E,MACF,KAAK1I,EAAYgB,oBACfa,EAAKkN,WAAWlN,EAAK8L,WAAW3E,OAAQsF,EAAeD,EAAU7F,EAAaG,OAC9E,MACF,KAAK3I,EAAYe,kBACfc,EAAKkN,WAAWlN,EAAK8L,WAAW3E,OAAQsF,EAAeD,EAAU7F,EAAaI,QAlEnD5J,KAiFjC0P,UAAY,SAACJ,EAAeU,EAAQX,GAC9BC,IACFzM,EAAK+B,QAAQoI,OAAOiD,IAAID,EAAQV,EAAeD,GAC/CxM,EAAKqN,gBApFwBlQ,KA4FjC2P,aAAe,SAAAL,GACTA,IACFzM,EAAK+B,QAAQoI,OAAOmD,OAAOb,GAC3BzM,EAAKqN,gBA/FwBlQ,KAqGjC+P,WAAa,SAAC/F,EAAQxD,EAAU4J,EAAMC,GAChC7J,IACF3D,EAAK+B,QAAQoI,OAAO+C,WAAW/F,EAAQxD,EAAU4J,EAAMC,GACvDxN,EAAKqN,gBAxGwBlQ,KAsIjCyP,UAAY,WACV,OAAQ5M,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACf9C,EAAKyN,eAAezN,EAAK8L,WAAW4B,OAAOnK,EAAI,GAC/C,MACF,KAAKV,EAAYG,MACfhD,EAAKyN,eAAezN,EAAK8L,WAAW4B,OAAOnK,EAAI,GAC/C,MACF,KAAKV,EAAYE,KACf/C,EAAK2N,eAAe3N,EAAK8L,WAAW4B,OAAOpK,EAAI,GAC/C,MACF,KAAKT,EAAYI,KACfjD,EAAK2N,eAAe3N,EAAK8L,WAAW4B,OAAOpK,EAAI,GAC/C,MACF,KAAKT,EAAYK,IACflD,EAAK4N,eAAe5N,EAAK8L,WAAW4B,OAAOjK,EAAI,GAC/C,MACF,KAAKZ,EAAYM,OACfnD,EAAK4N,eAAe5N,EAAK8L,WAAW4B,OAAOjK,EAAI,GAC/C,MACF,QACE,MAAM,IAAIgG,MAAJ,UAAAjN,OAAoBwD,EAAK8L,WAAW3E,OAApC,0BA3JqBhK,KAgKjCwP,cAAgB,WACd,OAAQ3M,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACf9C,EAAKyN,eAAezN,EAAK8L,WAAW4B,OAAOnK,EAAI,GAC/C,MACF,KAAKV,EAAYG,MACfhD,EAAKyN,eAAezN,EAAK8L,WAAW4B,OAAOnK,EAAI,GAC/C,MACF,KAAKV,EAAYE,KACf/C,EAAK2N,eAAe3N,EAAK8L,WAAW4B,OAAOpK,EAAI,GAC/C,MACF,KAAKT,EAAYI,KACfjD,EAAK2N,eAAe3N,EAAK8L,WAAW4B,OAAOpK,EAAI,GAC/C,MACF,KAAKT,EAAYK,IACflD,EAAK4N,eAAe5N,EAAK8L,WAAW4B,OAAOjK,EAAI,GAC/C,MACF,KAAKZ,EAAYM,OACfnD,EAAK4N,eAAe5N,EAAK8L,WAAW4B,OAAOjK,EAAI,GAC/C,MACF,QACE,MAAM,IAAIgG,MAAJ,UAAAjN,OAAoBwD,EAAK8L,WAAW3E,OAApC,0BArLqBhK,KA0LjC0Q,MAAQ,kBAAM7N,EAAK8N,WAAW,UA1LG3Q,KA6LjC4Q,MAAQ,kBAAM/N,EAAK8N,WAAW,UA7LG3Q,KAgMjC6Q,KAAO,kBAAMhO,EAAK8N,WAAW,SAhMI3Q,KAmMjC8Q,KAAO,kBAAMjO,EAAK8N,WAAW,SAnMI3Q,KAsMjC+Q,IAAM,kBAAMlO,EAAK8N,WAAW,QAtMK3Q,KAyMjCgR,OAAS,kBAAMnO,EAAK8N,WAAW,WAzME3Q,KA2MjC4P,WAAa,WACX,OAAQ/M,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACf9C,EAAK8N,WAAW,QAChB,MACF,KAAKjL,EAAYE,KACf/C,EAAK8N,WAAW,SAChB,MACF,KAAKjL,EAAYG,MACfhD,EAAK8N,WAAW,QAChB,MACF,KAAKjL,EAAYI,KACfjD,EAAK8N,WAAW,WAvNW3Q,KA8NjCiR,YAAc,WACZ,OAAQpO,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACf9C,EAAK8N,WAAW,QAChB,MACF,KAAKjL,EAAYI,KACfjD,EAAK8N,WAAW,SAChB,MACF,KAAKjL,EAAYG,MACfhD,EAAK8N,WAAW,QAChB,MACF,KAAKjL,EAAYE,KACf/C,EAAK8N,WAAW,WA1OW3Q,KAqPjCyQ,eAAiB,SAAAzL,GACXA,GAAS,GAAKA,EAAQnC,EAAK0K,OAC7B1K,EAAK8L,WAAW4B,OAAOjK,EAAItB,EAC3BnC,EAAKqN,gBAxPwBlQ,KAgQjCwQ,eAAiB,SAAAxL,GACXA,GAAS,GAAKA,EAAQnC,EAAK4K,OAC7B5K,EAAK8L,WAAW4B,OAAOpK,EAAInB,EAC3BnC,EAAKqN,gBAnQwBlQ,KA2QjCsQ,eAAiB,SAAAtL,GACXA,GAAS,GAAKA,EAAQnC,EAAK6K,OAC7B7K,EAAK8L,WAAW4B,OAAOnK,EAAIpB,EAC3BnC,EAAKqN,gBA9QwBlQ,KAsRjC2Q,WAAa,SAAA3G,GACXnH,EAAK8L,WAAW3E,OAAStE,EAAYsE,GACrCnH,EAAKqN,eAxR0BlQ,KA4RjCkQ,YAAc,WACZ,IAAIzD,EACJ,OAAQ5J,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACjB,KAAKD,EAAYG,MACf4G,EAAa5J,EAAK8L,WAAW4B,OAAOnK,EACpC,MACF,KAAKV,EAAYE,KACjB,KAAKF,EAAYI,KACf2G,EAAa5J,EAAK8L,WAAW4B,OAAOpK,EACpC,MACF,KAAKT,EAAYK,IACjB,KAAKL,EAAYM,OACfyG,EAAa5J,EAAK8L,WAAW4B,OAAOjK,EACpC,MACF,QACE,MAAM,IAAIgG,MAAJ,UAAAjN,OAAoBwD,EAAK8L,WAAW3E,OAApC,wBAGVnH,EAAKiM,MAAM3S,QAAQ,SAAA+U,GAAC,OAAIA,EAAErJ,KAAKhF,EAAK8L,WAAW3E,OAAQyC,EAAY5J,EAAK6J,uBA/SzC1M,KAuTjCuP,oBAAsB,SAACpJ,EAAGC,GAExB,OAAQvD,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACjB,KAAKD,EAAYG,MACjB,KAAKH,EAAYE,KACjB,KAAKF,EAAYI,KACf,GAAIM,GAAKvD,EAAK0K,KACZ,OAAO,KAQb,OAAQ1K,EAAK8L,WAAW3E,QACtB,KAAKtE,EAAYC,MACf,MAAO,CAAEQ,IAAGC,EAAGvD,EAAK8L,WAAW4B,OAAOnK,EAAGE,EAAGF,GAC9C,KAAKV,EAAYG,MACf,MAAO,CAAEM,EAAGtD,EAAKsO,SAAW,EAAIhL,EAAGC,EAAGvD,EAAK8L,WAAW4B,OAAOnK,EAAGE,EAAGF,GACrE,KAAKV,EAAYE,KACf,MAAO,CAAEO,EAAGtD,EAAK8L,WAAW4B,OAAOpK,EAAGC,EAAGvD,EAAKsO,SAAW,EAAIhL,EAAGG,EAAGF,GACrE,KAAKV,EAAYI,KACf,MAAO,CAAEK,EAAGtD,EAAK8L,WAAW4B,OAAOpK,EAAGC,EAAGD,EAAGG,EAAGF,GACjD,KAAKV,EAAYM,OACf,MAAO,CAAEG,IAAGC,EAAGvD,EAAKsO,SAAW,EAAI/K,EAAGE,EAAGzD,EAAK8L,WAAW4B,OAAOjK,GAClE,KAAKZ,EAAYK,IACf,MAAO,CAAEI,IAAGC,IAAGE,EAAGzD,EAAK8L,WAAW4B,OAAOjK,GAC3C,QACE,MAAM,IAAIgG,MAAJ,UAAAjN,OAAoBwD,EAAK8L,WAAW3E,OAApC,0BApVVhK,KAAK4E,QAAUA,EAEf5E,KAAKmR,SAAW7I,SAAS6I,SACzBnR,KAAKyN,KAAOnF,SAASmF,KACrBzN,KAAK0N,KAAOpF,SAASoF,KACrB1N,KAAKuN,KAAOjF,SAASiF,KAErBvN,KAAK2O,WAAaA,EAClB3O,KAAK8O,MAAQ,GACb9O,KAAK0M,oBAAqB,EAE1B1M,KAAKkQ,eCNF,SAASkB,EAAyBjL,EAAGC,GAAG,IAAAiL,EAC5B/I,SAAT7B,EADqC4K,EACrC5K,EAAGsC,EADkCsI,EAClCtI,EAGX,OAAU,IAAN5C,GAAWA,IAAOM,EAAI,GACb,IAANL,GAAWA,IAAO2C,EAAI,EACpB,KAdJ,SAA6BoG,EAAQC,GAAQ,IAE1C+B,EAAa7I,SAAb6I,SAGR,MAAO,CAAEhL,EAFCmL,KAAKC,MAAMpC,EAASgC,GAElB/K,EADF+K,EAAW,EAAIG,KAAKC,MAAMnC,EAAS+B,IAgB/B5B,EAFOpJ,EAAI,GAAKM,GACTL,EAAI,GAAK2C,OCdXyI,6MAMnB/O,MAAQ,CACNgP,WAAY,QA4BdC,KAAO,WAAM,IAAA3R,EACqB8C,EAAK5C,MAA7B2E,EADG7E,EACH6E,QAAS+J,EADN5O,EACM4O,WAEjB,IAAI9L,EAAK8O,SAAY/M,EAArB,CAGA/B,EAAK8O,SAAU,EAGf,IAAMF,EAAa,IAAI/C,EAAoB9J,EAAS+J,GACpD9L,EAAKgM,KAAO,IAAItC,EAAc1J,EAAK2J,OAAQ5H,GAC3C6M,EAAW7C,YAAY/L,EAAKgM,MAE5B4C,EAAWvB,cAEXrN,EAAKK,SAAS,CACZuO,mBAKJ/O,cAAgB,SAAAC,GAAS,IACf8O,EAAe5O,EAAKJ,MAApBgP,WAGR,GADmB5O,EAAK5C,MAAhBG,SACOY,EAAYW,iBAI3B,OAAQgB,EAAMC,SACZ,KAAK,GACH6O,EAAWb,QACX,MACF,KAAK,GACHa,EAAWf,QACX,MACF,KAAK,GACHe,EAAWZ,OACX,MACF,KAAK,GACHY,EAAWX,OACX,MACF,KAAK,GACHW,EAAWV,MACX,MACF,KAAK,GACHU,EAAWT,SACX,MACF,KAAK,GACHS,EAAWhC,YACX,MACF,KAAK,GACHgC,EAAWjC,oBAOjBoC,YAAc,SAAAjP,GAAS,IACb8O,EAAe5O,EAAKJ,MAApBgP,WACArR,EAAWyC,EAAK5C,MAAhBG,OACR1B,QAAQC,IAAIyB,GACZ,IAAMuK,EAAQyG,EAAyBzO,EAAMkP,QAASlP,EAAMmP,SACvDnH,GAGL8G,EAAWvC,SAAS9O,EAAQuK,EAAMxE,EAAGwE,EAAMvE,uFA3F3CpG,KAAK2R,SAAU,EAEf3R,KAAKwM,OAASnJ,SAASC,eAAe,QACtCD,SAASE,iBAAiB,UAAWvD,KAAK0C,eAC1C1C,KAAKwM,OAAOjJ,iBAAiB,YAAavD,KAAK4R,aAG/C5R,KAAK0R,oDAKL1R,KAAK0R,sDAILrO,SAASI,oBAAoB,UAAWzD,KAAK0C,eAC7C1C,KAAKwM,OAAO/I,oBAAoB,YAAazD,KAAK4R,8CA6E3C,IAAAG,EACUzJ,SAAT7B,EADDsL,EACCtL,EAAGsC,EADJgJ,EACIhJ,EAEX,OACEzI,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UAAQK,GAAG,OAAOmR,MAAOvL,EAAG3J,OAAQiM,YA9GVjI,IAAMmR,WCPnBC,EACnB,SAAAA,EAAYvK,GAAO,IAAA9E,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAkS,GAAAlS,KAOnBmS,WAAa,SAAChM,EAAGC,EAAGgM,GAClB,IAAM5G,EAAQ,IAAItD,WAASC,MAC3BqD,EAAMpD,SAASC,YAAYC,SAASC,OAAOC,eAAe,GAE1D,IAAMiD,EAAMtF,EAAImC,SAASU,EAAK,EACxB0C,EAAKpD,SAASU,EACd2C,EAAKrD,SAASS,EAAK3C,EAAIkC,SAASU,EAAK,EACrC4C,GAAMtD,SAASU,EAErBwC,EAAMpD,SAAS0C,SAASW,EAAIE,EAAID,EAAIE,GACpC/I,EAAK8E,MAAM4B,SAASiC,GAEpB,IAAM/M,EAAO,IAAIyJ,WAASmK,KAAKD,EAAK,wBAAyB9J,SAASC,OACtE9J,EAAK0H,EAAIsF,EAAMC,EAAK,EAAK,EACzBjN,EAAK2H,EAAIuF,EAAMC,EAAK,EAAK,EACzB/I,EAAK8E,MAAM4B,SAAS9K,IArBpBuB,KAAK2H,MAAQA,GCAI2K,EACnB,SAAAA,EAAY9F,EAAQ5H,GAAS,IAAA/B,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAsS,GAAAtS,KAa7B6H,KAAO,WAELhF,EAAK8E,MAAMgF,oBAEX,IAAK,IAAIvG,EAAI,EAAGA,EAAIkC,SAASoF,KAAMtH,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EACtCtD,EAAK0P,SAASJ,WAAWhM,EAAGC,EAAGvD,EAAK+B,QAAQgI,KAAK4F,MAAM,CAAErM,IAAGC,OAKhEvD,EAAK8E,MAAMyF,UAvBXpN,KAAK4E,QAAUA,EACf5E,KAAK2H,MAAQ,IAAIO,WAASiG,MAAM3B,GAEhCxM,KAAKuS,SAAW,IAAIL,EAAmBlS,KAAK2H,QCD3B8K,6MA6BnBf,KAAO,WAAM,IACH9M,EAAY/B,EAAK5C,MAAjB2E,SAEJ/B,EAAK8O,SAAY/M,IAGrB/B,EAAK8O,SAAU,EAEf9O,EAAKgM,KAAO,IAAIyD,EAASzP,EAAK2J,OAAQ5H,GAEtC/B,EAAKgM,KAAKhH,WAGZ+J,YAAc,SAAAjP,GAAS,IAAA5C,EACO8C,EAAK5C,MAAzB2E,EADa7E,EACb6E,QAASxE,EADIL,EACJK,OACXuK,EAAQyG,EAAyBzO,EAAMkP,QAASlP,EAAMmP,SACvDnH,IAIDvK,IAAWY,EAAYa,gBACzB+C,EAAQgI,KAAK8F,SAAS/H,GAEtB/F,EAAQgI,KAAK+F,SAAShI,GAExB9H,EAAKgM,KAAKhH,4FA/CV7H,KAAK2R,SAAU,EAEf3R,KAAKwM,OAASnJ,SAASC,eAAe,WACtCtD,KAAKwM,OAAOjJ,iBAAiB,YAAavD,KAAK4R,aAG/C5R,KAAK0R,oDAKL1R,KAAK0R,sDAIL1R,KAAKwM,OAAO/I,oBAAoB,YAAazD,KAAK4R,8CAmC3C,IAAAG,EACUzJ,SAAT7B,EADDsL,EACCtL,EAAGsC,EADJgJ,EACIhJ,EACX,OACEzI,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UAAQK,GAAG,UAAUmR,MAAOvL,EAAG3J,OAAQiM,YA7DbjI,IAAMmR,WCDnBW,6MAMnBnQ,MAAQ,CACNgP,WAAY,QA4BdC,KAAO,WAAM,IAAA3R,EACqB8C,EAAK5C,MAA7B2E,EADG7E,EACH6E,QAAS+J,EADN5O,EACM4O,WAEjB,IAAI9L,EAAK8O,SAAY/M,EAArB,CAGA/B,EAAK8O,SAAU,EAGf,IAAMF,EAAa,IAAI/C,EAAoB9J,EAAS+J,GACpD9L,EAAKgM,KAAO,IAAItC,EAAc1J,EAAK2J,OAAQ5H,GAC3C6M,EAAW7C,YAAY/L,EAAKgM,MAE5B4C,EAAWvB,cAEXrN,EAAKK,SAAS,CACZuO,mBAKJ/O,cAAgB,SAAAC,GAAS,IACf8O,EAAe5O,EAAKJ,MAApBgP,WAER,OAAQ9O,EAAMC,SACZ,KAAK,GACH6O,EAAWb,QACX,MACF,KAAK,GACHa,EAAWf,QACX,MACF,KAAK,GACHe,EAAWZ,OACX,MACF,KAAK,GACHY,EAAWX,OACX,MACF,KAAK,GACHW,EAAWV,MACX,MACF,KAAK,GACHU,EAAWT,SACX,MACF,KAAK,GACHS,EAAWhC,YACX,MACF,KAAK,GACHgC,EAAWjC,oBAOjBoC,YAAc,SAAAjP,GAAS,IACb8O,EAAe5O,EAAKJ,MAApBgP,WACArR,EAAWyC,EAAK5C,MAAhBG,OAEFyS,ELvEH,SAAoC1D,EAAQC,GAAQ,IAAA0D,EAC9BxK,SAAnB7B,EADiDqM,EACjDrM,EAAGsC,EAD8C+J,EAC9C/J,EAAGoI,EAD2C2B,EAC3C3B,SAGd,GAAe,IAAXhC,GAAgBA,IAAY1I,EAAI,GAClB,IAAX2I,GAAgBA,IAAYrG,EAAI,EACrC,OAAO,KAIT,IAWIqH,EAVE2C,GAAe3D,EAAS,GAAKrG,EAE7B5C,GAHegJ,EAAS,GAAK1I,EAGX0K,EAClB6B,EAAS1B,KAAKC,MAAMpL,GACpB8M,EAAa9M,EAAI6M,EAEjB5M,EAAI+K,EAAY4B,EAAc5B,EAC9B+B,EAAS5B,KAAKC,MAAMnL,GACpB+M,EAAa/M,EAAI8M,EAGjBE,EAAQ,EAAID,EACZE,EAAQF,EACRG,EAAQL,EACRM,EAAQ,EAAIN,EACZO,EAAMlC,KAAKmC,IAAIL,EAAOC,EAAOC,EAAOC,GAW1C,OAVIH,IAAUI,EACZpD,EAAO,IACEiD,IAAUG,EACnBpD,EAAO,IACEkD,IAAUE,EACnBpD,EAAO,IACEmD,IAAUC,IACnBpD,EAAO,KAGF,CAAEjK,EAAG6M,EAAQ5M,EAAG8M,EAAQ9C,QKkChBsD,CAA2B/Q,EAAMkP,QAASlP,EAAMmP,SAC7D,GAAKe,EAAL,CALqB,IASb1M,EAAe0M,EAAf1M,EAAGC,EAAYyM,EAAZzM,EAAGgK,EAASyC,EAATzC,KACdqB,EAAWvC,SAAS9O,EAAQ+F,EAAGC,EAAGgK,wFAxFlCpQ,KAAK2R,SAAU,EAEf3R,KAAKwM,OAASnJ,SAASC,eAAe,WACtCD,SAASE,iBAAiB,UAAWvD,KAAK0C,eAC1C1C,KAAKwM,OAAOjJ,iBAAiB,QAASvD,KAAK4R,aAG3C5R,KAAK0R,oDAKL1R,KAAK0R,sDAILrO,SAASI,oBAAoB,UAAWzD,KAAK0C,eAC7C1C,KAAKwM,OAAO/I,oBAAoB,QAASzD,KAAK4R,8CA0EvC,IAAAG,EACUzJ,SAAT7B,EADDsL,EACCtL,EAAGsC,EADJgJ,EACIhJ,EACX,OACEzI,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UAAQK,GAAG,UAAUmR,MAAOvL,EAAG3J,OAAQiM,YA1GVjI,IAAMmR,WCTtB0B,EACnB,SAAAA,EAAY/O,EAASgP,GAAkB,IAAA/Q,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA2T,GAAA3T,KAMvC4O,YAAc,SAAAC,GAAI,OAAIhM,EAAKiM,MAAMzO,KAAKwO,IANC7O,KAQvC+O,eAAiB,SAAAC,GAAQ,OAAInM,EAAKiM,MAAMG,OAAO,SAAAJ,GAAI,OAAIA,IAASG,KARzBhP,KAUvC6T,IAAM,SAAAC,GACJjR,EAAKiR,KAAOA,EACZjR,EAAK/E,EAAI,EAGTqH,WAAW,kBAAMtC,EAAKkR,qBAAqB,MAfN/T,KAmBvC+T,kBAAoB,WAClB,GAAIlR,EAAK/E,EAAI+E,EAAKiR,KAAKjW,OAAS,EAAG,CACjCgF,EAAK/E,GAAK,EACV,IAAMkW,EAAInR,EAAKiR,KAAKjR,EAAK/E,GACnBmW,EAAQpR,EAAKiR,KAAKjR,EAAK/E,EAAI,GACjC+E,EAAKiM,MAAM3S,QAAQ,SAAA+U,GAAC,OAAIA,EAAEgD,kBAAkBF,EAAGC,KAC/C9O,WAAW,kBAAMtC,EAAKkR,qBAAqB,UAE3ClR,EAAK+Q,oBA1BP5T,KAAK4E,QAAUA,EACf5E,KAAK8O,MAAQ,GACb9O,KAAK4T,iBAAmBA,GCCPO,mDACnBtM,KAAO,SAACuM,EAAOC,EAAS1F,GACtB,GAAK0F,EAML,IADA,IAAMC,EAAkBpN,EAAgBoB,SAASmF,KAAO,EAAGnF,SAASoF,KAAO,EAAG,MACrEtH,EAAI,EAAGA,GAAKkC,SAASoF,KAAMtH,GAAK,EACvC,IAAK,IAAID,EAAI,EAAGA,GAAKmC,SAASmF,KAAMtH,GAAK,EAAG,CAC1C,IAAMoO,EAAc,CAAEpO,IAAGC,IAAGE,EAAG+N,EAAQjO,GAAGD,GAAK,IACzCqO,EAAsB3R,EAAK4R,kBAAkBF,GAEnDC,EAAoBlO,GAAK,GACzBgO,EAAgBlO,GAAGD,GAAKqO,EAGxB,IAAIE,GAAO,EAcX,GAbI/F,IACEA,EAAW3E,SAAWtE,EAAYC,OAASgJ,EAAW3E,SAAWtE,EAAYG,MAC3E8I,EAAW4B,OAAOnK,IAAMA,EAAI,IAC9BsO,GAAO,GAEA/F,EAAW3E,SAAWtE,EAAYI,MAAQ6I,EAAW3E,SAAWtE,EAAYE,MACjF+I,EAAW4B,OAAOpK,IAAMA,EAAI,IAC9BuO,GAAO,IAMTtO,EAAI,EAAG,CACT,IAAMuO,EAAYL,EAAgBlO,EAAI,GAAGD,GACzCtD,EAAK+R,SAASR,EAAOI,EAAqBG,EAAWD,GAEvD,GAAIvO,EAAI,EAAG,CACT,IAAM0O,EAAYP,EAAgBlO,GAAGD,EAAI,GACzCtD,EAAK+R,SAASR,EAAOI,EAAqBK,EAAWH,WAM7DE,SAAW,SAACR,EAAOU,EAAIC,EAAIL,GACzB,IAGIzM,EAHE+M,EAAW,IAAIC,IACrBD,EAASE,SAAS7U,KAAK,IAAI4U,IAAcH,EAAG3O,EAAG2O,EAAG1O,EAAG0O,EAAGxO,IACxD0O,EAASE,SAAS7U,KAAK,IAAI4U,IAAcF,EAAG5O,EAAG4O,EAAG3O,EAAG2O,EAAGzO,IAGtD2B,EADEyM,EACK,IAAIO,IAAWD,EAAU,IAAIC,IAAwB,CAAE1M,MAAO,SAE9D,IAAI0M,IAAWD,EAAU1M,SAAS6M,UAG3Cf,EAAMnE,IAAIhI,SAOZwM,kBAAoB,SAAAT,GAAK,IACf7N,EAAY6N,EAAZ7N,EAAGC,EAAS4N,EAAT5N,EAAGE,EAAM0N,EAAN1N,EACd,MAAO,CAAEH,EAAGA,EAAImC,SAASU,EAAG5C,EAAGE,EAAIgC,SAASU,EAAKV,SAASU,EAAI,EAAI1C,GAAIF,EAAIkC,SAASU,KC8JxEoM,mDA7NbvN,KAAO,SAACuM,EAAOiB,GACb,GAAKA,EAIL,IAAK,IAAI/O,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIF,EAAI,EAAGA,EAAIkC,SAASoF,KAAMtH,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EAAG,CACzC,IAAM6J,EAASqF,EAAQ/O,GAAGF,GAAGD,GACvBK,EAAW,CAAEL,IAAGC,IAAGE,KACzB,GAAI0J,EACF,OAAQA,EAAO5F,YAAYC,MACzB,IAAK,OACHxH,EAAKyH,SAAS8J,EAAOpE,EAAQxJ,GAC7B,MACF,IAAK,OACH3D,EAAK0H,SAAS6J,EAAOpE,EAAQxJ,GAC7B,MACF,IAAK,UACH3D,EAAK2H,YAAY4J,EAAO5N,GACxB,MACF,IAAK,QACH3D,EAAK4H,UAAU2J,EAAO5N,WAWpC8D,SAAW,SAAC8J,EAAOnJ,EAAMzE,GACvB,IAAM8O,EAAQzS,EAAK0S,cAActK,GAE3BuK,EAAc,CAAErP,EAAGK,EAASL,EAAImC,SAASU,EAAG5C,EAAGI,EAASF,EAAIgC,SAASU,EAAG1C,GAAIE,EAASJ,EAAIkC,SAASU,GAExGsM,EAAM9O,SAASL,EAAIqP,EAAYrP,EAC/BmP,EAAM9O,SAASJ,EAAIoP,EAAYpP,EAC/BkP,EAAM9O,SAASF,EAAIkP,EAAYlP,EAC/B8N,EAAMnE,IAAIqF,SAGZC,cAAgB,SAAAtK,GACd,IAAM+J,EAAW,IAAIC,IAmFrB,OAjFIhK,EAAKK,SAAS3E,IAAM6C,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,IAGjCiC,EAAKK,SAAS1E,IAAM4C,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG,EAAG,GACxB,IAAIA,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc,EAAG,EAAG,IAGxBhK,EAAKK,SAASnQ,IAAMqO,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,IAGlCiC,EAAKK,SAAS5E,IAAM8C,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG,EAAG,GACxB,IAAIA,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG,EAAG,IAGxBhK,EAAKK,SAAS5K,IAAM8I,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,GAAIV,SAASU,GACpD,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAG,EAAG,IAGjCiC,EAAKK,SAAS7E,IAAM+C,EAAaE,OACnCsL,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG,EAAG,GACxB,IAAIA,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG3M,SAASU,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc,EAAG,EAAG,IAId,IAAIA,IAAmBD,EAAU1M,SAAS6M,gBAK1D5K,SAAW,SAAC6J,EAAOvI,EAAMrF,GACvB,IAAM8O,EAAQzS,EAAK4S,SAAS5J,GAEtB2J,EAAc,CAAErP,EAAGK,EAASL,EAAImC,SAASU,EAAG5C,EAAGI,EAASF,EAAIgC,SAASU,EAAG1C,GAAIE,EAASJ,EAAIkC,SAASU,GAExG,OAAQ6C,EAAKC,WACX,IAAK,IACH,MACF,IAAK,IACHwJ,EAAMI,SAAStP,EAAc,IAAVkL,KAAKqE,GACxBH,EAAYlP,GAAKgC,SAASU,EAC1B,MACF,IAAK,IACHsM,EAAMI,SAAStP,EAAIkL,KAAKqE,GACxBH,EAAYrP,GAAKmC,SAASU,EAC1BwM,EAAYlP,GAAKgC,SAASU,EAC1B,MACF,IAAK,IACHsM,EAAMI,SAAStP,EAAc,GAAVkL,KAAKqE,GACxBH,EAAYrP,GAAKmC,SAASU,EAC1B,MACF,QACE,OAEJsM,EAAM9O,SAASL,EAAIqP,EAAYrP,EAC/BmP,EAAM9O,SAASJ,EAAIoP,EAAYpP,EAC/BkP,EAAM9O,SAASF,EAAIkP,EAAYlP,EAC/B8N,EAAMnE,IAAIqF,SAGZG,SAAW,SAAA5J,GACT,IAAMmJ,EAAW,IAAIC,IA4BrB,OA1BIpJ,EAAKM,gBACP6I,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG,EAAG,GACxB,IAAIA,IAAc,EAAG,EAAG,GACxB,IAAIA,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAG,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,IAI9CgM,EAASE,SAAS7U,KAEhB,IAAI4U,IAAc,EAAG,GAAI3M,SAASU,GAClC,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc,EAAG3M,SAASU,EAAG,GACjC,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAGV,SAASU,EAAG,GAC1C,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc3M,SAASU,EAAG,GAAIV,SAASU,GAC3C,IAAIiM,IAAc,EAAG,GAAI3M,SAASU,IAGtB,IAAIiM,IAAmBD,EAAU1M,SAAS6M,gBAK1D3K,YAAc,SAAC4J,EAAOwB,GAAW,IACvBzP,EAAYyP,EAAZzP,EAAGC,EAASwP,EAATxP,EAAGE,EAAMsP,EAANtP,EACR0O,EAAW,IAAIC,IAAqB3M,SAASU,EAAI,EAAG,EAAG,GACvD6M,EAAY,IAAIZ,IAAoBD,GACpCM,EAAQ,IAAIL,IAAmBY,EAAWvN,SAAS6M,UACnD3O,EAAgBL,EAAImC,SAASU,EAA7BxC,EAAmCF,EAAIgC,SAASU,EAAhDxC,GAAuDJ,EAAIkC,SAASU,EAC1EsM,EAAM9O,SAASL,EAAIK,EAAc8B,SAASU,EAAI,EAC9CsM,EAAM9O,SAASJ,EAAII,EAAc8B,SAASU,EAAI,EAC9CsM,EAAM9O,SAASF,EAAIE,EAAc8B,SAASU,EAAI,EAC9CoL,EAAMnE,IAAIqF,SAGZ7K,UAAY,SAAC2J,EAAOwB,GAAW,IACrBzP,EAAYyP,EAAZzP,EAAGC,EAASwP,EAATxP,EAAGE,EAAMsP,EAANtP,EACRE,EAAW,CAAEL,GAAIA,EAAI,IAAOmC,SAASU,EAAG5C,EAAGE,EAAIgC,SAASU,EAAG1C,IAAKF,EAAI,IAAOkC,SAASU,GACpF8M,EAAY,CAAE3P,EAAGK,EAASL,EAAGC,EAAGI,EAASJ,EAAIkC,SAASU,EAAG1C,EAAGE,EAASF,GAC3EzD,EAAK+R,SAASR,EAAO5N,EAAUsP,SAGjClB,SAAW,SAACR,EAAOU,EAAIC,GACrB,IAAMC,EAAW,IAAIC,IACrBD,EAASE,SAAS7U,KAAK,IAAI4U,IAAcH,EAAG3O,EAAG2O,EAAG1O,EAAG0O,EAAGxO,IACxD0O,EAASE,SAAS7U,KAAK,IAAI4U,IAAcF,EAAG5O,EAAG4O,EAAG3O,EAAG2O,EAAGzO,IACxD,IAAM2B,EAAO,IAAIgN,IAAWD,EAAU1M,SAAS6M,UAC/Cf,EAAMnE,IAAIhI,KCtNO8N,EACnB,SAAAA,EAAYxR,EAAWK,EAAS+J,GAAY,IAAA9L,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA+V,GAAA/V,KAsB5C6H,KAAO,WACL,KAAOhF,EAAKuR,MAAM4B,SAASnY,OAAS,GAClCgF,EAAKuR,MAAMjE,OAAOtN,EAAKuR,MAAM4B,SAAS,IAGxCnT,EAAKoT,iBAAmB,IAAIb,EAC5B,IAAMpI,EAASnK,EAAK+B,QAAQoI,OAAOkJ,SACnCrT,EAAKoT,iBAAiBpO,KAAKhF,EAAKuR,MAAOpH,GAEvCnK,EAAKsT,eAAiB,IAAIhC,EAC1B,IAAMiC,EAAcvT,EAAK+B,QAAQgI,KAAKyJ,aACtCxT,EAAKsT,eAAetO,KAAKhF,EAAKuR,MAAOgC,EAAavT,EAAK8L,aAjCb3O,KAoC5CsW,OAAS,WACPzT,EAAKgF,OACLhF,EAAK0P,SAAS+D,OAAOzT,EAAKuR,MAAOvR,EAAKmH,SAtCIhK,KA8C5CkU,kBAAoB,SAACF,EAAGC,GACtBpR,EAAK0T,aAAc,EADa,IAAAC,EAEZ3T,EAAK4T,iBAAiBzC,GAAlC7N,EAFwBqQ,EAExBrQ,EAAGC,EAFqBoQ,EAErBpQ,EAAGE,EAFkBkQ,EAElBlQ,EACdzD,EAAKmH,OAAOxD,SAASL,EAAIA,EACzBtD,EAAKmH,OAAOxD,SAASJ,EAAIA,EACzBvD,EAAKmH,OAAOxD,SAASF,EAAIA,EAGzB,IAAMoQ,EAAK7T,EAAK4T,iBAAiBxC,GACjCpR,EAAKmH,OAAO2M,OAAOD,EAAGvQ,EAAGuQ,EAAGtQ,EAAGsQ,EAAGpQ,GAClCzD,EAAKyT,UAxDqCtW,KA+D5CyW,iBAAmB,SAAAzC,GAAK,IACd7N,EAAY6N,EAAZ7N,EAAGC,EAAS4N,EAAT5N,EAAGE,EAAM0N,EAAN1N,EACd,MAAO,CAAEH,EAAGA,EAAImC,SAASU,EAAG5C,EAAGE,EAAIgC,SAASU,EAAKV,SAASU,EAAI,EAAI1C,GAAIF,EAAIkC,SAASU,IAhEnFhJ,KAAKuE,UAAYA,EACjBvE,KAAKiD,OAAS,KACdjD,KAAK4E,QAAUA,EAGf5E,KAAKuW,aAAc,EAGnBvW,KAAKoU,MAAQ,IAAIa,IACjBjV,KAAKoU,MAAMwC,WAAa,IAAI3B,IAAY,GACxCjV,KAAKgK,OAAS,IAAIiL,IAAwB,GAAI3M,SAAS7B,EAAI6B,SAASS,EAAG,EAAG,KAC1E/I,KAAKoU,MAAMnE,IAAIjQ,KAAKgK,QACpBhK,KAAKuS,SAAW,IAAI0C,IAAoB,CAAE4B,WAAW,IACrD7W,KAAKuS,SAASuE,cAAc,IAC5B9W,KAAKuS,SAASwE,QAAQzO,SAAS7B,EAAG6B,SAASS,GAC3C/I,KAAKuE,UAAUyS,YAAYhX,KAAKuS,SAAS0E,YACzCjX,KAAK2O,WAAaA,EAElB3O,KAAK6H,QCpBYqP,6MA+BnBxF,KAAO,WAAM,IAAA3R,EACiC8C,EAAK5C,MAAzC2E,EADG7E,EACH6E,QAASkP,EADN/T,EACM+T,KAAMF,EADZ7T,EACY6T,kBACnB/Q,EAAK8O,SAAY/M,GAAYkP,IAGjCjR,EAAK8O,SAAU,EAEf9O,EAAK4O,WAAa,IAAIkC,EAAqB/O,EAASgP,GACpD/Q,EAAKgM,KAAO,IAAIkH,EAAelT,EAAK0B,UAAWK,GAC/C/B,EAAK4O,WAAW7C,YAAY/L,EAAKgM,UAGnCgF,IAAM,SAAAC,GACJjR,EAAK4O,WAAWoC,IAAIC,uFApCpB9T,KAAK2R,SAAU,EAEf3R,KAAKuE,UAAYlB,SAASC,eAAe,aAGzCtD,KAAK0R,OANa,IAQVoC,EAAS9T,KAAKC,MAAd6T,KACR9T,KAAK6T,IAAIC,gDAKT9T,KAAK0R,OAFc,IAIXoC,EAAS9T,KAAKC,MAAd6T,KACR9T,KAAK6T,IAAIC,oCAuBF,IAAA/B,EACUzJ,SAAT7B,EADDsL,EACCtL,EAAGsC,EADJgJ,EACIhJ,EAEX,OACEzI,EAAAC,EAAAC,cAAA,OAAKK,GAAG,YAAYD,MAAO,CAAEoR,MAAOvL,EAAG3J,OAAQiM,YAnDbjI,IAAMmR,WCCzBkF,6MAOnB1U,MAAQ,CACN2U,UAAU,KA0BZ1F,KAAO,WAAM,IACH9M,EAAY/B,EAAK5C,MAAjB2E,SAEJ/B,EAAK8O,SAAY/M,IAGrB/B,EAAK8O,SAAU,EAEf9O,EAAKgM,KAAO,IAAItC,EAAc1J,EAAK2J,OAAQ5H,GAE3C/B,EAAKgM,KAAKxB,4BAGZuE,YAAc,SAAAjP,GAAS,IACbyU,EAAavU,EAAKJ,MAAlB2U,SADarX,EAEkB8C,EAAK5C,MAApCoX,EAFatX,EAEbsX,cAAeC,EAFFvX,EAEEuX,YAEjB3M,EAAQyG,EAAyBzO,EAAMkP,QAASlP,EAAMmP,SACvDnH,IAIAyM,GAMHvU,EAAKgM,KAAK9D,WAAWJ,EAAMxE,EAAGwE,EAAMvE,GACpCvD,EAAKgM,KAAKzB,SACVjI,WAAW,WACTmS,EAAY3M,IACX,OATH0M,EAAc1M,GACd9H,EAAKK,SAAS,CAAEkU,UAAU,IAC1BvU,EAAKgM,KAAK9D,WAAWJ,EAAMxE,EAAGwE,EAAMvE,GACpCvD,EAAKgM,KAAKzB,+FAhDZpN,KAAK2R,SAAU,EAEf3R,KAAKwM,OAASnJ,SAASC,eAAe,WACtCtD,KAAKwM,OAAOjJ,iBAAiB,YAAavD,KAAK4R,aAG/C5R,KAAK0R,oDAKL1R,KAAK0R,sDAIL1R,KAAKwM,OAAO/I,oBAAoB,YAAazD,KAAK4R,8CA2C3C,IAAAG,EACUzJ,SAAT7B,EADDsL,EACCtL,EAAGsC,EADJgJ,EACIhJ,EACX,OACEzI,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,UAAQK,GAAG,UAAUmR,MAAOvL,EAAG3J,OAAQiM,YA1EPjI,IAAMmR,WCJzBsF,6MAKnB9U,MAAQ,CACNqR,KAAM,KACN0D,MAAO,QAGTC,cAAgB,SAAAC,GAAO,IACb9S,EAAY/B,EAAK5C,MAAjB2E,QACA4S,EAAU3U,EAAKJ,MAAf+U,MAEF1D,EAAOjR,EAAK8U,cAAcH,EAAOE,EAAK9S,GAE5C/B,EAAKK,SAAS,CAAE4Q,YAGlB6D,cAAgB,SAACH,EAAOE,GAKtB,IAJA,IACMhM,GAAMgM,EAAIvR,EAAIqR,EAAMrR,GADZ,GAERyF,GAAM8L,EAAItR,EAAIoR,EAAMpR,GAFZ,GAGR0N,EAAO,GACJhW,EAAI,EAAGA,EAJF,GAIaA,GAAK,EAC9BgW,EAAKzT,KAAK,CAAE8F,EAAGqR,EAAMrR,EAAKrI,EAAI4N,EAAKtF,EAAGoR,EAAMpR,EAAKtI,EAAI8N,EAAKtF,EAAG,IAE/D,OAAOwN,2EAGA,IAAA7O,EAAAjF,KACC8T,EAAS9T,KAAKyC,MAAdqR,KACAlP,EAAY5E,KAAKC,MAAjB2E,QAER,OACEtE,EAAAC,EAAAC,cAAA,WACKsT,EASCxT,EAAAC,EAAAC,cAACoX,EAAD,CACEhT,QAASA,EACTkP,KAAMA,EACNF,iBAAkB,kBAAM3O,EAAK/B,SAAS,CAAE4Q,KAAM,UAVhDxT,EAAAC,EAAAC,cAACqX,EAAD,CACEjT,QAASA,EACTyS,cAAe,SAAAG,GAAK,OAAIvS,EAAK/B,SAAS,CAAEsU,WACxCF,YAAa,SAAAI,GAAG,OAAIzS,EAAKwS,cAAcC,cAzCL5W,IAAMmR,WCWjC6F,6MAKnBrV,MAAQ,CAINrC,OAAQY,EAAYG,QACpB4W,YAAa,UAkBfC,YAAc,SAAA5X,GACZyC,EAAKK,SAAS,CAAE9C,cAIlBsC,cAAgB,SAAAC,GAAS,IACfvC,EAAWyC,EAAKJ,MAAhBrC,OACAwE,EAAY/B,EAAK5C,MAAjB2E,QACR,GAAIxE,IAAWY,EAAYW,uBAIzB,OADAjD,QAAQC,IAAIgE,EAAMC,SACVD,EAAMC,SAEZ,KAAK,GACHC,EAAKK,SAAS,CACZ6U,YAAa,OACb3X,OAAQY,EAAYG,UAEtB,MACF,KAAK,GACH0B,EAAKK,SAAS,CACZ6U,YAAa,SAEf,MACF,KAAK,GACHlV,EAAKK,SAAS,CACZ6U,YAAa,OACb3X,OAAQY,EAAYY,kBAEtB,MACF,KAAK,GACHiB,EAAKK,SAAS,CACZ6U,YAAa,OACb3X,OAAQY,EAAYiB,aAEtB,MACF,KAAK,IACH2C,EAAQC,QAAQoT,mBAChB,MACF,KAAK,IACHrT,EAAQkJ,QACRoK,SAASC,aASjBC,WAAa,WAAM,IAAAC,EACexV,EAAKJ,MAA7BrC,EADSiY,EACTjY,OAAQ2X,EADCM,EACDN,YADChY,EAEe8C,EAAK5C,MAA7B2E,EAFS7E,EAET6E,QAAS+J,EAFA5O,EAEA4O,WAEjB,IAAK/J,IAAYxE,EACf,OAAO,KAGT,OAAQ2X,GACN,IAAK,OACH,OAAQzX,EAAAC,EAAAC,cAAC8X,EAAD,CAAMlY,OAAQA,EAAQwE,QAASA,EAAS+J,WAAYA,IAC9D,IAAK,OACH,OAAQrO,EAAAC,EAAAC,cAAC+X,EAAD,CAAoB3T,QAASA,IACvC,IAAK,OACH,OAAQtE,EAAAC,EAAAC,cAACgY,EAAD,CAAMpY,OAAQA,EAAQwE,QAASA,IACzC,IAAK,OACH,OAAQtE,EAAAC,EAAAC,cAACiY,EAAD,CAASrY,OAAQA,EAAQwE,QAASA,EAAS+J,WAAYA,IAKnE,OAAO,QAGT+J,WAAa,WAGX,OAFwB7V,EAAKJ,MAArBsV,aAGN,IAAK,OACH,MAAO,CACL/W,EAAYG,QACZH,EAAYO,QACZP,EAAYqB,cACZrB,EAAYoB,cACZpB,EAAYQ,eACZR,EAAYS,eACZT,EAAYI,OACZJ,EAAYW,kBAEhB,IAAK,OACH,MAAO,GACT,IAAK,OACH,MAAO,CACLX,EAAYY,gBACZZ,EAAYa,iBAEhB,IAAK,OACH,MAAO,CACLb,EAAYc,cACZd,EAAYiB,YAUlB,MAAO,uFArHPoB,SAASE,iBAAiB,UAAWvD,KAAK0C,8DAI1CW,SAASI,oBAAoB,UAAWzD,KAAK0C,gDAoHtC,IACCtC,EAAWJ,KAAKyC,MAAhBrC,OACFF,EAAUF,KAAK0Y,aAEb9T,EAAY5E,KAAKC,MAAjB2E,QACR,OACEtE,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoR,MAAO,QAASlV,OAAQ,OAAQ6b,MAAO,SACnDrY,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoR,MAAO,QAASlV,OAAQ,UACpCwD,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEgY,QAAS,SACrBtY,EAAAC,EAAAC,cAACqY,EAAD,CAAKjU,QAASA,EAASxE,OAAQA,MAGnCE,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoR,MAAO,QAASlV,OAAQ,QAAS8b,QAAS,QACrD5Y,KAAKoY,eAGV9X,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoR,MAAO,QAASlV,OAAQ,OAAQ6b,MAAO,SACnDrY,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEgY,QAAS,SACrBtY,EAAAC,EAAAC,cAACsY,EAAD,CAAM5Y,QAASA,EAASC,QAASH,KAAKgY,YAAa5X,OAAQA,cAhKjCU,IAAMmR,WCbvB8G,6MAKnBtW,MAAQ,CACNuW,YAAa,GACbC,kBAAmB,GACnBC,UAAW,GACX7D,QAAS,MAkBX8D,0BAA4B,SAAAC,GAC1B,IAAIjb,EASJ,OAPEA,EADuB,IAArBkb,SAASD,EAAEjb,MACN,OACuB,IAArBkb,SAASD,EAAEjb,MACb,OAEA,YAGT,IAAAkB,OAAW+Z,EAAE3a,KAAb,QAAAY,OAAwB+Z,EAAE5a,GAA1B,KAAAa,OAAgC+Z,EAAEnb,KAAlC,QAAAoB,OAA6ClB,EAA7C,KAAAkB,OAAqD+Z,EAAE/a,KAAvD,KAAAgB,OAA+D+Z,EAAExb,MAAjE,QAAAyB,OAA6E+Z,EAAE7a,OAA/E,4FAzBkB,IAAA0G,EAAAjF,MACL,SAAPkF,IAAa,IACTN,EAAYK,EAAKhF,MAAjB2E,QACFoU,EAAcpU,EAAQ0U,SAASN,YAAYhU,QAC3CiU,EAAoBrU,EAAQ0U,SAASL,kBAAkBjU,QAEvDkU,EAAYtU,EAAQ2U,QAAQC,WAC5BnE,EAAUzQ,EAAQ2U,QAAQE,aAEhCxU,EAAK/B,SAAS,CAAE8V,cAAaC,oBAAmBC,YAAW7D,YAC3DlQ,WAAWD,EAAM,KAEnBA,oCAgBO,IAAAwU,EAAA1Z,KAAAqY,EAC+CrY,KAAKyC,MAAnDuW,EADDX,EACCW,YAAaC,EADdZ,EACcY,kBAAmBC,EADjCb,EACiCa,UAExC,OACE5Y,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAE4F,SAAU,WAAYmT,KAAM,OAAQ5I,IAAK,OAAQiB,MAAO,QAAS4H,SAAU,aAAcC,OAAQ,oBAAqBjB,QAAS,sBAAuBkB,SAAU,SAC5KxZ,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAAA,+BACAF,EAAAC,EAAAC,cAAA,WAAOwY,EAAYjd,IAAI,SAAAqd,GAAC,OAAK9Y,EAAAC,EAAAC,cAAA,OAAKpE,IAAKgd,EAAE3a,KAAMmC,MAAO,CAAEmZ,WAAY,QAAWL,EAAKP,0BAA0BC,QAEhH9Y,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoZ,UAAW,SACvB1Z,EAAAC,EAAAC,cAAA,iCACAF,EAAAC,EAAAC,cAAA,WAAOyY,EAAkBld,IAAI,SAAAqd,GAAC,OAAK9Y,EAAAC,EAAAC,cAAA,OAAKpE,IAAKgd,EAAE3a,KAAMmC,MAAO,CAAEmZ,WAAY,QAAWL,EAAKP,0BAA0BC,QAEtH9Y,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAEoZ,UAAW,SACvB1Z,EAAAC,EAAAC,cAAA,wBACAF,EAAAC,EAAAC,cAAA,WAAOb,KAAKC,UAAUsZ,aAvDkBpY,IAAMmR,WCGnCgI,6MAKnBC,KAAO,MAmDPC,aAAe,WACbtX,EAAKqV,UAAYrV,EAAKqV,SAAW,GAAKrV,EAAKuX,QAAQvc,OACnDgF,EAAKgM,KAAKqF,kBAAkBrR,EAAKuX,QAAQvX,EAAKqV,UAAWrV,EAAKI,4FAnD5C,IAAAgC,EAAAjF,KAClBA,KAAKuE,UAAYlB,SAASC,eAAe,sBADvB,IAAAvD,EAGcC,KAAKC,MAA7B2E,EAHU7E,EAGV6E,QAAS+J,EAHC5O,EAGD4O,WACjB3O,KAAK6O,KAAO,IAAIkH,EAAe/V,KAAKuE,UAAWK,EAAS+J,GACxD3O,KAAK6O,KAAK0D,SAASwE,QAAQ/W,KAAKka,KAAO,EAAGla,KAAKka,KAAO,GACtDla,KAAKiD,OAAS,CAAEkD,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAM/BtG,KAAKoa,QAAU,CAAC,CAAEjU,GALP,EAKcC,GALd,EAKqBE,EADtB,GAC2B,CAAEH,EAH5B,EAGmCC,GAFlC,GAEyCE,EAD3C,GAER,CAAEH,EALO,GAKAC,GANA,EAMOE,EAFR,GAEa,CAAEH,EAAGkU,GAASjU,EAJ1B,EAIiCE,EAFlC,GAGR,CAAEH,EANO,GAMAC,EANA,GAMOE,EAHR,GAGa,CAAEH,EALd,EAKqBC,EAAGiU,GAAS/T,EAHlC,GAIR,CAAEH,GARO,EAQAC,EAPA,GAOOE,EAJR,GAIa,CAAEH,GANd,EAMsBC,EANtB,EAM6BE,EAJ9B,IAOVtG,KAAKkY,UAAY,EACjBlY,KAAKma,eAEL,IAAIG,EAAiB,GACjBC,EAAiB,EACjBC,EAAkB,GACT,SAAPtV,IACJC,WAAW,WACT,IAAMsV,EAAa7V,EAAQ2U,QAAQmB,SAAS7c,OACtC8c,EAAc/V,EAAQgW,MAAMC,QAAQC,OAAO,SAACC,EAAO3I,GAAR,OAAgB2I,EAAQ3I,IACrEzD,EAAW3E,SAAWsQ,EAAetQ,QAAU2E,EAAW4B,OAAOpK,IAAMmU,EAAe/J,OAAOpK,GAC1FwI,EAAW4B,OAAOnK,IAAMkU,EAAe/J,OAAOnK,GAAKqU,IAAeF,GAAkBI,IAAgBH,IACzGvV,EAAK4J,KAAKyH,SACVgE,EAAiB,CACftQ,OAAQ2E,EAAW3E,OACnBuG,OAAQ,CACNpK,EAAGwI,EAAW4B,OAAOpK,EACrBC,EAAGuI,EAAW4B,OAAOnK,EACrBE,EAAGqI,EAAW4B,OAAOjK,IAGzBiU,EAAiBE,EACjBD,EAAkBG,GAGpBzV,KACC,KAELA,oCASA,OACE5E,EAAAC,EAAAC,cAAA,OAAKI,MAAO,CAAE4F,SAAU,WAAYwU,MAAO,OAAQjK,IAAK,OAAQxI,MAAO,OAAQsR,OAAQ,oBAAqB7H,MAAOhS,KAAKka,KAAO,OAC7H5Z,EAAAC,EAAAC,cAAA,OAAKK,GAAG,qBAAqBD,MAAO,CAAEoR,MAAOhS,KAAKka,KAAO,KAAMpd,OAAQkD,KAAKka,KAAO,QACnF5Z,EAAAC,EAAAC,cAAA,UAAQI,MAAO,CAAEiZ,OAAQ,oBAAqBoB,OAAQ,OAAQrC,QAAS,WAAYrQ,MAAO,WAAa2S,YAAalb,KAAKma,cAAzH,yBAjEiCrZ,IAAMmR,kBCJzCkJ,EACJ,SAAAA,IAAc,IAAAtY,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAmb,GAAAnb,KAoCd+E,YAAc,kBAAMlC,EAAKuY,UApCXpb,KAsCd8E,cAAgB,SAAArG,GACd,IAAM4c,EAAaC,IAAWC,OAAO9c,GAGrC,GAFAoE,EAAKuY,SAAS/a,KAAK5B,GAEf4c,GAA8C,eAAhCA,EAAWjR,YAAYC,KAAuB,CAE9D,IAAMmR,EAAiB,GAUvB,OATA3Y,EAAKmW,YAAY7c,QAAQ,SAAAsf,GAClBA,EAAIC,WAAWL,IAClBG,EAAenb,KAAKob,KAGxBD,EAAenb,KAAKgb,GAEpBxY,EAAKmW,YAAcwC,EACnB3Y,EAAKuY,SAAS/a,KAAK,uBACZ,EAGT,OADAwC,EAAKuY,SAAS/a,KAAK,oCACZ,GAzDKL,KA4DdiY,iBAAmB,WACjBpV,EAAKmW,YAAc,GACnBnW,EAAKuY,SAAS/a,KAAK,wBA9DPL,KAiEd2b,YAAc,SAAA3O,GACZ,IAAM4O,EAAY/Y,EAAKgZ,eAAe7O,GAChC8O,EAAoBjZ,EAAKkZ,uBAAuB/O,GAEhDgP,EAAc,GAChBJ,EAAU/d,OAAS,EACrBme,EAAY3b,KAAK,yCACRub,EAAU/d,OAAS,EAC5Bme,EAAY3b,KAAK,sCACRub,EAAU/d,OAAS,EAI5Bme,EAAY3b,KAAZ,2CAAAhB,OAA4Duc,EAAU,GAAGP,WAAW5c,KAApF,4BAAAY,OAAmHuc,EAAU,GAAGhe,MAAhI,MAC8B,IAArBge,EAAU/d,QAAgBgF,EAAK+Y,UAAU/d,OAAS,GAC3Dme,EAAY3b,KAAK,4BAGfyb,EAAkBje,OAAS,EAC7Bme,EAAY3b,KAAK,2CACqB,IAA7Byb,EAAkBje,QAAgBgF,EAAKiZ,kBAAkBje,OAAS,GAC3Eme,EAAY3b,KAAK,oCAGnB3B,QAAQC,IAAR,cAAAU,OAA0B2c,EAAYvc,KAAK,KAA3C,MACAoD,EAAKuY,SAAWY,EAChBnZ,EAAK+Y,UAAYA,EACjB/Y,EAAKiZ,kBAAoBA,GA5Fb9b,KAoGd6b,eAAiB,SAAA7O,GACf,IAAM4O,EAAY,GAQlB,OAPA/Y,EAAKmW,YAAY7c,QAAQ,SAAAkf,GACnBA,EAAWY,WAAWjP,GAAQzO,SAChCG,QAAQC,IAAI,wBACZid,EAAUvb,KAAK,CAAEgb,aAAYzd,MAAOyd,EAAWY,WAAWjP,GAAQpP,WAI/Dge,GA7GK5b,KAqHd+b,uBAAyB,SAAA/O,GACvB,IAAM8O,EAAoB,GAQ1B,OAPAjZ,EAAKoW,kBAAkB9c,QAAQ,SAAAkf,GACzBA,EAAWY,WAAWjP,GAAQzO,SAChCG,QAAQC,IAAI,+BACZmd,EAAkBzb,KAAK,CAAEgb,aAAYzd,MAAOyd,EAAWY,WAAWjP,GAAQpP,WAIvEke,GA7HP9b,KAAKgZ,YAAc,GACnBhZ,KAAKiZ,kBAAoB,CACvB,IAAIqC,IAAW,CACb7c,KAAM,2BACNF,QAAQ,EACRC,GAAI,MACJL,KAAM,YACNF,KAAM,SACNI,KAAM,IACNT,MAAO,MAET,IAAI0d,IAAW,CACb7c,KAAM,uBACNF,QAAQ,EACRC,GAAI,MACJL,KAAM,EACNF,KAAM,SACNI,KAAM,IACNT,MAAO,MAET,IAAI0d,IAAW,CACb7c,KAAM,uBACNF,QAAQ,EACRC,GAAI,MACJL,KAAM,YACNF,KAAM,WACNI,KAAM,IACNT,MAAO,OAGXoC,KAAK4b,UAAY,GACjB5b,KAAK8b,kBAAoB,GACzB9b,KAAKob,SAAW,IAiGpBD,EAAQ1R,OAAS,SAAA5E,GACf,IAAMqX,EAAUvc,KAAKC,UAAUiF,GAG/B,OAFalF,KAAKwc,MAAMD,IAK1Bf,EAAQiB,KAAO,SAAAC,GAAQ,IACbrD,EAAwDqD,EAAxDrD,YAAa4C,EAA2CS,EAA3CT,UAAWE,EAAgCO,EAAhCP,kBAAmBV,EAAaiB,EAAbjB,SAE7CvW,EAAU,IAAIsW,EAOpB,OALAtW,EAAQmU,YAAcA,EAAYjd,IAAI,SAAA2D,GAAc,OAAI,IAAI4b,IAAW5b,KACvEmF,EAAQ+W,UAAYA,EACpB/W,EAAQiX,kBAAoBA,EAC5BjX,EAAQuW,SAAWA,EAEZvW,GAGMsW,wBCxJMmB,GACnB,SAAAA,EAAYC,GAAU,IAAA1Z,EAAA7C,KACpB,GADoB/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAsc,GAAAtc,KAgBtBwc,gBAAkB,SAAAC,GAAW,IACnBthB,EAAkBshB,EAAlBthB,EAAGuF,EAAe+b,EAAf/b,EAAGgG,EAAY+V,EAAZ/V,EAAGD,EAASgW,EAAThW,EAAGE,EAAM8V,EAAN9V,EAEhBxL,GAA4B,SAAvBA,EAAEiP,YAAYC,OACrBxH,EAAKyI,SAASnQ,EAAIqO,EAAaK,KAC/B1O,EAAEmQ,SAAS5E,EAAI8C,EAAaK,MAE1BnJ,GAA4B,SAAvBA,EAAE0J,YAAYC,OACrBxH,EAAKyI,SAAS5K,EAAI8I,EAAaK,KAC/BnJ,EAAE4K,SAAS7E,EAAI+C,EAAaK,MAE1BnD,GAA4B,SAAvBA,EAAE0D,YAAYC,OACrBxH,EAAKyI,SAAS5E,EAAI8C,EAAaK,KAC/BnD,EAAE4E,SAASnQ,EAAIqO,EAAaK,MAE1BpD,GAA4B,SAAvBA,EAAE2D,YAAYC,OACrBxH,EAAKyI,SAAS7E,EAAI+C,EAAaK,KAC/BpD,EAAE6E,SAAS5K,EAAI8I,EAAaK,MAI1BlD,GAA4B,SAAvBA,EAAEyD,YAAYC,OACrBxH,EAAKyI,SAAS3E,EAAI6C,EAAaK,MAI7B1O,GAA4B,SAAvBA,EAAEiP,YAAYC,MAAmC,MAAhBlP,EAAE2Q,YAC1CjJ,EAAKyI,SAASnQ,EAAIqO,EAAaK,KAC/B1O,EAAEgR,gBAAiB,GAEjBzL,GAA4B,SAAvBA,EAAE0J,YAAYC,MAAmC,MAAhB3J,EAAEoL,YAC1CjJ,EAAKyI,SAAS5K,EAAI8I,EAAaK,KAC/BnJ,EAAEyL,gBAAiB,GAEjBzF,GAA4B,SAAvBA,EAAE0D,YAAYC,MAAmC,MAAhB3D,EAAEoF,YAC1CjJ,EAAKyI,SAAS5E,EAAI8C,EAAaK,KAC/BnD,EAAEyF,gBAAiB,GAEjB1F,GAA4B,SAAvBA,EAAE2D,YAAYC,MAAmC,MAAhB5D,EAAEqF,YAC1CjJ,EAAKyI,SAAS7E,EAAI+C,EAAaK,KAC/BpD,EAAE0F,gBAAiB,IAxDDnM,KA4DtB0c,iBAAmB,SAAAD,GAAW,IAEpBthB,EAAkBshB,EAAlBthB,EAAGuF,EAAe+b,EAAf/b,EAAGgG,EAAY+V,EAAZ/V,EAAGD,EAASgW,EAAThW,EAAGE,EAAM8V,EAAN9V,EAChBxL,GAA4B,SAAvBA,EAAEiP,YAAYC,OACrBlP,EAAEmQ,SAAS5E,EAAI8C,EAAaE,OAE1BhJ,GAA4B,SAAvBA,EAAE0J,YAAYC,OACrB3J,EAAE4K,SAAS7E,EAAI+C,EAAaE,OAE1BhD,GAA4B,SAAvBA,EAAE0D,YAAYC,OACrB3D,EAAE4E,SAASnQ,EAAIqO,EAAaE,OAE1BjD,GAA4B,SAAvBA,EAAE2D,YAAYC,OACrB5D,EAAE6E,SAAS5K,EAAI8I,EAAaE,OAI1B/C,GAA4B,SAAvBA,EAAEyD,YAAYC,OACrB1D,EAAE2E,SAAS1E,EAAI4C,EAAaE,OAI1BvO,GAA4B,SAAvBA,EAAEiP,YAAYC,MAAmC,MAAhBlP,EAAE2Q,YAC1C3Q,EAAEgR,gBAAiB,GAEjBzL,GAA4B,SAAvBA,EAAE0J,YAAYC,MAAmC,MAAhB3J,EAAEoL,YAC1CpL,EAAEyL,gBAAiB,GAEjBzF,GAA4B,SAAvBA,EAAE0D,YAAYC,MAAmC,MAAhB3D,EAAEoF,YAC1CpF,EAAEyF,gBAAiB,GAEjB1F,GAA4B,SAAvBA,EAAE2D,YAAYC,MAAmC,MAAhB5D,EAAEqF,YAC1CrF,EAAE0F,gBAAiB,IA5FDnM,KAgGtB+P,WAAa,SAAC4M,EAActM,GAC1BxN,EAAKyI,SAASqR,GAAgBtM,GAjGVrQ,KAqGtB4c,mBAAqB,SAAAH,GAAW,IACtBthB,EAAeshB,EAAfthB,EAAGuL,EAAY+V,EAAZ/V,EAAGhG,EAAS+b,EAAT/b,EAAG+F,EAAMgW,EAANhW,EACjB,OAAI5D,EAAKyI,SAAS5K,IAAM8I,EAAaK,MAAc,OAANnJ,IAGzCmC,EAAKyI,SAAS7E,IAAM+C,EAAaK,MAAc,OAANpD,IAGzC5D,EAAKyI,SAASnQ,IAAMqO,EAAaK,MAAc,OAAN1O,GAGzC0H,EAAKyI,SAAS5E,IAAM8C,EAAaK,MAAc,OAANnD,KAhHzB1G,KAsHtB6c,qBAAuB,SAAA/Q,GACrB,OAAIjJ,EAAKyI,SAASQ,KAAetC,EAAaK,MAtH1C0S,EAAU,KACJjR,EAAaiR,EAAbjR,SACRtL,KAAKsL,SAAWA,OAEhBtL,KAAKsL,SAAW,CACdnQ,EAAGqO,EAAaE,MAChBhJ,EAAG8I,EAAaE,MAChBhD,EAAG8C,EAAaE,MAChBjD,EAAG+C,EAAaE,MAChB/C,EAAG6C,EAAaE,MAChB9C,EAAG4C,EAAaE,QCZHoT,GACnB,SAAAA,EAAYC,GAAU,IAAAla,EAAA7C,KACpB,GADoB/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAA8c,GAAA9c,KAYtBwc,gBAAkB,SAACnN,EAAUoN,GAC3B5Z,EAAKiJ,UAAYuD,EADsB,IAG/BlU,EAAkBshB,EAAlBthB,EAAGuF,EAAe+b,EAAf/b,EAAGgG,EAAY+V,EAAZ/V,EAAGD,EAASgW,EAAThW,EAAGG,EAAM6V,EAAN7V,EAGhBA,GAA4B,SAAvBA,EAAEwD,YAAYC,OACrBzD,EAAE0E,SAAS3E,EAAI6C,EAAaK,MAI1B1O,GAA4B,SAAvBA,EAAEiP,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7C3Q,EAAEmQ,SAAS5E,EAAI8C,EAAaK,KAC5BhH,EAAKsJ,gBAAiB,GAEpBzL,GAA4B,SAAvBA,EAAE0J,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CpL,EAAE4K,SAAS7E,EAAI+C,EAAaK,KAC5BhH,EAAKsJ,gBAAiB,GAEpBzF,GAA4B,SAAvBA,EAAE0D,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CpF,EAAE4E,SAASnQ,EAAIqO,EAAaK,KAC5BhH,EAAKsJ,gBAAiB,GAEpB1F,GAA4B,SAAvBA,EAAE2D,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CrF,EAAE6E,SAAS5K,EAAI8I,EAAaK,KAC5BhH,EAAKsJ,gBAAiB,GAIpBhR,GAA6B,SAAvBA,EAAEiP,YAAYC,MAAmC,MAAhBlP,EAAE2Q,WAAyC,MAAnBjJ,EAAKiJ,YACtE3Q,EAAEgR,gBAAiB,EACnBtJ,EAAKsJ,gBAAiB,GAEpBzL,GAA6B,SAAvBA,EAAE0J,YAAYC,MAAmC,MAAhB3J,EAAEoL,WAAyC,MAAnBjJ,EAAKiJ,YACtEpL,EAAEyL,gBAAiB,EACnBtJ,EAAKsJ,gBAAiB,GAEpBzF,GAA6B,SAAvBA,EAAE0D,YAAYC,MAAmC,MAAhB3D,EAAEoF,WAAyC,MAAnBjJ,EAAKiJ,YACtEpF,EAAEyF,gBAAiB,EACnBtJ,EAAKsJ,gBAAiB,GAEpB1F,GAA6B,SAAvBA,EAAE2D,YAAYC,MAAmC,MAAhB5D,EAAEqF,WAAyC,MAAnBjJ,EAAKiJ,YACtErF,EAAE0F,gBAAiB,EACnBtJ,EAAKsJ,gBAAiB,IAvDJnM,KA2DtB0c,iBAAmB,SAAAD,GAAW,IACpBthB,EAAkBshB,EAAlBthB,EAAGuF,EAAe+b,EAAf/b,EAAGgG,EAAY+V,EAAZ/V,EAAGD,EAASgW,EAAThW,EAAGG,EAAM6V,EAAN7V,EAEhBA,GAA4B,SAAvBA,EAAEwD,YAAYC,OACrBzD,EAAE0E,SAAS3E,EAAI6C,EAAaE,OAE1BvO,GAA4B,SAAvBA,EAAEiP,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7C3Q,EAAEmQ,SAAS5E,EAAI8C,EAAaE,OAE1BhJ,GAA4B,SAAvBA,EAAE0J,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CpL,EAAE4K,SAAS7E,EAAI+C,EAAaE,OAE1BhD,GAA4B,SAAvBA,EAAE0D,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CpF,EAAE4E,SAASnQ,EAAIqO,EAAaE,OAE1BjD,GAA4B,SAAvBA,EAAE2D,YAAYC,MAAsC,MAAnBxH,EAAKiJ,YAC7CrF,EAAE6E,SAAS5K,EAAI8I,EAAaE,OAI1BvO,GAA6B,SAAvBA,EAAEiP,YAAYC,MAAmC,MAAhBlP,EAAE2Q,WAAyC,MAAnBjJ,EAAKiJ,YACtE3Q,EAAEgR,gBAAiB,GAEjBzL,GAA6B,SAAvBA,EAAE0J,YAAYC,MAAmC,MAAhB3J,EAAEoL,WAAyC,MAAnBjJ,EAAKiJ,YACtEpL,EAAEyL,gBAAiB,GAEjBzF,GAA6B,SAAvBA,EAAE0D,YAAYC,MAAmC,MAAhB3D,EAAEoF,WAAyC,MAAnBjJ,EAAKiJ,YACtEpF,EAAEyF,gBAAiB,GAEjB1F,GAA6B,SAAvBA,EAAE2D,YAAYC,MAAmC,MAAhB5D,EAAEqF,WAAyC,MAAnBjJ,EAAKiJ,YACtErF,EAAE0F,gBAAiB,IAzFDnM,KA6FtB+P,WAAa,SAAC4M,EAActM,GAC1B,GAAIA,IAAY7G,EAAaK,KAC3B,OAAQ8S,GACN,IAAK,IACoB,MAAnB9Z,EAAKiJ,YACPjJ,EAAKsJ,gBAAiB,GAExB,MACF,IAAK,IACoB,MAAnBtJ,EAAKiJ,YACPjJ,EAAKsJ,gBAAiB,GAExB,MACF,IAAK,IACoB,MAAnBtJ,EAAKiJ,YACPjJ,EAAKsJ,gBAAiB,GAExB,MACF,IAAK,IACoB,MAAnBtJ,EAAKiJ,YACPjJ,EAAKsJ,gBAAiB,KAhH1B4Q,EAAU,KACJjR,EAA8BiR,EAA9BjR,UAAWK,EAAmB4Q,EAAnB5Q,eACnBnM,KAAK8L,UAAYA,EACjB9L,KAAKmM,eAAiBA,OAEtBnM,KAAK8L,UAAY,IACjB9L,KAAKmM,gBAAiB,GCVf6Q,GAAb,SAAAA,IAAA/gB,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAgd,IAEaC,GAAb,SAAAA,IAAAhhB,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAid,ICmBMC,GACJ,SAAAA,EAAY7H,GAAS,IAAAxS,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAkd,GAAAld,KAUrBkW,OAAS,kBAAMrT,EAAKwS,SAVCrV,KAYrB8N,MAAQ,WACNjL,EAAKwS,QAAU5N,EAAgBa,SAASmF,KAAMnF,SAASoF,KAAMpF,SAASiF,OAbnDvN,KAqBrBiQ,IAAM,SAAC/D,EAAK1F,EAAU6I,GACpB,IACI8N,EADEV,EAAUlW,EAAiB1D,EAAKwS,QAAS7O,GAE/C,OAAQ0F,GACN,KAAKkC,EAAYG,MACf,GAAI/H,EAASJ,EAAKkC,SAASoF,KAAO,EAAI,KAC5BvH,EAASK,EAATL,EAAGC,EAAMI,EAANJ,EACLE,EAAME,EAANF,EAEA8W,EAAkB,CAAEjX,IAAGC,IAAGE,EADhCA,GAAK,GAKL,OAFAzD,EAAKwa,SAAS7W,EAAU,IAAIyW,GAAMzW,IAClC3D,EAAKwa,SAASD,EAAiB,IAAIJ,GAAQI,KACpC,EAET,OAAO,EACT,KAAKhP,EAAYC,KAIf,OAHA8O,EAAY,IAAIb,GAChBzZ,EAAKwa,SAAS7W,EAAU2W,GACxBA,EAAUX,gBAAgBC,IACnB,EACT,KAAKrO,EAAYE,KAIf,OAHA6O,EAAY,IAAIL,GAChBja,EAAKwa,SAAS7W,EAAU2W,GACxBA,EAAUX,gBAAgBnN,EAAUoN,IAC7B,EACT,QACE,OAAO,IAhDQzc,KAwDrBmQ,OAAS,SAAA3J,GACP,IAAM0F,EAAMrJ,EAAKya,SAAS9W,GAE1B,GAAK0F,EAIL,OAAQA,EAAI9B,YAAYC,MACtB,IAAK,QACH,GAAI7D,EAASF,EAAKgC,SAASiF,KAAO,EAAI,CACpC1K,EAAKwa,SAAS7W,EAAU,MADY,IAE5BL,EAASK,EAATL,EAAGC,EAAMI,EAANJ,EACLE,EAAME,EAANF,EACNA,GAAK,EACLzD,EAAKwa,SAAS,CAAElX,IAAGC,IAAGE,KAAK,MAE7B,MACF,IAAK,UACH,GAAIE,EAASF,EAAI,EAAG,CAClBzD,EAAKwa,SAAS7W,EAAU,MADN,IAEVL,EAASK,EAATL,EAAGC,EAAMI,EAANJ,EACLE,EAAME,EAANF,EACNA,GAAK,EACLzD,EAAKwa,SAAS,CAAElX,IAAGC,IAAGE,KAAK,MAE7B,MACF,QACE,GAAI4F,GAAOA,EAAIwQ,iBAAkB,CAC/B,IAAMD,EAAUlW,EAAiB1D,EAAKwS,QAAS7O,GAC/C0F,EAAIwQ,iBAAiBD,GAEvB5Z,EAAKwa,SAAS7W,EAAU,QAvFTxG,KAiGrB+P,WAAa,SAAC/F,EAAQxD,EAAU4J,EAAMC,GACpC,IAAMnE,EAAMrJ,EAAKya,SAAS9W,GAEpBmW,EAAe9Z,EAAK0a,gBAAgBvT,EAAQoG,GAC9ClE,GAAOA,EAAI6D,YACb7D,EAAI6D,WAAW4M,EAActM,GAG/B,IACMmN,EADUjX,EAAiB1D,EAAKwS,QAAS7O,GACZmW,GAC/Ba,GAAsBA,EAAmBzN,YAC3CyN,EAAmBzN,WpB1DlB,SAA8B0N,GACnC,OAAQA,GACN,IAAK,IACH,MAAO,IACT,IAAK,IACH,MAAO,IACT,IAAK,IACH,MAAO,IACT,IAAK,IACH,MAAO,IACT,IAAK,IACH,MAAO,IACT,IAAK,IACH,MAAO,IACT,QACE,OAAO,MoB2CuBC,CAAqBf,GAAetM,IA5GjDrQ,KAgHrByZ,WAAa,WAEX,IADA,IAAMpE,EAAU,GACP/O,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIF,EAAI,EAAGA,EAAIkC,SAASoF,KAAMtH,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EAAG,CACzC,IAAM6J,EAASnN,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAClC,GAAI6J,EAAQ,CACV,IAAI7R,EAAO,KACX,OAAQ6R,EAAO5F,YAAYC,MACzB,IAAK,OACHlM,EAAOiQ,EAAYC,KACnB,MACF,IAAK,OACHlQ,EAAOiQ,EAAYE,KACnB,MACF,IAAK,UACHnQ,EAAOiQ,EAAYI,QACnB,MACF,IAAK,QACHrQ,EAAOiQ,EAAYG,MAKvB8G,EAAQhV,KAAK,CACX2P,SACA7R,OACAqI,SAAU,CAAEL,IAAGC,IAAGE,QAO5B,OAAO+O,GAlJYrV,KAqJrB2d,aAAe,WACb,OAAI9a,EAAK2W,WACA3W,EAAK2W,WAEP,IAzJYxZ,KA4JrB4d,oBAAsB,SAAAhR,GACpB,IAAMyI,EAAUxS,EAAK4W,aAGrB,GAFA5W,EAAK6X,SAAWrF,EAEXA,EAAL,CAKAxS,EAAKgb,0BAA0BxI,EAASzI,GACxC/J,EAAKib,gBAAgBzI,GAGrB,IAAM6D,EAAYrW,EAAKkb,cAAc1I,GACrCxS,EAAK2W,WAAa3W,EAAKmb,4BAA4B9E,KA1KhClZ,KA6KrB6d,0BAA4B,SAACxI,EAASzI,GACpCyI,EAAQlZ,QAAQ,SAAAoD,GAAQ,IACdiH,EAAqBjH,EAArBiH,SAAUwJ,EAAWzQ,EAAXyQ,OACV7J,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACR2X,EAAKrR,EAAK4F,MAAM,CAAErM,IAAGC,MAInBQ,EAAML,EAAiB1D,EAAKwS,QAAS,CAAElP,IAAGC,IAAGE,MAA7CM,EAER,OAAQoJ,EAAO5F,YAAYC,MACzB,IAAK,OACH2F,EAAOnT,KAAO,IACdmT,EAAOlT,OAAS,IAAMwJ,EAAI,EAAI2X,GAC9BjO,EAAOkO,OAAS,IAAM5X,EAAI2X,GAC1B,MACF,IAAK,OACHjO,EAAOlT,OAAS,IAAMwJ,EAAI,EAAI2X,GAE9BjO,EAAOmO,OAASvX,GAA4B,SAAvBA,EAAEwD,YAAYC,KAAkB,EAAI,EACzD2F,EAAOkO,OAAS,IAAM5X,EAAI2X,GAC1B,MACF,IAAK,UAIL,IAAK,QACHjO,EAAOlT,OAAS,IAAMwJ,EAAI,EAAI2X,GAC9BjO,EAAOkO,OAAS,IAAM5X,EAAI2X,OAzMbje,KAiNrB8d,gBAAkB,SAAAzI,GAEhBA,EAAQlZ,QAAQ,SAAAoD,GACVA,EAAKpB,OAASiQ,EAAYC,OACT9O,EAAXyQ,OACDjT,aAAeqhB,OAK1B,IAAMC,EAAehJ,EAAQpG,OAAO,SAAA1P,GAClC,GAAIA,EAAKpB,OAASiQ,EAAYC,KAAM,KAC1B7H,EAAqBjH,EAArBiH,SAAUwJ,EAAWzQ,EAAXyQ,OACV7J,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACRmW,EAAUlW,EAAiB1D,EAAKwS,QAAS,CAAElP,IAAGC,IAAGE,MACvD,OAAO0J,EAAO4M,mBAAmBH,GAEnC,OAAO,IAuCT4B,EAAaliB,QAAQ,SAAAoD,IApCD,SAAd+e,EAAe9X,EAAU+X,GAAS,IAC9BpY,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACd,KAAIH,EAAI,GAAKC,EAAI,GAAKD,GAAKmC,SAASmF,MAAQrH,GAAKkC,SAASoF,MAA1D,CAIA,IAAMsC,EAASnN,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAElC,GAAI6J,GAAWuO,EAAOvO,EAAOjT,aAAe,CAE1CiT,EAAOjT,aAAewhB,EACtB,IAAMC,EAAWD,EAAO,GAGpBvO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,IAAGC,EAAGA,EAAI,EAAGE,KAAKkY,GAE9BxO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,IAAGC,EAAGA,EAAI,EAAGE,KAAKkY,GAE9BxO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,EAAGA,EAAI,EAAGC,IAAGE,KAAKkY,GAE9BxO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,EAAGA,EAAI,EAAGC,IAAGE,KAAKkY,GAE9BxO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,IAAGC,IAAGE,EAAGA,EAAI,GAAKkY,GAE9BxO,EAAO6M,qBAAqB,MAC9ByB,EAAY,CAAEnY,IAAGC,IAAGE,EAAGA,EAAI,GAAKkY,KAQpCF,CADqB/e,EAAbiH,SACc,OA3QLxG,KA+QrBge,4BAA8B,SAAA9E,GAE5B,IAAMuF,EAAqB,GAqC3B,OApCAxiB,OAAOC,KAAKgd,GAAW/c,QAAQ,SAAAC,GAC7B,IAAMT,EAAWud,EAAU9c,GAGvBsiB,GAAW,EACX5hB,EAAS,EACTohB,EAASE,IACTvhB,EAAO,EACP8hB,EAAkB,EACtBhjB,EAASQ,QAAQ,SAAAyiB,GACe,SAA1BA,EAAKxU,YAAYC,OACnBxN,GAAQ,IAEJ+hB,EAAK7hB,aAAe4hB,IACtBA,EAAkBC,EAAK7hB,eAGP,KAAhB6hB,EAAK9hB,SACP4hB,GAAW,GAETE,EAAK9hB,OAASA,IAChBA,EAAS8hB,EAAK9hB,QAEZ8hB,EAAKV,OAASA,IAChBA,EAASU,EAAKV,UAGlBO,EAAmBpe,KAAK,CACtBxD,OACA6hB,SAAUA,EAAW,EAAI,EACzB5hB,SACAohB,SACAS,sBAIGF,GAtTYze,KAyTrB+d,cAAgB,SAAA1I,GACd,IAAMwJ,EAAgBxJ,EAAQpG,OAAO,SAAA1P,GAAI,OAAIA,EAAKpB,OAASiQ,EAAYC,MAAQ9O,EAAKpB,OAASiQ,EAAYE,OACnG4K,EAAY,GAGlB2F,EAAc1iB,QAAQ,SAAAoD,GACDA,EAAXyQ,OACD8O,cAAgB,OAIzB,IAiBIC,EAAY,EAUhB,OATAF,EAAc1iB,QAAQ,SAAAoD,GAAQ,IACpBiH,EAAqBjH,EAArBiH,SACqB,OADAjH,EAAXyQ,OACP8O,gBACT5F,EAAU6F,GAAa,GArBA,SAArBC,EAAsBxY,EAAUsY,GAAkB,IAC9C3Y,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACd,KAAIH,EAAI,GAAKC,EAAI,GAAKE,EAAI,GAAKH,GAAKmC,SAASmF,MAAQrH,GAAKkC,SAASoF,MAAQpH,GAAKgC,SAASiF,MAAzF,CAIA,IAAMyC,EAASnN,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAC9B6J,GAAmC,OAAzBA,EAAO8O,gBACnB9O,EAAO8O,cAAgBA,EACvB5F,EAAU4F,GAAeze,KAAK2P,GACJ,CAAC,CAAE7J,IAAGC,EAAGA,EAAI,EAAGE,KAAK,CAAEH,IAAGC,EAAGA,EAAI,EAAGE,KAAK,CAAEH,EAAGA,EAAI,EAAGC,IAAGE,KAChF,CAAEH,EAAGA,EAAI,EAAGC,IAAGE,KAAK,CAAEH,IAAGC,IAAGE,EAAGA,EAAI,GAAK,CAAEH,IAAGC,IAAGE,EAAGA,EAAI,IACvCnK,QAAQ,SAAA8iB,GAAgB,OAAID,EAAmBC,EAAkBH,OAUnFE,CAAmBxY,EAAUuY,GAC7BA,GAAa,KAIV7F,GA/VYlZ,KAmWrBud,gBAAkB,SAACvT,EAAQoG,GACzB,IAAIuM,EACJ,GAAa,MAATvM,GAAyB,MAATA,EAClB,OAAQpG,GACN,KAAKtE,EAAYC,MACjB,KAAKD,EAAYG,MACjB,KAAKH,EAAYE,KACjB,KAAKF,EAAYI,KACf6W,EAAevM,EACf,MACF,KAAK1K,EAAYM,OAEb2W,EADW,MAATvM,EACa,IAEA,IAEjB,MACF,KAAK1K,EAAYK,IAEb4W,EADW,MAATvM,EACa,IAEA,IAEjB,MACF,QACE,MAAM,IAAI9D,MAAJ,UAAAjN,OAAoB2K,EAApB,6BAGV,OAAQA,GACN,KAAKtE,EAAYC,MACF,MAATyK,EACFuM,EAAe,IACG,MAATvM,IACTuM,EAAe,KAEjB,MACF,KAAKjX,EAAYG,MACF,MAATuK,EACFuM,EAAe,IACG,MAATvM,IACTuM,EAAe,KAEjB,MACF,KAAKjX,EAAYE,KACF,MAATwK,EACFuM,EAAe,IACG,MAATvM,IACTuM,EAAe,KAEjB,MACF,KAAKjX,EAAYI,KACF,MAATsK,EACFuM,EAAe,IACG,MAATvM,IACTuM,EAAe,KAEjB,MACF,KAAKjX,EAAYM,OACjB,KAAKN,EAAYK,IACF,MAATqK,EACFuM,EAAe,IACG,MAATvM,IACTuM,EAAe,KAEjB,MACF,QACE,MAAM,IAAIrQ,MAAJ,UAAAjN,OAAoB2K,EAApB,wBAGZ,OAAO2S,GAxaY3c,KAgbrB6M,SAAW,SAAC7C,EAAQyC,GAClB,IAAIyS,EACAC,EACAC,EACJ,OAAQpV,GACN,KAAKtE,EAAYC,MACf,OAAO9C,EAAKwc,WAAW5S,GACzB,KAAK/G,EAAYG,MAEf,OADAqZ,EAASrc,EAAKwc,WAAW5S,GAClB6S,IAAQC,MAAML,GACvB,KAAKxZ,EAAYE,KAEf,OADAuZ,EAAStc,EAAK2c,WAAW/S,GAClB6S,IAAQC,MAAMJ,GACvB,KAAKzZ,EAAYI,KACf,OAAOjD,EAAK2c,WAAW/S,GACzB,KAAK/G,EAAYM,OAEf,OADAoZ,EAASvc,EAAK4c,WAAWhT,GAClB6S,IAAQI,MAAMN,GACvB,KAAK1Z,EAAYK,IACf,OAAOlD,EAAK4c,WAAWhT,GACzB,QACE,MAAM,IAAIH,MAAJ,UAAAjN,OAAoB2K,EAApB,0BArcShK,KAycrBiN,oBAAsB,SAACjD,EAAQyC,GAC7B,IAAIkT,EAAuBlT,EACrBmT,EAAyB,GAC/B,OAAQ5V,GACN,KAAKtE,EAAYC,MACf,KAAOga,EAAwBrX,SAASoF,KAAO,GAC7CiS,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,KAAKja,EAAYG,MACf,KAAO8Z,EAAuB,GAC5BA,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,KAAKja,EAAYE,KACf,KAAO+Z,EAAwBrX,SAASmF,KAAO,GAC7CkS,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,KAAKja,EAAYI,KACf,KAAO6Z,EAAuB,GAC5BA,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,KAAKja,EAAYM,OACf,KAAO2Z,EAAwBrX,SAASiF,KAAO,GAC7CoS,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,KAAKja,EAAYK,IACf,KAAO4Z,EAAuB,GAC5BA,GAAwB,EACxBC,EAAuBvf,KAAKsf,GAE9B,MACF,QACE,MAAM,IAAIrT,MAAJ,UAAAjN,OAAoB2K,EAApB,wBAGV,OADyB4V,EAAuB7jB,IAAI,SAAA+B,GAAC,OAAI+E,EAAKgK,SAAS7C,EAAQlM,MApf5DkC,KAwfrByf,WAAa,SAAAnZ,GAAC,OAAIzD,EAAKwS,QAAQ/O,IAxfVtG,KA0frBwf,WAAa,SAAArZ,GAEX,IADA,IAAMnB,EAAQkC,EAAgBoB,SAASiF,KAAMjF,SAASoF,MAC7CpH,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIF,EAAI,EAAGA,EAAIkC,SAASoF,KAAMtH,GAAK,EACtCpB,EAAMsB,GAAGF,GAAKvD,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAGrC,OAAOnB,GAjgBYhF,KAogBrBqf,WAAa,SAAAjZ,GAEX,IADA,IAAMpB,EAAQkC,EAAgBoB,SAASiF,KAAMjF,SAASmF,MAC7CnH,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIH,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EACtCnB,EAAMsB,GAAGH,GAAKtD,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAGrC,OAAOnB,GA3gBYhF,KA8gBrBsd,SAAW,SAAA9W,GAAY,IACbL,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACd,OAAIH,GAAK,GAAKC,GAAK,GAAKE,GAAK,GAAKH,EAAImC,SAASmF,MAAQrH,EAAIkC,SAASoF,MAAQpH,EAAIgC,SAASiF,KAChF1K,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAErB,MAnhBYnG,KAshBrBqd,SAAW,SAAC7W,EAAUwJ,GAAW,IACvB7J,EAAYK,EAAZL,EAAGC,EAASI,EAATJ,EAAGE,EAAME,EAANF,EACVH,GAAK,GAAKC,GAAK,GAAKE,GAAK,GAAKH,EAAImC,SAASmF,MAAQrH,EAAIkC,SAASoF,MAAQpH,EAAIgC,SAASiF,OACvF1K,EAAKwS,QAAQ/O,GAAGF,GAAGD,GAAK6J,IAzhBPhQ,KA6hBrB6f,SAAW,SAAArZ,GACT,IAAMiW,EAAUlW,EAAiBC,GAC3B4S,EAAI,IAAIkD,GAAK9V,EAAUiW,GAC7B5Z,EAAK6M,UAAUlJ,EAAU4S,IAhiBNpZ,KAmiBrB8f,KAAO,WACL,IAAMpQ,EAAY,SAACqQ,EAAK5hB,EAAM6hB,GAC1Bnd,EAAKoN,IAAI9R,EAAM4hB,EAAKC,IAGxBtQ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,EAAG,KAEpCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,EAAG,KAEpCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,EAAG,KAEpCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GAEjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GAEjCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GAEjCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,GAAIE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,GAAIE,EAAG,GAAK,EAAG,KAEpCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,GAAIE,EAAG,GAAK,GACjCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,GAAIE,EAAG,GAAK,EAAG,KAGpCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,EAAG,KAEpCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,EAAG,KACnCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,GAAIC,EAAG,EAAGE,EAAG,GAAK,GAGjCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAChCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,GAEhCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,EAAG,KACnCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,EAAG,KAEnCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,EAAG,KACnCoJ,EAAU,CAAEvJ,EAAG,EAAGC,EAAG,EAAGE,EAAG,GAAK,EAAG,MAllB/B+O,EACFrV,KAAKqV,QAAUA,GAGfrV,KAAKqV,QAAU5N,EAAgBa,SAASmF,KAAMnF,SAASoF,KAAMpF,SAASiF,MACtEvN,KAAK8f,SAilBX5C,GAAOzT,OAAS,SAAAuD,GAGd,IAHwB,IAChBqI,EAAYrI,EAAZqI,QACF4K,EAAgBxY,EAAgBa,SAASmF,KAAMnF,SAASoF,KAAMpF,SAASiF,MACpEjH,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIF,EAAI,EAAGA,EAAIkC,SAASmF,KAAMrH,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EAAG,CACzC,IAAM+Z,EAAa7K,EAAQ/O,GAAGF,GAAGD,GACjC,GAAI+Z,EAAY,CACd,IAAMhE,EAAUvc,KAAKC,UAAUsgB,GACzB7D,EAAO1c,KAAKwc,MAAMD,GACxBG,EAAKle,KAAO+hB,EAAW9V,YAAYC,KACnC4V,EAAc3Z,GAAGF,GAAGD,GAAKkW,GAUjC,MAJa,CACXhH,QAAS4K,IAMb/C,GAAOd,KAAO,SAAAC,GAIZ,IAJoB,IACZhH,EAAYgH,EAAZhH,QACF8K,EAAkB1Y,EAAgBa,SAASmF,KAAMnF,SAASoF,KAAMpF,SAASiF,MAEtEjH,EAAI,EAAGA,EAAIgC,SAASiF,KAAMjH,GAAK,EACtC,IAAK,IAAIF,EAAI,EAAGA,EAAIkC,SAASmF,KAAMrH,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAImC,SAASmF,KAAMtH,GAAK,EAAG,CACzC,IAAM+Z,EAAa7K,EAAQ/O,GAAGF,GAAGD,GACjC,GAAI+Z,EAAY,CACd,IAAIlQ,EAAS,KACb,OAAQkQ,EAAW/hB,MACjB,IAAK,OACH6R,EAAS,IAAIsM,GAAK4D,GAClB,MACF,IAAK,OACHlQ,EAAS,IAAI8M,GAAKoD,GAClB,MACF,IAAK,UACHlQ,EAAS,IAAIgN,GAAQkD,GACrB,MACF,IAAK,QACHlQ,EAAS,IAAIiN,GAAMiD,GAMvBC,EAAgB7Z,GAAGF,GAAGD,GAAK6J,GAOnC,OADe,IAAIkN,GAAOiD,IAIbjD,UCnqBTzK,GACJ,SAAAA,EAAYoI,GAAS,IAAAhY,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAyS,GAAAzS,KAQrB8N,MAAQ,WACNjL,EAAKgY,QAAU3T,EAAgBoB,SAASoF,KAAMpF,SAASmF,KAAM,IAT1CzN,KAYrB2S,SAAW,SAAAnM,GACT,IAAM1J,EAAS+F,EAAKgY,QAAQrU,EAASJ,GAAGI,EAASL,GAAK,EAClDrJ,GAAUwL,SAASiF,OACrB1K,EAAKgY,QAAQrU,EAASJ,GAAGI,EAASL,GAAKrJ,IAftBkD,KAmBrB0S,SAAW,SAAAlM,GACT,IAAM1J,EAAS+F,EAAKgY,QAAQrU,EAASJ,GAAGI,EAASL,GAAK,EAClDrJ,GAAU,IACZ+F,EAAKgY,QAAQrU,EAASJ,GAAGI,EAASL,GAAKrJ,IAtBtBkD,KA8BrBwS,MAAQ,SAAAhM,GAAQ,OAAI3D,EAAKgY,QAAQrU,EAASJ,GAAGI,EAASL,IA9BjCnG,KAqCrB6M,SAAW,SAAC7C,EAAQyC,GAElB,IAAI2T,EACJ,OAAQpW,GACN,KAAKtE,EAAYC,MACfya,EAAcvd,EAAKgY,QACnB,MACF,KAAKnV,EAAYG,MACfua,EAAcd,IAAQC,MAAM1c,EAAKgY,SACjC,MACF,KAAKnV,EAAYE,KACfwa,EAAcd,IAAQC,MAAMD,IAAQe,UAAUxd,EAAKgY,UACnD,MACF,KAAKnV,EAAYI,KACfsa,EAAcd,IAAQe,UAAUxd,EAAKgY,SACrC,MACF,KAAKnV,EAAYM,OACjB,KAAKN,EAAYK,IACf,OAAO,KACT,QACE,MAAM,IAAIuG,MAAJ,UAAAjN,OAAoB2K,EAApB,wBAaV,IAVA,I5B1C8B9D,EAAKC,EAAGC,E4B0ChCiD,EAAO,GACPX,EAAQ,GASL5K,EAAI,EAAGA,EAAIsiB,EAAY3T,GAAY5O,OAAQC,GAAK,EAAG,CAE1D,IAAM2e,E5BrDH,CACL3V,QAASb,EAFqBC,E4BsDMka,G5BtDDja,E4BsDcrI,G5BpDvB,GAFYsI,E4BsDcqG,G5BpDnB,GACjCsE,IAAK9K,EAAQC,EAAKC,EAAGC,EAAI,GACzBW,SAAUd,EAAQC,EAAKC,EAAI,EAAGC,EAAI,GAClCuT,KAAM1T,EAAQC,EAAKC,EAAI,EAAGC,GAC1BwP,OAAQ3P,EAAQC,EAAKC,EAAGC,GACxB4U,MAAO/U,EAAQC,EAAKC,EAAI,EAAGC,GAC3BY,WAAYf,EAAQC,EAAKC,EAAI,EAAGC,EAAI,GACpC4K,OAAQ/K,EAAQC,EAAKC,EAAGC,EAAI,GAC5Ba,YAAahB,EAAQC,EAAKC,EAAI,EAAGC,EAAI,I4B8CjCU,EACE2V,EADF3V,QAASiK,EACP0L,EADO1L,IAAKhK,EACZ0V,EADY1V,SAAU4S,EACtB8C,EADsB9C,KAAM/D,EAC5B6G,EAD4B7G,OAAQoF,EACpCyB,EADoCzB,MAAOhU,EAC3CyV,EAD2CzV,WAAYgK,EACvDyL,EADuDzL,OAAQ/J,EAC/DwV,EAD+DxV,YAGnEoC,EAAKhJ,KAAK,CAACiR,KAAKkC,IAAI1M,EAASiK,EAAK4I,EAAM/D,GAAStE,KAAKkC,IAAIzC,EAAKhK,EAAU6O,EAAQoF,KACjFtS,EAAMrI,KAAK,CAAEiR,KAAKkC,IAAIxM,EAAYgK,EAAQ2I,EAAM/D,GAAStE,KAAKkC,IAAIxC,EAAQ/J,EAAa2O,EAAQoF,KAGjG,MAAO,CAAEtS,QAAOW,SAjFGrJ,KAuFrBqW,WAAa,WAMX,IANiB,IAEXiK,EADazd,EAAKgY,QAAhBhd,OACuB,EAEzBwW,EAAUnN,EAAgBoZ,EAAeA,EAAe,GAErDla,EAAI,EAAGA,EAAIka,EAAela,GAAK,EACtC,IAAK,IAAID,EAAI,EAAGA,EAAIma,EAAena,GAAK,EAAG,CACzC,IAAMsW,EAAU5V,EAAoBhE,EAAKgY,QAAS1U,EAAGC,GAEnDU,EACE2V,EADF3V,QAASC,EACP0V,EADO1V,SAAUC,EACjByV,EADiBzV,WAAYC,EAC7BwV,EAD6BxV,YAGjCoN,EAAQjO,GAAGD,GAAKmL,KAAKkC,IAAI1M,EAASC,EAAUC,EAAYC,GAK5D,OAAOoN,GAvGLrU,KAAK6a,QADHA,GAGa3T,EAAgBoB,SAASoF,KAAMpF,SAASmF,KAAM,IAyGnEgF,GAAKhJ,OAAS,SAAAmD,GACZ,IAAMsP,EAAUvc,KAAKC,UAAUgN,GAG/B,OAFajN,KAAKwc,MAAMD,IAK1BzJ,GAAK2J,KAAO,SAAAC,GAAQ,IACVxB,EAAYwB,EAAZxB,QAER,OADa,IAAIpI,GAAKoI,IAITpI,UCxHT8N,GACJ,SAAAA,EAAY1f,GAAI,IAAAgC,EAAA7C,KAAA/D,OAAA2L,EAAA,EAAA3L,CAAA+D,KAAAugB,GAAAvgB,KAIhBwgB,SAAW,WAET3d,EAAK0W,QAAQqE,oBAAoB/a,EAAK+J,MAGtC/J,EAAKyW,SAASqC,YAAY9Y,EAAK0W,SAG/B1W,EAAK4d,QAZSzgB,KAehB8N,MAAQ,WACNjL,EAAK0W,QAAQzL,QACbjL,EAAK+X,MAAM9M,QACXjL,EAAKyW,SAASrB,mBACdpV,EAAK2d,YAnBSxgB,KAuBhBgN,OAAS,CACPiD,IAAK,SAAC9R,EAAMuiB,EAAKC,GACf9d,EAAK0W,QAAQtJ,IAAI9R,EAAMuiB,EAAKC,GAC5B9d,EAAK2d,YAEPrQ,OAAQ,SAAAuQ,GACN7d,EAAK0W,QAAQpJ,OAAOuQ,GACpB7d,EAAK2d,YAEPzQ,WAAY,SAAC/F,EAAQ0W,EAAKtQ,EAAMC,GAC9BxN,EAAK0W,QAAQxJ,WAAW/F,EAAQ0W,EAAKtQ,EAAMC,GAC3CxN,EAAK2d,YAGPtK,OAAQ,kBAAMrT,EAAK0W,QAAQrD,UAE3BrJ,SAAU,SAAC7C,EAAQhF,GAAT,OAAmBnC,EAAK0W,QAAQ1M,SAAS7C,EAAQhF,IAC3DiI,oBAAqB,SAACjD,EAAQhF,GAAT,OAAmBnC,EAAK0W,QAAQtM,oBAAoBjD,EAAQhF,KAxCnEhF,KA4ChB4M,KAAO,CAEL+F,SAAU,SAAAiO,GACR/d,EAAK+X,MAAMjI,SAASiO,GACpB/d,EAAK2d,YAGP9N,SAAU,SAAAkO,GACR/d,EAAK+X,MAAMlI,SAASkO,GACpB/d,EAAK2d,YAGPnK,WAAY,kBAAMxT,EAAK+X,MAAMvE,cAE7B7D,MAAO,SAAAoO,GAAE,OAAI/d,EAAK+X,MAAMpI,MAAMoO,IAE9B/T,SAAU,SAAC7C,EAAQhF,GAAT,OAAmBnC,EAAK+X,MAAM/N,SAAS7C,EAAQhF,KA5D3ChF,KAgEhB6E,QAAU,CACRC,cAAe,SAAArG,GACGoE,EAAKyW,SAASxU,cAAcrG,IAE1CoE,EAAK2d,YAGTvI,iBAAkB,WAChBpV,EAAKyW,SAASrB,mBACdpV,EAAK2d,YAEPzb,YAAa,kBAAMlC,EAAKyW,SAASvU,gBA3EnB/E,KA8EhBygB,KAAO,WAEL,IAAMI,EAAMN,EAAU9W,OAAO5G,GAC7Bie,aAAaC,QAAQle,EAAKme,IAAKrhB,KAAKC,UAAUihB,KAhF9C7gB,KAAKghB,IAAMngB,GAoFf0f,GAAUhF,OAAS,SAAA1a,GACjB,IAAM+D,EAAU,IAAI2b,GAAU1f,GAM9B,OALA+D,EAAQ2U,QAAU,IAAI2D,GACtBtY,EAAQgW,MAAQ,IAAInI,GACpB7N,EAAQ0U,SAAW,IAAI6B,EAEvBvW,EAAQ6b,OACD7b,GAGT2b,GAAU9W,OAAS,SAAA7E,GAAW,IACpBoc,EAAkCpc,EAAlCoc,IAAKzH,EAA6B3U,EAA7B2U,QAASqB,EAAoBhW,EAApBgW,MAAOtB,EAAa1U,EAAb0U,SAS7B,MAPa,CACXzY,GAAImgB,EACJhU,OAAQkQ,GAAOzT,OAAO8P,GACtB3M,KAAM6F,GAAKhJ,OAAOmR,GAClB/V,QAASsW,EAAQ1R,OAAO6P,KAM5BiH,GAAUnE,KAAO,SAAAC,GAAQ,IACfxb,EAA8Bwb,EAA9Bxb,GAAImM,EAA0BqP,EAA1BrP,OAAQJ,EAAkByP,EAAlBzP,KAAM/H,EAAYwX,EAAZxX,QACpBD,EAAU,IAAI2b,GAAU1f,GAO9B,OANA+D,EAAQ2U,QAAU2D,GAAOd,KAAKpP,GAC9BpI,EAAQgW,MAAQnI,GAAK2J,KAAKxP,GAC1BhI,EAAQ0U,SAAW6B,EAAQiB,KAAKvX,GAEhCD,EAAQ4b,WAED5b,GAGM2b,UCxHTjY,GAAW,CACf7B,EAAG,IACHsC,EAAG,IACHR,MAAO,UACP4I,SAAU,GACV1D,KAAM,GACNC,KAAM,GACNH,KAAM,EACNvE,EAAG,GACHmM,SAAU,IAAIF,IAAwB,CAAE1M,MAAO,WAC/CE,OAAQ,KAEVpE,OAAOiE,SAAWA,GAElB,IAAM1D,IAAU,qDCnBdqc,UAAY,WACV,IAAIC,EAAMJ,aAAaK,QAAQ,mBAO/B,OAHED,EAHGA,EAGGA,EAAIE,MAAM,KAFV,GAIR1iB,QAAQC,IAAIuiB,GACLA,QAGTG,IAAM,SAAAxgB,GACJ,IAAMwb,EAAO1c,KAAKwc,MAAM2E,aAAaK,QAAQtgB,IACvC+D,EAAU2b,GAAUnE,KAAKC,GAG3B6E,EAAMre,EAAKoe,YAKf,OAJAC,EAAMA,EAAIjS,OAAO,SAAA1P,GAAI,OAAIA,IAASsB,KAC9BR,KAAKQ,GACTgC,EAAKye,WAAWJ,GAETtc,QAGTuL,OAAS,SAAAtP,GACP,IAAIqgB,EAAMre,EAAKoe,YAGf,OAFAC,EAAMA,EAAIjS,OAAO,SAAA1P,GAAI,OAAIA,IAASsB,IAClCgC,EAAKye,WAAWJ,GACTA,QAGTK,KAAO,WACL,IACM1gB,EADMgC,EAAKoe,YACFO,MAEf,IAAK3gB,EACH,OAAOgC,EAAK4e,aAGd,IAAMpF,EAAO1c,KAAKwc,MAAM2E,aAAaK,QAAQtgB,IAG7C,OAFgB0f,GAAUnE,KAAKC,SAKjCoF,WAAa,WACX,IAAM5gB,EAAKgC,EAAK6e,aAEVR,EAAMre,EAAKoe,YAKjB,OAJAC,EAAI7gB,KAAKQ,GACTgC,EAAKye,WAAWJ,GAEAX,GAAUhF,OAAO1a,SAInC8gB,KAAO,WACL,IAAM9gB,EAAKgC,EAAK6e,aAEVR,EAAMre,EAAKoe,YACjBC,EAAI7gB,KAAKQ,GACTgC,EAAKye,WAAWJ,GAGhB,IAAMS,EAAOb,aAAaK,QAAQ,qBAIlC,OAFAQ,EAAK9gB,GAAKA,EACM0f,GAAUnE,KAAKuF,SAIjCL,WAAa,SAAAJ,GAAG,OAAIJ,aAAaC,QAAQ,kBAAmBG,SAE5DQ,WAAa,WACX,IAAIE,EAAYd,aAAaK,QAAQ,oBAMrC,OALKS,IACHA,GAAa,GAEfA,EAAYvI,SAASuI,EAAW,IAAM,EACtCd,aAAaC,QAAQ,mBAAoBa,GACzC,aAAAviB,OAAoBuiB,MD7DeL,OACjC5S,GAAa,CACjB3E,OAAQ,EACRuG,OAAQ,CACNpK,EAAG,EACHC,EAAG,EACHE,EAAG,IAKcub,8MAEnBpf,MAAQ,CACNqf,OAAO,sFAGW,IAAA7c,EAAAjF,KAClBqD,SAASE,iBAAiB,UAAW,SAACZ,GAAU,IACtCmf,EAAU7c,EAAKxC,MAAfqf,MACU,MAAdnf,EAAMvG,KACR6I,EAAK/B,SAAS,CAAE4e,OAAQA,uCAKrB,IACCA,EAAU9hB,KAAKyC,MAAfqf,MACR,OACExhB,EAAAC,EAAAC,cAAA,OAAKgF,UAAU,OACblF,EAAAC,EAAAC,cAACuhB,EAAD,CAAUnd,QAASA,GAAS+J,WAAYA,KACtCmT,GACAxhB,EAAAC,EAAAC,cAAA,WACEF,EAAAC,EAAAC,cAACwhB,EAAD,CAAsBpd,QAASA,KAC/BtE,EAAAC,EAAAC,cAACyhB,EAAD,CAAard,QAASA,GAAS+J,WAAYA,cAvBtB7N,IAAMmR,WE/BvCiQ,IAAS5L,OAAOhW,EAAAC,EAAAC,cAAC2hB,GAAD,MAAS9e,SAASC,eAAe,gTCH3CgY,WACJ,SAAAA,WAAY8G,MAAM,IAAAvf,MAAA7C,KAChB,GADgB/D,OAAAomB,oHAAA,EAAApmB,CAAA+D,KAAAsb,YAAAtb,KAalBic,WAAa,SAAAjP,QACX,IAAIsV,cACJ,GAAkB,cAAdzf,MAAK1E,KACPmkB,cAAgBtV,OAAO2Q,mBAClB,CACL,IAAMtI,QAAUrI,OAAOyM,aACvB6I,cAAgBjN,QAAQpG,OAAO,SAAA1P,GAAI,OAAI8Z,SAASxW,MAAK1E,QAAUoB,EAAKpB,OACpEmkB,cAAgBA,cAAcvmB,IAAI,SAAAwD,GAAI,OAAIA,EAAKyQ,SAGjD,IAAMuS,WAAaD,cAAcvmB,IAAI,SAAAwD,GAAI,OAAIA,EAAKsD,MAAK5E,QAEvD,GAA0B,IAAtBskB,WAAW1kB,OACb,OAAO,EAGT,IAAI2kB,gBAAkB,KACtB,OAAQ3f,MAAKrE,IACX,IAAK,MACHgkB,gBAAkBD,WAAWzH,OAAO,SAAC2H,EAAKrQ,GAAN,OAAcA,EAAOqQ,EAAMrQ,EAAOqQ,IACtE,MACF,IAAK,MACHD,gBAAkBD,WAAWzH,OAAO,SAACtH,EAAKpB,GAAN,OAAcA,EAAMd,KAAKkC,IAAIA,EAAKpB,GAAOoB,IAC7E,MACF,IAAK,MACHgP,gBAAkBD,WAAWzH,OAAO,SAACrH,EAAKrB,GAAN,OAAcA,EAAMd,KAAKmC,IAAIA,EAAKrB,GAAOqB,IAMjF,IAAMiP,iBAAmBC,KAAI,GAAAtjB,OAAImjB,gBAAJ,KAAAnjB,OAAuBwD,MAAKxE,KAA5B,KAAAgB,OAAoCwD,MAAKjF,QACtEc,QAAQC,IAAIkE,MAAK5E,KAAMukB,gBAAiB3f,MAAKxE,KAAMwE,MAAKjF,MAAO8kB,iBAAkB,WAAY7f,MAAKtE,QAClG,IAAM0d,WAAayG,mBAAqB7f,MAAKtE,OAE7C,MAAO,CACLA,OAAQ0d,WACRre,MAAO4kB,kBAlDOxiB,KAsDlB0b,WAAa,SAAAkH,GACX,OAAOA,EAAgBpkB,KAAOqE,MAAKrE,IAC9BmB,KAAKC,UAAUgjB,EAAgBzkB,QAAUwB,KAAKC,UAAUiD,MAAK1E,OAC7DykB,EAAgB3kB,OAAS4E,MAAK5E,MAxD/BmkB,KAAM,KACA3jB,KAA8C2jB,KAA9C3jB,KAAMF,OAAwC6jB,KAAxC7jB,OAAQC,GAAgC4jB,KAAhC5jB,GAAIL,KAA4BikB,KAA5BjkB,KAAMF,KAAsBmkB,KAAtBnkB,KAAMI,KAAgB+jB,KAAhB/jB,KAAMT,MAAUwkB,KAAVxkB,MAC5CoC,KAAKvB,KAAOA,KACZuB,KAAKzB,OAASA,OACdyB,KAAKxB,GAAKA,GACVwB,KAAK7B,KAAOA,KACZ6B,KAAK/B,KAAOA,KACZ+B,KAAK3B,KAAOA,KACZ2B,KAAKpC,MAAQA,QAoDbilB,oBAAsB,CAC1B,CAAErkB,GAAI,MAAOL,KAAM,YAAaF,KAAM,UACtC,CAAEO,GAAI,MAAOL,KAAM,YAAaF,KAAM,UACtC,CAAEO,GAAI,MAAOL,KAAM,IAAKF,KAAM,gBAC9B,CAAEO,GAAI,MAAOL,KAAM,YAAaF,KAAM,QACtC,CAAEO,GAAI,MAAOL,KAAM,YAAaF,KAAM,SAGlC6kB,SAAW,SAAApjB,GACf,IAAKA,EACH,OAAO,EAFwB,IAKzBlB,EAAwCkB,EAAxClB,GAAIL,EAAoCuB,EAApCvB,KAAMF,EAA8ByB,EAA9BzB,KAAML,EAAwB8B,EAAxB9B,MAAOS,EAAiBqB,EAAjBrB,KAAME,EAAWmB,EAAXnB,OACrC,IAAKC,IAAOL,IAASF,IAASL,IAAUS,GAAmB,OAAXE,EAC9C,OAAO,EAGT,IAAIwkB,GAAW,EAYf,OAVAF,oBAAoB1mB,QAAQ,SAAA6mB,QACFxe,IAAnBwe,EAAYxkB,IAAoBwkB,EAAYxkB,KAAOA,QAC3BgG,IAArBwe,EAAY7kB,MAAsB6kB,EAAY7kB,OAASA,QAClCqG,IAArBwe,EAAY/kB,MAAsB+kB,EAAY/kB,OAASA,QACjCuG,IAAtBwe,EAAYplB,OAAuBolB,EAAYplB,QAAUA,QACpC4G,IAArBwe,EAAY3kB,MAAsB2kB,EAAY3kB,OAASA,QAChCmG,IAAvBwe,EAAYzkB,QAAwBykB,EAAYzkB,SAAWA,IACjEwkB,GAAW,MAGVA,GAMPzH,WAAWC,OAAS,SAAA9c,GAClB,IAAKA,EACH,MAAO,mBAGT,IAAMiB,EAAiB1E,iEAAUyD,GACjC,OAAKqkB,SAASpjB,IAGdhB,QAAQC,IAAR,mBAAAU,OAA+BM,KAAKC,UAAUF,KACvC,MAHE,IAAI4b,WAAW5b,IAMX4b","file":"static/js/main.b28b38f9.chunk.js","sourcesContent":["import nlp from 'compromise';\n\nconst plugin = {\n  words: {\n    'less than': 'Comparative',\n    'fewer than': 'Comparative',\n    'more than': 'Comparative',\n    'greater than': 'Comparative',\n    'building': 'Noun',\n    'structure': 'Noun',\n    'no': 'Expression'\n  }\n};\nnlp.plugin(plugin);\n\n// Replace problem words or for convenience\nconst REPLACE = {\n  // result\n  no: ['not', 'none'],\n};\n\nconst TYPES = {\n  Structure: ['structure', 'building', 'structures', 'buildings', 'house', 'home', 'domicile', 'complex', 'design'],\n  0: ['cube', 'room', 'area', 'cubes', 'rooms', 'areas', 'elements'], // ObjectsEnum.CUBE\n  1: ['roof', 'roofs', 'rooves', 'covering', 'ceiling', 'gable', 'crown'], // ObjectsEnum.ROOF\n  2: ['tree', 'plant', 'bush', 'trees', 'plants', 'bushes', 'canopy'], // ObjectsEnum.TRUNK\n};\n\nconst PROPS = {\n  area: ['area', 'square footage', 'sf', 'space', 'floor', 'floorspace', 'size', 'expanse', 'breadth', 'field'],\n  height: ['tall', 'height', 'elevation', 'taller', 'shorter', 'ceiling', 'peak', 'stature', 'crest', 'tip', 'zenith'],\n  distToAccess: ['access', 'entry', 'entrance', 'ingress', 'path', 'route', 'exit', 'way', 'door']\n};\n\nconst COMPS = {\n  '===': ['equals', 'same'],\n  '>': ['greater', 'more', 'bigger', 'taller', 'larger', 'above', 'exceeding', 'over', 'further', 'farther'],\n  '<': ['fewer', 'less', 'smaller', 'shorter', 'below', 'under', 'lower', 'beneath'],\n  '>=': ['minimum', 'min', 'littlest', 'least', 'smallest'],\n  '<=': ['maximum', 'max', 'biggest', 'most', 'largest', 'greatest'],\n};\n\nfunction reverseMap(map) {\n  const reverse = {};\n  Object.keys(map).forEach(key => {\n    const synonyms = map[key];\n    synonyms.forEach(synonym => {\n      reverse[synonym] = key;\n    });\n  });\n  return reverse;\n}\n\n// Create inverse map for look ups\nconst COMPS_REVERSE = reverseMap(COMPS);\nconst PROPS_REVERSE = reverseMap(PROPS);\nconst TYPES_REVERSE = reverseMap(TYPES);\nconst REPLACE_REVERSE = reverseMap(REPLACE);\n\n// const FNS = {\n//   // 'MAX': ['', 'same'],\n//   // 'MIN': ['greater', 'more', 'bigger', 'taller', 'larger'],\n//   SUM: ['total', 'any']\n// };\n\n// function splitResults(results) {\n//   const trueResults = [];\n//   results.forEach(result => {\n//     trueResults.push(...result.normal.split(' '));\n//   });\n//   return trueResults;\n// }\n\n// const STOP_WORDS = [\n//   // source: https://nlp.stanford.edu/IR-book/html/htmledition/dropping-common-terms-stop-words-1.html\n//   'a', 'an', 'and', 'are', 'as', 'at', 'be', 'by', 'for', 'from', 'has', 'he', 'in',\n//   'is', 'it', 'its', 'of', 'on', 'that', 'the', 'to', 'was', 'were', 'will', 'with',\n//   // others\n//   'should', 'there'\n// ];\n\nconst getResult = doc => !doc.has('no');\n\nconst getValue = doc => {\n  const numbers = doc.values().numbers();\n  let value = null;\n  if (numbers.length > 0) {\n    let i = 0;\n    while (!numbers[i] && i < numbers.length - 1) {\n      i += 1;\n    }\n    value = numbers[i].toString();\n  }\n  return value;\n};\n\nconst getProp = doc => {\n  // const nounParts = doc.nouns().data();\n\n  // console.log('nounParts', nounParts);\n  // let prop = null;\n  // if (nounParts.length > 0) {\n  //   const propKeys = Object.keys(PROPS_REVERSE);\n\n  //   nounParts.forEach(nounPart => {\n  //     const noun = nounPart.singular;\n  //     if (propKeys.includes(noun)) {\n  //       prop = PROPS_REVERSE[noun];\n  //     }\n  //   });\n  // }\n\n  // const compWords = doc.match('(#Comparative|#Adverb|#Adjective)').out('array');\n  // if (compWords.length > 0) {\n  //   const propKeys = Object.keys(PROPS_REVERSE);\n  //   compWords.forEach(compWord => {\n  //     console.log('compWord', compWord);\n  //     if (propKeys.includes(compWord)) {\n  //       prop = PROPS_REVERSE[compWord];\n  //     }\n  //   });\n  // }\n\n  let prop = null;\n  const propKeys = Object.keys(PROPS_REVERSE);\n  propKeys.forEach(key => {\n    if (doc.has(key)) {\n      prop = PROPS_REVERSE[key];\n    }\n  });\n\n  return prop;\n};\n\nconst getType = doc => {\n  // const nounParts = doc.nouns().data();\n  // let type = '0';\n  // // split multipart nouns into parts\n  // const nouns = splitResults(doc.nouns().data());\n  // if (nouns.length > 0) {\n  //   const typeKeys = Object.keys(TYPES_REVERSE);\n\n  //   nouns.forEach(noun => {\n  //     if (typeKeys.includes(noun)) {\n  //       type = TYPES_REVERSE[noun];\n  //     }\n  //   });\n  // }\n\n  let type = '0';\n  const propKeys = Object.keys(TYPES_REVERSE);\n  propKeys.forEach(key => {\n    if (doc.has(key)) {\n      type = TYPES_REVERSE[key];\n    }\n  });\n  return type;\n};\n\nconst getComp = doc => {\n  let comp = null;\n  const compKeys = Object.keys(COMPS_REVERSE);\n  compKeys.forEach(key => {\n    if (doc.has(key)) {\n      comp = COMPS_REVERSE[key];\n    }\n  });\n  return comp;\n};\n\nconst getFn = (result, comp) => {\n  let fn = null;\n  if (!result) {\n    if (comp === '>' || comp === '>=') {\n      fn = 'MAX';\n    } else if (comp === '<' || comp === '<=') {\n      fn = 'MIN';\n    } else if (comp === '===') {\n      fn = 'SUM';\n    }\n  } else {\n    if (comp === '>' || comp === '>=') { // eslint-disable-line\n      fn = 'MIN';\n    } else if (comp === '<' || comp === '<=') {\n      fn = 'MAX';\n    } else if (comp === '===') {\n      fn = 'SUM';\n    }\n  }\n  return fn;\n};\n\nexport default function parseText(text) {\n  console.log('Original text: ' + text);\n\n  // Clean up to lower case and remove symbols\n  let cleanText = text.toLowerCase().replace(/[.,-/#!$%^&*;:{}=\\-_`()]/g, '').trim();\n\n  // Remove contractions and 'normalize'\n  cleanText = nlp(cleanText).normalize().out();\n\n  // Replace keywords with synonyms\n  Object.keys(REPLACE_REVERSE).forEach(word => {\n    const replacement = REPLACE_REVERSE[word];\n    cleanText = cleanText.replace(new RegExp(`${word} `, 'g'), `${replacement} `);\n  });\n\n  console.log('Cleaned text: ' + cleanText);\n  // Parse cleaned up text into parts of speech\n  const doc = nlp(cleanText);\n\n  // Log parts\n  const pos = doc.out('tags');\n  const display = pos.map(item => `[${item.text}: ${item.tags.join(',')}]`).join('');\n  console.log('pos: ' + display);\n\n  const result = getResult(doc);\n  const value = getValue(doc);\n  const type = getType(doc);\n  const prop = getProp(doc);\n  const comp = getComp(doc);\n\n  const fn = getFn(result, comp);\n\n  const constraintData = { text, result, fn, type, prop, comp, value }; // eslint-disable-line\n  // It should look something like this\n  // const constraintData = {\n  //   result: true,\n  //   fn: 'MAX',\n  //   type: 'Cube',\n  //   prop: 'area',\n  //   comp: '<',\n  //   value: 50\n  // };\n\n  console.log(`Constraint result: \\n${JSON.stringify(constraintData)}`);\n\n  return constraintData;\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\n/** Class for the side panel of 'light buttons' */\nexport default class Menu extends React.PureComponent {\n  static propTypes = {\n    // Array of ActionsEnum to show\n    actions: PropTypes.array.isRequired, // eslint-disable-line react/forbid-prop-types\n    // Function to call when button is clicked\n    onClick: PropTypes.func.isRequired // eslint-disable-line react/forbid-prop-types\n  }\n\n  render() {\n    const buttonElements = [];\n\n    const { actions, onClick, action } = this.props;\n    if (actions) {\n      actions.forEach(item => {\n        buttonElements.push((\n          <button\n            type=\"button\"\n            key={item.label}\n            onClick={e => {\n              e.preventDefault();\n              onClick(item);\n            }}\n            style={{ display: 'block' }}\n          >\n            {item.label + (item.id === action.id ? '_' : '')}\n          </button>\n        ));\n      });\n    }\n\n    return (\n      <div>\n        {buttonElements}\n      </div>\n    );\n  }\n}\n","const ActionsEnum = {\n  STEPOUT: { id: 0, label: 'STEP OUT' }, // Retreat to the previous slice\n  STEPIN: { id: 1, label: 'STEP  IN' }, // Advance to the next slice\n  ADDCUBE: { id: 2, label: 'ADD CUBE' }, // Add a cube\n  REMOVE: { id: 3, label: 'RE  MOVE' }, // Remove an object\n  ROTATELT: { id: 4, label: 'ROTATELT' }, // Rotate the view to the right\n  ROTATERT: { id: 5, label: 'ROTATERT' }, // Rotate the view to the left\n  ADDTREE: { id: 6, label: 'ADD TREE' }, // Add a Tree (trunk and foliage)\n  ADD_ROOF_NORTH: { id: 7, label: 'ADDROOFN' }, // Add Angled Roof down towards north\n  ADD_ROOF_SOUTH: { id: 8, label: 'ADDROOFS' }, // Add Angled Roof down towards south\n  WALKTHRU: { id: 9, label: 'WALKTHRU' }, // Start walkthrough\n  // EDITTOPO: { id: 10, label: 'EDITTOPO' }, // Edit topo mode\n  SPEAK_CONSTRAINT: { id: 11, label: 'SPEAK' }, // Enter text constraint\n  INCREASE_HEIGHT: { id: 12, label: 'INCRS HT' },\n  DECREASE_HEIGHT: { id: 13, label: 'DECRS HT' },\n  SOLID_SURFACE: { id: 14, label: 'SOLIDSRF' },\n  PARTITION_SURFACE: { id: 15, label: 'PARTTION' },\n  TRANSPARENT_SURFACE: { id: 16, label: 'TRANSPNT' },\n  NO_SURFACE: { id: 17, label: 'NO SRF' },\n  HAS_ACCESS: { id: 18, label: 'HASACCSS' },\n  NO_ACCESS: { id: 19, label: 'NO ACCSS' },\n  ADD_ROOF_WEST: { id: 20, label: 'ADDROOFW' }, // Add Angled Roof down towards west\n  ADD_ROOF_EAST: { id: 21, label: 'ADDROOFE' }, // Add Angled Roof down towards east\n\n  isAdd: action => [2, 6, 7, 8, 20, 21].includes(action.id),\n};\n\nexport default ActionsEnum;\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\n/* global document */\n\n/** Class for the top of the screen where text interaction with URBAN5 takes place */\nexport default class TextInput extends React.PureComponent {\n  static propTypes = {\n    onSubmit: PropTypes.func.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    value: ''\n  };\n\n  componentDidMount() {\n    this.input = document.getElementById('speak');\n    this.input.addEventListener('keydown', this.handleKeyDown);\n    this.input.focus();\n  }\n\n  componentWillUnmount() {\n    this.input.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  handleKeyDown = event => {\n    if (event.keyCode === 13) { // Is 'Enter'\n      this.handleSubmit();\n    }\n    switch (event.keyCode) {\n      default:\n        break;\n    }\n  };\n\n  handleChange = event => {\n    const val = event.target.value;\n    // const last = val[val.length - 1];\n    // const start = val.substring(0, val.length - 2);\n    // const actualVal = `${start}${last}_`;\n    const actualVal = val;\n    this.setState({ value: actualVal });\n  };\n\n  handleSubmit = () => {\n    const { onSubmit } = this.props;\n    const { value } = this.state;\n\n    onSubmit(value);\n    this.setState({ value: '' });\n  };\n\n  render() {\n    const { value } = this.state;\n\n    return (\n      <div>\n        <input type=\"text\" id=\"speak\" autoComplete=\"off\" spellCheck=\"false\" value={value} onChange={this.handleChange} />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport ActionsEnum from '../js/enums/ActionsEnum';\nimport TextInput from './TextInput';\n\n/* global window */\n/* global document */\n\n/** Class for the top of the screen where text interaction with URBAN5 takes place */\nexport default class Top extends React.PureComponent {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    action: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    textMessages: []\n  };\n\n  componentDidMount() {\n    const { session } = this.props;\n\n    const poll = () => {\n      const textMessages = session.monitor.getMessages();\n      this.setState({ textMessages });\n      setTimeout(poll, 100);\n    };\n    poll();\n  }\n\n  onMessage = newMessage => {\n    this.setState(prevState => ({ textMessages: [...prevState.textMessages, newMessage] }));\n  }\n\n  componentDidUpdate = () => {\n    this.scrollElement();\n  }\n\n  scrollElement = () => {\n    window.requestAnimationFrame(() => {\n      const container = document.getElementById('topContainer');\n      if (container !== undefined) {\n        container.scrollTop = container.scrollHeight + 100;\n      }\n    });\n  };\n\n  onSpeak = text => {\n    const { session } = this.props;\n\n    session.monitor.addConstraint(text);\n\n    const textMessages = session.monitor.getMessages();\n    this.setState({ textMessages: textMessages.slice() });\n  };\n\n  render() {\n    const { action } = this.props;\n    const { textMessages } = this.state;\n\n    let textInput = null;\n\n    if (action === ActionsEnum.SPEAK_CONSTRAINT) {\n      textInput = (<TextInput onSubmit={this.onSpeak} />);\n    }\n\n    const messageElements = textMessages.map(message => (\n      <div className=\"mono-text\" key={message}>{message}</div>\n    ));\n\n    return (\n      <div id=\"topContainer\" style={{ overflow: 'hidden', height: '75px' }}>\n        { messageElements }\n        { textInput }\n      </div>\n    );\n  }\n}\n","// These are the 2D slice views of the 3D model\nconst CamerasEnum = {\n  NORTH: 0,\n  EAST: 1,\n  SOUTH: 2,\n  WEST: 3,\n  TOP: 4,\n  BOTTOM: 5,\n};\n\nexport default CamerasEnum;\n","/**\n* Helper functions for dealing with arrays.\n*/\n\nfunction getSafe(arr, x, y) {\n  if (x >= 0 && arr.length > 0 && arr[0].length && x < arr[0].length && y >= 0 && y < arr.length) {\n    return arr[y][x];\n  }\n  return null;\n}\n\nfunction getSafe3D(arr, x, y, z) {\n  if (arr.length > 0 && arr[0].length && arr[0][0].length\n      && x >= 0 && x < arr[0][0].length\n      && y >= 0 && y < arr[0].length\n      && z >= 0 && z < arr.length) {\n    return arr[z][y][x];\n  }\n  return null;\n}\n\n/**\n* Given a 2D array 'arr' and a position, get the position and all cells around it as an object\n* This can be unpacked as follows:\n* const { topLeft, top, topRight, left, center, right, bottomLeft, bottom, bottomRight } = context;\n*/\nexport function getCellContext3x3(arr, x, y) {\n  return {\n    topLeft: getSafe(arr, x - 1, y + 1),\n    top: getSafe(arr, x, y + 1),\n    topRight: getSafe(arr, x + 1, y + 1),\n    left: getSafe(arr, x - 1, y),\n    center: getSafe(arr, x, y),\n    right: getSafe(arr, x + 1, y),\n    bottomLeft: getSafe(arr, x - 1, y - 1),\n    bottom: getSafe(arr, x, y - 1),\n    bottomRight: getSafe(arr, x + 1, y - 1)\n  };\n}\n\n/**\n* Given a 2D array 'arr' and a position, get the position and all cells around it as an object\n* This can be unpacked as follows:\n* const { n, e, s, w, t, b } = context;\n*/\nexport function getCellContext3D(arr, position) {\n  const { x, y, z } = position;\n  return {\n    w: getSafe3D(arr, x - 1, y, z),\n    n: getSafe3D(arr, x, y + 1, z),\n    e: getSafe3D(arr, x + 1, y, z),\n    s: getSafe3D(arr, x, y - 1, z),\n    t: getSafe3D(arr, x, y, z + 1),\n    b: getSafe3D(arr, x, y, z - 1)\n  };\n}\n\n/**\n* Given a 2D array 'arr' and a position of a corner, get the height of all adjacent cells around it as an object\n* This can be unpacked as follows:\n* const { topLeft, topRight, bottomLeft, bottomRight } = context;\n*/\nexport function getCornerContext2x2(arr, x, y) {\n  return {\n    topLeft: getSafe(arr, x - 1, y),\n    topRight: getSafe(arr, x, y),\n    bottomLeft: getSafe(arr, x - 1, y - 1),\n    bottomRight: getSafe(arr, x, y - 1)\n  };\n}\n\n/**\n * Returns an empty 2D array\n * @param {int} rows - Number of rows in the array\n * @param {int} columns - Number of columns in the array\n * @param defaultValue - Default value for new array cells\n */\nexport function getEmpty2DArray(rows, columns, defaultValue = null) {\n  const arr = new Array(rows);\n  for (let i = 0; i < rows; i += 1) {\n    arr[i] = new Array(columns);\n    for (let j = 0; j < columns; j += 1) {\n      arr[i][j] = defaultValue;\n    }\n  }\n  return arr;\n}\n\nexport function getEmpty3DArray(x, y, z) {\n  const arr = new Array(z);\n\n  for (let i = 0; i < arr.length; i += 1) {\n    arr[i] = getEmpty2DArray(y, x, null);\n  }\n\n  return arr;\n}\n","import { createjs } from '@createjs/easeljs';\n\n/* global SETTINGS */\n\nexport default class TopoRenderer2D {\n  constructor(stage) {\n    this.stage = stage;\n  }\n\n  draw = topoSlice => {\n    const line = new createjs.Shape();\n    let cornerX;\n    let cornerY;\n\n    // Draw the front heights left to right as a connected line\n    cornerX = 1;\n    line.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    topoSlice.front.forEach(s => {\n      const [ startHeight, endHeight ] = s;\n      cornerY = SETTINGS.h - 1 - (startHeight * SETTINGS.r);\n      line.graphics.moveTo(cornerX, cornerY);\n      cornerX += SETTINGS.r;\n      cornerY = SETTINGS.h - 1 - (endHeight * SETTINGS.r);\n      line.graphics.lineTo(cornerX, cornerY);\n    });\n    line.graphics.endStroke();\n\n    // Draw the back heights left to right as a dashed line\n    cornerX = 1;\n    line.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    line.graphics.setStrokeDash([4, 8], 0);\n    topoSlice.back.forEach(s => {\n      const [ startHeight, endHeight ] = s;\n      cornerY = SETTINGS.h - 1 - (startHeight * SETTINGS.r);\n      line.graphics.moveTo(cornerX, cornerY);\n      cornerX += SETTINGS.r;\n      cornerY = SETTINGS.h - 1 - (endHeight * SETTINGS.r);\n      line.graphics.lineTo(cornerX, cornerY);\n    });\n    line.graphics.endStroke();\n\n    this.stage.addChild(line);\n  }\n}\n","const SurfacesEnum = Object.freeze({\n  SOLID: 0,\n  TRANS: 1,\n  PART: 2,\n  NONE: 3\n});\n\nexport default SurfacesEnum;\n","import { createjs } from '@createjs/easeljs';\nimport CamerasEnum from '../enums/CamerasEnum';\nimport SurfacesEnum from '../enums/SurfacesEnum';\n\n/* global SETTINGS */\n\n/** Class responsible for rendering a 2D slice */\nexport default class DesignRenderer2D {\n  constructor(stage) {\n    this.stage = stage;\n  }\n\n  /**\n   * Add a slice to the view\n   * @param {int} camera - CamerasEnum\n   * @param {int[][]} slice - 2D array representing slice to add\n   * @param {boolean} isDashed - Whether the lines should be dashed or not\n   */\n  drawSlice = (camera, slice, isDashed = false) => {\n    this.camera = camera;\n    for (let y = 0; y < slice.length; y += 1) {\n      const row = slice[y];\n      for (let x = 0; x < row.length; x += 1) {\n        const cell = row[x];\n\n        if (cell) {\n          switch (cell.constructor.name) {\n            case 'Cube':\n              this.drawCube(cell, camera, this.stage, x, y, isDashed);\n              break;\n            case 'Roof':\n              this.drawRoof(cell, camera, this.stage, x, y, isDashed);\n              break;\n            case 'Foliage':\n              // Dont draw background trees\n              if (!isDashed) {\n                this.drawFoliage(camera, this.stage, x, y, isDashed);\n              }\n              break;\n            case 'Trunk':\n              // Dont draw background trees\n              if (!isDashed) {\n                this.drawTrunk(camera, this.stage, x, y, isDashed);\n              }\n              break;\n            default:\n              break;\n          }\n        }\n      }\n    }\n  };\n\n  /**\n   * Draw points that match the size of the current slice\n   * @param {int[][]} slice - 2D array representing slice to add\n   */\n  drawGridPoints = slice => {\n    for (let y = 0; y < slice.length; y += 1) {\n      const row = slice[y];\n      for (let x = 0; x < row.length; x += 1) {\n        const point = new createjs.Shape();\n        const contextX = (x + 0.5) * SETTINGS.r;\n        const contextY = SETTINGS.h - ((y + 0.5) * SETTINGS.r);\n\n        point.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke - 1).drawRect(contextX, contextY, 2, -2);\n        this.stage.addChild(point);\n      }\n    }\n  };\n\n  /**\n   * Draw a circle at the location\n   * @param {int} x\n   * @param {int} y\n   */\n  drawCircle = (x, y) => {\n    const circle = new createjs.Shape();\n\n    circle.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    const cornerX = ((x + 0.5) * SETTINGS.r) + 1;\n    const cornerY = SETTINGS.h - ((y + 0.45) * SETTINGS.r) - 1;\n    circle.graphics.drawCircle(cornerX, cornerY, SETTINGS.r * 0.40);\n\n    this.stage.addChild(circle);\n  };\n\n  drawCube = (cube, camera, stage, x, y, isDashed = false) => {\n    let drawLeft, drawTop, drawRight, drawBottom;\n    const s = cube.surfaces;\n    // Lines on the sides require knowing the camera angle\n    switch (camera) {\n      case CamerasEnum.NORTH:\n        drawLeft = s.w === SurfacesEnum.SOLID;\n        drawTop = s.t === SurfacesEnum.SOLID;\n        drawRight = s.e === SurfacesEnum.SOLID;\n        drawBottom = s.b === SurfacesEnum.SOLID;\n        break;\n      case CamerasEnum.SOUTH:\n        drawLeft = s.e === SurfacesEnum.SOLID;\n        drawTop = s.t === SurfacesEnum.SOLID;\n        drawRight = s.w === SurfacesEnum.SOLID;\n        drawBottom = s.b === SurfacesEnum.SOLID;\n        break;\n      case CamerasEnum.EAST:\n        drawLeft = s.n === SurfacesEnum.SOLID;\n        drawTop = s.t === SurfacesEnum.SOLID;\n        drawRight = s.s === SurfacesEnum.SOLID;\n        drawBottom = s.b === SurfacesEnum.SOLID;\n        break;\n      case CamerasEnum.WEST:\n        drawLeft = s.s === SurfacesEnum.SOLID;\n        drawTop = s.t === SurfacesEnum.SOLID;\n        drawRight = s.n === SurfacesEnum.SOLID;\n        drawBottom = s.b === SurfacesEnum.SOLID;\n        break;\n      case CamerasEnum.TOP:\n        drawLeft = s.w === SurfacesEnum.SOLID;\n        drawTop = s.n === SurfacesEnum.SOLID;\n        drawRight = s.e === SurfacesEnum.SOLID;\n        drawBottom = s.s === SurfacesEnum.SOLID;\n        break;\n      case CamerasEnum.BOTTOM:\n        drawLeft = s.w === SurfacesEnum.SOLID;\n        drawTop = s.s === SurfacesEnum.SOLID;\n        drawRight = s.e === SurfacesEnum.SOLID;\n        drawBottom = s.n === SurfacesEnum.SOLID;\n        break;\n      default:\n        return;\n    }\n\n    this._drawCubeSquare(stage, x, y, isDashed, drawLeft, drawTop, drawRight, drawBottom);\n  };\n\n  _drawCubeSquare = (stage, x, y, isDashed = false, drawLeft = true, drawTop = true, drawRight = true, drawBottom = true) => {\n    const shape = new createjs.Shape();\n    shape.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n\n    const sx = (x * SETTINGS.r) + 1;\n    const dx = SETTINGS.r;\n    const sy = SETTINGS.h - (y * SETTINGS.r) - 1;\n    const dy = -SETTINGS.r;\n\n    if (isDashed) {\n      shape.graphics.setStrokeDash([4, 8], 0);\n    }\n\n    if (drawLeft) { // left\n      shape.graphics.moveTo(sx, sy).lineTo(sx, sy + dy);\n    }\n    if (drawTop) { // top\n      shape.graphics.moveTo(sx, sy + dy).lineTo(sx + dx, sy + dy);\n    }\n    if (drawRight) { // right\n      shape.graphics.moveTo(sx + dx, sy + dy).lineTo(sx + dx, sy);\n    }\n    if (drawBottom) { // bottom\n      shape.graphics.moveTo(sx + dx, sy).lineTo(sx, sy);\n    }\n\n    stage.addChild(shape);\n  };\n\n  drawRoof = (roof, camera, stage, x, y, isDashed = false) => {\n    switch (camera) {\n      case CamerasEnum.NORTH:\n        if (roof.direction === 'n' || roof.direction === 's') {\n          this._drawRoofSquare(stage, x, y, isDashed);\n        } else if (roof.direction === 'w') {\n          this._drawRoofSlantLeft(roof, stage, x, y, isDashed);\n        } else if (roof.direction === 'e') {\n          this._drawRoofSlantRight(roof, stage, x, y, isDashed);\n        }\n        break;\n      case CamerasEnum.SOUTH:\n        if (roof.direction === 'n' || roof.direction === 's') {\n          this._drawRoofSquare(stage, x, y, isDashed);\n        } else if (roof.direction === 'e') {\n          this._drawRoofSlantLeft(roof, stage, x, y, isDashed);\n        } else if (roof.direction === 'w') {\n          this._drawRoofSlantRight(roof, stage, x, y, isDashed);\n        }\n        break;\n      case CamerasEnum.EAST:\n        if (roof.direction === 'e' || roof.direction === 'w') {\n          this._drawRoofSquare(stage, x, y, isDashed);\n        } else if (roof.direction === 's') {\n          this._drawRoofSlantRight(roof, stage, x, y, isDashed);\n        } else if (roof.direction === 'n') {\n          this._drawRoofSlantLeft(roof, stage, x, y, isDashed);\n        }\n        break;\n      case CamerasEnum.WEST:\n        if (roof.direction === 'e' || roof.direction === 'w') {\n          this._drawRoofSquare(stage, x, y, isDashed);\n        } else if (roof.direction === 'n') {\n          this._drawRoofSlantRight(roof, stage, x, y, isDashed);\n        } else if (roof.direction === 's') {\n          this._drawRoofSlantLeft(roof, stage, x, y, isDashed);\n        }\n        break;\n      case CamerasEnum.TOP:\n      case CamerasEnum.BOTTOM:\n        this._drawRoofSquare(stage, x, y, isDashed);\n        break;\n      default:\n    }\n  };\n\n  _drawRoofSquare = (stage, x, y, isDashed = false) => {\n    const shape = new createjs.Shape();\n    shape.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n\n    const sx = (x * SETTINGS.r) + 1;\n    const dx = SETTINGS.r;\n    const sy = SETTINGS.h - (y * SETTINGS.r) - 1;\n    const dy = -SETTINGS.r;\n\n    if (isDashed) {\n      shape.graphics.setStrokeDash([3, 7], 0);\n    }\n\n    shape.graphics.drawRect(sx, sy, dx, dy);\n    stage.addChild(shape);\n  };\n\n  /**\n   * Draw a line that slants down to the left\n   * @param {int} x\n   * @param {int} y\n   */\n  _drawRoofSlantLeft = (obj, stage, x, y, isDashed = false) => {\n    const roof = new createjs.Shape();\n\n    if (isDashed) {\n      roof.graphics.setStrokeDash([4, 8], 0);\n    }\n\n    let cornerX = (x * SETTINGS.r) + 1;\n    let cornerY = SETTINGS.h - (y * SETTINGS.r) - 1;\n    roof.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    roof.graphics.moveTo(cornerX, cornerY);\n    cornerX += SETTINGS.r;\n    cornerY -= SETTINGS.r;\n    roof.graphics.lineTo(cornerX, cornerY);\n\n    if (obj.hasSideSurface) {\n      roof.graphics.moveTo(cornerX, cornerY);\n      cornerY += SETTINGS.r;\n      roof.graphics.lineTo(cornerX, cornerY);\n    }\n    roof.graphics.endStroke();\n\n    stage.addChild(roof);\n  };\n\n  /**\n   * Draw a line that slants down to the right\n   * @param {int} x\n   * @param {int} y\n   */\n  _drawRoofSlantRight = (obj, stage, x, y, isDashed = false) => {\n    const roof = new createjs.Shape();\n\n    if (isDashed) {\n      roof.graphics.setStrokeDash([4, 8], 0);\n    }\n\n    let cornerX = (x * SETTINGS.r) + 1;\n    let cornerY = SETTINGS.h - ((y + 1) * SETTINGS.r) - 1;\n    roof.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    roof.graphics.moveTo(cornerX, cornerY);\n    cornerX += SETTINGS.r;\n    cornerY += SETTINGS.r;\n    roof.graphics.lineTo(cornerX, cornerY);\n\n    if (obj.hasSideSurface) {\n      cornerX -= SETTINGS.r;\n      cornerY -= SETTINGS.r;\n      roof.graphics.moveTo(cornerX, cornerY);\n      cornerY += SETTINGS.r;\n      roof.graphics.lineTo(cornerX, cornerY);\n    }\n    roof.graphics.endStroke();\n\n    stage.addChild(roof);\n  };\n\n  /**\n   * Draws the circle representing foliage of a tree at the given x and y.\n   * @param {int} x\n   * @param {int} y\n   */\n  drawFoliage = (camera, stage, x, y, isDashed = false) => {\n    const foliage = new createjs.Shape();\n\n    if (isDashed) {\n      foliage.graphics.setStrokeDash([SETTINGS.stroke, 7], 0);\n    }\n\n    foliage.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    const cornerX = ((x + 0.5) * SETTINGS.r) + 1;\n    const cornerY = SETTINGS.h - ((y + 0.45) * SETTINGS.r) - 1;\n    foliage.graphics.drawCircle(cornerX, cornerY, SETTINGS.r * 0.40);\n\n    stage.addChild(foliage);\n  };\n\n  /**\n   * Draws the trunk of a tree at the given x and y.\n   * @param {int} x\n   * @param {int} y\n   * @param {boolean} isDashed - Whether the lines should be dashed or not\n   */\n  drawTrunk = (camera, stage, x, y, isDashed = false) => {\n    const trunk = new createjs.Shape();\n\n    if (isDashed) {\n      trunk.graphics.setStrokeDash([4, 8], 0);\n    }\n\n    trunk.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    const cornerX = ((x + 0.5) * SETTINGS.r) + 1;\n    const cornerY = SETTINGS.h - (y * SETTINGS.r) - 1;\n\n    // The trunk is a rectangle from the side and a dot from the ends\n    switch (camera) {\n      case CamerasEnum.NORTH:\n      case CamerasEnum.SOUTH:\n      case CamerasEnum.WEST:\n      case CamerasEnum.EAST:\n        // Draw a line\n        trunk.graphics.moveTo(cornerX, cornerY).lineTo(cornerX, cornerY - SETTINGS.r);\n        break;\n      case CamerasEnum.TOP:\n      case CamerasEnum.BOTTOM:\n        // Draw no point, because grid point\n        break;\n      default:\n        throw new Error(`camera ${camera} is not recognized!`);\n    }\n\n    stage.addChild(trunk);\n  };\n}\n","import { createjs } from '@createjs/easeljs';\nimport CamerasEnum from './enums/CamerasEnum';\nimport { getEmpty2DArray } from './helpers/ArrayHelpers';\n\nimport TopoRenderer2D from './renderers/TopoRenderer2D';\nimport DesignRenderer2D from './renderers/DesignRenderer2D';\n\n/* global SETTINGS */\n\n/** Class responsible for rednering a 2D slice */\nexport default class Display2DView {\n  constructor(canvas, session) {\n    this.session = session;\n    this.stage = new createjs.Stage(canvas);\n    this.designRenderer = new DesignRenderer2D(this.stage);\n    this.topoRenderer = new TopoRenderer2D(this.stage);\n\n    this.drawBackground = true; // Whether background slices should be rendered\n  }\n\n  /**\n   * Draw the given sliceIndex for the camera angle to the screen\n   * @param {int} camera - CamerasEnum\n   * @param {int} sliceIndex - Index of slice of model from given camera view to draw\n   * @param {int} isBackgroundDashed - Draw objects in background slices as dashed lines\n   */\n  draw = (camera, sliceIndex, isBackgroundDashed = true) => {\n    // Clear the screen\n    this.stage.removeAllChildren();\n\n    // Draw the topography\n    const topoSlice = this.session.topo.getSlice(camera, sliceIndex);\n    if (topoSlice) {\n      this.topoRenderer.draw(topoSlice);\n    }\n\n    // Draw the background slices\n    if (this.drawBackground) {\n      const backgroundSlices = this.session.design.getBackgroundSlices(camera, sliceIndex);\n      backgroundSlices.forEach(s => this.designRenderer.drawSlice(camera, s, isBackgroundDashed));\n    }\n\n    // Draw the given slice\n    const currentSlice = this.session.design.getSlice(camera, sliceIndex);\n    this.designRenderer.drawSlice(camera, currentSlice);\n\n    // Draw the grid of appropriate size for this slice\n    this.designRenderer.drawGridPoints(currentSlice);\n\n    // Render to the screen\n    this.stage.update();\n  };\n\n  /**\n   * Draw a version where all the layers are compressed into a single top view\n   */\n  drawTopCompressedView = () => {\n    // Clear the screen\n    this.stage.removeAllChildren();\n\n    const allSlices = this.session.design.getBackgroundSlices(CamerasEnum.TOP, SETTINGS.zMax);\n    // Reverse to go from bottom up\n    allSlices.reverse();\n\n    // Create master slice from all slices\n    const masterSlice = getEmpty2DArray(SETTINGS.xMax, SETTINGS.yMax, null);\n    for (let y = 0; y < SETTINGS.yMax; y += 1) {\n      for (let x = 0; x < SETTINGS.xMax; x += 1) {\n        let topObj = null;\n        allSlices.forEach(slice => {\n          const obj = slice[y][x];\n          if (obj) {\n            topObj = obj;\n          }\n        });\n        masterSlice[y][x] = topObj;\n      }\n    }\n\n    this.designRenderer.drawSlice(CamerasEnum.TOP, masterSlice);\n\n    // Render to the screen\n    this.stage.update();\n  };\n\n  /** Update the screen */\n  update = () => {\n    this.stage.update();\n  };\n\n  /** Clear the screen */\n  clear = () => {\n    this.stage.removeAllChildren();\n    this.stage.update();\n  };\n\n  /**\n   * Draw a line representing the 1D slice of topography\n   * @param {array} topoSlice - heights at given locations\n   */\n  _drawTopoSlice = topoSlice => {\n    const line = new createjs.Shape();\n    let cornerX = 1;\n    let cornerY;\n    line.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n\n    // Draw the heights left to right as a connected line\n    topoSlice.forEach(s => {\n      const { startHeight, endHeight } = s;\n      cornerY = SETTINGS.h - 1 - (startHeight * SETTINGS.r);\n      line.graphics.moveTo(cornerX, cornerY);\n      cornerX += SETTINGS.r;\n      cornerY = SETTINGS.h - 1 - (endHeight * SETTINGS.r);\n      line.graphics.lineTo(cornerX, cornerY);\n    });\n    line.graphics.endStroke();\n\n    this.stage.addChild(line);\n  };\n\n  /**\n   * Add a slice to the view\n   * @param {int} camera - CamerasEnum\n   * @param {int[][]} slice - 2D array representing slice to add\n   * @param {boolean} isDashed - Whether the lines should be dashed or not\n   */\n  _drawSlice = (camera, slice, isDashed = false) => {\n    this.camera = camera;\n    for (let y = 0; y < slice.length; y += 1) {\n      const row = slice[y];\n      for (let x = 0; x < row.length; x += 1) {\n        const cell = row[x];\n\n        if (cell) {\n          cell.draw2D(camera, this.stage, x, y, isDashed);\n        }\n      }\n    }\n  };\n\n  /**\n   * Draw points that match the size of the current slice\n   * @param {int[][]} slice - 2D array representing slice to add\n   */\n  _drawGridPoints = slice => {\n    for (let y = 0; y < slice.length; y += 1) {\n      const row = slice[y];\n      for (let x = 0; x < row.length; x += 1) {\n        const point = new createjs.Shape();\n        const contextX = (x + 0.5) * SETTINGS.r;\n        const contextY = SETTINGS.h - ((y + 0.5) * SETTINGS.r);\n\n        point.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke - 1).drawRect(contextX, contextY, 2, -2);\n        this.stage.addChild(point);\n      }\n    }\n  };\n\n  /**\n   * Draw a circle at the location\n   * @param {int} x\n   * @param {int} y\n   */\n  drawCircle = (x, y) => {\n    const circle = new createjs.Shape();\n\n    circle.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);\n    const cornerX = ((x + 0.5) * SETTINGS.r) + 1;\n    const cornerY = SETTINGS.h - ((y + 0.45) * SETTINGS.r) - 1;\n    circle.graphics.drawCircle(cornerX, cornerY, SETTINGS.r * 0.40);\n\n    this.stage.addChild(circle);\n  };\n}\n","// Various objects that can occupy a single cube in space\nconst ObjectsEnum = {\n  CUBE: 0,\n  ROOF: 1,\n  TRUNK: 2,\n  FOLIAGE: 3,\n  PERSON: 4,\n};\n\nexport default ObjectsEnum;\n","import CamerasEnum from './enums/CamerasEnum';\nimport ActionsEnum from './enums/ActionsEnum';\nimport ObjectsEnum from './enums/ObjectsEnum';\nimport SurfacesEnum from './enums/SurfacesEnum';\n\n/* global SETTINGS */\n\n/** Class to control rotating to different slice angles and elevations and moving through slices */\nexport default class Display2DController {\n  constructor(session, cameraView) {\n    this.session = session;\n\n    this.gridSize = SETTINGS.gridSize;\n    this.xMax = SETTINGS.xMax;\n    this.yMax = SETTINGS.yMax;\n    this.zMax = SETTINGS.zMax;\n\n    this.cameraView = cameraView;\n    this.views = [];\n    this.isBackgroundDashed = true;\n\n    this.updateViews();\n  }\n\n  addListener = view => this.views.push(view)\n\n  removeListener = toRemove => this.views.filter(view => view !== toRemove)\n\n  doAction = (action, clickX, clickY, modifier) => {\n    const modelPosition = this.getRelativePosition(clickX, clickY);\n    // Execute the currently selected action from the light button at the click location\n    switch (action) {\n      case ActionsEnum.STEPOUT:\n        this.previousSlice();\n        break;\n      case ActionsEnum.STEPIN:\n        this.nextSlice();\n        break;\n      case ActionsEnum.ADDCUBE:\n        this.addObject(modelPosition, ObjectsEnum.CUBE);\n        break;\n      case ActionsEnum.REMOVE:\n        this.removeObject(modelPosition);\n        break;\n      case ActionsEnum.ROTATELT:\n        this.rotateLeft();\n        break;\n      case ActionsEnum.ADDTREE:\n        this.addObject(modelPosition, ObjectsEnum.TRUNK);\n        break;\n      case ActionsEnum.ADD_ROOF_EAST:\n        this.addObject(modelPosition, ObjectsEnum.ROOF, 'e');\n        break;\n      case ActionsEnum.ADD_ROOF_WEST:\n        this.addObject(modelPosition, ObjectsEnum.ROOF, 'w');\n        break;\n      case ActionsEnum.ADD_ROOF_NORTH:\n        this.addObject(modelPosition, ObjectsEnum.ROOF, 'n');\n        break;\n      case ActionsEnum.ADD_ROOF_SOUTH:\n        this.addObject(modelPosition, ObjectsEnum.ROOF, 's');\n        break;\n      case ActionsEnum.EDITTOPO:\n        this.setTopoHeight(modelPosition);\n        break;\n      case ActionsEnum.NO_SURFACE:\n        this.setSurface(this.cameraView.camera, modelPosition, modifier, SurfacesEnum.NONE);\n        break;\n      case ActionsEnum.SOLID_SURFACE:\n        this.setSurface(this.cameraView.camera, modelPosition, modifier, SurfacesEnum.SOLID);\n        break;\n      case ActionsEnum.TRANSPARENT_SURFACE:\n        this.setSurface(this.cameraView.camera, modelPosition, modifier, SurfacesEnum.TRANS);\n        break;\n      case ActionsEnum.PARTITION_SURFACE:\n        this.setSurface(this.cameraView.camera, modelPosition, modifier, SurfacesEnum.PART);\n        break;\n      default:\n        // nothing\n        break;\n    }\n    // if (modelPosition) {\n    //   this.actionsAPI.onAction(action, { modelPosition });\n    // }\n  };\n\n  /**\n   * Add the object at the normalized position. Remove any object that is there.\n   * @param {object} modelPosition - {x,y,z}\n   */\n  addObject = (modelPosition, object, modifier) => {\n    if (modelPosition) {\n      this.session.design.add(object, modelPosition, modifier);\n      this.updateViews();\n    }\n  }\n\n  /**\n   * Remove the object at the normalized position.\n   * @param {object} modelPosition - {x,y,z}\n   */\n  removeObject = modelPosition => {\n    if (modelPosition) {\n      this.session.design.remove(modelPosition);\n      this.updateViews();\n    }\n  }\n\n  /**\n   */\n  setSurface = (camera, position, side, surface) => {\n    if (position) {\n      this.session.design.setSurface(camera, position, side, surface);\n      this.updateViews();\n    }\n  }\n\n  // /**\n  //  * Set the topo height at the normalized position. If there is no ground where you click, raise\n  //  * to fill that area. If there is ground there, remove down to the base of that point\n  //  * @param {object} modelPosition - {x,y,z}\n  //  */\n  // setTopoHeight = modelPosition => {\n  //   if (modelPosition) {\n  //     const { x, y, z } = modelPosition;\n  //     const { topo } = this.model;\n\n  //     let height;\n\n  //     const currentHeight = topo.getTopoHeight({ x, y });\n  //     if (z < currentHeight) {\n  //       // If ground was previous full, Drop height down to base of click grid square\n  //       height = z;\n  //     } else {\n  //       // Raise height to fill up the grid square if it was empty\n  //       height = z + 1;\n  //     }\n  //     this.session.topo.setTopoHeight({ x, y }, height);\n  //     this.updateViews();\n  //   }\n  // }\n\n  /** Move the view to the next slice, without exceeding the last slice */\n  nextSlice = () => {\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n        this._setSliceYAxis(this.cameraView.slices.y + 1);\n        break;\n      case CamerasEnum.SOUTH:\n        this._setSliceYAxis(this.cameraView.slices.y - 1);\n        break;\n      case CamerasEnum.EAST:\n        this._setSliceXAxis(this.cameraView.slices.x + 1);\n        break;\n      case CamerasEnum.WEST:\n        this._setSliceXAxis(this.cameraView.slices.x - 1);\n        break;\n      case CamerasEnum.TOP:\n        this._setSliceZAxis(this.cameraView.slices.z - 1);\n        break;\n      case CamerasEnum.BOTTOM:\n        this._setSliceZAxis(this.cameraView.slices.z + 1);\n        break;\n      default:\n        throw new Error(`camera ${this.cameraView.camera} is not recognized!`);\n    }\n  }\n\n  /** Move the view to the previous slice, without going past 0 */\n  previousSlice = () => {\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n        this._setSliceYAxis(this.cameraView.slices.y - 1);\n        break;\n      case CamerasEnum.SOUTH:\n        this._setSliceYAxis(this.cameraView.slices.y + 1);\n        break;\n      case CamerasEnum.EAST:\n        this._setSliceXAxis(this.cameraView.slices.x - 1);\n        break;\n      case CamerasEnum.WEST:\n        this._setSliceXAxis(this.cameraView.slices.x + 1);\n        break;\n      case CamerasEnum.TOP:\n        this._setSliceZAxis(this.cameraView.slices.z + 1);\n        break;\n      case CamerasEnum.BOTTOM:\n        this._setSliceZAxis(this.cameraView.slices.z - 1);\n        break;\n      default:\n        throw new Error(`camera ${this.cameraView.camera} is not recognized!`);\n    }\n  }\n\n  /** Set the camera view to NORTH and reset the slice to 0 */\n  north = () => this._setCamera('NORTH')\n\n  /** Set the camera view to SOUTH and reset the slice to 0 */\n  south = () => this._setCamera('SOUTH')\n\n  /** Set the camera view to EAST and reset the slice to 0 */\n  east = () => this._setCamera('EAST')\n\n  /** Set the camera view to WEST and reset the slice to 0 */\n  west = () => this._setCamera('WEST')\n\n  /** Set the camera view to TOP and reset the slice to 0 */\n  top = () => this._setCamera('TOP')\n\n  /** Set the camera view to BOTTOM and reset the slice to 0 */\n  bottom = () => this._setCamera('BOTTOM')\n\n  rotateLeft = () => {\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n        this._setCamera('EAST');\n        break;\n      case CamerasEnum.EAST:\n        this._setCamera('SOUTH');\n        break;\n      case CamerasEnum.SOUTH:\n        this._setCamera('WEST');\n        break;\n      case CamerasEnum.WEST:\n        this._setCamera('NORTH');\n        break;\n      default:\n        // do nothing for top and bottom\n    }\n  }\n\n  rotateRight = () => {\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n        this._setCamera('WEST');\n        break;\n      case CamerasEnum.WEST:\n        this._setCamera('SOUTH');\n        break;\n      case CamerasEnum.SOUTH:\n        this._setCamera('EAST');\n        break;\n      case CamerasEnum.EAST:\n        this._setCamera('NORTH');\n        break;\n      default:\n        // do nothing for top and bottom\n    }\n  }\n\n  /**\n   * Set the slice in view in the Z axis, only runs if a legal slice\n   * @param {int} slice - number of slice\n   */\n  _setSliceZAxis = slice => {\n    if (slice >= 0 && slice < this.zMax) {\n      this.cameraView.slices.z = slice;\n      this.updateViews();\n    }\n  }\n\n  /**\n   * Set the slice in view in the X axis, only runs if a legal slice\n   * @param {int} slice - number of slice\n   */\n  _setSliceXAxis = slice => {\n    if (slice >= 0 && slice < this.xMax) {\n      this.cameraView.slices.x = slice;\n      this.updateViews();\n    }\n  }\n\n  /**\n   * Set the slice in view in the Y axis, only runs if a legal slice\n   * @param {int} slice - number of slice\n   */\n  _setSliceYAxis = slice => {\n    if (slice >= 0 && slice < this.yMax) {\n      this.cameraView.slices.y = slice;\n      this.updateViews();\n    }\n  }\n\n  /**\n   * Set the camera view to the given view and reset the slice to 0\n   * @param {String} camera - CamerasEnum name\n   */\n  _setCamera = camera => {\n    this.cameraView.camera = CamerasEnum[camera];\n    this.updateViews();\n  }\n\n  /** Draw the current view from the current camera angle and sliceIndex */\n  updateViews = () => {\n    let sliceIndex;\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n      case CamerasEnum.SOUTH:\n        sliceIndex = this.cameraView.slices.y;\n        break;\n      case CamerasEnum.EAST:\n      case CamerasEnum.WEST:\n        sliceIndex = this.cameraView.slices.x;\n        break;\n      case CamerasEnum.TOP:\n      case CamerasEnum.BOTTOM:\n        sliceIndex = this.cameraView.slices.z;\n        break;\n      default:\n        throw new Error(`camera ${this.cameraView.camera} is not recognized!`);\n    }\n\n    this.views.forEach(v => v.draw(this.cameraView.camera, sliceIndex, this.isBackgroundDashed));\n  }\n\n  /**\n   * Returns a 3D vector of the model position based on the normalized click\n   * @param {float} clickX - Normalized x between 0 and 1\n   * @param {float} clickY - Normalized y between 0 and 1\n   */\n  getRelativePosition = (x, y) => {\n    // Check that it is a legal 3D index\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n      case CamerasEnum.SOUTH:\n      case CamerasEnum.EAST:\n      case CamerasEnum.WEST:\n        if (y >= this.zMax) {\n          return null;\n        }\n        break;\n      default:\n        // do nothing\n    }\n\n    // translate this position along with the current slice to the 3D model indeces\n    switch (this.cameraView.camera) {\n      case CamerasEnum.NORTH:\n        return { x, y: this.cameraView.slices.y, z: y };\n      case CamerasEnum.SOUTH:\n        return { x: this.gridSize - 1 - x, y: this.cameraView.slices.y, z: y };\n      case CamerasEnum.EAST:\n        return { x: this.cameraView.slices.x, y: this.gridSize - 1 - x, z: y };\n      case CamerasEnum.WEST:\n        return { x: this.cameraView.slices.x, y: x, z: y };\n      case CamerasEnum.BOTTOM:\n        return { x, y: this.gridSize - 1 - y, z: this.cameraView.slices.z };\n      case CamerasEnum.TOP:\n        return { x, y, z: this.cameraView.slices.z };\n      default:\n        throw new Error(`camera ${this.cameraView.camera} is not recognized!`);\n    }\n  }\n}\n","/* global SETTINGS */\n\n/**\n * Returns a 3D vector of the model position based on the normalized click\n * @param {float} clickX - Normalized x between 0 and 1\n * @param {float} clickY - Normalized y between 0 and 1\n */\nexport function getRelativePosition(clickX, clickY) {\n  // get the x, y position in the scale of the model\n  const { gridSize } = SETTINGS;\n  const x = Math.floor(clickX * gridSize);\n  const y = gridSize - 1 - Math.floor(clickY * gridSize);\n  return { x, y };\n}\n\nexport function getGridPointInModelSpace(x, y) {\n  const { w, h } = SETTINGS;\n  // There is a 1px padding around the edges to not cut off the graphics awkwardly\n  // Ignore clicks in that range\n  if (x === 0 || x === (w - 1)\n      || y === 0 || y === (h - 1)) {\n    return null;\n  }\n\n  // Offset click for 1px padding and find normalized position\n  const normalizedX = (x - 1) / w;\n  const normalizedY = (y - 1) / h;\n  const point = getRelativePosition(normalizedX, normalizedY);\n\n  return point;\n}\n\nexport function getClosestEdgeInModelSpace(clickX, clickY) {\n  const { w, h, gridSize } = SETTINGS;\n  // There is a 1px padding around the edges to not cut off the graphics awkwardly\n  // Ignore clicks in that range\n  if (clickX === 0 || clickX === (w - 1)\n      || clickY === 0 || clickY === (h - 1)) {\n    return null;\n  }\n\n  // Offset click for 1px padding and find normalized position\n  const normalizedX = (clickX - 1) / w;\n  const normalizedY = (clickY - 1) / h;\n\n  const x = normalizedX * gridSize;\n  const xRound = Math.floor(x);\n  const xRemainder = x - xRound;\n\n  const y = gridSize - (normalizedY * gridSize);\n  const yRound = Math.floor(y);\n  const yRemainder = y - yRound;\n\n  let side;\n  const tDist = 1 - yRemainder;\n  const bDist = yRemainder;\n  const lDist = xRemainder;\n  const rDist = 1 - xRemainder;\n  const max = Math.min(tDist, bDist, lDist, rDist);\n  if (tDist === max) {\n    side = 't';\n  } else if (bDist === max) {\n    side = 'b';\n  } else if (lDist === max) {\n    side = 'l';\n  } else if (rDist === max) {\n    side = 'r';\n  }\n\n  return { x: xRound, y: yRound, side };\n}\n\nexport function getOppositeDirection(cardinalDirection) {\n  switch (cardinalDirection) {\n    case 'n':\n      return 's';\n    case 's':\n      return 'n';\n    case 'e':\n      return 'w';\n    case 'w':\n      return 'e';\n    case 't':\n      return 'b';\n    case 'b':\n      return 't';\n    default:\n      return null;\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Display2DView from '../js/Display2DView';\nimport Display2DController from '../js/Display2DController';\nimport ActionsEnum from '../js/enums/ActionsEnum';\nimport { getGridPointInModelSpace } from '../js/helpers/Helpers';\n\n/* global document */\n/* global SETTINGS */\n\n/** Class for the 2D slice views */\nexport default class Draw extends React.Component {\n  static propTypes = {\n    action: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    controller: null\n  }\n\n  componentDidMount() {\n    this.isWired = false;\n\n    this.canvas = document.getElementById('draw');\n    document.addEventListener('keydown', this.handleKeyDown);\n    this.canvas.addEventListener('mousedown', this.handleClick);\n\n    // If the model had already been created, immediately wire\n    this.wire();\n  }\n\n  componentDidUpdate() {\n    // When the model is created, we need to wire it\n    this.wire();\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    this.canvas.removeEventListener('mousedown', this.handleClick);\n  }\n\n  /**\n   * This should be called one time once the HTML element and the model are ready.\n   * It sets up the rendering to the canvas.\n   */\n  wire = () => {\n    const { session, cameraView } = this.props;\n    // Only wire once, and only do it once the model is ready\n    if (this.isWired || !session) {\n      return;\n    }\n    this.isWired = true;\n\n    // Create controller and 2D slice view\n    const controller = new Display2DController(session, cameraView);\n    this.view = new Display2DView(this.canvas, session);\n    controller.addListener(this.view);\n    // Trigger initial render\n    controller.updateViews();\n\n    this.setState({\n      controller\n    });\n  }\n\n  /** Add some hotkeys to make testing easier */\n  handleKeyDown = event => {\n    const { controller } = this.state;\n\n    const { action } = this.props;\n    if (action === ActionsEnum.SPEAK_CONSTRAINT) {\n      return; // text area has control\n    }\n\n    switch (event.keyCode) {\n      case 87: // w\n        controller.south();\n        break;\n      case 88: // x\n        controller.north();\n        break;\n      case 65: // a\n        controller.east();\n        break;\n      case 68: // d\n        controller.west();\n        break;\n      case 83: // s\n        controller.top();\n        break;\n      case 67: // f\n        controller.bottom();\n        break;\n      case 38: // up arrow\n        controller.nextSlice();\n        break;\n      case 40: // down arrow\n        controller.previousSlice();\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleClick = event => {\n    const { controller } = this.state;\n    const { action } = this.props;\n    console.log(action);\n    const point = getGridPointInModelSpace(event.offsetX, event.offsetY);\n    if (!point) {\n      return;\n    }\n    controller.doAction(action, point.x, point.y);\n  }\n\n  render() {\n    const { w, h } = SETTINGS;\n\n    return (\n      <div>\n        <canvas id=\"draw\" width={w} height={h} />\n      </div>\n    );\n  }\n}\n","import { createjs } from '@createjs/easeljs';\n\n/* global SETTINGS */\n\n/** Class responsible for rednering a 2D slice */\nexport default class EditTopoRenderer2D {\n  constructor(stage) {\n    this.stage = stage;\n  }\n\n  /**\n   * Add a square at x,y with number representing height\n   */\n  drawSquare = (x, y, num) => {\n    const shape = new createjs.Shape();\n    shape.graphics.beginStroke(SETTINGS.color).setStrokeStyle(1);\n\n    const sx = (x * SETTINGS.r) + 1;\n    const dx = SETTINGS.r;\n    const sy = SETTINGS.h - (y * SETTINGS.r) - 1;\n    const dy = -SETTINGS.r;\n\n    shape.graphics.drawRect(sx, sy, dx, dy);\n    this.stage.addChild(shape);\n\n    const text = new createjs.Text(num, 'bold 17px Andale Mono', SETTINGS.color);\n    text.x = sx + (dx / 2) - 5;\n    text.y = sy + (dy / 2) - 6;\n    this.stage.addChild(text);\n  }\n}\n","import { createjs } from '@createjs/easeljs';\n\nimport EditTopoRenderer2D from './renderers/EditTopoRenderer2D';\n\n/* global SETTINGS */\n\n/** Class responsible for rednering a 2D slice */\nexport default class TopoView {\n  constructor(canvas, session) {\n    this.session = session;\n    this.stage = new createjs.Stage(canvas);\n\n    this.renderer = new EditTopoRenderer2D(this.stage);\n  }\n\n  /**\n   * Draw the given sliceIndex for the camera angle to the screen\n   * @param {int} camera - CamerasEnum\n   * @param {int} sliceIndex - Index of slice of model from given camera view to draw\n   * @param {int} isBackgroundDashed - Draw objects in background slices as dashed lines\n   */\n  draw = () => {\n    // Clear the screen\n    this.stage.removeAllChildren();\n\n    for (let y = 0; y < SETTINGS.yMax; y += 1) {\n      for (let x = 0; x < SETTINGS.xMax; x += 1) {\n        this.renderer.drawSquare(x, y, this.session.topo.getAt({ x, y }));\n      }\n    }\n\n    // Render to the screen\n    this.stage.update();\n  };\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport TopoView from '../js/TopoView';\nimport { getGridPointInModelSpace } from '../js/helpers/Helpers';\nimport ActionsEnum from '../js/enums/ActionsEnum';\n\n/* global document */\n/* global SETTINGS */\n\n/** Class for t */\nexport default class Topo extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    action: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  componentDidMount() {\n    this.isWired = false;\n\n    this.canvas = document.getElementById('display');\n    this.canvas.addEventListener('mousedown', this.handleClick);\n\n    // If the model had already been created, immediately wire\n    this.wire();\n  }\n\n  componentDidUpdate() {\n    // When the model is created, we need to wire it\n    this.wire();\n  }\n\n  componentWillUnmount() {\n    this.canvas.removeEventListener('mousedown', this.handleClick);\n  }\n\n  /**\n   * This should be called one time once the HTML element and the model are ready.\n   * It sets up the rendering to the canvas.\n   */\n  wire = () => {\n    const { session } = this.props;\n    // Only wire once, and only do it once the model is ready\n    if (this.isWired || !session) {\n      return;\n    }\n    this.isWired = true;\n\n    this.view = new TopoView(this.canvas, session);\n    // Trigger initial render\n    this.view.draw();\n  }\n\n  handleClick = event => {\n    const { session, action } = this.props;\n    const point = getGridPointInModelSpace(event.offsetX, event.offsetY);\n    if (!point) {\n      return;\n    }\n\n    if (action === ActionsEnum.DECREASE_HEIGHT) {\n      session.topo.decrease(point);\n    } else {\n      session.topo.increase(point);\n    }\n    this.view.draw();\n  }\n\n  render() {\n    const { w, h } = SETTINGS;\n    return (\n      <div>\n        <canvas id=\"display\" width={w} height={h} />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Display2DView from '../js/Display2DView';\nimport Display2DController from '../js/Display2DController';\nimport { getClosestEdgeInModelSpace } from '../js/helpers/Helpers';\n\n/* global document */\n/* global SETTINGS */\n\nexport default class Surface extends React.Component {\n  static propTypes = {\n    action: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    controller: null\n  }\n\n  componentDidMount() {\n    this.isWired = false;\n\n    this.canvas = document.getElementById('surface');\n    document.addEventListener('keydown', this.handleKeyDown);\n    this.canvas.addEventListener('click', this.handleClick);\n\n    // If the model had already been created, immediately wire\n    this.wire();\n  }\n\n  componentDidUpdate() {\n    // When the model is created, we need to wire it\n    this.wire();\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n    this.canvas.removeEventListener('click', this.handleClick);\n  }\n\n  /**\n   * This should be called one time once the HTML element and the model are ready.\n   * It sets up the rendering to the canvas.\n   */\n  wire = () => {\n    const { session, cameraView } = this.props;\n    // Only wire once, and only do it once the model is ready\n    if (this.isWired || !session) {\n      return;\n    }\n    this.isWired = true;\n\n    // Create controller and 2D slice view\n    const controller = new Display2DController(session, cameraView);\n    this.view = new Display2DView(this.canvas, session);\n    controller.addListener(this.view);\n    // Trigger initial render\n    controller.updateViews();\n\n    this.setState({\n      controller\n    });\n  }\n\n  /** Add some hotkeys to make testing easier */\n  handleKeyDown = event => {\n    const { controller } = this.state;\n\n    switch (event.keyCode) {\n      case 87: // w\n        controller.south();\n        break;\n      case 88: // x\n        controller.north();\n        break;\n      case 65: // a\n        controller.east();\n        break;\n      case 68: // d\n        controller.west();\n        break;\n      case 83: // s\n        controller.top();\n        break;\n      case 67: // f\n        controller.bottom();\n        break;\n      case 38: // up arrow\n        controller.nextSlice();\n        break;\n      case 40: // down arrow\n        controller.previousSlice();\n        break;\n      default:\n        break;\n    }\n  }\n\n  handleClick = event => {\n    const { controller } = this.state;\n    const { action } = this.props;\n\n    const edge = getClosestEdgeInModelSpace(event.offsetX, event.offsetY);\n    if (!edge) {\n      return;\n    }\n\n    const { x, y, side } = edge;\n    controller.doAction(action, x, y, side);\n  }\n\n  render() {\n    const { w, h } = SETTINGS;\n    return (\n      <div>\n        <canvas id=\"surface\" width={w} height={h} />\n      </div>\n    );\n  }\n}\n","/** Class for controlling a 3D view mimicking a walk through of the model */\nexport default class CameraPathController {\n  constructor(session, onWalkthroughEnd) {\n    this.session = session;\n    this.views = [];\n    this.onWalkthroughEnd = onWalkthroughEnd;\n  }\n\n  addListener = view => this.views.push(view)\n\n  removeListener = toRemove => this.views.filter(view => view !== toRemove)\n\n  run = path => {\n    this.path = path;\n    this.i = 0;\n\n    // Start animation of path, after a delay to allow the page to render\n    setTimeout(() => this.animateCameraPath(), 500);\n  }\n\n  /** Every 500ms update the camera position of the views to the next in the path */\n  animateCameraPath = () => {\n    if (this.i < this.path.length - 2) {\n      this.i += 1;\n      const p = this.path[this.i];\n      const nextP = this.path[this.i + 1];\n      this.views.forEach(v => v.setCameraPosition(p, nextP));\n      setTimeout(() => this.animateCameraPath(), 300);\n    } else {\n      this.onWalkthroughEnd();\n    }\n  }\n}\n","import * as THREE from 'three';\nimport { getEmpty2DArray } from '../helpers/ArrayHelpers';\nimport CamerasEnum from '../enums/CamerasEnum';\n\n/* global SETTINGS */\n\nexport default class TopoRenderer3D {\n  draw = (scene, corners, cameraView) => {\n    if (!corners) {\n      return;\n    }\n\n    // calculate the corners of all the topography and connect them\n    const adjustedCorners = getEmpty2DArray(SETTINGS.xMax + 1, SETTINGS.yMax + 1, null);\n    for (let y = 0; y <= SETTINGS.yMax; y += 1) {\n      for (let x = 0; x <= SETTINGS.xMax; x += 1) {\n        const cornerPoint = { x, y, z: corners[y][x] - 0.5 };\n        const adjustedCornerPoint = this._getAdjustedPoint(cornerPoint);\n        // Drop the height by half a block\n        adjustedCornerPoint.z -= 0.5;\n        adjustedCorners[y][x] = adjustedCornerPoint;\n\n        // Add code for debugger to mark current camera view\n        let mark = false;\n        if (cameraView) {\n          if (cameraView.camera === CamerasEnum.NORTH || cameraView.camera === CamerasEnum.SOUTH) {\n            if (cameraView.slices.y === y - 1) {\n              mark = true;\n            }\n          } else if (cameraView.camera === CamerasEnum.WEST || cameraView.camera === CamerasEnum.EAST) {\n            if (cameraView.slices.x === x - 1) {\n              mark = true;\n            }\n          }\n        }\n\n        // Connect down and right\n        if (y > 0) {\n          const downPoint = adjustedCorners[y - 1][x];\n          this._addLine(scene, adjustedCornerPoint, downPoint, mark);\n        }\n        if (x > 0) {\n          const leftPoint = adjustedCorners[y][x - 1];\n          this._addLine(scene, adjustedCornerPoint, leftPoint, mark);\n        }\n      }\n    }\n  }\n\n  _addLine = (scene, p0, p1, mark) => {\n    const geometry = new THREE.Geometry();\n    geometry.vertices.push(new THREE.Vector3(p0.x, p0.y, p0.z));\n    geometry.vertices.push(new THREE.Vector3(p1.x, p1.y, p1.z));\n    let line;\n    if (mark) {\n      line = new THREE.Line(geometry, new THREE.LineBasicMaterial({ color: 0x00EE00 }));\n    } else {\n      line = new THREE.Line(geometry, SETTINGS.material);\n    }\n\n    scene.add(line);\n  }\n\n  /**\n   * Returns the point adjusted for the 3D world\n   * @param {object} p - A 3D point\n   */\n  _getAdjustedPoint = p => {\n    const { x, y, z } = p;\n    return { x: x * SETTINGS.r, y: z * SETTINGS.r + (SETTINGS.r / 2), z: -y * SETTINGS.r };\n  }\n}\n","import * as THREE from 'three';\nimport SurfacesEnum from '../enums/SurfacesEnum';\n\n/* global SETTINGS */\n\nclass DesignRenderer3D {\n  draw = (scene, objects) => {\n    if (!objects) {\n      return;\n    }\n\n    for (let z = 0; z < SETTINGS.zMax; z += 1) {\n      for (let y = 0; y < SETTINGS.yMax; y += 1) {\n        for (let x = 0; x < SETTINGS.xMax; x += 1) {\n          const object = objects[z][y][x];\n          const position = { x, y, z };\n          if (object) {\n            switch (object.constructor.name) {\n              case 'Cube':\n                this.drawCube(scene, object, position);\n                break;\n              case 'Roof':\n                this.drawRoof(scene, object, position);\n                break;\n              case 'Foliage':\n                this.drawFoliage(scene, position);\n                break;\n              case 'Trunk':\n                this.drawTrunk(scene, position);\n                break;\n              default:\n                break;\n            }\n          }\n        }\n      }\n    }\n  }\n\n  drawCube = (scene, cube, position) => {\n    const lines = this._getCubeFaces(cube);\n\n    const positionAdj = { x: position.x * SETTINGS.r, y: position.z * SETTINGS.r, z: -position.y * SETTINGS.r };\n\n    lines.position.x = positionAdj.x;\n    lines.position.y = positionAdj.y;\n    lines.position.z = positionAdj.z;\n    scene.add(lines);\n  };\n\n  _getCubeFaces = cube => {\n    const geometry = new THREE.Geometry();\n\n    if (cube.surfaces.t === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // top face\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, 0),\n      );\n    }\n    if (cube.surfaces.b === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // bottom face\n        new THREE.Vector3(0, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n        new THREE.Vector3(0, 0, 0),\n      );\n    }\n    if (cube.surfaces.n === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // north face\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n      );\n    }\n    if (cube.surfaces.s === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // south face\n        new THREE.Vector3(0, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(0, 0, 0),\n      );\n    }\n    if (cube.surfaces.e === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // east face\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n      );\n    }\n    if (cube.surfaces.w === SurfacesEnum.SOLID) {\n      geometry.vertices.push(\n        // west face\n        new THREE.Vector3(0, 0, 0),\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, SETTINGS.r, -SETTINGS.r),\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n        new THREE.Vector3(0, 0, -SETTINGS.r),\n        new THREE.Vector3(0, 0, 0),\n      );\n    }\n\n    const lines = new THREE.LineSegments(geometry, SETTINGS.material);\n\n    return lines;\n  }\n\n  drawRoof = (scene, roof, position) => {\n    const lines = this._getRoof(roof);\n\n    const positionAdj = { x: position.x * SETTINGS.r, y: position.z * SETTINGS.r, z: -position.y * SETTINGS.r };\n\n    switch (roof.direction) {\n      case 'n':\n        break;\n      case 'e':\n        lines.rotation.y = Math.PI * 1.5;\n        positionAdj.z -= SETTINGS.r;\n        break;\n      case 's':\n        lines.rotation.y = Math.PI;\n        positionAdj.x += SETTINGS.r;\n        positionAdj.z -= SETTINGS.r;\n        break;\n      case 'w':\n        lines.rotation.y = Math.PI * 0.5;\n        positionAdj.x += SETTINGS.r;\n        break;\n      default:\n        return;\n    }\n    lines.position.x = positionAdj.x;\n    lines.position.y = positionAdj.y;\n    lines.position.z = positionAdj.z;\n    scene.add(lines);\n  };\n\n  _getRoof = roof => {\n    const geometry = new THREE.Geometry();\n\n    if (roof.hasSideSurface) {\n      geometry.vertices.push(\n        // tall face bottom\n        new THREE.Vector3(0, SETTINGS.r, 0),\n        new THREE.Vector3(0, 0, 0),\n        new THREE.Vector3(0, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, 0, 0),\n        new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n      );\n    }\n\n    geometry.vertices.push(\n      // slanted face\n      new THREE.Vector3(0, 0, -SETTINGS.r),\n      new THREE.Vector3(0, SETTINGS.r, 0),\n      new THREE.Vector3(0, SETTINGS.r, 0),\n      new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n      new THREE.Vector3(SETTINGS.r, SETTINGS.r, 0),\n      new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n      new THREE.Vector3(SETTINGS.r, 0, -SETTINGS.r),\n      new THREE.Vector3(0, 0, -SETTINGS.r),\n    );\n\n    const lines = new THREE.LineSegments(geometry, SETTINGS.material);\n\n    return lines;\n  }\n\n  drawFoliage = (scene, center) => {\n    const { x, y, z } = center;\n    const geometry = new THREE.SphereGeometry(SETTINGS.r / 2, 5, 5);\n    const wireframe = new THREE.EdgesGeometry(geometry);\n    const lines = new THREE.LineSegments(wireframe, SETTINGS.material);\n    const position = { x: x * SETTINGS.r, y: z * SETTINGS.r, z: -y * SETTINGS.r };\n    lines.position.x = position.x + (SETTINGS.r / 2);\n    lines.position.y = position.y + (SETTINGS.r / 2);\n    lines.position.z = position.z - (SETTINGS.r / 2);\n    scene.add(lines);\n  };\n\n  drawTrunk = (scene, center) => {\n    const { x, y, z } = center;\n    const position = { x: (x + 0.5) * SETTINGS.r, y: z * SETTINGS.r, z: (-y - 0.5) * SETTINGS.r };\n    const position2 = { x: position.x, y: position.y + SETTINGS.r, z: position.z };\n    this._addLine(scene, position, position2);\n  };\n\n  _addLine = (scene, p0, p1) => {\n    const geometry = new THREE.Geometry();\n    geometry.vertices.push(new THREE.Vector3(p0.x, p0.y, p0.z));\n    geometry.vertices.push(new THREE.Vector3(p1.x, p1.y, p1.z));\n    const line = new THREE.Line(geometry, SETTINGS.material);\n    scene.add(line);\n  }\n}\n\nexport default DesignRenderer3D;\n","import * as THREE from 'three';\n\nimport TopoRenderer3D from './renderers/TopoRenderer3D';\nimport DesignRenderer3D from './renderers/DesignRenderer3D';\n\n/* global SETTINGS */\n/* global requestAnimationFrame */\n\n/** Class responsible for drawing a 3D view of the model */\nexport default class CameraPathView {\n  constructor(container, session, cameraView) {\n    this.container = container;\n    this.target = null;\n    this.session = session;\n\n    // Set to true once the controller gives it a camera position\n    this.hasPosition = false;\n\n    // Setup Three.js scene, camera, and renderer\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(0x000000);\n    this.camera = new THREE.PerspectiveCamera(75, SETTINGS.w / SETTINGS.h, 1, 2000);\n    this.scene.add(this.camera);\n    this.renderer = new THREE.WebGLRenderer({ antialias: true });\n    this.renderer.setPixelRatio(0.6);\n    this.renderer.setSize(SETTINGS.w, SETTINGS.h);\n    this.container.appendChild(this.renderer.domElement);\n    this.cameraView = cameraView;\n\n    this.draw();\n  }\n\n  draw = () => {\n    while (this.scene.children.length > 0) {\n      this.scene.remove(this.scene.children[0]);\n    }\n\n    this.designRenderer3D = new DesignRenderer3D();\n    const design = this.session.design.getAll();\n    this.designRenderer3D.draw(this.scene, design);\n\n    this.topoRenderer3D = new TopoRenderer3D();\n    const topoCorners = this.session.topo.getCorners();\n    this.topoRenderer3D.draw(this.scene, topoCorners, this.cameraView);\n  }\n\n  render = () => {\n    this.draw();\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  /**\n   * Sets the camera position according to the given point\n   * @param {object} p - A 3D point\n   * @param {object} nextP - The next 3D point for direction\n   */\n  setCameraPosition = (p, nextP) => {\n    this.hasPosition = true;\n    const { x, y, z } = this.getAdjustedPoint(p);\n    this.camera.position.x = x;\n    this.camera.position.y = y;\n    this.camera.position.z = z;\n\n    // Point camera at next point\n    const np = this.getAdjustedPoint(nextP);\n    this.camera.lookAt(np.x, np.y, np.z);\n    this.render();\n  }\n\n  /**\n   * Returns the point adjusted for the 3D world\n   * @param {object} p - A 3D point\n   */\n  getAdjustedPoint = p => {\n    const { x, y, z } = p;\n    return { x: x * SETTINGS.r, y: z * SETTINGS.r + (SETTINGS.r / 2), z: -y * SETTINGS.r };\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport CameraPathController from '../js/CameraPathController';\nimport CameraPathView from '../js/CameraPathView';\n\n/* global document */\n/* global SETTINGS */\n\n/** Class for the 3D fly throughs of the model */\nexport default class CameraPath extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    path: PropTypes.array.isRequired, // eslint-disable-line react/forbid-prop-types\n    onWalkthroughEnd: PropTypes.func.isRequired // eslint-disable-line react/forbid-prop-types\n  }\n\n  componentDidMount() {\n    this.isWired = false;\n\n    this.container = document.getElementById('display3D');\n\n    // If the model had already been created, immediately wire\n    this.wire();\n\n    const { path } = this.props;\n    this.run(path);\n  }\n\n  componentDidUpdate() {\n    // When the model is created, we need to wire it\n    this.wire();\n\n    const { path } = this.props;\n    this.run(path);\n  }\n\n  /**\n   * This should be called one time once the HTML element and the model are ready.\n   * It sets up the rendering to the DOM.\n   */\n  wire = () => {\n    const { session, path, onWalkthroughEnd } = this.props;\n    if (this.isWired || !session || !path) {\n      return;\n    }\n    this.isWired = true;\n\n    this.controller = new CameraPathController(session, onWalkthroughEnd);\n    this.view = new CameraPathView(this.container, session);\n    this.controller.addListener(this.view);\n  }\n\n  run = path => {\n    this.controller.run(path);\n  }\n\n  render() {\n    const { w, h } = SETTINGS;\n\n    return (\n      <div id=\"display3D\" style={{ width: w, height: h }} />\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Display2DView from '../js/Display2DView';\nimport { getGridPointInModelSpace } from '../js/helpers/Helpers';\n\n/* global document */\n/* global SETTINGS */\n\n/** Class for t */\nexport default class ChoosePath extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n    onSelectStart: PropTypes.func.isRequired, // eslint-disable-line react/forbid-prop-types\n    onSelectEnd: PropTypes.func.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    hasStart: false\n  }\n\n  componentDidMount() {\n    this.isWired = false;\n\n    this.canvas = document.getElementById('display');\n    this.canvas.addEventListener('mousedown', this.handleClick);\n\n    // If the model had already been created, immediately wire\n    this.wire();\n  }\n\n  componentDidUpdate() {\n    // When the model is created, we need to wire it\n    this.wire();\n  }\n\n  componentWillUnmount() {\n    this.canvas.removeEventListener('mousedown', this.handleClick);\n  }\n\n  /**\n   * This should be called one time once the HTML element and the model are ready.\n   * It sets up the rendering to the canvas.\n   */\n  wire = () => {\n    const { session } = this.props;\n    // Only wire once, and only do it once the model is ready\n    if (this.isWired || !session) {\n      return;\n    }\n    this.isWired = true;\n\n    this.view = new Display2DView(this.canvas, session);\n    // Trigger initial render\n    this.view.drawTopCompressedView();\n  }\n\n  handleClick = event => {\n    const { hasStart } = this.state;\n    const { onSelectStart, onSelectEnd } = this.props;\n\n    const point = getGridPointInModelSpace(event.offsetX, event.offsetY);\n    if (!point) {\n      return;\n    }\n\n    if (!hasStart) {\n      onSelectStart(point);\n      this.setState({ hasStart: true });\n      this.view.drawCircle(point.x, point.y);\n      this.view.update();\n    } else {\n      this.view.drawCircle(point.x, point.y);\n      this.view.update();\n      setTimeout(() => {\n        onSelectEnd(point);\n      }, 1000);\n    }\n  }\n\n  render() {\n    const { w, h } = SETTINGS;\n    return (\n      <div>\n        <canvas id=\"display\" width={w} height={h} />\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport CameraPath from './CameraPath';\nimport ChoosePath from './ChoosePath';\n\nexport default class DisplayWalkthrough extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    path: null,\n    start: null\n  }\n\n  doWalkthrough = end => {\n    const { session } = this.props;\n    const { start } = this.state;\n\n    const path = this.calculatePath(start, end, session);\n\n    this.setState({ path });\n  }\n\n  calculatePath = (start, end) => {\n    const steps = 15;\n    const dx = (end.x - start.x) / steps;\n    const dy = (end.y - start.y) / steps;\n    const path = [];\n    for (let i = 0; i < steps; i += 1) {\n      path.push({ x: start.x + (i * dx), y: start.y + (i * dy), z: 0 });\n    }\n    return path;\n  }\n\n  render() {\n    const { path } = this.state;\n    const { session } = this.props;\n\n    return (\n      <div>\n        { !path\n          ? (\n            <ChoosePath\n              session={session}\n              onSelectStart={start => this.setState({ start })}\n              onSelectEnd={end => this.doWalkthrough(end)}\n            />\n          )\n          : (\n            <CameraPath\n              session={session}\n              path={path}\n              onWalkthroughEnd={() => this.setState({ path: null })}\n            />\n          )\n        }\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\nimport Menu from './Menu';\nimport Top from './Top';\nimport ActionsEnum from '../js/enums/ActionsEnum';\n\nimport Draw from './Draw';\nimport Topo from './Topo';\nimport Surface from './Surface';\n\nimport DisplayWalkthrough from './DisplayWalkthrough';\n\n/* global document */\n/* global location */\n\n/** Class for the rendering the main view with top, menu, and center panels */\nexport default class MainPage extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    // action: ActionsEnum.ADDCUBE, // Default action is ADDCUBE\n    // displayType: 'CALC'\n\n    action: ActionsEnum.ADDCUBE, // Default action is ADDCUBE\n    displayType: 'DRAW',\n\n    // action: ActionsEnum.INCREASE_HEIGHT, // Default action is ADDCUBE\n    // displayType: 'TOPO'\n\n    // action: ActionsEnum.NO_SURFACE, // Default action is ADDCUBE\n    // displayType: 'SURF'\n\n  };\n\n  componentDidMount() {\n    document.addEventListener('keydown', this.handleKeyDown);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('keydown', this.handleKeyDown);\n  }\n\n  onMenuClick = action => {\n    this.setState({ action });\n  }\n\n  /** Add some hotkeys to make testing easier */\n  handleKeyDown = event => {\n    const { action } = this.state;\n    const { session } = this.props;\n    if (action === ActionsEnum.SPEAK_CONSTRAINT) {\n      // do nothing\n    } else {\n      console.log(event.keyCode);\n      switch (event.keyCode) {\n        // Switch between views\n        case 66: // b\n          this.setState({\n            displayType: 'DRAW',\n            action: ActionsEnum.ADDCUBE\n          });\n          break;\n        case 86: // v\n          this.setState({\n            displayType: 'CALC'\n          });\n          break;\n        case 67: // c\n          this.setState({\n            displayType: 'TOPO',\n            action: ActionsEnum.INCREASE_HEIGHT\n          });\n          break;\n        case 78: // n\n          this.setState({\n            displayType: 'SURF',\n            action: ActionsEnum.NO_SURFACE\n          });\n          break;\n        case 191: // /\n          session.monitor.clearConstraints();\n          break;\n        case 220: // \\\n          session.clear();\n          location.reload(); // eslint-disable-line\n          break;\n        default:\n          break;\n      }\n    }\n\n  }\n\n  getDisplay = () => {\n    const { action, displayType } = this.state;\n    const { session, cameraView } = this.props;\n\n    if (!session || !action) {\n      return null;\n    }\n\n    switch (displayType) {\n      case 'DRAW':\n        return (<Draw action={action} session={session} cameraView={cameraView} />);\n      case 'CALC':\n        return (<DisplayWalkthrough session={session} />);\n      case 'TOPO':\n        return (<Topo action={action} session={session} />);\n      case 'SURF':\n        return (<Surface action={action} session={session} cameraView={cameraView} />);\n      default:\n        break;\n    }\n\n    return null;\n  }\n\n  getActions = () => {\n    const { displayType } = this.state;\n\n    switch (displayType) {\n      case 'DRAW':\n        return [\n          ActionsEnum.ADDCUBE,\n          ActionsEnum.ADDTREE,\n          ActionsEnum.ADD_ROOF_EAST,\n          ActionsEnum.ADD_ROOF_WEST,\n          ActionsEnum.ADD_ROOF_NORTH,\n          ActionsEnum.ADD_ROOF_SOUTH,\n          ActionsEnum.REMOVE,\n          ActionsEnum.SPEAK_CONSTRAINT\n        ];\n      case 'CALC':\n        return [];\n      case 'TOPO':\n        return [\n          ActionsEnum.INCREASE_HEIGHT,\n          ActionsEnum.DECREASE_HEIGHT\n        ];\n      case 'SURF':\n        return [\n          ActionsEnum.SOLID_SURFACE,\n          ActionsEnum.NO_SURFACE,\n          // ActionsEnum.PARTITION_SURFACE,\n          // ActionsEnum.TRANSPARENT_SURFACE,\n          // ActionsEnum.HAS_ACCESS,\n          // ActionsEnum.NO_ACCESS\n        ];\n      default:\n        break;\n    }\n\n    return [];\n  }\n\n  render() {\n    const { action } = this.state;\n    const actions = this.getActions();\n\n    const { session } = this.props;\n    return (\n      <div>\n        <div style={{ width: '864px', height: '100%', float: 'left' }}>\n          <div style={{ width: '864px', height: '160px' }}>\n            <div style={{ padding: '20px' }}>\n              <Top session={session} action={action} />\n            </div>\n          </div>\n          <div style={{ width: '852px', height: '852px', padding: '5px' }}>\n            {this.getDisplay()}\n          </div>\n        </div>\n        <div style={{ width: '160px', height: '100%', float: 'left' }}>\n          <div style={{ padding: '20px' }}>\n            <Menu actions={actions} onClick={this.onMenuClick} action={action} />\n          </div>\n        </div>\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\n\n/** Class that renders various views helpful for debugging. */\nexport default class DebuggingConstraints extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  state = {\n    constraints: [],\n    systemConstraints: [],\n    buildings: [],\n    objects: []\n  };\n\n  componentDidMount() {\n    const poll = () => {\n      const { session } = this.props;\n      const constraints = session._monitor.constraints.slice();\n      const systemConstraints = session._monitor.systemConstraints.slice();\n\n      const buildings = session._design._buildings;\n      const objects = session._design.getObjects();\n\n      this.setState({ constraints, systemConstraints, buildings, objects });\n      setTimeout(poll, 500);\n    };\n    poll();\n  }\n\n  getStringsFromConstraints = c => {\n    let type;\n    if (parseInt(c.type) === 0) {\n      type = 'room';\n    } else if (parseInt(c.type) === 1) {\n      type = 'roof';\n    } else {\n      type = 'structure';\n    }\n\n    return `\"${c.text}\":\\n${c.fn} ${c.prop} of ${type} ${c.comp} ${c.value} == ${c.result}\\n\\n`;\n  }\n\n  render() {\n    const { constraints, systemConstraints, buildings } = this.state;\n\n    return (\n      <div style={{ position: 'absolute', left: '20px', top: '20px', width: '500px', wordWrap: 'break-word', border: '1px solid #E8E8DA', padding: '10px 10px 40px 10px', fontSize: '16px' }}>\n        <div>\n          <h3>User Constraints:</h3>\n          <div>{ constraints.map(c => (<div key={c.text} style={{ whiteSpace: 'pre' }}>{ this.getStringsFromConstraints(c) }</div>)) }</div>\n        </div>\n        <div style={{ marginTop: '20px' }}>\n          <h3>System Constraints:</h3>\n          <div>{ systemConstraints.map(c => (<div key={c.text} style={{ whiteSpace: 'pre' }}>{ this.getStringsFromConstraints(c) }</div>)) }</div>\n        </div>\n        <div style={{ marginTop: '20px' }}>\n          <h3>Buildings:</h3>\n          <div>{ JSON.stringify(buildings) }</div>\n        </div>\n        {/*<div style={{ marginTop: '20px' }}>\n          <h3>Objects:</h3>\n          <div>{ JSON.stringify(objects) }</div>\n        </div>*/}\n      </div>\n    );\n  }\n}\n","import React from 'react';\nimport PropTypes from 'prop-types';\nimport CameraPathView from '../js/CameraPathView';\n\n/* global document */\n\n/** Class for the 3D fly throughs of the model */\nexport default class Debugging3D extends React.Component {\n  static propTypes = {\n    session: PropTypes.object.isRequired, // eslint-disable-line react/forbid-prop-types\n  }\n\n  size = 500;\n\n  componentDidMount() {\n    this.container = document.getElementById('debuggingDisplay3D');\n\n    const { session, cameraView } = this.props;\n    this.view = new CameraPathView(this.container, session, cameraView);\n    this.view.renderer.setSize(this.size - 1, this.size - 1);\n    this.target = { x: 8, y: 8, z: 0 };\n    const d0 = -3;\n    const d1 = 20;\n    const m0 = 8;\n    const m1 = -10;\n    const z = 6;\n    this.origins = [{ x: d0, y: d0, z }, { x: m0, y: m1, z },\n      { x: d1, y: d0, z }, { x: d1 + m0, y: m0, z },\n      { x: d1, y: d1, z }, { x: m0, y: d1 + m0, z },\n      { x: d0, y: d1, z }, { x: -m0, y: m0, z }\n    ];\n\n    this.location = -1;\n    this.nextRotation();\n\n    let lastCameraView = {};\n    let lastNumObjects = 0;\n    let lastTotalHeight = 0;\n    const poll = () => {\n      setTimeout(() => {\n        const numObjects = session._design._objects.length;\n        const totalHeight = session._topo.heights.reduce((total, num) => total + num);\n        if (cameraView.camera !== lastCameraView.camera || cameraView.slices.x !== lastCameraView.slices.x\n            || cameraView.slices.y !== lastCameraView.slices.y || numObjects !== lastNumObjects || totalHeight !== lastTotalHeight) {\n          this.view.render();\n          lastCameraView = {\n            camera: cameraView.camera,\n            slices: {\n              x: cameraView.slices.x,\n              y: cameraView.slices.y,\n              z: cameraView.slices.z,\n            }\n          };\n          lastNumObjects = numObjects;\n          lastTotalHeight = totalHeight;\n        }\n\n        poll();\n      }, 100);\n    };\n    poll();\n  }\n\n  nextRotation = () => {\n    this.location = (this.location + 1) % this.origins.length;\n    this.view.setCameraPosition(this.origins[this.location], this.target);\n  }\n\n  render() {\n    return (\n      <div style={{ position: 'absolute', right: '20px', top: '20px', color: '#000', border: '1px solid #E8E8DA', width: this.size + 'px' }}>\n        <div id=\"debuggingDisplay3D\" style={{ width: this.size + 'px', height: this.size + 'px' }} />\n        <button style={{ border: '1px solid #E8E8DA', margin: '10px', padding: '4px 10px', color: '#E8E8DA' }} onMouseDown={this.nextRotation}>Toggle Rotate</button>\n      </div>\n    );\n  }\n}\n","import Constraint from './Constraint';\n\n/** Class to monitor the actions of the user */\nclass Monitor {\n  constructor() {\n    this.constraints = [];\n    this.systemConstraints = [\n      new Constraint({\n        text: 'no building below ground',\n        result: false,\n        fn: 'MIN',\n        type: 'Structure',\n        prop: 'ground',\n        comp: '<',\n        value: '0'\n      }),\n      new Constraint({\n        text: 'no roof without base',\n        result: false,\n        fn: 'SUM',\n        type: 1,\n        prop: 'noBase',\n        comp: '>',\n        value: '0' // the height of top of the building\n      }),\n      new Constraint({\n        text: 'no building floating',\n        result: false,\n        fn: 'SUM',\n        type: 'Structure',\n        prop: 'floating',\n        comp: '>',\n        value: '0' // the height of top of the building\n      }),\n    ];\n    this.conflicts = [];\n    this.incompatibilities = [];\n    this.messages = [];\n  }\n\n  getMessages = () => this.messages;\n\n  addConstraint = text => {\n    const constraint = Constraint.create(text);\n    this.messages.push(text);\n\n    if (constraint && constraint.constructor.name === 'Constraint') {\n      // Check if this overrides former constraint\n      const newConstraints = [];\n      this.constraints.forEach(old => {\n        if (!old.isSameType(constraint)) {\n          newConstraints.push(old);\n        }\n      });\n      newConstraints.push(constraint);\n\n      this.constraints = newConstraints;\n      this.messages.push('I have understood.');\n      return true;\n    }\n    this.messages.push('I am sorry I do not understand.');\n    return false;\n  };\n\n  clearConstraints = () => {\n    this.constraints = [];\n    this.messages.push('Cleared constraints');\n  }\n\n  checkDesign = design => {\n    const conflicts = this.checkConflicts(design);\n    const incompatibilities = this.checkIncompatibilities(design);\n\n    const newMessages = [];\n    if (conflicts.length > 3) {\n      newMessages.push('Don\\'t you think you should stop, Ted?');\n    } else if (conflicts.length > 2) {\n      newMessages.push('Ted, many conflicts are occurring.');\n    } else if (conflicts.length > 0) {\n      // conflicts.forEach(conflict => {\n      //   newMessages.push(`Ted, a conflict has occurred, you said: ${conflict.constraint.text}. The present status is ${conflict.value}.`);\n      // });\n      newMessages.push(`Ted, a conflict has occurred, you said: ${conflicts[0].constraint.text}. The present status is ${conflicts[0].value}.`);\n    } else if (conflicts.length === 0 && this.conflicts.length > 0) {\n      newMessages.push('Conflicts were resolved.');\n    }\n\n    if (incompatibilities.length > 0) {\n      newMessages.push('Not structurally possible at this time.');\n    } else if (incompatibilities.length === 0 && this.incompatibilities.length > 0) {\n      newMessages.push('Incompatibilities were resolved.');\n    }\n\n    console.log(`Messages: [${newMessages.join(',')}]`);\n    this.messages = newMessages;\n    this.conflicts = conflicts;\n    this.incompatibilities = incompatibilities;\n  }\n\n  /**\n    * Conflict “An inconsistency discerned by the machine relating criteria specified by the designer\n    * to forms generated by the designer.”\n    * Examples: max height, number of objects, light, blocking entrances, check access\n    */\n  checkConflicts = design => {\n    const conflicts = [];\n    this.constraints.forEach(constraint => {\n      if (constraint.isViolated(design).result) {\n        console.log('violated constraint!');\n        conflicts.push({ constraint, value: constraint.isViolated(design).value });\n      }\n    });\n\n    return conflicts;\n  };\n\n  /**\n    * Incompatibility: “incongruity between a designer’s action and a predefined requisite embedded in the machine.”\n    * Leads to a bell ringing and displaying the message on the top of the screen\n    * Examples: underground, floating, clash\n    */\n  checkIncompatibilities = design => {\n    const incompatibilities = [];\n    this.systemConstraints.forEach(constraint => {\n      if (constraint.isViolated(design).result) {\n        console.log('violated system constraint!');\n        incompatibilities.push({ constraint, value: constraint.isViolated(design).value });\n      }\n    });\n\n    return incompatibilities;\n  };\n}\n\nMonitor.freeze = monitor => {\n  const jsonStr = JSON.stringify(monitor);\n  const json = JSON.parse(jsonStr);\n\n  return json;\n};\n\nMonitor.thaw = json => {\n  const { constraints, conflicts, incompatibilities, messages } = json;\n\n  const monitor = new Monitor();\n\n  monitor.constraints = constraints.map(constraintData => new Constraint(constraintData));\n  monitor.conflicts = conflicts;\n  monitor.incompatibilities = incompatibilities;\n  monitor.messages = messages;\n\n  return monitor;\n};\n\nexport default Monitor;\n","import SurfacesEnum from '../enums/SurfacesEnum';\n\nexport default class Cube {\n  constructor(cubeData) {\n    if (cubeData) {\n      const { surfaces } = cubeData;\n      this.surfaces = surfaces;\n    } else {\n      this.surfaces = {\n        n: SurfacesEnum.SOLID,\n        e: SurfacesEnum.SOLID,\n        s: SurfacesEnum.SOLID,\n        w: SurfacesEnum.SOLID,\n        t: SurfacesEnum.SOLID,\n        b: SurfacesEnum.SOLID\n      };\n    }\n  }\n\n  hookAfterInsert = context => {\n    const { n, e, s, w, t } = context;\n    // Join to adjacent cubes (update both this one and the other)\n    if (n && n.constructor.name === 'Cube') {\n      this.surfaces.n = SurfacesEnum.NONE;\n      n.surfaces.s = SurfacesEnum.NONE;\n    }\n    if (e && e.constructor.name === 'Cube') {\n      this.surfaces.e = SurfacesEnum.NONE;\n      e.surfaces.w = SurfacesEnum.NONE;\n    }\n    if (s && s.constructor.name === 'Cube') {\n      this.surfaces.s = SurfacesEnum.NONE;\n      s.surfaces.n = SurfacesEnum.NONE;\n    }\n    if (w && w.constructor.name === 'Cube') {\n      this.surfaces.w = SurfacesEnum.NONE;\n      w.surfaces.e = SurfacesEnum.NONE;\n    }\n\n    // Join to roof above\n    if (t && t.constructor.name === 'Roof') {\n      this.surfaces.t = SurfacesEnum.NONE;\n    }\n\n    // Join to adjacent roofs that face this cube\n    if (n && n.constructor.name === 'Roof' && n.direction === 'n') {\n      this.surfaces.n = SurfacesEnum.NONE;\n      n.hasSideSurface = false;\n    }\n    if (e && e.constructor.name === 'Roof' && e.direction === 'e') {\n      this.surfaces.e = SurfacesEnum.NONE;\n      e.hasSideSurface = false;\n    }\n    if (s && s.constructor.name === 'Roof' && s.direction === 's') {\n      this.surfaces.s = SurfacesEnum.NONE;\n      s.hasSideSurface = false;\n    }\n    if (w && w.constructor.name === 'Roof' && w.direction === 'w') {\n      this.surfaces.w = SurfacesEnum.NONE;\n      w.hasSideSurface = false;\n    }\n  };\n\n  hookBeforeRemove = context => {\n    // check adjacent cubes and seal them?\n    const { n, e, s, w, t } = context;\n    if (n && n.constructor.name === 'Cube') {\n      n.surfaces.s = SurfacesEnum.SOLID;\n    }\n    if (e && e.constructor.name === 'Cube') {\n      e.surfaces.w = SurfacesEnum.SOLID;\n    }\n    if (s && s.constructor.name === 'Cube') {\n      s.surfaces.n = SurfacesEnum.SOLID;\n    }\n    if (w && w.constructor.name === 'Cube') {\n      w.surfaces.e = SurfacesEnum.SOLID;\n    }\n\n    // Readd floor from cube above\n    if (t && t.constructor.name === 'Cube') {\n      t.surfaces.b = SurfacesEnum.SOLID;\n    }\n\n    // Unjoin to adjacent roofs that face this cube\n    if (n && n.constructor.name === 'Roof' && n.direction === 'n') {\n      n.hasSideSurface = true;\n    }\n    if (e && e.constructor.name === 'Roof' && e.direction === 'e') {\n      e.hasSideSurface = true;\n    }\n    if (s && s.constructor.name === 'Roof' && s.direction === 's') {\n      s.hasSideSurface = true;\n    }\n    if (w && w.constructor.name === 'Roof' && w.direction === 'w') {\n      w.hasSideSurface = true;\n    }\n  };\n\n  setSurface = (sideCardinal, surface) => {\n    this.surfaces[sideCardinal] = surface;\n  };\n\n  // Check if any wall has no surface\n  hasAccessToOutside = context => {\n    const { n, s, e, w } = context;\n    if (this.surfaces.e === SurfacesEnum.NONE && e === null) {\n      return true;\n    }\n    if (this.surfaces.w === SurfacesEnum.NONE && w === null) {\n      return true;\n    }\n    if (this.surfaces.n === SurfacesEnum.NONE && n === null) {\n      return true;\n    }\n    if (this.surfaces.s === SurfacesEnum.NONE && s === null) {\n      return true;\n    }\n    return false;\n  };\n\n  hasAccessInDirection = direction => {\n    if (this.surfaces[direction] === SurfacesEnum.NONE) {\n      return true;\n    }\n    return false;\n  };\n}\n","import SurfacesEnum from '../enums/SurfacesEnum';\n\nexport default class Roof {\n  constructor(roofData) {\n    if (roofData) {\n      const { direction, hasSideSurface } = roofData;\n      this.direction = direction;\n      this.hasSideSurface = hasSideSurface;\n    } else {\n      this.direction = 'n';\n      this.hasSideSurface = true;\n    }\n  }\n\n  // Join cube surfaces that connect\n  hookAfterInsert = (modifier, context) => {\n    this.direction = modifier;\n\n    const { n, e, s, w, b } = context;\n\n    // Join to roof above\n    if (b && b.constructor.name === 'Cube') {\n      b.surfaces.t = SurfacesEnum.NONE;\n    }\n\n    // Join to adjacent cubes that face this roof\n    if (n && n.constructor.name === 'Cube' && this.direction === 's') {\n      n.surfaces.s = SurfacesEnum.NONE;\n      this.hasSideSurface = false;\n    }\n    if (e && e.constructor.name === 'Cube' && this.direction === 'w') {\n      e.surfaces.w = SurfacesEnum.NONE;\n      this.hasSideSurface = false;\n    }\n    if (s && s.constructor.name === 'Cube' && this.direction === 'n') {\n      s.surfaces.n = SurfacesEnum.NONE;\n      this.hasSideSurface = false;\n    }\n    if (w && w.constructor.name === 'Cube' && this.direction === 'e') {\n      w.surfaces.e = SurfacesEnum.NONE;\n      this.hasSideSurface = false;\n    }\n\n    // Join to adjacent roofs\n    if (n && (n.constructor.name === 'Roof' && n.direction === 'n') && this.direction === 's') {\n      n.hasSideSurface = false;\n      this.hasSideSurface = false;\n    }\n    if (e && (e.constructor.name === 'Roof' && e.direction === 'e') && this.direction === 'w') {\n      e.hasSideSurface = false;\n      this.hasSideSurface = false;\n    }\n    if (s && (s.constructor.name === 'Roof' && s.direction === 's') && this.direction === 'n') {\n      s.hasSideSurface = false;\n      this.hasSideSurface = false;\n    }\n    if (w && (w.constructor.name === 'Roof' && w.direction === 'w') && this.direction === 'e') {\n      w.hasSideSurface = false;\n      this.hasSideSurface = false;\n    }\n  };\n\n  hookBeforeRemove = context => {\n    const { n, e, s, w, b } = context;\n    // Unjoin adjacent cubes\n    if (b && b.constructor.name === 'Cube') {\n      b.surfaces.t = SurfacesEnum.SOLID;\n    }\n    if (n && n.constructor.name === 'Cube' && this.direction === 's') {\n      n.surfaces.s = SurfacesEnum.SOLID;\n    }\n    if (e && e.constructor.name === 'Cube' && this.direction === 'w') {\n      e.surfaces.w = SurfacesEnum.SOLID;\n    }\n    if (s && s.constructor.name === 'Cube' && this.direction === 'n') {\n      s.surfaces.n = SurfacesEnum.SOLID;\n    }\n    if (w && w.constructor.name === 'Cube' && this.direction === 'e') {\n      w.surfaces.e = SurfacesEnum.SOLID;\n    }\n\n    // Unjoin adjacent roofs\n    if (n && (n.constructor.name === 'Roof' && n.direction === 'n') && this.direction === 's') {\n      n.hasSideSurface = true;\n    }\n    if (e && (e.constructor.name === 'Roof' && e.direction === 'e') && this.direction === 'w') {\n      e.hasSideSurface = true;\n    }\n    if (s && (s.constructor.name === 'Roof' && s.direction === 's') && this.direction === 'n') {\n      s.hasSideSurface = true;\n    }\n    if (w && (w.constructor.name === 'Roof' && w.direction === 'w') && this.direction === 'e') {\n      w.hasSideSurface = true;\n    }\n  };\n\n  setSurface = (sideCardinal, surface) => {\n    if (surface === SurfacesEnum.NONE) {\n      switch (sideCardinal) {\n        case 'n':\n          if (this.direction === 's') {\n            this.hasSideSurface = false;\n          }\n          break;\n        case 's':\n          if (this.direction === 'n') {\n            this.hasSideSurface = false;\n          }\n          break;\n        case 'e':\n          if (this.direction === 'w') {\n            this.hasSideSurface = false;\n          }\n          break;\n        case 'w':\n          if (this.direction === 'e') {\n            this.hasSideSurface = false;\n          }\n          break;\n        default:\n          break;\n      }\n    }\n  };\n}\n","export class Foliage {}\n\nexport class Trunk {}\n","import Array2D from 'array2d';\nimport ObjectsEnum from '../enums/ObjectsEnum';\nimport CamerasEnum from '../enums/CamerasEnum';\n\nimport { getEmpty2DArray, getEmpty3DArray, getCellContext3D } from '../helpers/ArrayHelpers';\nimport { getOppositeDirection } from '../helpers/Helpers';\n\nimport Cube from './Cube';\nimport Roof from './Roof';\nimport { Foliage, Trunk } from './Tree';\n\n/* global SETTINGS */\n\n/**\n * Represents the data of a design world\n *\n * The world is similar to Google Sketchup. The standard view \"North\" (looking North)\n * has x increasing from left to right, y, starting at 0 and increasing as it moves\n * away from you, and z increasing as it goes up.\n *\n */\nclass Design {\n  constructor(objects) {\n    if (objects) {\n      this.objects = objects;\n    } else {\n      // init empty world\n      this.objects = getEmpty3DArray(SETTINGS.xMax, SETTINGS.yMax, SETTINGS.zMax);\n      this.fill();\n    }\n  }\n\n  getAll = () => this.objects;\n\n  clear = () => {\n    this.objects = getEmpty3DArray(SETTINGS.xMax, SETTINGS.yMax, SETTINGS.zMax);\n  };\n\n  /**\n   * Add an object at a certain position.\n   * @param {object} position - 3D position in the form {x:x,y:y,z:z}\n   * @param {int} obj - int representing the ObjectsEnum object\n   */\n  add = (obj, position, modifier) => {\n    const context = getCellContext3D(this.objects, position);\n    let newObject;\n    switch (obj) {\n      case ObjectsEnum.TRUNK:\n        if (position.y < (SETTINGS.yMax - 1)) {\n          const { x, y } = position;\n          let { z } = position;\n          z += 1;\n          const foliagePosition = { x, y, z };\n          // Check placement spot and placement spot above\n          this._setCell(position, new Trunk(position));\n          this._setCell(foliagePosition, new Foliage(foliagePosition));\n          return true;\n        }\n        return false;\n      case ObjectsEnum.CUBE:\n        newObject = new Cube();\n        this._setCell(position, newObject);\n        newObject.hookAfterInsert(context);\n        return true;\n      case ObjectsEnum.ROOF:\n        newObject = new Roof();\n        this._setCell(position, newObject);\n        newObject.hookAfterInsert(modifier, context);\n        return true;\n      default:\n        return false;\n    }\n  }\n\n  /**\n   * Remove the object at a certain position\n   * @param {object} position - 3D position in the form {x:x,y:y,z:z}\n   */\n  remove = position => {\n    const obj = this._getCell(position);\n\n    if (!obj) {\n      return;\n    }\n\n    switch (obj.constructor.name) {\n      case 'Trunk':\n        if (position.z < (SETTINGS.zMax - 1)) {\n          this._setCell(position, null);\n          const { x, y } = position;\n          let { z } = position;\n          z += 1;\n          this._setCell({ x, y, z }, null);\n        }\n        break;\n      case 'Foliage':\n        if (position.z > 0) {\n          this._setCell(position, null);\n          const { x, y } = position;\n          let { z } = position;\n          z -= 1;\n          this._setCell({ x, y, z }, null);\n        }\n        break;\n      default:\n        if (obj && obj.hookBeforeRemove) {\n          const context = getCellContext3D(this.objects, position);\n          obj.hookBeforeRemove(context);\n        }\n        this._setCell(position, null);\n        break;\n    }\n  }\n\n  /**\n   * Use the camera and 2D side (l, r, t, b) to get a cardinal\n   * point (n,s,e,w,t,b) and set that surface at the model position\n   * to the given surface.\n   */\n  setSurface = (camera, position, side, surface) => {\n    const obj = this._getCell(position);\n\n    const sideCardinal = this.getCardinalSide(camera, side);\n    if (obj && obj.setSurface) {\n      obj.setSurface(sideCardinal, surface);\n    }\n\n    const context = getCellContext3D(this.objects, position);\n    const sharedWallNeighbor = context[sideCardinal];\n    if (sharedWallNeighbor && sharedWallNeighbor.setSurface) {\n      sharedWallNeighbor.setSurface(getOppositeDirection(sideCardinal), surface);\n    }\n  }\n\n  getObjects = () => {\n    const objects = [];\n    for (let z = 0; z < SETTINGS.zMax; z += 1) {\n      for (let y = 0; y < SETTINGS.yMax; y += 1) {\n        for (let x = 0; x < SETTINGS.xMax; x += 1) {\n          const object = this.objects[z][y][x];\n          if (object) {\n            let type = null;\n            switch (object.constructor.name) {\n              case 'Cube':\n                type = ObjectsEnum.CUBE;\n                break;\n              case 'Roof':\n                type = ObjectsEnum.ROOF;\n                break;\n              case 'Foliage':\n                type = ObjectsEnum.FOLIAGE;\n                break;\n              case 'Trunk':\n                type = ObjectsEnum.TRUNK;\n                break;\n              default:\n                break;\n            }\n            objects.push({\n              object,\n              type,\n              position: { x, y, z }\n            });\n          }\n        }\n      }\n    }\n\n    return objects;\n  }\n\n  getBuildings = () => {\n    if (this._buildings) {\n      return this._buildings;\n    }\n    return [];\n  }\n\n  calculateAttributes = topo => {\n    const objects = this.getObjects();\n    this._objects = objects;\n\n    if (!objects) {\n      return;\n    }\n\n    // Calculate individual object attributes\n    this.calculateObjectAttributes(objects, topo);\n    this.calculateAccess(objects);\n\n    // Check building attributes\n    const buildings = this.findBuildings(objects);\n    this._buildings = this.calculateBuildingAttributes(buildings); // save building attributes\n  }\n\n  calculateObjectAttributes = (objects, topo) => {\n    objects.forEach(item => {\n      const { position, object } = item;\n      const { x, y, z } = position;\n      const gh = topo.getAt({ x, y }); // get ground height\n      // const {\n      //   n, e, s, w, t, b\n      // } = getCellContext3D(this.objects, { x, y, z });\n      const { b } = getCellContext3D(this.objects, { x, y, z });\n\n      switch (object.constructor.name) {\n        case 'Cube':\n          object.area = 100;\n          object.height = 10 * (z + 1 - gh);\n          object.ground = 10 * (z - gh);\n          break;\n        case 'Roof':\n          object.height = 10 * (z + 1 - gh);\n          // 0 if has building below, else 1\n          object.noBase = b && b.constructor.name === 'Cube' ? 0 : 1;\n          object.ground = 10 * (z - gh);\n          break;\n        case 'Foliage':\n          object.height = 10 * (z + 1 - gh);\n          object.ground = 10 * (z - gh);\n          break;\n        case 'Trunk':\n          object.height = 10 * (z + 1 - gh);\n          object.ground = 10 * (z - gh);\n          break;\n        default:\n          break;\n      }\n    });\n  }\n\n  calculateAccess = objects => {\n    // Reset access\n    objects.forEach(item => {\n      if (item.type === ObjectsEnum.CUBE) {\n        const { object } = item;\n        object.distToAccess = Infinity;\n      }\n    });\n\n    // Get access points\n    const accessPoints = objects.filter(item => {\n      if (item.type === ObjectsEnum.CUBE) {\n        const { position, object } = item;\n        const { x, y, z } = position;\n        const context = getCellContext3D(this.objects, { x, y, z });\n        return object.hasAccessToOutside(context);\n      }\n      return false;\n    });\n\n    const checkAccess = (position, dist) => {\n      const { x, y, z } = position;\n      if (x < 0 || y < 0 || x >= SETTINGS.xMax || y >= SETTINGS.yMax) {\n        // out of bounds\n        return;\n      }\n      const object = this.objects[z][y][x];\n\n      if (object && (dist < object.distToAccess)) {\n        // Update access and continue flood fill of neighbors if this is the closest acces seen yet\n        object.distToAccess = dist;\n        const nextDist = dist + 10;\n\n        // check neigbors that open in this direction\n        if (object.hasAccessInDirection('n')) {\n          checkAccess({ x, y: y + 1, z }, nextDist);\n        }\n        if (object.hasAccessInDirection('s')) {\n          checkAccess({ x, y: y - 1, z }, nextDist);\n        }\n        if (object.hasAccessInDirection('e')) {\n          checkAccess({ x: x + 1, y, z }, nextDist);\n        }\n        if (object.hasAccessInDirection('w')) {\n          checkAccess({ x: x - 1, y, z }, nextDist);\n        }\n        if (object.hasAccessInDirection('t')) {\n          checkAccess({ x, y, z: z + 1 }, nextDist);\n        }\n        if (object.hasAccessInDirection('b')) {\n          checkAccess({ x, y, z: z - 1 }, nextDist);\n        }\n      }\n    };\n\n    // For each access points, flood fill building, replacing access distance if lower\n    accessPoints.forEach(item => {\n      const { position } = item;\n      checkAccess(position, 10);\n    });\n  }\n\n  calculateBuildingAttributes = buildings => {\n    // Check building attributes\n    const buildingAttributes = []; // save building attributes\n    Object.keys(buildings).forEach(key => {\n      const building = buildings[key];\n      // building touches ground\n      // square footage of buildings\n      let floating = true;\n      let height = 0;\n      let ground = Infinity;\n      let area = 0;\n      let maxDistToAccess = 0;\n      building.forEach(part => {\n        if (part.constructor.name === 'Cube') {\n          area += 100;\n\n          if (part.distToAccess > maxDistToAccess) {\n            maxDistToAccess = part.distToAccess;\n          }\n        }\n        if (part.height === 10) { // on ground\n          floating = false;\n        }\n        if (part.height > height) {\n          height = part.height;\n        }\n        if (part.ground < ground) {\n          ground = part.ground;\n        }\n      });\n      buildingAttributes.push({\n        area,\n        floating: floating ? 1 : 0,\n        height,\n        ground,\n        maxDistToAccess\n      });\n    });\n\n    return buildingAttributes;\n  }\n\n  findBuildings = objects => {\n    const buildingParts = objects.filter(item => item.type === ObjectsEnum.CUBE || item.type === ObjectsEnum.ROOF);\n    const buildings = {};\n\n    // Reset buildings\n    buildingParts.forEach(item => {\n      const { object } = item;\n      object.buildingIndex = null;\n    });\n\n    // get the next building part, if no building, flood fill\n    const floodFillBuildings = (position, buildingIndex) => {\n      const { x, y, z } = position;\n      if (x < 0 || y < 0 || z < 0 || x >= SETTINGS.xMax || y >= SETTINGS.yMax || z >= SETTINGS.zMax) {\n        // out of bounds\n        return;\n      }\n      const object = this.objects[z][y][x];\n      if (object && object.buildingIndex === null) {\n        object.buildingIndex = buildingIndex;\n        buildings[buildingIndex].push(object);\n        const neighborPositions = [{ x, y: y + 1, z }, { x, y: y - 1, z }, { x: x + 1, y, z },\n          { x: x - 1, y, z }, { x, y, z: z + 1 }, { x, y, z: z - 1 }];\n        neighborPositions.forEach(neighborPosition => floodFillBuildings(neighborPosition, buildingIndex));\n      }\n    };\n\n    // For each access points, flood fill building, replacing access distance if lower\n    let nextIndex = 0;\n    buildingParts.forEach(item => {\n      const { position, object } = item;\n      if (object.buildingIndex === null) {\n        buildings[nextIndex] = [];\n        floodFillBuildings(position, nextIndex);\n        nextIndex += 1;\n      }\n    });\n\n    return buildings;\n  }\n\n  // Given 2D side { t, b, l, r } and camera view, return the cardinal direction { t, b, n, s, e, w }\n  getCardinalSide = (camera, side) => {\n    let sideCardinal;\n    if (side === 't' || side === 'b') {\n      switch (camera) {\n        case CamerasEnum.NORTH:\n        case CamerasEnum.SOUTH:\n        case CamerasEnum.EAST:\n        case CamerasEnum.WEST:\n          sideCardinal = side;\n          break;\n        case CamerasEnum.BOTTOM:\n          if (side === 't') {\n            sideCardinal = 's';\n          } else {\n            sideCardinal = 'n';\n          }\n          break;\n        case CamerasEnum.TOP:\n          if (side === 't') {\n            sideCardinal = 'n';\n          } else {\n            sideCardinal = 's';\n          }\n          break;\n        default:\n          throw new Error(`camera ${camera} is not recognized!`);\n      }\n    } else {\n      switch (camera) {\n        case CamerasEnum.NORTH:\n          if (side === 'l') {\n            sideCardinal = 'w';\n          } else if (side === 'r') {\n            sideCardinal = 'e';\n          }\n          break;\n        case CamerasEnum.SOUTH:\n          if (side === 'l') {\n            sideCardinal = 'e';\n          } else if (side === 'r') {\n            sideCardinal = 'w';\n          }\n          break;\n        case CamerasEnum.EAST:\n          if (side === 'l') {\n            sideCardinal = 'n';\n          } else if (side === 'r') {\n            sideCardinal = 's';\n          }\n          break;\n        case CamerasEnum.WEST:\n          if (side === 'l') {\n            sideCardinal = 's';\n          } else if (side === 'r') {\n            sideCardinal = 'n';\n          }\n          break;\n        case CamerasEnum.BOTTOM:\n        case CamerasEnum.TOP:\n          if (side === 'l') {\n            sideCardinal = 'w';\n          } else if (side === 'r') {\n            sideCardinal = 'e';\n          }\n          break;\n        default:\n          throw new Error(`camera ${camera} is not recognized!`);\n      }\n    }\n    return sideCardinal;\n  }\n\n  /**\n   * Returns 2D array of objects in the given slice\n   * @param {int} camera - The CamerasEnum camera view\n   * @param {int} sliceIndex - The current slice being viewed from that camera view\n   */\n  getSlice = (camera, sliceIndex) => {\n    let ySlice;\n    let xSlice;\n    let zSlice;\n    switch (camera) {\n      case CamerasEnum.NORTH:\n        return this._getYSlice(sliceIndex);\n      case CamerasEnum.SOUTH:\n        ySlice = this._getYSlice(sliceIndex);\n        return Array2D.hflip(ySlice);\n      case CamerasEnum.EAST:\n        xSlice = this._getXSlice(sliceIndex);\n        return Array2D.hflip(xSlice);\n      case CamerasEnum.WEST:\n        return this._getXSlice(sliceIndex);\n      case CamerasEnum.BOTTOM:\n        zSlice = this._getZSlice(sliceIndex);\n        return Array2D.vflip(zSlice);\n      case CamerasEnum.TOP:\n        return this._getZSlice(sliceIndex);\n      default:\n        throw new Error(`camera ${camera} is not recognized!`);\n    }\n  }\n\n  getBackgroundSlices = (camera, sliceIndex) => {\n    let backgroundSliceIndex = sliceIndex;\n    const backgroundSliceIndices = [];\n    switch (camera) {\n      case CamerasEnum.NORTH:\n        while (backgroundSliceIndex < (SETTINGS.yMax - 1)) {\n          backgroundSliceIndex += 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      case CamerasEnum.SOUTH:\n        while (backgroundSliceIndex > 0) {\n          backgroundSliceIndex -= 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      case CamerasEnum.EAST:\n        while (backgroundSliceIndex < (SETTINGS.xMax - 1)) {\n          backgroundSliceIndex += 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      case CamerasEnum.WEST:\n        while (backgroundSliceIndex > 0) {\n          backgroundSliceIndex -= 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      case CamerasEnum.BOTTOM:\n        while (backgroundSliceIndex < (SETTINGS.zMax - 1)) {\n          backgroundSliceIndex += 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      case CamerasEnum.TOP:\n        while (backgroundSliceIndex > 0) {\n          backgroundSliceIndex -= 1;\n          backgroundSliceIndices.push(backgroundSliceIndex);\n        }\n        break;\n      default:\n        throw new Error(`camera ${camera} is not recognized!`);\n    }\n    const backgroundSlices = backgroundSliceIndices.map(i => this.getSlice(camera, i));\n    return backgroundSlices;\n  }\n\n  _getZSlice = z => this.objects[z]\n\n  _getXSlice = x => {\n    const slice = getEmpty2DArray(SETTINGS.zMax, SETTINGS.yMax);\n    for (let z = 0; z < SETTINGS.zMax; z += 1) {\n      for (let y = 0; y < SETTINGS.yMax; y += 1) {\n        slice[z][y] = this.objects[z][y][x];\n      }\n    }\n    return slice;\n  }\n\n  _getYSlice = y => {\n    const slice = getEmpty2DArray(SETTINGS.zMax, SETTINGS.xMax);\n    for (let z = 0; z < SETTINGS.zMax; z += 1) {\n      for (let x = 0; x < SETTINGS.xMax; x += 1) {\n        slice[z][x] = this.objects[z][y][x];\n      }\n    }\n    return slice;\n  }\n\n  _getCell = position => {\n    const { x, y, z } = position;\n    if (x >= 0 && y >= 0 && z >= 0 && x < SETTINGS.xMax && y < SETTINGS.yMax && z < SETTINGS.zMax) {\n      return this.objects[z][y][x];\n    }\n    return null;\n  }\n\n  _setCell = (position, object) => {\n    const { x, y, z } = position;\n    if (x >= 0 && y >= 0 && z >= 0 && x < SETTINGS.xMax && y < SETTINGS.yMax && z < SETTINGS.zMax) {\n      this.objects[z][y][x] = object;\n    }\n  }\n\n  _addCube = position => {\n    const context = getCellContext3D(position);\n    const c = new Cube(position, context);\n    this.addObject(position, c);\n  }\n\n  fill = () => {\n    const addObject = (pos, type, mod) => {\n        this.add(type, pos, mod);\n    };\n\n    addObject({ x: 11, y: 3, z: 0 }, 0);\n    addObject({ x: 11, y: 3, z: 1 }, 0);\n    addObject({ x: 11, y: 3, z: 2 }, 1, 'w');\n\n    addObject({ x: 12, y: 3, z: 0 }, 0);\n    addObject({ x: 12, y: 3, z: 1 }, 0);\n    addObject({ x: 12, y: 3, z: 2 }, 1, 'e');\n\n    addObject({ x: 13, y: 3, z: 0 }, 0);\n    addObject({ x: 13, y: 3, z: 1 }, 1, 'e');\n\n    addObject({ x: 14, y: 3, z: 0 }, 0);\n\n    addObject({ x: 15, y: 3, z: 0 }, 0);\n\n    addObject({ x: 16, y: 3, z: 0 }, 2);\n\n    addObject({ x: 9, y: 13, z: 0 }, 0);\n    addObject({ x: 9, y: 13, z: 1 }, 1, 's');\n\n    addObject({ x: 9, y: 14, z: 0 }, 0);\n    addObject({ x: 9, y: 14, z: 1 }, 1, 'n');\n\n\n    addObject({ x: 13, y: 5, z: 4 }, 1, 'e');\n\n    addObject({ x: 5, y: 0, z: 1 }, 1, 'e');\n    addObject({ x: 7, y: 0, z: 0 }, 0);\n    addObject({ x: 9, y: 0, z: 0 }, 0);\n    addObject({ x: 10, y: 0, z: 0 }, 0);\n\n\n    addObject({ x: 1, y: 1, z: 2 }, 0);\n    addObject({ x: 2, y: 1, z: 2 }, 0);\n    addObject({ x: 1, y: 2, z: 2 }, 0);\n    addObject({ x: 2, y: 2, z: 2 }, 0);\n    addObject({ x: 1, y: 2, z: 3 }, 0);\n    addObject({ x: 2, y: 2, z: 3 }, 0);\n\n    addObject({ x: 4, y: 2, z: 5 }, 1, 's');\n    addObject({ x: 4, y: 2, z: 5 }, 1, 'n');\n\n    addObject({ x: 4, y: 2, z: 5 }, 1, 's');\n    addObject({ x: 4, y: 2, z: 5 }, 1, 'n');\n  }\n}\n\nDesign.freeze = design => {\n  const { objects } = design;\n  const objectsPacked = getEmpty3DArray(SETTINGS.xMax, SETTINGS.yMax, SETTINGS.zMax);\n  for (let z = 0; z < SETTINGS.zMax; z += 1) {\n    for (let y = 0; y < SETTINGS.xMax; y += 1) {\n      for (let x = 0; x < SETTINGS.xMax; x += 1) {\n        const objectData = objects[z][y][x];\n        if (objectData) {\n          const jsonStr = JSON.stringify(objectData);\n          const json = JSON.parse(jsonStr);\n          json.type = objectData.constructor.name;\n          objectsPacked[z][y][x] = json;\n        }\n      }\n    }\n  }\n\n  const json = {\n    objects: objectsPacked\n  };\n\n  return json;\n};\n\nDesign.thaw = json => {\n  const { objects } = json;\n  const objectsUnpacked = getEmpty3DArray(SETTINGS.xMax, SETTINGS.yMax, SETTINGS.zMax);\n  // Deserialize all the object data into objects\n  for (let z = 0; z < SETTINGS.zMax; z += 1) {\n    for (let y = 0; y < SETTINGS.xMax; y += 1) {\n      for (let x = 0; x < SETTINGS.xMax; x += 1) {\n        const objectData = objects[z][y][x];\n        if (objectData) {\n          let object = null;\n          switch (objectData.type) {\n            case 'Cube':\n              object = new Cube(objectData);\n              break;\n            case 'Roof':\n              object = new Roof(objectData);\n              break;\n            case 'Foliage':\n              object = new Foliage(objectData);\n              break;\n            case 'Trunk':\n              object = new Trunk(objectData);\n              break;\n            default:\n              break;\n          }\n\n          objectsUnpacked[z][y][x] = object;\n        }\n      }\n    }\n  }\n\n  const design = new Design(objectsUnpacked);\n  return design;\n};\n\nexport default Design;\n","import Array2D from 'array2d';\nimport CamerasEnum from '../enums/CamerasEnum';\nimport { getEmpty2DArray, getCellContext3x3, getCornerContext2x2 } from '../helpers/ArrayHelpers';\n\n/* global SETTINGS */\n\n/** Class represents the topograhy of a design world */\nclass Topo {\n  constructor(heights) {\n    if (heights) {\n      this.heights = heights;\n    } else {\n      this.heights = getEmpty2DArray(SETTINGS.yMax, SETTINGS.xMax, 0);\n    }\n  }\n\n  clear = () => {\n    this.heights = getEmpty2DArray(SETTINGS.yMax, SETTINGS.xMax, 0);\n  };\n\n  increase = position => {\n    const height = this.heights[position.y][position.x] + 1;\n    if (height <= SETTINGS.zMax) {\n      this.heights[position.y][position.x] = height;\n    }\n  };\n\n  decrease = position => {\n    const height = this.heights[position.y][position.x] - 1;\n    if (height >= 0) {\n      this.heights[position.y][position.x] = height;\n    }\n  };\n\n  /**\n   * Get the topography height at a given position\n   * @param {object} position - 2D position in the form {x:x,y:y}\n   */\n  getAt = position => this.heights[position.y][position.x];\n\n  /**\n   * Get a the 1D array of heights for the given slice at the camera angle\n   * @param {int} camera - The CamerasEnum camera view\n   * @param {int} sliceIndex - The current slice being viewed from that camera view\n   */\n  getSlice = (camera, sliceIndex) => {\n    // console.log(`camera ${camera} and sliceIndex ${sliceIndex}`);\n    let heightsView;\n    switch (camera) {\n      case CamerasEnum.NORTH:\n        heightsView = this.heights;\n        break;\n      case CamerasEnum.SOUTH:\n        heightsView = Array2D.hflip(this.heights);\n        break;\n      case CamerasEnum.EAST:\n        heightsView = Array2D.hflip(Array2D.transpose(this.heights));\n        break;\n      case CamerasEnum.WEST:\n        heightsView = Array2D.transpose(this.heights);\n        break;\n      case CamerasEnum.BOTTOM:\n      case CamerasEnum.TOP:\n        return null;\n      default:\n        throw new Error(`camera ${camera} is not recognized!`);\n    }\n\n    const back = [];\n    const front = [];\n\n    /*\n    For a given slice, get the highest corners of the front of the current cube and\n    the cubes in front and back and left and right. Imagine a sheet hung\n    over stacks of cubes. That is what we represent. This is necessary\n    because we set the heights of the cells, but we render the heights\n    at half way points in the slices.\n    */\n    for (let i = 0; i < heightsView[sliceIndex].length; i += 1) {\n      // Get the context\n      const context = getCellContext3x3(heightsView, i, sliceIndex);\n      const {\n        topLeft, top, topRight, left, center, right, bottomLeft, bottom, bottomRight\n      } = context;\n      // Find the heightest points\n      back.push([Math.max(topLeft, top, left, center), Math.max(top, topRight, center, right)]);\n      front.push([ Math.max(bottomLeft, bottom, left, center), Math.max(bottom, bottomRight, center, right) ]);\n    }\n\n    return { front, back };\n  };\n\n  /**\n   * Get 2D array of all the corner heights (at each corner use the highest adjacent tile)\n   */\n  getCorners = () => {\n    const { length } = this.heights;\n    const cornersLength = length + 1;\n    // Create a 2D array 1 longer and wider than heights\n    const corners = getEmpty2DArray(cornersLength, cornersLength, 0);\n\n    for (let y = 0; y < cornersLength; y += 1) {\n      for (let x = 0; x < cornersLength; x += 1) {\n        const context = getCornerContext2x2(this.heights, x, y);\n        const {\n          topLeft, topRight, bottomLeft, bottomRight\n        } = context;\n        // console.log(topLeft, topRight, bottomLeft, bottomRight);\n        corners[y][x] = Math.max(topLeft, topRight, bottomLeft, bottomRight);\n      }\n    }\n\n    // console.dir(corners);\n    return corners;\n  };\n}\n\nTopo.freeze = topo => {\n  const jsonStr = JSON.stringify(topo);\n  const json = JSON.parse(jsonStr);\n\n  return json;\n};\n\nTopo.thaw = json => {\n  const { heights } = json;\n  const topo = new Topo(heights);\n  return topo;\n};\n\nexport default Topo;\n","import Monitor from './Monitor';\nimport Design from './Design';\nimport Topo from './Topo';\n\n/* global localStorage */\n\n/**\n* Represents a user's session with the system and provides an interface for\n* the UI to display information about it.\n*/\nclass U5Session {\n  constructor(id) {\n    this._id = id;\n  }\n\n  onUpdate = () => {\n    // calculate totals\n    this._design.calculateAttributes(this.topo);\n\n    // monitor checks design\n    this._monitor.checkDesign(this._design);\n\n    // save\n    this.save();\n  };\n\n  clear = () => {\n    this._design.clear();\n    this._topo.clear();\n    this._monitor.clearConstraints();\n    this.onUpdate();\n  };\n\n  // Interface for the design model\n  design = {\n    add: (type, xyz, meta) => {\n      this._design.add(type, xyz, meta);\n      this.onUpdate();\n    },\n    remove: xyz => {\n      this._design.remove(xyz);\n      this.onUpdate();\n    },\n    setSurface: (camera, xyz, side, surface) => {\n      this._design.setSurface(camera, xyz, side, surface);\n      this.onUpdate();\n    },\n    // Get the 3D array of objects\n    getAll: () => this._design.getAll(),\n    // Get the 2D array of objects for a given slice\n    getSlice: (camera, slice) => this._design.getSlice(camera, slice),\n    getBackgroundSlices: (camera, slice) => this._design.getBackgroundSlices(camera, slice)\n  };\n\n  // Interface for the topography model\n  topo = {\n    // Increase the height of the topography at position xy by 1\n    increase: xy => {\n      this._topo.increase(xy);\n      this.onUpdate();\n    },\n    // Decrease the height of the topography at position xy by 1\n    decrease: xy => {\n      this._topo.decrease(xy);\n      this.onUpdate();\n    },\n    // Get the 2D array of heights for the topography\n    getCorners: () => this._topo.getCorners(),\n    // Get the 2D array of heights for the topography\n    getAt: xy => this._topo.getAt(xy),\n    // Get a list of heights for the topography at the corners for a line representing it in a slice\n    getSlice: (camera, slice) => this._topo.getSlice(camera, slice)\n  };\n\n  // Interface for the monitor\n  monitor = {\n    addConstraint: text => {\n      const success = this._monitor.addConstraint(text);\n      if (success) {\n        this.onUpdate();\n      }\n    },\n    clearConstraints: () => {\n      this._monitor.clearConstraints();\n      this.onUpdate();\n    },\n    getMessages: () => this._monitor.getMessages()\n  };\n\n  save = () => {\n    // console.log('save!');\n    const ice = U5Session.freeze(this);\n    localStorage.setItem(this._id, JSON.stringify(ice));\n  };\n}\n\nU5Session.create = id => {\n  const session = new U5Session(id);\n  session._design = new Design();  // eslint-disable-line\n  session._topo = new Topo();  // eslint-disable-line\n  session._monitor = new Monitor();  // eslint-disable-line\n\n  session.save();\n  return session;\n};\n\nU5Session.freeze = session => {\n  const { _id, _design, _topo, _monitor } = session;  // eslint-disable-line\n\n  const json = {\n    id: _id,\n    design: Design.freeze(_design),\n    topo: Topo.freeze(_topo),\n    monitor: Monitor.freeze(_monitor)\n  };\n\n  return json;\n};\n\nU5Session.thaw = json => {\n  const { id, design, topo, monitor } = json;  // eslint-disable-line\n  const session = new U5Session(id);\n  session._design = Design.thaw(design);  // eslint-disable-line\n  session._topo = Topo.thaw(topo);  // eslint-disable-line\n  session._monitor = Monitor.thaw(monitor);  // eslint-disable-line\n\n  session.onUpdate();\n\n  return session;\n};\n\nexport default U5Session;\n","import React from 'react';\nimport './App.css';\nimport * as THREE from 'three';\n\nimport MainPage from './components/MainPage';\nimport DebuggingConstraints from './debugging/DebuggingConstraints';\nimport Debugging3D from './debugging/Debugging3D';\nimport U5SessionFactory from './js/sessionAPI/U5SessionFactory';\n\n/* global window */\n\nconst SETTINGS = {\n  w: 852,\n  h: 852,\n  color: '#E8E8DA',\n  gridSize: 17,\n  xMax: 17,\n  yMax: 17,\n  zMax: 7,\n  r: 50,\n  material: new THREE.LineBasicMaterial({ color: 0xE8E8DA }),\n  stroke: 3.5\n};\nwindow.SETTINGS = SETTINGS;\n\nconst session = new U5SessionFactory().last();\nconst cameraView = {\n  camera: 0,\n  slices: {\n    x: 0,\n    y: 0,\n    z: 6\n  }\n};\n// const session = new U5SessionFactory().test();\n\nexport default class App extends React.Component {\n\n  state = {\n    debug: true\n  }\n\n  componentDidMount() {\n    document.addEventListener('keydown', (event) => {\n      const { debug } = this.state;\n      if (event.key === 'p') {\n        this.setState({ debug: !debug });\n      }\n    });\n  }\n\n  render() {\n    const { debug } = this.state;\n    return (\n      <div className=\"app\">\n        <MainPage session={session} cameraView={cameraView} />\n        { debug && (\n          <div>\n            <DebuggingConstraints session={session} />\n            <Debugging3D session={session} cameraView={cameraView} />\n          </div>\n        )}\n      </div>\n    );\n  }\n}\n","import U5Session from './U5Session';\n\n/* global localStorage */\n\n/** Provides access to previous, new, and test U5Sessions */\nexport default class U5SessionFactory {\n  getIDList = () => {\n    let ids = localStorage.getItem('U5SessionIDList');\n    if (!ids) {\n      ids = [];\n    } else {\n      ids = ids.split(',');\n    }\n    console.log(ids);\n    return ids;\n  }\n\n  get = id => {\n    const json = JSON.parse(localStorage.getItem(id));\n    const session = U5Session.thaw(json);\n\n    // Reorder sessions to make this session the most recent\n    let ids = this.getIDList();\n    ids = ids.filter(item => item !== id);\n    ids.push(id);\n    this._setIDList(ids);\n\n    return session;\n  }\n\n  remove = id => {\n    let ids = this.getIDList();\n    ids = ids.filter(item => item !== id);\n    this._setIDList(ids);\n    return ids;\n  }\n\n  last = () => {\n    const ids = this.getIDList();\n    const id = ids.pop();\n\n    if (!id) {\n      return this.newSession();\n    }\n\n    const json = JSON.parse(localStorage.getItem(id));\n    const session = U5Session.thaw(json);\n\n    return session;\n  }\n\n  newSession = () => {\n    const id = this._getNextID();\n\n    const ids = this.getIDList();\n    ids.push(id);\n    this._setIDList(ids);\n\n    const session = U5Session.create(id);\n    return session;\n  }\n\n  test = () => {\n    const id = this._getNextID();\n\n    const ids = this.getIDList();\n    ids.push(id);\n    this._setIDList(ids);\n\n    // Always get the same data, but save to new id\n    const test = localStorage.getItem('U5SessionTestData');\n\n    test.id = id;\n    const session = U5Session.thaw(test);\n    return session;\n  }\n\n  _setIDList = ids => localStorage.setItem('U5SessionIDList', ids)\n\n  _getNextID = () => {\n    let currentID = localStorage.getItem('U5SessionIDCount');\n    if (!currentID) {\n      currentID = -1;\n    }\n    currentID = parseInt(currentID, 10) + 1;\n    localStorage.setItem('U5SessionIDCount', currentID);\n    return `U5Session_${currentID}`;\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(<App />, document.getElementById('root'));\n","import parseText from '../helpers/TextToConstraint';\n\nclass Constraint {\n  constructor(data) {\n    if (data) {\n      const { text, result, fn, type, prop, comp, value } = data;  // eslint-disable-line\n      this.text = text;\n      this.result = result;\n      this.fn = fn;\n      this.type = type;\n      this.prop = prop;\n      this.comp = comp;\n      this.value = value;\n    }\n  }\n\n  isViolated = design => {\n    let objectsOfType;\n    if (this.type === 'Structure') {\n      objectsOfType = design.getBuildings();\n    } else {\n      const objects = design.getObjects();\n      objectsOfType = objects.filter(item => parseInt(this.type) === item.type);\n      objectsOfType = objectsOfType.map(item => item.object);\n    }\n\n    const propValues = objectsOfType.map(item => item[this.prop]);\n\n    if (propValues.length === 0) {\n      return false;\n    }\n\n    let calculatedValue = null;\n    switch (this.fn) {\n      case 'SUM':\n        calculatedValue = propValues.reduce((sum, num) => num ? (sum + num) : sum);  // eslint-disable-line\n        break;\n      case 'MAX':\n        calculatedValue = propValues.reduce((max, num) => num ? Math.max(max, num) : max);  // eslint-disable-line\n        break;\n      case 'MIN':\n        calculatedValue = propValues.reduce((min, num) => num ? Math.min(min, num) : min);  // eslint-disable-line\n        break;\n      default:\n        break;\n    }\n\n    const calculatedResult = eval(`${calculatedValue} ${this.comp} ${this.value}`);  // eslint-disable-line\n    console.log(this.prop, calculatedValue, this.comp, this.value, calculatedResult, 'expected', this.result);\n    const isViolated = calculatedResult !== this.result;\n\n    return {\n      result: isViolated,\n      value: calculatedValue\n    };\n  }\n\n  isSameType = otherConstraint => {\n    return otherConstraint.fn === this.fn\n      && JSON.stringify(otherConstraint.type) === JSON.stringify(this.type)\n      && otherConstraint.prop === this.prop;\n  }\n}\n\nconst possibleConstraints = [\n  { fn: 'MAX', type: 'Structure', prop: 'height' }, // can compare the max structure height to anything\n  { fn: 'MIN', type: 'Structure', prop: 'height' }, // can compare the min structure height to anything\n  { fn: 'MAX', type: '0', prop: 'distToAccess' }, // can compare to dist to access for cubes\n  { fn: 'MAX', type: 'Structure', prop: 'area' }, // can compare the max structure area to anything\n  { fn: 'MIN', type: 'Structure', prop: 'area' }, // can compare the min structure area to anything\n];\n\nconst hasError = constraintData => {\n  if (!constraintData) {\n    return true;\n  }\n\n  const { fn, type, prop, value, comp, result } = constraintData;\n  if (!fn || !type || !prop || !value || !comp || result === null) {\n    return true;\n  }\n\n  let hasMatch = false;\n  // Check if they match a possible constraint\n  possibleConstraints.forEach(possibility => {\n    if ((possibility.fn === undefined || possibility.fn === fn)\n        && (possibility.type === undefined || possibility.type === type)\n        && (possibility.prop === undefined || possibility.prop === prop)\n        && (possibility.value === undefined || possibility.value === value)\n        && (possibility.comp === undefined || possibility.comp === comp)\n        && (possibility.result === undefined || possibility.result === result)) {\n      hasMatch = true; // if they match all the provided criteria\n    }\n  });\n  if (!hasMatch) {\n    return true;\n  }\n  return false;\n};\n\nConstraint.create = text => {\n  if (!text) {\n    return 'No text provided';\n  }\n\n  const constraintData = parseText(text);\n  if (!hasError(constraintData)) {\n    return new Constraint(constraintData);\n  }\n  console.log(`Bad Constraint: ${JSON.stringify(constraintData)}`);\n  return null;\n};\n\nexport default Constraint;\n"],"sourceRoot":""}