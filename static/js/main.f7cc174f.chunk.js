(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(22),Constraint=function Constraint(data){var _this=this;if(Object(_Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,Constraint),this.isViolated=function(design){var objectsOfType;if("Structure"===_this.type)objectsOfType=design.getBuildings();else{var objects=design.getObjects();objectsOfType=objects.filter(function(e){return parseInt(_this.type)===e.type}),objectsOfType=objectsOfType.map(function(e){return e.object})}var propValues=objectsOfType.map(function(e){return e[_this.prop]});if(0===propValues.length)return!1;var calculatedValue=null;switch(_this.fn){case"SUM":calculatedValue=propValues.reduce(function(e,t){return t?e+t:e});break;case"MAX":calculatedValue=propValues.reduce(function(e,t){return t?Math.max(e,t):e});break;case"MIN":calculatedValue=propValues.reduce(function(e,t){return t?Math.min(e,t):e})}var calculatedResult=eval("".concat(calculatedValue," ").concat(_this.comp," ").concat(_this.value));console.log(_this.prop,calculatedValue,_this.comp,_this.value,calculatedResult,"expected",_this.result);var isViolated=calculatedResult!==_this.result;return{result:isViolated,value:calculatedValue}},this.isSameType=function(e){return JSON.stringify(e.type)===JSON.stringify(_this.type)&&e.prop===_this.prop},data){var text=data.text,result=data.result,fn=data.fn,type=data.type,prop=data.prop,comp=data.comp,value=data.value,removeFlag=data.removeFlag;this.text=text,this.result=result,this.fn=fn,this.type=type,this.prop=prop,this.comp=comp,this.value=value,this.removeFlag=removeFlag}},possibleConstraints=[{fn:"MAX",type:"Structure",prop:"height"},{fn:"MIN",type:"Structure",prop:"height"},{fn:"MAX",type:"0",prop:"distToAccess"},{fn:"MAX",type:"Structure",prop:"area"},{fn:"MIN",type:"Structure",prop:"area"}],hasError=function(e){if(!e)return!0;var t=e.fn,a=e.type,r=e.prop,n=e.value,s=e.comp,i=e.result;if(e.removeFlag)return!1;if(!t||!a||!r||!n||!s||null===i)return!0;var o=!1;return possibleConstraints.forEach(function(e){void 0!==e.fn&&e.fn!==t||void 0!==e.type&&e.type!==a||void 0!==e.prop&&e.prop!==r||void 0!==e.value&&e.value!==n||void 0!==e.comp&&e.comp!==s||void 0!==e.result&&e.result!==i||(o=!0)}),!o};Constraint.create=function(e){if(!e)return"No text provided";var t=Object(_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__.a)(e);return hasError(t)?null:new Constraint(t)},__webpack_exports__.a=Constraint},22:function(e,t,a){"use strict";a.d(t,"a",function(){return v});var r=a(16),n=a.n(r);n.a.plugin({words:{"less than":"Comparative","fewer than":"Comparative","more than":"Comparative","greater than":"Comparative",building:"Noun",structure:"Noun",no:"Expression"}});var s=["any","whatever","infinity","remove","allow"];function i(e){var t={};return Object.keys(e).forEach(function(a){e[a].forEach(function(e){t[e]=a})}),t}var o=i({"===":["equals","same"],">":["greater","more","bigger","taller","larger","above","exceeding","over","further","farther"],"<":["fewer","less","smaller","shorter","below","under","lower","beneath"],">=":["minimum","min","littlest","least","smallest"],"<=":["maximum","max","biggest","most","largest","greatest"]}),c=i({area:["area","square footage","sf","space","floor","floorspace","size","expanse","breadth","field"],height:["tall","height","elevation","taller","shorter","ceiling","peak","stature","crest","tip","zenith"],distToAccess:["access","entry","entrance","ingress","path","route","exit","way","door"]}),l=i({Structure:["structure","building","structures","buildings","house","home","domicile","complex","design"],0:["cube","room","area","cubes","rooms","areas","elements"],1:["roof","roofs","rooves","covering","ceiling","gable","crown"],2:["tree","plant","bush","trees","plants","bushes","canopy"]}),u=i({no:["not","none"]}),S=function(e){return!e.has("no")},h=function(e){var t=e.values().numbers(),a=null;if(t.length>0){for(var r=0;!t[r]&&r<t.length-1;)r+=1;a=t[r].toString()}return a},T=function(e){var t=null;return Object.keys(c).forEach(function(a){e.has(a)&&(t=c[a])}),t},d=function(e){var t="0";return Object.keys(l).forEach(function(a){e.has(a)&&(t=l[a])}),t},f=function(e){var t=null;return Object.keys(o).forEach(function(a){e.has(a)&&(t=o[a])}),t},E=function(e,t){var a=null;return e?">"===t||">="===t?a="MIN":"<"===t||"<="===t?a="MAX":"==="===t&&(a="SUM"):">"===t||">="===t?a="MAX":"<"===t||"<="===t?a="MIN":"==="===t&&(a="SUM"),a},p=function(e){var t=!1;return s.forEach(function(a){e.has(a)&&(t=!0)}),t};function v(e){console.log("Original text: "+e);var t=e.toLowerCase().replace(/[.,-\/#!$%^&*;:{}=\-_`()]/g,"").trim();t=n()(t).normalize().out(),Object.keys(u).forEach(function(e){var a=u[e];t=t.replace(new RegExp("".concat(e," "),"g"),"".concat(a," "))}),console.log("Cleaned text: "+t);var a=n()(t),r=a.out("tags").map(function(e){return"[".concat(e.text,": ").concat(e.tags.join(","),"]")}).join("");console.log("pos: "+r);var s=S(a),i=h(a),o=d(a),c=T(a),l=f(a),v=!1;i||(v=p(a));var g={text:e,result:s,fn:E(s,l),type:o,prop:c,comp:l,value:i,removeFlag:v};return console.log("Constraint result: \n".concat(JSON.stringify(g))),g}},24:function(e,t,a){e.exports=a(51)},29:function(e,t,a){},31:function(e,t,a){},51:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(21),i=a.n(s),o=(a(29),a(2)),c=a(3),l=a(5),u=a(4),S=a(6),h=(a(31),a(1)),T=a(11),d=function e(){var t=this;Object(o.a)(this,e),this.getMessages=function(){return t.messages},this.setMessages=function(e){return t.messages=e},this.addConstraint=function(e){var a=T.a.create(e);if(t.messages.push(e),a&&a instanceof T.a){var r=[],n=null;return t.constraints.forEach(function(e){e.isSameType(a)?n=e:r.push(e)}),a.removeFlag?n&&t.messages.push("Removed the constraint: '".concat(n.text,"'")):(r.push(a),t.messages.push("I have understood. The constraint: '".concat(a.text,"' was added."))),t.constraints=r,!0}return t.messages.push("I am sorry I do not understand."),!1},this.clearConstraints=function(){t.constraints=[],t.messages.push("Cleared constraints")},this.checkDesign=function(e){var a=t.checkConflicts(e),r=t.checkIncompatibilities(e),n=[];a.length>2?n.push("Don't you think you should stop, ".concat(SETTINGS.userName,"?")):a.length>1?n.push("".concat(SETTINGS.userName,", many conflicts are occurring.")):a.length>0?n.push("".concat(SETTINGS.userName,", a conflict has occurred, you said: ").concat(a[0].constraint.text,". The present status is ").concat(a[0].value,".")):0===a.length&&t.conflicts.length>0&&n.push("Conflicts were resolved."),r.length>0?n.push("Not structurally possible at this time."):0===r.length&&t.incompatibilities.length>0&&n.push("Incompatibilities were resolved."),console.log("Messages: [".concat(n.join(","),"]")),t.messages=n;var s=!1;return(a.length>t.conflicts.length||r.length>t.incompatibilities.length)&&(s=!0),t.conflicts=a,t.incompatibilities=r,s},this.checkConflicts=function(e){var a=[];return t.constraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated constraint!"),a.push({constraint:t,value:t.isViolated(e).value}))}),a},this.checkIncompatibilities=function(e){var a=[];return t.systemConstraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated system constraint!"),a.push({constraint:t,value:t.isViolated(e).value}))}),a},this.constraints=[],this.systemConstraints=[new T.a({text:"no building below ground",result:!1,fn:"MIN",type:"Structure",prop:"ground",comp:"<",value:"0"}),new T.a({text:"no roof without base",result:!1,fn:"SUM",type:1,prop:"noBase",comp:">",value:"0"}),new T.a({text:"no building floating",result:!1,fn:"SUM",type:"Structure",prop:"floating",comp:">",value:"0"})],this.conflicts=[],this.incompatibilities=[],this.messages=[]};d.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},d.thaw=function(e){var t=e.constraints,a=e.conflicts,r=e.incompatibilities,n=e.messages,s=new d;return s.constraints=t.map(function(e){return new T.a(e)}),s.conflicts=a,s.incompatibilities=r,s.messages=n,s};var f=d,E=a(9),p=a.n(E),v={CUBE:0,ROOF:1,TRUNK:2,FOLIAGE:3,PERSON:4},g={NORTH:0,EAST:1,SOUTH:2,WEST:3,TOP:4,BOTTOM:5};function m(e,t){var a=SETTINGS,r=a.w,n=a.h;return 0===e||e===r-1||0===t||t===n-1?null:function(e,t){var a=SETTINGS.gridSize;return{x:Math.floor(e*a),y:a-1-Math.floor(t*a)}}((e-1)/r,(t-1)/n)}function w(e,t,a){return t>=0&&e.length>0&&e[0].length&&t<e[0].length&&a>=0&&a<e.length?e[a][t]:null}function A(e,t,a,r){return e.length>0&&e[0].length&&e[0][0].length&&t>=0&&t<e[0][0].length&&a>=0&&a<e[0].length&&r>=0&&r<e.length?e[r][a][t]:null}function I(e,t){var a=t.x,r=t.y,n=t.z;return{w:A(e,a-1,r,n),n:A(e,a,r+1,n),e:A(e,a+1,r,n),s:A(e,a,r-1,n),t:A(e,a,r,n+1),b:A(e,a,r,n-1)}}function N(e,t,a){return{topLeft:w(e,t-1,a),topRight:w(e,t,a),bottomLeft:w(e,t-1,a-1),bottomRight:w(e,t,a-1)}}function y(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=new Array(e),n=0;n<e;n+=1){r[n]=new Array(t);for(var s=0;s<t;s+=1)r[n][s]=a}return r}function b(e,t,a){for(var r=new Array(a),n=0;n<r.length;n+=1)r[n]=y(t,e,null);return r}var x=Object.freeze({SOLID:0,TRANS:1,PART:2,NONE:3}),O=function e(t){var a=this;if(Object(o.a)(this,e),this.hookAfterInsert=function(t,r){a.direction=t;var n=r.n,s=r.e,i=r.s,o=r.w,c=r.b;c&&c.constructor===k&&(c.surfaces.t=x.NONE),n&&n.constructor===k&&"s"===a.direction&&(n.surfaces.s=x.NONE,a.hasSideSurface=!1),s&&s.constructor===k&&"w"===a.direction&&(s.surfaces.w=x.NONE,a.hasSideSurface=!1),i&&i.constructor===k&&"n"===a.direction&&(i.surfaces.n=x.NONE,a.hasSideSurface=!1),o&&o.constructor===k&&"e"===a.direction&&(o.surfaces.e=x.NONE,a.hasSideSurface=!1),n&&n.constructor===e&&"n"===n.direction&&"s"===a.direction&&(n.hasSideSurface=!1,a.hasSideSurface=!1),s&&s.constructor===e&&"e"===s.direction&&"w"===a.direction&&(s.hasSideSurface=!1,a.hasSideSurface=!1),i&&i.constructor===e&&"s"===i.direction&&"n"===a.direction&&(i.hasSideSurface=!1,a.hasSideSurface=!1),o&&o.constructor===e&&"w"===o.direction&&"e"===a.direction&&(o.hasSideSurface=!1,a.hasSideSurface=!1)},this.hookBeforeRemove=function(t){var r=t.n,n=t.e,s=t.s,i=t.w,o=t.b;o&&o.constructor===k&&(o.surfaces.t=x.SOLID),r&&r.constructor===k&&"s"===a.direction&&(r.surfaces.s=x.SOLID),n&&n.constructor===k&&"w"===a.direction&&(n.surfaces.w=x.SOLID),s&&s.constructor===k&&"n"===a.direction&&(s.surfaces.n=x.SOLID),i&&i.constructor===k&&"e"===a.direction&&(i.surfaces.e=x.SOLID),r&&r.constructor===e&&"n"===r.direction&&"s"===a.direction&&(r.hasSideSurface=!0),n&&n.constructor===e&&"e"===n.direction&&"w"===a.direction&&(n.hasSideSurface=!0),s&&s.constructor===e&&"s"===s.direction&&"n"===a.direction&&(s.hasSideSurface=!0),i&&i.constructor===e&&"w"===i.direction&&"e"===a.direction&&(i.hasSideSurface=!0)},this.setSurface=function(e,t){if(t===x.NONE)switch(e){case"n":"s"===a.direction&&(a.hasSideSurface=!1);break;case"s":"n"===a.direction&&(a.hasSideSurface=!1);break;case"e":"w"===a.direction&&(a.hasSideSurface=!1);break;case"w":"e"===a.direction&&(a.hasSideSurface=!1)}},t){var r=t.direction,n=t.hasSideSurface;this.direction=r,this.hasSideSurface=n}else this.direction="n",this.hasSideSurface=!0};O.typeName="ROOF";var k=function e(t){var a=this;if(Object(o.a)(this,e),this.hookAfterInsert=function(t){var r=t.n,n=t.e,s=t.s,i=t.w,o=t.t;r&&r.constructor===e&&(a.surfaces.n=x.NONE,r.surfaces.s=x.NONE),n&&n.constructor===e&&(a.surfaces.e=x.NONE,n.surfaces.w=x.NONE),s&&s.constructor===e&&(a.surfaces.s=x.NONE,s.surfaces.n=x.NONE),i&&i.constructor===e&&(a.surfaces.w=x.NONE,i.surfaces.e=x.NONE),o&&o.constructor===O&&(a.surfaces.t=x.NONE),r&&r.constructor===O&&"n"===r.direction&&(a.surfaces.n=x.NONE,r.hasSideSurface=!1),n&&n.constructor===O&&"e"===n.direction&&(a.surfaces.e=x.NONE,n.hasSideSurface=!1),s&&s.constructor===O&&"s"===s.direction&&(a.surfaces.s=x.NONE,s.hasSideSurface=!1),i&&i.constructor===O&&"w"===i.direction&&(a.surfaces.w=x.NONE,i.hasSideSurface=!1)},this.hookBeforeRemove=function(t){var a=t.n,r=t.e,n=t.s,s=t.w,i=t.t;a&&a.constructor===e&&(a.surfaces.s=x.SOLID),r&&r.constructor===e&&(r.surfaces.w=x.SOLID),n&&n.constructor===e&&(n.surfaces.n=x.SOLID),s&&s.constructor===e&&(s.surfaces.e=x.SOLID),i&&i.constructor===e&&(i.surfaces.b=x.SOLID),a&&a.constructor===O&&"n"===a.direction&&(a.hasSideSurface=!0),r&&r.constructor===O&&"e"===r.direction&&(r.hasSideSurface=!0),n&&n.constructor===O&&"s"===n.direction&&(n.hasSideSurface=!0),s&&s.constructor===O&&"w"===s.direction&&(s.hasSideSurface=!0)},this.setSurface=function(e,t){a.surfaces[e]=t},this.hasAccessToOutside=function(e){var t=e.n,r=e.s,n=e.e,s=e.w;return a.surfaces.e===x.NONE&&null===n||(a.surfaces.w===x.NONE&&null===s||(a.surfaces.n===x.NONE&&null===t||a.surfaces.s===x.NONE&&null===r))},this.hasAccessInDirection=function(e){return a.surfaces[e]===x.NONE},t){var r=t.surfaces;this.surfaces=r}else this.surfaces={n:x.SOLID,e:x.SOLID,s:x.SOLID,w:x.SOLID,t:x.SOLID,b:x.SOLID}};k.typeName="CUBE";var G=function e(){Object(o.a)(this,e)};G.typeName="FOLIAGE";var j=function e(){Object(o.a)(this,e)};j.typeName="TRUNK";var C=Object.freeze({CUBE:k,TRUNK:j,FOLIAGE:G,ROOF:O}),D=function e(t){var a=this;Object(o.a)(this,e),this.getAll=function(){return a.objects},this.getAt=function(e){return a.objects[e.z][e.y][e.x]},this.clear=function(){a.objects=b(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax)},this.add=function(e,t,r){var n,s=I(a.objects,t);switch(e){case v.TRUNK:if(t.z<SETTINGS.zMax-1){var i=t.x,o=t.y,c=t.z,l={x:i,y:o,z:c+=1};return a.remove(t),a.remove(l),a._setCell(t,new j(t)),a._setCell(l,new G(l)),!0}return!1;case v.CUBE:return n=new k,a.remove(t),a._setCell(t,n),n.hookAfterInsert(s),!0;case v.ROOF:return n=new O,a.remove(t),a._setCell(t,n),n.hookAfterInsert(r,s),!0;default:return!1}},this.remove=function(e){var t=a._getCell(e);if(t)switch(t.constructor){case j:if(e.z<SETTINGS.zMax-1){a._setCell(e,null);var r=e.x,n=e.y,s=e.z;s+=1,a._setCell({x:r,y:n,z:s},null)}break;case G:if(e.z>0){a._setCell(e,null);var i=e.x,o=e.y,c=e.z;c-=1,a._setCell({x:i,y:o,z:c},null)}break;default:if(t&&t.hookBeforeRemove){var l=I(a.objects,e);t.hookBeforeRemove(l)}a._setCell(e,null)}},this.setSurface=function(e,t,r,n){var s=a._getCell(t),i=a.getCardinalSide(e,r);s&&s.setSurface&&s.setSurface(i,n);var o=I(a.objects,t)[i];o&&o.setSurface&&o.setSurface(function(e){switch(e){case"n":return"s";case"s":return"n";case"e":return"w";case"w":return"e";case"t":return"b";case"b":return"t";default:return null}}(i),n)},this.getObjects=function(){for(var e=[],t=0;t<SETTINGS.zMax;t+=1)for(var r=0;r<SETTINGS.yMax;r+=1)for(var n=0;n<SETTINGS.xMax;n+=1){var s=a.objects[t][r][n];if(s){var i=null;switch(s.constructor){case k:i=v.CUBE;break;case O:i=v.ROOF;break;case G:i=v.FOLIAGE;break;case j:i=v.TRUNK}e.push({object:s,type:i,position:{x:n,y:r,z:t}})}}return e},this.getBuildings=function(){return a._buildings?a._buildings:[]},this.calculateAttributes=function(e){var t=a.getObjects();if(a._objects=t,t){a.calculateObjectAttributes(t,e),a.calculateAccess(t);var r=a.findBuildings(t);a._buildings=a.calculateBuildingAttributes(r)}},this.calculateObjectAttributes=function(e,t){e.forEach(function(e){var r=e.position,n=e.object,s=r.x,i=r.y,o=r.z,c=t.getAt({x:s,y:i}),l=I(a.objects,{x:s,y:i,z:o}).b;switch(n.constructor){case k:n.area=100,n.height=10*(o+1-c),n.ground=10*(o-c);break;case O:n.height=10*(o+1-c),n.noBase=l&&l.constructor===k?0:1,n.ground=10*(o-c);break;case G:case j:n.height=10*(o+1-c),n.ground=10*(o-c)}})},this.calculateAccess=function(e){e.forEach(function(e){e.type===v.CUBE&&(e.object.distToAccess=1/0)});var t=e.filter(function(e){if(e.type===v.CUBE){var t=e.position,r=e.object,n=t.x,s=t.y,i=t.z,o=I(a.objects,{x:n,y:s,z:i});return r.hasAccessToOutside(o)}return!1});t.forEach(function(e){!function e(t,r){var n=t.x,s=t.y,i=t.z;if(!(n<0||s<0||n>=SETTINGS.xMax||s>=SETTINGS.yMax)){var o=a.objects[i][s][n];if(o&&r<o.distToAccess){o.distToAccess=r;var c=r+10;o.hasAccessInDirection("n")&&e({x:n,y:s+1,z:i},c),o.hasAccessInDirection("s")&&e({x:n,y:s-1,z:i},c),o.hasAccessInDirection("e")&&e({x:n+1,y:s,z:i},c),o.hasAccessInDirection("w")&&e({x:n-1,y:s,z:i},c),o.hasAccessInDirection("t")&&e({x:n,y:s,z:i+1},c),o.hasAccessInDirection("b")&&e({x:n,y:s,z:i-1},c)}}}(e.position,10)})},this.calculateBuildingAttributes=function(e){var t=[];return Object.keys(e).forEach(function(a){var r=e[a],n=!0,s=0,i=1/0,o=0,c=0;r.forEach(function(e){e.constructor===k&&(o+=100,e.distToAccess>c&&(c=e.distToAccess)),10===e.height&&(n=!1),e.height>s&&(s=e.height),e.ground<i&&(i=e.ground)}),t.push({area:o,floating:n?1:0,height:s,ground:i,maxDistToAccess:c})}),t},this.findBuildings=function(e){var t=e.filter(function(e){return e.type===v.CUBE||e.type===v.ROOF}),r={};t.forEach(function(e){e.object.buildingIndex=null});var n=0;return t.forEach(function(e){var t=e.position;null===e.object.buildingIndex&&(r[n]=[],function e(t,n){var s=t.x,i=t.y,o=t.z;if(!(s<0||i<0||o<0||s>=SETTINGS.xMax||i>=SETTINGS.yMax||o>=SETTINGS.zMax)){var c=a.objects[o][i][s];c&&null===c.buildingIndex&&(c.buildingIndex=n,r[n].push(c),[{x:s,y:i+1,z:o},{x:s,y:i-1,z:o},{x:s+1,y:i,z:o},{x:s-1,y:i,z:o},{x:s,y:i,z:o+1},{x:s,y:i,z:o-1}].forEach(function(t){return e(t,n)}))}}(t,n),n+=1)}),r},this.getCardinalSide=function(e,t){var a;if("t"===t||"b"===t)switch(e){case g.NORTH:case g.SOUTH:case g.EAST:case g.WEST:a=t;break;case g.BOTTOM:a="t"===t?"s":"n";break;case g.TOP:a="t"===t?"n":"s";break;default:throw new Error("camera ".concat(e," is not recognized!"))}else switch(e){case g.NORTH:"l"===t?a="w":"r"===t&&(a="e");break;case g.SOUTH:"l"===t?a="e":"r"===t&&(a="w");break;case g.EAST:"l"===t?a="n":"r"===t&&(a="s");break;case g.WEST:"l"===t?a="s":"r"===t&&(a="n");break;case g.BOTTOM:case g.TOP:"l"===t?a="w":"r"===t&&(a="e");break;default:throw new Error("camera ".concat(e," is not recognized!"))}return a},this.getSlice=function(e,t){var r,n,s;switch(e){case g.NORTH:return a._getYSlice(t);case g.SOUTH:return r=a._getYSlice(t),p.a.hflip(r);case g.EAST:return n=a._getXSlice(t),p.a.hflip(n);case g.WEST:return a._getXSlice(t);case g.BOTTOM:return s=a._getZSlice(t),p.a.vflip(s);case g.TOP:return a._getZSlice(t);default:throw new Error("camera ".concat(e," is not recognized!"))}},this.getBackgroundSlices=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17,n=t,s=[];switch(e){case g.NORTH:for(;n<SETTINGS.yMax-1;)n+=1,s.push(n);break;case g.SOUTH:for(;n>0;)n-=1,s.push(n);break;case g.EAST:for(;n<SETTINGS.xMax-1;)n+=1,s.push(n);break;case g.WEST:for(;n>0;)n-=1,s.push(n);break;case g.BOTTOM:for(;n<SETTINGS.zMax-1;)n+=1,s.push(n);break;case g.TOP:for(;n>0;)n-=1,s.push(n);break;default:throw new Error("camera ".concat(e," is not recognized!"))}return(s=s.slice(0,r)).map(function(t){return a.getSlice(e,t)})},this._getZSlice=function(e){return a.objects[e]},this._getXSlice=function(e){for(var t=y(SETTINGS.zMax,SETTINGS.yMax),r=0;r<SETTINGS.zMax;r+=1)for(var n=0;n<SETTINGS.yMax;n+=1)t[r][n]=a.objects[r][n][e];return t},this._getYSlice=function(e){for(var t=y(SETTINGS.zMax,SETTINGS.xMax),r=0;r<SETTINGS.zMax;r+=1)for(var n=0;n<SETTINGS.xMax;n+=1)t[r][n]=a.objects[r][e][n];return t},this._getCell=function(e){var t=e.x,r=e.y,n=e.z;return t>=0&&r>=0&&n>=0&&t<SETTINGS.xMax&&r<SETTINGS.yMax&&n<SETTINGS.zMax?a.objects[n][r][t]:null},this._setCell=function(e,t){var r=e.x,n=e.y,s=e.z;r>=0&&n>=0&&s>=0&&r<SETTINGS.xMax&&n<SETTINGS.yMax&&s<SETTINGS.zMax&&(a.objects[s][n][r]=t)},this._addCube=function(e){var t=I(e),r=new k(e,t);a.addObject(e,r)},this.fill=function(){var e=function(e,t,r){a.add(t,e,r)};e({x:7,y:8,z:0},0),e({x:8,y:8,z:0},0),e({x:7,y:8,z:1},0),e({x:8,y:8,z:1},0),e({x:7,y:8,z:2},1,"w"),e({x:8,y:8,z:2},1,"e"),e({x:7,y:9,z:0},0),e({x:8,y:9,z:0},0),e({x:12,y:8,z:1},2),a.setSurface(0,{x:7,y:8,z:0},"l",1),a.setSurface(0,{x:8,y:8,z:1},"b",1)},t?this.objects=t:(this.objects=b(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),this.fill())};D.freeze=function(e){for(var t=e.objects,a=b(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),r=0;r<SETTINGS.zMax;r+=1)for(var n=0;n<SETTINGS.xMax;n+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=t[r][n][s];if(i){var o=JSON.stringify(i),c=JSON.parse(o);c.typeName=i.constructor.typeName,a[r][n][s]=c}}return{objects:a}},D.thaw=function(e){for(var t=e.objects,a=b(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),r=0;r<SETTINGS.zMax;r+=1)for(var n=0;n<SETTINGS.xMax;n+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=t[r][n][s];if(i){var o;o=new(0,C[i.typeName])(i),a[r][n][s]=o}}return new D(a)};var M=D,_=function e(t){var a=this;Object(o.a)(this,e),this.clear=function(){a.heights=y(SETTINGS.yMax,SETTINGS.xMax,0)},this.increase=function(e){var t=a.heights[e.y][e.x]+1;t<SETTINGS.zMax&&(a.heights[e.y][e.x]=t)},this.decrease=function(e){var t=a.heights[e.y][e.x]-1;t>=0&&(a.heights[e.y][e.x]=t)},this.getAt=function(e){return a.heights[e.y][e.x]},this.getSlice=function(e,t){var r;switch(e){case g.NORTH:r=a.heights;break;case g.SOUTH:r=p.a.hflip(a.heights);break;case g.EAST:r=p.a.hflip(p.a.transpose(a.heights));break;case g.WEST:r=p.a.transpose(a.heights);break;case g.BOTTOM:case g.TOP:return null;default:throw new Error("camera ".concat(e," is not recognized!"))}for(var n,s,i,o=[],c=[],l=[],u=0;u<r[t].length;u+=1){var S={topLeft:w(n=r,(s=u)-1,(i=t)+1),top:w(n,s,i+1),topRight:w(n,s+1,i+1),left:w(n,s-1,i),center:w(n,s,i),right:w(n,s+1,i),bottomLeft:w(n,s-1,i-1),bottom:w(n,s,i-1),bottomRight:w(n,s+1,i-1)},h=S.topLeft,T=S.top,d=S.topRight,f=S.left,E=S.center,v=S.right,m=S.bottomLeft,A=S.bottom,I=S.bottomRight;l.push([Math.max(m,A,h,T,f,E),Math.max(A,I,T,d,E,v)]),o.push([Math.max(h,T,f,E),Math.max(T,d,E,v)]),c.push([Math.max(m,A,f,E),Math.max(A,I,E,v)])}return{all:l,front:c,back:o}},this.getBackgroundSlices=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17,n=t,s=[];switch(e){case g.NORTH:for(;n<SETTINGS.yMax-1;)n+=1,s.push(n);break;case g.SOUTH:for(;n>0;)n-=1,s.push(n);break;case g.EAST:for(;n<SETTINGS.xMax-1;)n+=1,s.push(n);break;case g.WEST:for(;n>0;)n-=1,s.push(n);break;case g.BOTTOM:case g.TOP:break;default:throw new Error("camera ".concat(e," is not recognized!"))}return(s=s.slice(0,r)).map(function(t){return a.getSlice(e,t)})},this.getCorners=function(){for(var e=a.heights.length+1,t=y(e,e,0),r=0;r<e;r+=1)for(var n=0;n<e;n+=1){var s=N(a.heights,n,r),i=s.topLeft,o=s.topRight,c=s.bottomLeft,l=s.bottomRight;t[r][n]=Math.max(i,o,c,l)}return t},this.fill=function(){a.heights[8][12]=1},t?this.heights=t:(this.heights=y(SETTINGS.yMax,SETTINGS.xMax,0),this.fill())};_.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},_.thaw=function(e){var t=e.heights;return new _(t)};var R=_;var z=function e(t){var a=this;Object(o.a)(this,e),this.onUpdate=function(){a._design.calculateAttributes(a.topo),a._monitor.checkDesign(a._design)&&new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play(),a.save()},this.clear=function(){a._design.clear(),a._topo.clear(),a._monitor.clearConstraints(),a.onUpdate()},this.design={add:function(e,t,r){a._design.add(e,t,r),a.onUpdate()},remove:function(e){a._design.remove(e),a.onUpdate()},setSurface:function(e,t,r,n){a._design.setSurface(e,t,r,n),a.onUpdate()},getAll:function(){return a._design.getAll()},getAt:function(e){return a._design.getAt(e)},getObjects:function(){return a._design.getObjects()},getSlice:function(e,t){return a._design.getSlice(e,t)},getBackgroundSlices:function(e,t,r){return a._design.getBackgroundSlices(e,t,r)}},this.topo={increase:function(e){a._topo.increase(e),a.onUpdate()},decrease:function(e){a._topo.decrease(e),a.onUpdate()},getCorners:function(){return a._topo.getCorners()},getAt:function(e){return a._topo.getAt(e)},getSlice:function(e,t){return a._topo.getSlice(e,t)},getBackgroundSlices:function(e,t,r){return a._topo.getBackgroundSlices(e,t,r)}},this.monitor={addConstraint:function(e){a._monitor.addConstraint(e)&&setTimeout(a.onUpdate,4e3)},clearConstraints:function(){a._monitor.clearConstraints(),a.onUpdate()},getMessages:function(){return a._monitor.getMessages()},setMessages:function(e){return a._monitor.setMessages(e)}},this.save=function(){var t=e.freeze(a);localStorage.setItem(a._id,JSON.stringify(t)),localStorage.setItem("".concat(a._id,"_date"),Date.now())},this._id=t};z.create=function(e){var t=new z(e);return t._design=new M,t._topo=new R,t._monitor=new f,t.save(),t},z.freeze=function(e){var t=e._id,a=e._design,r=e._topo,n=e._monitor;return{id:t,design:M.freeze(a),topo:R.freeze(r),monitor:f.freeze(n)}},z.thaw=function(e){var t=e.id,a=e.design,r=e.topo,n=e.monitor,s=(e.date,new z(t));return s._design=M.thaw(a),s._topo=R.thaw(r),s._monitor=f.thaw(n),s.onUpdate(),s};var L=z,U=function e(){var t=this;Object(o.a)(this,e),this.getIDList=function(){var e=localStorage.getItem("U5SessionIDList");return e=e?e.split(","):[],console.log(e),e},this.get=function(e){var a=JSON.parse(localStorage.getItem(e)),r=L.thaw(a),n=t.getIDList();return(n=n.filter(function(t){return t!==e})).push(e),t._setIDList(n),r},this.remove=function(e){var a=t.getIDList();return a=a.filter(function(t){return t!==e}),t._setIDList(a),a},this.last=function(){var e=t.getIDList().pop();if(!e)return t.newSession();var a=JSON.parse(localStorage.getItem(e));return L.thaw(a)},this.newSession=function(){var e=t._getNextID(),a=t.getIDList();return a.push(e),t._setIDList(a),L.create(e)},this.test=function(){var e=t._getNextID(),a=t.getIDList();a.push(e),t._setIDList(a);var r=localStorage.getItem("U5SessionTestData");return r.id=e,L.thaw(r)},this._setIDList=function(e){return localStorage.setItem("U5SessionIDList",e)},this._getNextID=function(){var e=localStorage.getItem("U5SessionIDCount");return e||(e=0),e=parseInt(e,10)+1,localStorage.setItem("U5SessionIDCount",e),"U5Session_".concat(e)}},B=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={},a.onButtonClick=function(e){var t=a.props.onSelectSession,r=new U;t("new"===e?r.newSession():"last"===e?r.last():r.get(e))},a.getButton=function(e){var t=localStorage.getItem("".concat(e,"_date")),r="";t&&(r=new Date(parseInt(t)).toLocaleString());var s=r;return n.a.createElement("li",{key:e},n.a.createElement("button",{type:"button",onClick:function(t){return a.onButtonClick(e)}},s))},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this,t=(new U).getIDList();t.reverse();var a=t.slice(0,8);return n.a.createElement("div",null,n.a.createElement("div",null,"Load Previous Session:"),n.a.createElement("ul",{style:{lineHeight:"28px"}},n.a.createElement("li",{key:"new"},n.a.createElement("button",{type:"button",onClick:function(t){return e.onButtonClick("new")}},"NEW")),a.map(this.getButton)))}}]),t}(n.a.Component),W=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={value:""},a.handleKeyDown=function(e){13===e.keyCode&&a.handleSubmit()},a.handleChange=function(e){var t=e.target.value;a.setState({value:t})},a.handleSubmit=function(){var e=a.props.onSubmit,t=a.state.value;a.setState({value:""}),e(t)},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.input=document.getElementById("speak"),this.input.addEventListener("keydown",this.handleKeyDown),this.input.focus()}},{key:"componentWillUnmount",value:function(){this.input.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.state.value;return n.a.createElement("div",null,n.a.createElement("input",{type:"text",id:"speak",autoComplete:"off",spellCheck:"false",value:e,onChange:this.handleChange}))}}]),t}(n.a.PureComponent),V=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={stageId:-1,firstTime:null},a.handleKeyStartSession=function(e){e.preventDefault(),a.newSession()},a.onFirstTimeSpeak=function(e){e.toLowerCase().includes("y")?a.setState({stageId:1,firstTime:!0}):a.setState({stageId:1,firstTime:!1})},a.onNameSpeak=function(e){var t=a.state.firstTime;SETTINGS.userName=e||"User",t?a.setState({stageId:3}):a.setState({stageId:2})},a.newSession=function(){(0,a.props.onSelectSession)((new U).newSession())},a.next=function(e){e.preventDefault();var t=a.state.stageId;a.setState({stageId:t+1}),document.removeEventListener("keydown",a.next)},a.getStage=function(){var e=a.state.stageId,t=a.props.onSelectSession;switch(e){case-1:return document.addEventListener("keydown",a.next),n.a.createElement("div",null,n.a.createElement("h1",null,"URBAN5"),n.a.createElement("div",null,"Welcome to a recreation of Nicholas Negroponte's URBAN5."),n.a.createElement("br",null),n.a.createElement("div",null,"URBAN5 is an urban planning tool representing the built environment as ten foot cubes."),n.a.createElement("br",null),n.a.createElement("div",null,"The purpose of this project is not an exact replica of the original with the same hardware and software, but rather an approximation using modern tools to enrich our understanding of the device. URBAN5 was created with the goal to \u201cstudy the desirability and feasibility of conversing with a machine about an environmental design project.\u201d"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("button",{type:"button",onClick:a.next},"> CONTINUE"),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",{style:{textAlign:"center",margin:"40px"}},n.a.createElement("img",{src:"/imgs/zoomscrn.png",alt:"original"})));case 0:return n.a.createElement("div",null,n.a.createElement("div",null,"Is this the first time you are using the machine? (Y/N)"),n.a.createElement("input",{type:"text",id:"speak",autoComplete:"off",spellCheck:"false",value:"",onChange:function(e){return a.onFirstTimeSpeak(e.target.value)},autoFocus:!0}));case 1:return n.a.createElement("div",null,n.a.createElement("div",null,"What is your name?"),n.a.createElement(W,{onSubmit:a.onNameSpeak}));case 2:return n.a.createElement("div",null,n.a.createElement(B,{onSelectSession:t}));case 3:return setTimeout(function(){return document.addEventListener("keydown",a.handleKeyStartSession)},0),n.a.createElement("div",null,n.a.createElement("div",null,"Welcome\xa0",n.a.createElement("span",null,SETTINGS.userName,"!")),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("div",null,"To save and exit at any time, press Escape."),n.a.createElement("br",null),n.a.createElement("br",null),n.a.createElement("button",{type:"button",onClick:a.newSession},"> CONTINUE"))}return null},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyStartSession),document.removeEventListener("keydown",this.next)}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left"}},n.a.createElement("div",{style:{padding:"80px"}},this.getStage())))}}]),t}(n.a.Component),F=function(e){function t(){return Object(o.a)(this,t),Object(l.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[],t=this.props,a=t.actions,r=t.onClick,s=t.action;return a&&a.forEach(function(t){e.push(n.a.createElement("button",{type:"button",key:t.label,onClick:function(e){e.preventDefault(),r(t)},style:{display:"block",whiteSpace:"pre"}},t.label+(t.id===s.id?"_":"")))}),n.a.createElement("div",null,e)}}]),t}(n.a.PureComponent),P=a(23),H={STEPOUT:{id:0,label:"STEP OUT"},STEPIN:{id:1,label:"STEP  IN"},ADDCUBE:{id:2,label:"ADD CUBE"},REMOVE:{id:3,label:"DELETE"},ROTATELT:{id:4,label:"LOOKLEFT"},ROTATERT:{id:5,label:"LOOKRGHT"},ADDTREE:{id:6,label:"ADD TREE"},ADD_ROOF_NORTH:{id:7,label:"ADDROOFN"},ADD_ROOF_SOUTH:{id:8,label:"ADDROOFS"},WALKTHRU:{id:9,label:"WALKTHRU"},SPEAK_CONSTRAINT:{id:11,label:"SPEAK"},INCREASE_HEIGHT:{id:12,label:"INCRS HT"},DECREASE_HEIGHT:{id:13,label:"DECRS HT"},SOLID_SURFACE:{id:14,label:"SOLIDSRF"},PARTITION_SURFACE:{id:15,label:"PARTTION"},TRANSPARENT_SURFACE:{id:16,label:"TRANSPNT"},NO_SURFACE:{id:17,label:"NO SRF"},HAS_ACCESS:{id:18,label:"HASACCSS"},NO_ACCESS:{id:19,label:"NO ACCSS"},ADD_ROOF_WEST:{id:20,label:"ADDROOFW"},ADD_ROOF_EAST:{id:21,label:"ADDROOFE"},ADDROOF:{id:22,label:"ADD ROOF"},isAdd:function(e){return[2,6,7,8,20,21].includes(e.id)}},K=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={textMessages:[]},a.onMessage=function(e){a.setState(function(t){return{textMessages:[].concat(Object(P.a)(t.textMessages),[e])}})},a.componentDidUpdate=function(){a.scrollElement()},a.scrollElement=function(){window.requestAnimationFrame(function(){var e=document.getElementById("topContainer");void 0!==e&&(e.scrollTop=e.scrollHeight+100)})},a.onSpeak=function(e){var t=a.props.session;t.monitor.addConstraint(e);var r=t.monitor.getMessages();a.setState({textMessages:r.slice()})},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.session;!function a(){var r=t.monitor.getMessages();e.setState({textMessages:r}),e.pollTimeout=setTimeout(a,100)}()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){var e=this.props.action,t=this.state.textMessages,a=null;e===H.SPEAK_CONSTRAINT&&(a=n.a.createElement("div",null,n.a.createElement(W,{onSubmit:this.onSpeak}))),console.log("textMessages",t);var r=t.map(function(e){return n.a.createElement("div",{className:"mono-text",key:e},e)});return n.a.createElement("div",{id:"topContainer",style:{overflow:"hidden",height:"75px"}},r,a)}}]),t}(n.a.PureComponent),Q=a(7),Z=a(15),Y=function e(t){var a=this;Object(o.a)(this,e),this.draw=function(e,t){var r,n,s=new Q.createjs.Shape;r=1,s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),t&&s.graphics.setStrokeDash([4,8],0),e.all.forEach(function(e){var t=Object(Z.a)(e,2),a=t[0],i=t[1];n=SETTINGS.h-1-a*SETTINGS.r,s.graphics.moveTo(r,n),r+=SETTINGS.r,n=SETTINGS.h-1-i*SETTINGS.r,s.graphics.lineTo(r,n)}),s.graphics.endStroke(),a.stage.addChild(s)},this.stage=t},q=function e(t){var a=this;Object(o.a)(this,e),this.drawSlice=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.camera=e;for(var n=0;n<t.length;n+=1)for(var s=t[n],i=0;i<s.length;i+=1){var o=s[i];if(o)switch(o.constructor){case k:a.drawCube(o,e,a.stage,i,n,r);break;case O:a.drawRoof(o,e,a.stage,i,n,r);break;case G:r||a.drawFoliage(e,a.stage,i,n,r);break;case j:r||a.drawTrunk(e,a.stage,i,n,r)}}},this.drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var r=e[t],n=0;n<r.length;n+=1){var s=new Q.createjs.Shape,i=(n+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(i,o,2,-2),a.stage.addChild(s)}},this.drawCircle=function(e,t){var r=new Q.createjs.Shape;r.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var n=(e+.5)*SETTINGS.r+1,s=SETTINGS.h-(t+.45)*SETTINGS.r-1;r.graphics.drawCircle(n,s,.4*SETTINGS.r),a.stage.addChild(r)},this.drawCube=function(e,t,r,n,s){var i,o,c,l,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=e.surfaces;switch(t){case g.NORTH:i=S.w===x.SOLID,o=S.t===x.SOLID,c=S.e===x.SOLID,l=S.b===x.SOLID;break;case g.SOUTH:i=S.e===x.SOLID,o=S.t===x.SOLID,c=S.w===x.SOLID,l=S.b===x.SOLID;break;case g.EAST:i=S.n===x.SOLID,o=S.t===x.SOLID,c=S.s===x.SOLID,l=S.b===x.SOLID;break;case g.WEST:i=S.s===x.SOLID,o=S.t===x.SOLID,c=S.n===x.SOLID,l=S.b===x.SOLID;break;case g.TOP:i=S.w===x.SOLID,o=S.n===x.SOLID,c=S.e===x.SOLID,l=S.s===x.SOLID;break;case g.BOTTOM:i=S.w===x.SOLID,o=S.s===x.SOLID,c=S.e===x.SOLID,l=S.n===x.SOLID;break;default:return}a._drawCubeSquare(r,n,s,u,i,o,c,l)},this._drawCubeSquare=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=new Q.createjs.Shape;c.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var l=t*SETTINGS.r+1,u=SETTINGS.r,S=SETTINGS.h-a*SETTINGS.r-1,h=-SETTINGS.r;r&&c.graphics.setStrokeDash([4,8],0),n&&c.graphics.moveTo(l,S).lineTo(l,S+h),s&&c.graphics.moveTo(l,S+h).lineTo(l+u,S+h),i&&c.graphics.moveTo(l+u,S+h).lineTo(l+u,S),o&&c.graphics.moveTo(l+u,S).lineTo(l,S),e.addChild(c)},this.drawRoof=function(e,t,r,n,s){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];switch(t){case g.NORTH:"n"===e.direction||"s"===e.direction?a._drawRoofSquare(r,n,s,i):"w"===e.direction?a._drawRoofSlantLeft(e,r,n,s,i):"e"===e.direction&&a._drawRoofSlantRight(e,r,n,s,i);break;case g.SOUTH:"n"===e.direction||"s"===e.direction?a._drawRoofSquare(r,n,s,i):"e"===e.direction?a._drawRoofSlantLeft(e,r,n,s,i):"w"===e.direction&&a._drawRoofSlantRight(e,r,n,s,i);break;case g.EAST:"e"===e.direction||"w"===e.direction?a._drawRoofSquare(r,n,s,i):"s"===e.direction?a._drawRoofSlantRight(e,r,n,s,i):"n"===e.direction&&a._drawRoofSlantLeft(e,r,n,s,i);break;case g.WEST:"e"===e.direction||"w"===e.direction?a._drawRoofSquare(r,n,s,i):"n"===e.direction?a._drawRoofSlantRight(e,r,n,s,i):"s"===e.direction&&a._drawRoofSlantLeft(e,r,n,s,i);break;case g.TOP:case g.BOTTOM:a._drawRoofSquare(r,n,s,i)}},this._drawRoofSquare=function(e,t,a){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new Q.createjs.Shape;n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var s=t*SETTINGS.r+1,i=SETTINGS.r,o=SETTINGS.h-a*SETTINGS.r-1,c=-SETTINGS.r;r&&n.graphics.setStrokeDash([3,7],0),n.graphics.drawRect(s,o,i,c),e.addChild(n)},this._drawRoofSlantLeft=function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Q.createjs.Shape;n&&s.graphics.setStrokeDash([4,8],0);var i=a*SETTINGS.r+1,o=SETTINGS.h-r*SETTINGS.r-1;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),s.graphics.moveTo(i,o),i+=SETTINGS.r,o-=SETTINGS.r,s.graphics.lineTo(i,o),e.hasSideSurface&&(s.graphics.moveTo(i,o),o+=SETTINGS.r,s.graphics.lineTo(i,o)),s.graphics.endStroke(),t.addChild(s)},this._drawRoofSlantRight=function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Q.createjs.Shape;n&&s.graphics.setStrokeDash([4,8],0);var i=a*SETTINGS.r+1,o=SETTINGS.h-(r+1)*SETTINGS.r-1;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),s.graphics.moveTo(i,o),i+=SETTINGS.r,o+=SETTINGS.r,s.graphics.lineTo(i,o),e.hasSideSurface&&(i-=SETTINGS.r,o-=SETTINGS.r,s.graphics.moveTo(i,o),o+=SETTINGS.r,s.graphics.lineTo(i,o)),s.graphics.endStroke(),t.addChild(s)},this.drawFoliage=function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Q.createjs.Shape;n&&s.graphics.setStrokeDash([SETTINGS.stroke,7],0),s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var i=(a+.5)*SETTINGS.r+1,o=SETTINGS.h-(r+.45)*SETTINGS.r-1;s.graphics.drawCircle(i,o,.4*SETTINGS.r),t.addChild(s)},this.drawTrunk=function(e,t,a,r){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Q.createjs.Shape;n&&s.graphics.setStrokeDash([4,8],0),s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var i=(a+.5)*SETTINGS.r+1,o=SETTINGS.h-r*SETTINGS.r-1;switch(e){case g.NORTH:case g.SOUTH:case g.WEST:case g.EAST:s.graphics.moveTo(i,o).lineTo(i,o-SETTINGS.r);break;case g.TOP:case g.BOTTOM:break;default:throw new Error("camera ".concat(e," is not recognized!"))}t.addChild(s)},this.stage=t},J=function e(t,a){var r=this;Object(o.a)(this,e),this.draw=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];r.stage.removeAllChildren();var n=r.session.topo.getSlice(e,t);(n&&r.topoRenderer.draw(n),r.drawBackground)&&(r.session.topo.getBackgroundSlices(e,t,SETTINGS.clippingMax).forEach(function(e){return r.topoRenderer.draw(e,a)}),r.session.design.getBackgroundSlices(e,t,SETTINGS.clippingMax).forEach(function(t){return r.designRenderer.drawSlice(e,t,a)}));var s=r.session.design.getSlice(e,t);r.designRenderer.drawSlice(e,s),r.designRenderer.drawGridPoints(s),r.stage.update()},this.drawTopCompressedView=function(){r.stage.removeAllChildren();var e=r.session.design.getBackgroundSlices(g.TOP,SETTINGS.zMax);e.reverse();for(var t=y(SETTINGS.xMax,SETTINGS.yMax,null),a=function(a){for(var r=function(r){var n=null;e.forEach(function(e){var t=e[a][r];t&&(n=t)}),t[a][r]=n},n=0;n<SETTINGS.xMax;n+=1)r(n)},n=0;n<SETTINGS.yMax;n+=1)a(n);r.designRenderer.drawSlice(g.TOP,t),r.stage.update()},this.update=function(){r.stage.update()},this.clear=function(){r.stage.removeAllChildren(),r.stage.update()},this._drawTopoSlice=function(e){var t,a=new Q.createjs.Shape,n=1;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),e.forEach(function(e){var r=e.startHeight,s=e.endHeight;t=SETTINGS.h-1-r*SETTINGS.r,a.graphics.moveTo(n,t),n+=SETTINGS.r,t=SETTINGS.h-1-s*SETTINGS.r,a.graphics.lineTo(n,t)}),a.graphics.endStroke(),r.stage.addChild(a)},this._drawSlice=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.camera=e;for(var n=0;n<t.length;n+=1)for(var s=t[n],i=0;i<s.length;i+=1){var o=s[i];o&&o.draw2D(e,r.stage,i,n,a)}},this._drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var a=e[t],n=0;n<a.length;n+=1){var s=new Q.createjs.Shape,i=(n+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(i,o,2,-2),r.stage.addChild(s)}},this.drawCircle=function(e,t){var a=new Q.createjs.Shape;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var n=(e+.5)*SETTINGS.r+1,s=SETTINGS.h-(t+.45)*SETTINGS.r-1;a.graphics.drawCircle(n,s,.4*SETTINGS.r),r.stage.addChild(a)},this.animateX=function(e,t,a,n){if(t>=e.length)n();else{var s=e[t],i=r.drawX(s.xNoise,s.yNoise);r.update(),setTimeout(function(){r.stage.removeChild(i),r.animateX(e,t+1,a,n)},a)}},this.drawX=function(e,t){var a=new Q.createjs.Shape;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var n=(e+.2)*SETTINGS.r,s=SETTINGS.h-(t+.2)*SETTINGS.r;a.graphics.moveTo(n,s).lineTo(n+.6*SETTINGS.r,s-.6*SETTINGS.r);var i=(e+1-.2)*SETTINGS.r,o=SETTINGS.h-(t+.2)*SETTINGS.r;return a.graphics.moveTo(i,o).lineTo(i-.6*SETTINGS.r,o-.6*SETTINGS.r),r.stage.addChild(a)},this.session=a,this.stage=new Q.createjs.Stage(t),this.designRenderer=new q(this.stage),this.topoRenderer=new Y(this.stage),this.drawBackground=!0},X=function e(t,a){var r=this;Object(o.a)(this,e),this.addListener=function(e){return r.views.push(e)},this.removeListener=function(e){return r.views.filter(function(t){return t!==e})},this.doAction=function(e,t,a,n){var s=r.getRelativePosition(t,a);switch(e){case H.STEPOUT:r.previousSlice();break;case H.STEPIN:r.nextSlice();break;case H.ADDCUBE:r.addObject(s,v.CUBE);break;case H.REMOVE:r.removeObject(s);break;case H.ROTATELT:r.rotateLeft();break;case H.ROTATERT:r.rotateRight();break;case H.ADDTREE:r.addObject(s,v.TRUNK);break;case H.ADDROOF:var i=r.session.design.getAt(s);i&&"ROOF"===i.constructor.typeName?"e"===i.direction?r.addObject(s,v.ROOF,"n"):"n"===i.direction?r.addObject(s,v.ROOF,"w"):"w"===i.direction?r.addObject(s,v.ROOF,"s"):"s"===i.direction&&r.addObject(s,v.ROOF,"e"):r.addObject(s,v.ROOF,"e");break;case H.ADD_ROOF_EAST:r.addObject(s,v.ROOF,"e");break;case H.ADD_ROOF_WEST:r.addObject(s,v.ROOF,"w");break;case H.ADD_ROOF_NORTH:r.addObject(s,v.ROOF,"n");break;case H.ADD_ROOF_SOUTH:r.addObject(s,v.ROOF,"s");break;case H.EDITTOPO:r.setTopoHeight(s);break;case H.NO_SURFACE:r.setSurface(r.cameraView.camera,s,n,x.NONE);break;case H.SOLID_SURFACE:r.setSurface(r.cameraView.camera,s,n,x.SOLID);break;case H.TRANSPARENT_SURFACE:r.setSurface(r.cameraView.camera,s,n,x.TRANS);break;case H.PARTITION_SURFACE:r.setSurface(r.cameraView.camera,s,n,x.PART)}},this.addObject=function(e,t,a){e&&(r.session.design.add(t,e,a),r.updateViews())},this.removeObject=function(e){e&&(r.session.design.remove(e),r.updateViews())},this.setSurface=function(e,t,a,n){t&&(r.session.design.setSurface(e,t,a,n),r.updateViews())},this.nextSlice=function(){switch(r.cameraView.camera){case g.NORTH:r._setSliceYAxis(r.cameraView.slices.y+1);break;case g.SOUTH:r._setSliceYAxis(r.cameraView.slices.y-1);break;case g.EAST:r._setSliceXAxis(r.cameraView.slices.x+1);break;case g.WEST:r._setSliceXAxis(r.cameraView.slices.x-1);break;case g.TOP:r._setSliceZAxis(r.cameraView.slices.z-1);break;case g.BOTTOM:r._setSliceZAxis(r.cameraView.slices.z+1);break;default:throw new Error("camera ".concat(r.cameraView.camera," is not recognized!"))}},this.previousSlice=function(){switch(r.cameraView.camera){case g.NORTH:r._setSliceYAxis(r.cameraView.slices.y-1);break;case g.SOUTH:r._setSliceYAxis(r.cameraView.slices.y+1);break;case g.EAST:r._setSliceXAxis(r.cameraView.slices.x-1);break;case g.WEST:r._setSliceXAxis(r.cameraView.slices.x+1);break;case g.TOP:r._setSliceZAxis(r.cameraView.slices.z+1);break;case g.BOTTOM:r._setSliceZAxis(r.cameraView.slices.z-1);break;default:throw new Error("camera ".concat(r.cameraView.camera," is not recognized!"))}},this.north=function(){return r._setCamera("NORTH")},this.south=function(){return r._setCamera("SOUTH")},this.east=function(){return r._setCamera("EAST")},this.west=function(){return r._setCamera("WEST")},this.top=function(){return r._setCamera("TOP")},this.bottom=function(){return r._setCamera("BOTTOM")},this.rotateLeft=function(){switch(r.cameraView.camera){case g.NORTH:r._setCamera("EAST");break;case g.EAST:r._setCamera("SOUTH");break;case g.SOUTH:r._setCamera("WEST");break;case g.WEST:r._setCamera("NORTH")}},this.rotateRight=function(){switch(r.cameraView.camera){case g.NORTH:r._setCamera("WEST");break;case g.WEST:r._setCamera("SOUTH");break;case g.SOUTH:r._setCamera("EAST");break;case g.EAST:r._setCamera("NORTH")}},this._setSliceZAxis=function(e){e>=0&&e<r.zMax&&(r.cameraView.slices.z=e,r.updateViews())},this._setSliceXAxis=function(e){e>=0&&e<r.xMax&&(r.cameraView.slices.x=e,r.updateViews())},this._setSliceYAxis=function(e){e>=0&&e<r.yMax&&(r.cameraView.slices.y=e,r.updateViews())},this._setCamera=function(e){r.cameraView.camera=g[e];var t=SETTINGS.xMax,a=SETTINGS.yMax,n=SETTINGS.zMax,s=0,i=0,o=0,c=r.session.design.getObjects();switch(c.length>0&&c.forEach(function(e){var r=e.position,c=r.x,l=r.y,u=r.z;c<t&&(t=c),c>s&&(s=c),l<a&&(a=l),l>i&&(i=l),u<n&&(n=u),u>o&&(o=u)}),r.cameraView.camera){case g.NORTH:r.cameraView.slices.y=a;break;case g.SOUTH:r.cameraView.slices.y=i;break;case g.EAST:r.cameraView.slices.x=t;break;case g.WEST:r.cameraView.slices.x=s;break;case g.TOP:r.cameraView.slices.z=o;break;case g.BOTTOM:r.cameraView.slices.z=n;break;default:throw new Error("camera ".concat(r.cameraView.camera," is not recognized!"))}r.updateViews()},this.updateViews=function(){var e;switch(r.cameraView.camera){case g.NORTH:case g.SOUTH:e=r.cameraView.slices.y;break;case g.EAST:case g.WEST:e=r.cameraView.slices.x;break;case g.TOP:case g.BOTTOM:e=r.cameraView.slices.z;break;default:throw new Error("camera ".concat(r.cameraView.camera," is not recognized!"))}r.views.forEach(function(t){return t.draw(r.cameraView.camera,e,r.isBackgroundDashed)})},this.getRelativePosition=function(e,t){switch(r.cameraView.camera){case g.NORTH:case g.SOUTH:case g.EAST:case g.WEST:if(t>=r.zMax)return null}switch(r.cameraView.camera){case g.NORTH:return{x:e,y:r.cameraView.slices.y,z:t};case g.SOUTH:return{x:r.gridSize-1-e,y:r.cameraView.slices.y,z:t};case g.EAST:return{x:r.cameraView.slices.x,y:r.gridSize-1-e,z:t};case g.WEST:return{x:r.cameraView.slices.x,y:e,z:t};case g.BOTTOM:return{x:e,y:r.gridSize-1-t,z:r.cameraView.slices.z};case g.TOP:return{x:e,y:t,z:r.cameraView.slices.z};default:throw new Error("camera ".concat(r.cameraView.camera," is not recognized!"))}},this.session=t,this.gridSize=SETTINGS.gridSize,this.xMax=SETTINGS.xMax,this.yMax=SETTINGS.yMax,this.zMax=SETTINGS.zMax,this.cameraView=a,this.views=[],this.isBackgroundDashed=!0,this.north()},$=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={controller:null},a.wire=function(){var e=a.props,t=e.session,r=e.cameraView;if(!a.isWired&&t){a.isWired=!0;var n=new X(t,r);a.view=new J(a.canvas,t),n.addListener(a.view),n.updateViews(),a.setState({controller:n})}},a.handleKeyDown=function(e){var t=a.state.controller;if(a.props.action!==H.SPEAK_CONSTRAINT)switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},a.handleClick=function(e){var t=a.state.controller,r=a.props.action;console.log(r);var n=m(e.offsetX,e.offsetY);n&&t.doAction(r,n.x,n.y)},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("draw"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"draw",width:t,height:a}))}}]),t}(n.a.Component),ee=[0,60,110,150,180,205,225,240],te=function e(t){var a=this;Object(o.a)(this,e),this.drawSquare=function(e,t,r){var n=new Q.createjs.Shape;n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(1);var s=e*SETTINGS.r+1,i=SETTINGS.r,o=SETTINGS.h-t*SETTINGS.r-1,c=-SETTINGS.r,l=ee[r],u="rgba(".concat(l,", ").concat(l,", ").concat(l,", 0.7)");n.graphics.beginFill(u),n.graphics.drawRect(s,o,i,c),n.graphics.endFill(),a.stage.addChild(n);var S=new Q.createjs.Text(r,"bold 24px Andale Mono",SETTINGS.color);S.x=s+i/2-7,S.y=o+c/2-11,a.stage.addChild(S)},this.stage=t},ae=function e(t,a){var r=this;Object(o.a)(this,e),this.draw=function(){r.stage.removeAllChildren();for(var e=0;e<SETTINGS.yMax;e+=1)for(var t=0;t<SETTINGS.xMax;t+=1)r.renderer.drawSquare(t,e,r.session.topo.getAt({x:t,y:e}));r.stage.update()},this.session=a,this.stage=new Q.createjs.Stage(t),this.renderer=new te(this.stage)},re=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).wire=function(){var e=a.props.session;!a.isWired&&e&&(a.isWired=!0,a.view=new ae(a.canvas,e),a.view.draw())},a.handleClick=function(e){var t=a.props,r=t.session,n=t.action,s=m(e.offsetX,e.offsetY);s&&(n===H.DECREASE_HEIGHT?r.topo.decrease(s):r.topo.increase(s),a.view.draw())},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"display",width:t,height:a}))}}]),t}(n.a.Component),ne=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={controller:null},a.wire=function(){var e=a.props,t=e.session,r=e.cameraView;if(!a.isWired&&t){a.isWired=!0;var n=new X(t,r);a.view=new J(a.canvas,t),n.addListener(a.view),n.updateViews(),a.setState({controller:n})}},a.handleKeyDown=function(e){var t=a.state.controller;switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},a.handleClick=function(e){var t=a.state.controller,r=a.props.action,n=function(e,t){var a=SETTINGS,r=a.w,n=a.h,s=a.gridSize;if(0===e||e===r-1||0===t||t===n-1)return null;var i,o=(t-1)/n,c=(e-1)/r*s,l=Math.floor(c),u=c-l,S=s-o*s,h=Math.floor(S),T=S-h,d=1-T,f=T,E=u,p=1-u,v=Math.min(d,f,E,p);return d===v?i="t":f===v?i="b":E===v?i="l":p===v&&(i="r"),{x:l,y:h,side:i}}(e.offsetX,e.offsetY);if(n){var s=n.x,i=n.y,o=n.side;t.doAction(r,s,i,o)}},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("surface"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("click",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("click",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"surface",width:t,height:a}))}}]),t}(n.a.Component),se=function e(t,a){var r=this;Object(o.a)(this,e),this.addListener=function(e){return r.views.push(e)},this.removeListener=function(e){return r.views.filter(function(t){return t!==e})},this.run=function(e){r.path=e,r.i=0,setTimeout(function(){return r.animateCameraPath()},500)},this.animateCameraPath=function(){if(r.i<r.path.length-2){r.i+=1;var e=r.path[r.i],t=r.path[r.i+1];r.views.forEach(function(a){return a.setCameraPosition(e,t)}),setTimeout(function(){return r.animateCameraPath()},150)}else r.onWalkthroughEnd()},this.session=t,this.views=[],this.onWalkthroughEnd=a},ie=function e(){var t=this;Object(o.a)(this,e),this.draw=function(e,a,r){if(a){if(r){var n=t._getArrows(r);t._addArrows(e,n)}for(var s=!!r,i=y(SETTINGS.xMax+1,SETTINGS.yMax+1,null),o=0;o<=SETTINGS.yMax;o+=1)for(var c=0;c<=SETTINGS.xMax;c+=1){var l={x:c,y:o,z:a[o][c]-.5},u=t._getAdjustedPoint(l);if(u.z-=.5,i[o][c]=u,o>0){var S=i[o-1][c];t._addLine(e,u,S,s)}if(c>0){var h=i[o][c-1];t._addLine(e,u,h,s)}}}},this._addArrows=function(e,a){a.forEach(function(a){var r=new h.c;a.forEach(function(e){var a=t._getAdjustedPoint(e),n=a.x,s=a.y,i=a.z;r.vertices.push(new h.j(n,s,i))});var n=new h.d(r,new h.e({color:60928}));e.add(n)})},this._getArrows=function(e){var t,a=e.slices,r=a.x,n=a.y,s=a.z;switch(e.camera){case g.TOP:case g.BOTTOM:t=[[{x:-1,y:0,z:s},{x:0,y:0,z:s},{x:0,y:-1,z:s},{x:-1,y:0,z:s}],[{x:SETTINGS.xMax+1,y:SETTINGS.yMax,z:s},{x:SETTINGS.xMax,y:SETTINGS.yMax,z:s},{x:SETTINGS.xMax,y:SETTINGS.yMax+1,z:s},{x:SETTINGS.xMax+1,y:SETTINGS.yMax,z:s}],[{x:SETTINGS.xMax+1,y:0,z:s},{x:SETTINGS.xMax,y:0,z:s},{x:SETTINGS.xMax,y:-1,z:s},{x:SETTINGS.xMax+1,y:0,z:s}],[{x:-1,y:SETTINGS.yMax,z:s},{x:0,y:SETTINGS.yMax,z:s},{x:0,y:SETTINGS.yMax+1,z:s},{x:-1,y:SETTINGS.yMax,z:s}]];break;case g.WEST:t=[[{x:(r-=.5)+1,y:-1,z:-.5},{x:r,y:-.5,z:-.5},{x:r+1,y:0,z:-.5},{x:r+1,y:-1,z:-.5}],[{x:r+1,y:SETTINGS.yMax+1,z:-.5},{x:r,y:SETTINGS.yMax+.5,z:-.5},{x:r+1,y:SETTINGS.yMax,z:-.5},{x:r+1,y:SETTINGS.yMax+1,z:-.5}]];break;case g.EAST:t=[[{x:r+=.5,y:-1,z:-.5},{x:r+1,y:-.5,z:-.5},{x:r,y:0,z:-.5},{x:r,y:-1,z:-.5}],[{x:r,y:SETTINGS.yMax+1,z:-.5},{x:r+1,y:SETTINGS.yMax+.5,z:-.5},{x:r,y:SETTINGS.yMax,z:-.5},{x:r,y:SETTINGS.yMax+1,z:-.5}]];break;case g.NORTH:t=[[{x:-1,y:n+=.5,z:-.5},{x:-.5,y:n+1,z:-.5},{x:0,y:n,z:-.5},{x:-1,y:n,z:-.5}],[{x:SETTINGS.xMax+1,y:n,z:-.5},{x:SETTINGS.xMax+.5,y:n+1,z:-.5},{x:SETTINGS.xMax,y:n,z:-.5},{x:SETTINGS.xMax+1,y:n,z:-.5}]];break;case g.SOUTH:t=[[{x:-1,y:(n-=.5)+1,z:-.5},{x:-.5,y:n,z:-.5},{x:0,y:n+1,z:-.5},{x:-1,y:n+1,z:-.5}],[{x:SETTINGS.xMax+1,y:n+1,z:-.5},{x:SETTINGS.xMax+.5,y:n,z:-.5},{x:SETTINGS.xMax,y:n+1,z:-.5},{x:SETTINGS.xMax+1,y:n+1,z:-.5}]];break;default:t=[]}return t},this._addLine=function(e,t,a,r){var n,s=new h.c;s.vertices.push(new h.j(t.x,t.y,t.z)),s.vertices.push(new h.j(a.x,a.y,a.z)),n=r?new h.d(s,new h.e({color:6710886})):new h.d(s,SETTINGS.material),e.add(n)},this._getAdjustedPoint=function(e){var t=e.x,a=e.y,r=e.z;return{x:t*SETTINGS.r,y:r*SETTINGS.r+SETTINGS.r/2,z:-a*SETTINGS.r}}},oe=function e(){var t=this;Object(o.a)(this,e),this.draw=function(e,a){if(a)for(var r=0;r<SETTINGS.zMax;r+=1)for(var n=0;n<SETTINGS.yMax;n+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=a[r][n][s],o={x:s,y:n,z:r};if(i)switch(i.constructor){case k:t.drawCube(e,i,o);break;case O:t.drawRoof(e,i,o);break;case G:t.drawFoliage(e,o);break;case j:t.drawTrunk(e,o)}}},this.drawCube=function(e,a,r){var n=t._getCubeFaces(a),s={x:r.x*SETTINGS.r,y:r.z*SETTINGS.r,z:-r.y*SETTINGS.r};n.position.x=s.x,n.position.y=s.y,n.position.z=s.z,e.add(n)},this._getCubeFaces=function(e){var t=new h.c;return e.surfaces.t===x.SOLID&&t.vertices.push(new h.j(0,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,0)),e.surfaces.b===x.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,0)),e.surfaces.n===x.SOLID&&t.vertices.push(new h.j(0,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,0,-SETTINGS.r)),e.surfaces.s===x.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,0,0)),e.surfaces.e===x.SOLID&&t.vertices.push(new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,0)),e.surfaces.w===x.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,0)),new h.f(t,SETTINGS.material)},this.drawRoof=function(e,a,r){var n=t._getRoof(a),s={x:r.x*SETTINGS.r,y:r.z*SETTINGS.r,z:-r.y*SETTINGS.r};switch(a.direction){case"n":break;case"e":n.rotation.y=1.5*Math.PI,s.z-=SETTINGS.r;break;case"s":n.rotation.y=Math.PI,s.x+=SETTINGS.r,s.z-=SETTINGS.r;break;case"w":n.rotation.y=.5*Math.PI,s.x+=SETTINGS.r;break;default:return}n.position.x=s.x,n.position.y=s.y,n.position.z=s.z,e.add(n)},this._getRoof=function(e){var t=new h.c;return e.hasSideSurface&&t.vertices.push(new h.j(0,SETTINGS.r,0),new h.j(0,0,0),new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0)),t.vertices.push(new h.j(0,0,-SETTINGS.r),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r)),new h.f(t,SETTINGS.material)},this.drawFoliage=function(e,t){var a=t.x,r=t.y,n=t.z,s=new h.i(SETTINGS.r/2,5,5),i=new h.b(s),o=new h.f(i,SETTINGS.material),c=a*SETTINGS.r,l=n*SETTINGS.r,u=-r*SETTINGS.r;o.position.x=c+SETTINGS.r/2,o.position.y=l+SETTINGS.r/2,o.position.z=u-SETTINGS.r/2,e.add(o)},this.drawTrunk=function(e,a){var r=a.x,n=a.y,s=a.z,i={x:(r+.5)*SETTINGS.r,y:s*SETTINGS.r,z:(-n-.5)*SETTINGS.r},o={x:i.x,y:i.y+SETTINGS.r,z:i.z};t._addLine(e,i,o)},this._addLine=function(e,t,a){var r=new h.c;r.vertices.push(new h.j(t.x,t.y,t.z)),r.vertices.push(new h.j(a.x,a.y,a.z));var n=new h.d(r,SETTINGS.material);e.add(n)}},ce=function e(t,a,r){var n=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:75;Object(o.a)(this,e),this.draw=function(){for(;n.scene.children.length>0;)n.scene.remove(n.scene.children[0]);n.designRenderer3D=new oe;var e=n.session.design.getAll();n.designRenderer3D.draw(n.scene,e),n.topoRenderer3D=new ie;var t=n.session.topo.getCorners();n.topoRenderer3D.draw(n.scene,t,n.cameraView)},this.render=function(){n.draw(),n.renderer.render(n.scene,n.camera)},this.setCameraPosition=function(e,t){n.hasPosition=!0;var a=n.getAdjustedPoint(e),r=a.x,s=a.y,i=a.z;n.camera.position.x=r,n.camera.position.y=s,n.camera.position.z=i;var o=n.getAdjustedPoint(t);n.camera.lookAt(o.x,o.y,o.z),n.render()},this.getAdjustedPoint=function(e){var t=e.x,a=e.y,r=e.z;return{x:t*SETTINGS.r+SETTINGS.r/2,y:r*SETTINGS.r+.75*SETTINGS.r,z:-a*SETTINGS.r-SETTINGS.r/2}},this.container=t,this.target=null,this.session=a,this.hasPosition=!1,this.scene=new h.h,this.scene.background=new h.a(0),this.camera=new h.g(s,SETTINGS.w/SETTINGS.h,1,8e3),this.scene.add(this.camera),this.renderer=new h.k({antialias:!0}),this.renderer.setPixelRatio(.6),this.renderer.setSize(SETTINGS.w,SETTINGS.h),this.container.appendChild(this.renderer.domElement),this.cameraView=r,this.draw()},le=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).wire=function(){var e=a.props,t=e.session,r=e.path,n=e.onWalkthroughEnd;!a.isWired&&t&&r&&(a.isWired=!0,a.controller=new se(t,n),a.view=new ce(a.container,t),a.controller.addListener(a.view))},a.run=function(e){a.controller.run(e)},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.container=document.getElementById("display3D"),this.wire();var e=this.props.path;this.run(e)}},{key:"componentDidUpdate",value:function(){this.wire();var e=this.props.path;this.run(e)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return n.a.createElement("div",{id:"display3D",style:{width:t,height:a}})}}]),t}(n.a.Component),ue=a(34);function Se(e,t,a){var r=function(e,t){if(t>1&&e.length<2)return e;for(var a=[],r=1;r<e.length;r+=1)for(var n=e[r-1],s=e[r],i=(s.x-n.x)/t,o=(s.y-n.y)/t,c=(s.z-n.z)/t,l=0;l<t;l+=1){var u=n.x+l*i,S=n.y+l*o,h=n.z+l*c;a.push({x:u,y:S,z:h})}return a.push(e[e.length-1]),a}(function(e,t,a){for(var r=new ue.Grid(3*SETTINGS.xMax,3*SETTINGS.yMax),n=e.topo.getCorners(),s=0;s<SETTINGS.yMax;s+=1)for(var i=0;i<SETTINGS.xMax;i+=1){var o=Math.floor(i),c=Math.floor(s),l=e.topo.getAt({x:o,y:c}),u=Math.max(n[s][i],n[s][i+1],n[s+1][i],n[s+1][i+1]);if(l!==u){console.log("z comp",l,u);for(var S=!1,h=l;h<u+1;h+=1)e.design.getAt({x:o,y:c,z:h})&&(S=!0);S&&(r.setWalkableAt(3*i,3*s,!1),r.setWalkableAt(3*i+2,3*s,!1),r.setWalkableAt(3*i+2,3*s+2,!1),r.setWalkableAt(3*i,3*s+2,!1),r.setWalkableAt(3*i,3*s+1,!1),r.setWalkableAt(3*i+2,3*s+1,!1),r.setWalkableAt(3*i+1,3*s+2,!1),r.setWalkableAt(3*i+1,3*s,!1))}else{var T=e.design.getAt({x:o,y:c,z:l});T&&(r.setWalkableAt(3*i,3*s,!1),r.setWalkableAt(3*i+2,3*s,!1),r.setWalkableAt(3*i+2,3*s+2,!1),r.setWalkableAt(3*i,3*s+2,!1),"CUBE"===T.constructor.typeName?(T.hasAccessInDirection("w")||r.setWalkableAt(3*i,3*s+1,!1),T.hasAccessInDirection("e")||r.setWalkableAt(3*i+2,3*s+1,!1),T.hasAccessInDirection("n")||r.setWalkableAt(3*i+1,3*s+2,!1),T.hasAccessInDirection("s")||r.setWalkableAt(3*i+1,3*s,!1)):(r.setWalkableAt(3*i,3*s+1,!1),r.setWalkableAt(3*i+2,3*s+1,!1),r.setWalkableAt(3*i+1,3*s+2,!1),r.setWalkableAt(3*i+1,3*s,!1)))}}for(var d=new ue.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}).findPath(3*t.x+1,3*t.y+1,3*a.x+1,3*a.y+1,r),f=[],E=null,p=null,v=0;v<d.length;v+=1){var g=Object(Z.a)(d[v],2),m=g[0],w=g[1],A=Math.floor(m/3),I=Math.floor(w/3);A===E&&I===p||(E=A,p=I,f.push({x:E,y:p}))}return f}(e,t,a).map(function(t){var a=t.x,r=t.y;return{x:a,y:r,z:e.topo.getAt({x:a,y:r})}}),3);return function(e,t){for(var a=1;a<e.length-1;a+=1){var r=2*Math.random()*t-t,n=2*Math.random()*t-t,s=e[a];s.xNoise=s.x+r,s.yNoise=s.y+n}}(r,.1),r}var he=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={hasStart:!1},a.wire=function(){var e=a.props.session;!a.isWired&&e&&(a.isWired=!0,a.view=new J(a.canvas,e),a.view.drawTopCompressedView())},a.handleClick=function(e){var t=a.state.hasStart,r=a.props,n=r.onSelectPath,s=r.session,i=m(e.offsetX,e.offsetY);if(i&&!s.design.getAt({x:i.x,y:i.y,z:0}))if(t){if(a.start.x!==i.x||a.start.y!==i.y){a.view.drawCircle(i.x,i.y),a.view.update(),a.end=i;var o=Se(s,a.start,a.end);if(!o||0===o.length)return s.monitor.setMessages(["".concat(SETTINGS.userName,", No path could be found.")]),a.start=null,a.end=null,a.setState({hasStart:!1}),void n(o);var c=(o.length-1)/3*10;s.monitor.setMessages(["".concat(SETTINGS.userName,", I have arrived at the destination point"),"the trip distance (in feet) is ".concat(c,".")]);a.view.animateX(o,0,75,function(){a.start=null,a.end=null,a.setState({hasStart:!1}),n(o)})}}else a.setState({hasStart:!0}),a.view.drawCircle(i.x,i.y),a.view.update(),a.start=i},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.start=null,this.end=null,this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"display",width:t,height:a}))}}]),t}(n.a.Component),Te=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={path:null},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state.path,a=this.props.session;return n.a.createElement("div",null,t?n.a.createElement(le,{session:a,path:t,onWalkthroughEnd:function(){return e.setState({path:null})}}):n.a.createElement(he,{session:a,onSelectPath:function(t){return e.setState({path:t})}}))}}]),t}(n.a.Component),de=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={action:H.ADDCUBE,displayType:"DRAW"},a.onMenuClick=function(e){a.setState({action:e})},a.handleKeyDown=function(e){var t=a.state.action;a.props.session;if(t===H.SPEAK_CONSTRAINT);else switch(console.log(e.keyCode),e.keyCode){case 49:a.setState({displayType:"DRAW",action:H.ADDCUBE});break;case 50:a.setState({displayType:"SURF",action:H.NO_SURFACE});break;case 51:a.setState({displayType:"TOPO",action:H.INCREASE_HEIGHT});break;case 52:a.setState({displayType:"CALC"})}},a.getDisplay=function(){var e=a.state,t=e.action,r=e.displayType,s=a.props,i=s.session,o=s.cameraView;if(!i||!t)return null;switch(r){case"DRAW":return n.a.createElement($,{action:t,session:i,cameraView:o});case"CALC":return n.a.createElement(Te,{session:i});case"TOPO":return n.a.createElement(re,{action:t,session:i});case"SURF":return n.a.createElement(ne,{action:t,session:i,cameraView:o})}return null},a.getActions=function(){switch(a.state.displayType){case"DRAW":return[H.STEPOUT,H.STEPIN,H.ROTATELT,H.ROTATERT,H.ADDCUBE,H.ADDTREE,H.ADDROOF,H.REMOVE,H.SPEAK_CONSTRAINT];case"CALC":return[];case"TOPO":return[H.INCREASE_HEIGHT,H.DECREASE_HEIGHT];case"SURF":return[H.SOLID_SURFACE,H.NO_SURFACE]}return[]},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.state.action,t=this.getActions(),a=this.props.session;return n.a.createElement("div",null,n.a.createElement("div",{style:{width:"864px",height:"100%",float:"left"}},n.a.createElement("div",{style:{width:"864px",height:"160px"}},n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement(K,{session:a,action:e}))),n.a.createElement("div",{style:{width:"852px",height:"852px",padding:"5px"}},this.getDisplay())),n.a.createElement("div",{style:{width:"160px",height:"100%",float:"left"}},n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement(F,{actions:t,onClick:this.onMenuClick,action:e}))))}}]),t}(n.a.Component),fe=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).state={constraints:[],systemConstraints:[],buildings:[],objects:[]},a.getStringsFromConstraints=function(e){var t;return t=0===parseInt(e.type,10)?"room":1===parseInt(e.type,10)?"roof":"structure",'"'.concat(e.text,'":\n').concat(e.fn," ").concat(e.prop," of ").concat(t," ").concat(e.comp," ").concat(e.value," == ").concat(e.result,"\n\n")},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function t(){var a=e.props.session,r=a._monitor.constraints.slice(),n=a._monitor.systemConstraints.slice(),s=a._design._buildings,i=a._design.getObjects();e.setState({constraints:r,systemConstraints:n,buildings:s,objects:i}),e.pollTimeout=setTimeout(t,500)}()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){var e=this,t=this.state,a=t.constraints,r=t.systemConstraints,s=t.buildings;return n.a.createElement("div",null,n.a.createElement("div",null,n.a.createElement("h3",null,"User Constraints:"),n.a.createElement("div",null,a.map(function(t){return n.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),n.a.createElement("div",{style:{marginTop:"20px"}},n.a.createElement("h3",null,"System Constraints:"),n.a.createElement("div",null,r.map(function(t){return n.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),n.a.createElement("div",{style:{marginTop:"20px"}},n.a.createElement("h3",null,"Buildings:"),n.a.createElement("div",null,JSON.stringify(s))))}}]),t}(n.a.Component),Ee=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,n=new Array(r),s=0;s<r;s++)n[s]=arguments[s];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(n)))).startPoll=function(){var e=a.props,t=e.session,r=e.cameraView;clearTimeout(a.pollTimeout);var n={},s=0,i=0;!function e(){a.pollTimeout=setTimeout(function(){if(t){var o=t.design.getObjects().length,c=t._topo.heights.reduce(function(e,t){return e+t});r.camera===n.camera&&r.slices.x===n.slices.x&&r.slices.y===n.slices.y&&r.slices.z===n.slices.z&&o===s&&c===i||(a.view.render(),n={camera:r.camera,slices:{x:r.slices.x,y:r.slices.y,z:r.slices.z}},s=o,i=c)}e()},100)}()},a.nextRotation=function(){a.location=(a.location+1)%a.origins.length,a.view.setCameraPosition(a.origins[a.location],a.target)},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.container=document.getElementById("debuggingDisplay3D");var e=this.props,t=e.session,a=e.cameraView,r=e.size;this.view=new ce(this.container,t,a,20),this.view.renderer.setSize(r-1,r-1),this.target={x:8,y:8,z:0};var n=2*Math.PI/8;this.origins=[];for(var s=0;s<8;s+=1){var i={x:63*Math.cos(s*n+-.5*Math.PI)+8,y:63*Math.sin(s*n+-.5*Math.PI)+8,z:35};this.origins.push(i)}this.location=-1,this.nextRotation()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){return this.startPoll(),n.a.createElement("div",null,n.a.createElement("div",{id:"debuggingDisplay3D",style:{textAlign:"center"}}),n.a.createElement("button",{style:{border:"1px solid #E8E8DA",margin:"10px",padding:"4px 10px",color:"#E8E8DA"},onMouseDown:this.nextRotation},"Toggle Rotate"))}}]),t}(n.a.Component),pe={w:852,h:852,color:"#E8E8DA",gridSize:17,xMax:17,yMax:17,zMax:7,r:50,material:new h.e({color:15263962}),stroke:3.5,clippingMax:1,userName:"Ted"};window.SETTINGS=pe;var ve=function(e){function t(){var e,a;Object(o.a)(this,t);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(a=Object(l.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(s)))).state={view:1,session:null,cameraView:null,restartIndex:0},a.startSession=function(e){var t=a.getCameraView(e);a.setState({session:e,cameraView:t})},a.getCameraView=function(e){return{camera:0,slices:{x:0,y:0,z:0}}},a.reset=function(){var e=a.state.restartIndex;pe.userName=null,a.setState({session:null,cameraView:null,restartIndex:e+1})},a.renderBody=function(e){var t=a.state,r=t.session,s=t.cameraView;switch(e){case 1:return n.a.createElement(de,{session:r,cameraView:s});case 2:return n.a.createElement("div",{style:{width:"100%"}},n.a.createElement(Ee,{session:r,cameraView:s,size:962}));case 3:return n.a.createElement(fe,{session:r});case 4:return n.a.createElement("div",null,n.a.createElement(de,{session:r,cameraView:s}),n.a.createElement("div",{style:{position:"absolute",right:"20px",top:"20px",color:"#000",border:"1px solid #E8E8DA",width:"500px"}},n.a.createElement(Ee,{session:r,cameraView:s,size:500})),n.a.createElement("div",{style:{position:"absolute",left:"20px",top:"20px",width:"500px",wordWrap:"break-word",border:"1px solid #E8E8DA",padding:"10px 10px 40px 10px",fontSize:"16px"}},n.a.createElement(fe,{session:r})));default:return null}},a}return Object(S.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",function(t){switch(console.log("event.key",t.key),t.key){case"F1":e.setState({view:1});break;case"F2":e.setState({view:2});break;case"F3":e.setState({view:3});break;case"F4":e.setState({view:4});break;case"Escape":e.reset()}}),document.addEventListener("keydown",function(){clearTimeout(e.resetTimer),e.resetTimer=setTimeout(e.reset,6e4)}),document.addEventListener("mousedown",function(){clearTimeout(e.resetTimer),e.resetTimer=setTimeout(e.reset,6e4)}),this.resetTimer=setTimeout(this.reset,6e4)}},{key:"render",value:function(){var e=this.state,t=e.view,a=e.session,r=e.restartIndex;return n.a.createElement("div",{className:"app"},null===a?n.a.createElement(V,{key:r,onSelectSession:this.startSession}):this.renderBody(t))}}]),t}(n.a.Component);i.a.render(n.a.createElement(ve,null),document.getElementById("root"))}},[[24,2,1]]]);
//# sourceMappingURL=main.f7cc174f.chunk.js.map