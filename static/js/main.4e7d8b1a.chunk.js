(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(23),Constraint=function Constraint(data){var _this=this;if(Object(_Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,Constraint),this.isViolated=function(design){var objectsOfType;if("Structure"===_this.type)objectsOfType=design.getBuildings();else{var objects=design.getObjects();objectsOfType=objects.filter(function(e){return parseInt(_this.type)===e.type}),objectsOfType=objectsOfType.map(function(e){return e.object})}var propValues=objectsOfType.map(function(e){return e[_this.prop]});if(0===propValues.length)return!1;var calculatedValue=null;switch(_this.fn){case"SUM":calculatedValue=propValues.reduce(function(e,t){return t?e+t:e});break;case"MAX":calculatedValue=propValues.reduce(function(e,t){return t?Math.max(e,t):e});break;case"MIN":calculatedValue=propValues.reduce(function(e,t){return t?Math.min(e,t):e})}var calculatedResult=eval("".concat(calculatedValue," ").concat(_this.comp," ").concat(_this.value));console.log(_this.prop,calculatedValue,_this.comp,_this.value,calculatedResult,"expected",_this.result);var isViolated=calculatedResult!==_this.result;return{result:isViolated,value:calculatedValue}},this.isSameType=function(e){return JSON.stringify(e.type)===JSON.stringify(_this.type)&&e.prop===_this.prop},data){var text=data.text,result=data.result,fn=data.fn,type=data.type,prop=data.prop,comp=data.comp,value=data.value,removeFlag=data.removeFlag;this.text=text,this.result=result,this.fn=fn,this.type=type,this.prop=prop,this.comp=comp,this.value=value,this.removeFlag=removeFlag}},possibleConstraints=[{fn:"MAX",type:"Structure",prop:"height"},{fn:"MIN",type:"Structure",prop:"height"},{fn:"MAX",type:"0",prop:"distToAccess"},{fn:"MAX",type:"Structure",prop:"area"},{fn:"MIN",type:"Structure",prop:"area"}],hasError=function(e){if(!e)return!0;var t=e.fn,a=e.type,n=e.prop,r=e.value,s=e.comp,i=e.result;if(e.removeFlag)return!1;if(!t||!a||!n||!r||!s||null===i)return!0;var o=!1;return possibleConstraints.forEach(function(e){void 0!==e.fn&&e.fn!==t||void 0!==e.type&&e.type!==a||void 0!==e.prop&&e.prop!==n||void 0!==e.value&&e.value!==r||void 0!==e.comp&&e.comp!==s||void 0!==e.result&&e.result!==i||(o=!0)}),!o};Constraint.create=function(e){if(!e)return"No text provided";var t=Object(_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__.a)(e);return hasError(t)?null:new Constraint(t)},__webpack_exports__.a=Constraint},23:function(e,t,a){"use strict";a.d(t,"a",function(){return g});var n=a(16),r=a.n(n);r.a.plugin({words:{"less than":"Comparative","fewer than":"Comparative","more than":"Comparative","greater than":"Comparative",building:"Noun",structure:"Noun",no:"Expression"}});var s=["any","whatever","infinity","remove","allow"];function i(e){var t={};return Object.keys(e).forEach(function(a){e[a].forEach(function(e){t[e]=a})}),t}var o=i({"===":["equals","same"],">":["greater","more","bigger","taller","larger","above","exceeding","over","further","farther"],"<":["fewer","less","smaller","shorter","below","under","lower","beneath"],">=":["minimum","min","littlest","least","smallest"],"<=":["maximum","max","biggest","most","largest","greatest"]}),c=i({area:["area","square footage","sf","space","floor","floorspace","size","expanse","breadth","field"],height:["tall","height","elevation","taller","shorter","ceiling","peak","stature","crest","tip","zenith"],distToAccess:["access","entry","entrance","ingress","path","route","exit","way","door"]}),l=i({Structure:["structure","building","structures","buildings","house","home","domicile","complex","design"],0:["cube","room","area","cubes","rooms","areas","elements"],1:["roof","roofs","rooves","covering","ceiling","gable","crown"],2:["tree","plant","bush","trees","plants","bushes","canopy"]}),u=i({no:["not","none"]}),S=function(e){return!e.has("no")},h=function(e){var t=e.values().numbers(),a=null;if(t.length>0){for(var n=0;!t[n]&&n<t.length-1;)n+=1;a=t[n].toString()}return a},d=function(e){var t=null;return Object.keys(c).forEach(function(a){e.has(a)&&(t=c[a])}),t},T=function(e){var t="0";return Object.keys(l).forEach(function(a){e.has(a)&&(t=l[a])}),t},f=function(e){var t=null;return Object.keys(o).forEach(function(a){e.has(a)&&(t=o[a])}),t},E=function(e,t){var a=null;return e?">"===t||">="===t?a="MIN":"<"===t||"<="===t?a="MAX":"==="===t&&(a="SUM"):">"===t||">="===t?a="MAX":"<"===t||"<="===t?a="MIN":"==="===t&&(a="SUM"),a},p=function(e){var t=!1;return s.forEach(function(a){e.has(a)&&(t=!0)}),t};function g(e){console.log("Original text: "+e);var t=e.toLowerCase().replace(/[.,-\/#!$%^&*;:{}=\-_`()]/g,"").trim();t=r()(t).normalize().out(),Object.keys(u).forEach(function(e){var a=u[e];t=t.replace(new RegExp("".concat(e," "),"g"),"".concat(a," "))}),console.log("Cleaned text: "+t);var a=r()(t),n=a.out("tags").map(function(e){return"[".concat(e.text,": ").concat(e.tags.join(","),"]")}).join("");console.log("pos: "+n);var s=S(a),i=h(a),o=T(a),c=d(a),l=f(a),g=!1;i||(g=p(a));var m={text:e,result:s,fn:E(s,l),type:o,prop:c,comp:l,value:i,removeFlag:g};return console.log("Constraint result: \n".concat(JSON.stringify(m))),m}},25:function(e,t,a){e.exports=a(52)},30:function(e,t,a){},32:function(e,t,a){},52:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(22),i=a.n(s),o=(a(30),a(1)),c=a(2),l=a(3),u=a(5),S=a(4),h=a(6),d=a(20),T=(a(32),a(11)),f=function e(){var t=this;Object(c.a)(this,e),this.getMessages=function(){return t.messages},this.setMessages=function(e){return t.messages=e},this.addConstraint=function(e){var a=T.a.create(e);if(t.messages.push(e),a&&a instanceof T.a){var n=[],r=null;return t.constraints.forEach(function(e){e.isSameType(a)?r=e:n.push(e)}),a.removeFlag?r&&t.messages.push("Removed the constraint: '".concat(r.text,"'")):(n.push(a),t.messages.push("I have understood. The constraint: '".concat(a.text,"' was added."))),t.constraints=n,!0}return t.messages.push("I am sorry I do not understand."),!1},this.clearConstraints=function(){t.constraints=[],t.messages.push("Cleared constraints")},this.checkDesign=function(e){var a=t.checkConflicts(e),n=t.checkIncompatibilities(e),r=[];a.length>2?r.push("Don't you think you should stop, ".concat(SETTINGS.userName,"?")):a.length>1?r.push("".concat(SETTINGS.userName,", many conflicts are occurring.")):a.length>0?r.push("".concat(SETTINGS.userName,", a conflict has occurred, you said: ").concat(a[0].constraint.text,". The present status is ").concat(a[0].value,".")):0===a.length&&t.conflicts.length>0&&r.push("Conflicts were resolved."),n.length>0?r.push("Not structurally possible at this time."):0===n.length&&t.incompatibilities.length>0&&r.push("Incompatibilities were resolved."),console.log("Messages: [".concat(r.join(","),"]")),t.messages=r;var s=!1;return(a.length>t.conflicts.length||n.length>t.incompatibilities.length)&&(s=!0),t.conflicts=a,t.incompatibilities=n,s},this.checkConflicts=function(e){var a=[];return t.constraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated constraint!"),a.push({constraint:t,value:t.isViolated(e).value}))}),a},this.checkIncompatibilities=function(e){var a=[];return t.systemConstraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated system constraint!"),a.push({constraint:t,value:t.isViolated(e).value}))}),a},this.constraints=[],this.systemConstraints=[new T.a({text:"no building below ground",result:!1,fn:"MIN",type:"Structure",prop:"ground",comp:"<",value:"0"}),new T.a({text:"no roof without base",result:!1,fn:"SUM",type:1,prop:"noBase",comp:">",value:"0"}),new T.a({text:"no building floating",result:!1,fn:"SUM",type:"Structure",prop:"floating",comp:">",value:"0"})],this.conflicts=[],this.incompatibilities=[],this.messages=[]};f.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},f.thaw=function(e){var t=e.constraints,a=e.conflicts,n=e.incompatibilities,r=e.messages,s=new f;return s.constraints=t.map(function(e){return new T.a(e)}),s.conflicts=a,s.incompatibilities=n,s.messages=r,s};var E=f,p=a(9),g=a.n(p),m={CUBE:0,ROOF:1,TRUNK:2,FOLIAGE:3,PERSON:4},v={NORTH:0,EAST:1,SOUTH:2,WEST:3,TOP:4,BOTTOM:5};function w(e,t){var a=SETTINGS,n=a.w,r=a.h;return 0===e||e===n-1||0===t||t===r-1?null:function(e,t){var a=SETTINGS.gridSize;return{x:Math.floor(e*a),y:a-1-Math.floor(t*a)}}((e-1)/n,(t-1)/r)}function A(e,t,a){return t>=0&&e.length>0&&e[0].length&&t<e[0].length&&a>=0&&a<e.length?e[a][t]:null}function y(e,t,a,n){return e.length>0&&e[0].length&&e[0][0].length&&t>=0&&t<e[0][0].length&&a>=0&&a<e[0].length&&n>=0&&n<e.length?e[n][a][t]:null}function I(e,t){var a=t.x,n=t.y,r=t.z;return{w:y(e,a-1,n,r),n:y(e,a,n+1,r),e:y(e,a+1,n,r),s:y(e,a,n-1,r),t:y(e,a,n,r+1),b:y(e,a,n,r-1)}}function b(e,t,a){return{topLeft:A(e,t-1,a),topRight:A(e,t,a),bottomLeft:A(e,t-1,a-1),bottomRight:A(e,t,a-1)}}function N(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=new Array(e),r=0;r<e;r+=1){n[r]=new Array(t);for(var s=0;s<t;s+=1)n[r][s]=a}return n}function O(e,t,a){for(var n=new Array(a),r=0;r<n.length;r+=1)n[r]=N(t,e,null);return n}var x=Object.freeze({SOLID:0,TRANS:1,PART:2,NONE:3}),k=function e(t){var a=this;if(Object(c.a)(this,e),this.hookAfterInsert=function(t,n){a.direction=t;var r=n.n,s=n.e,i=n.s,o=n.w,c=n.b;c&&c.constructor===G&&(c.surfaces.t=x.NONE),r&&r.constructor===G&&"s"===a.direction&&(r.surfaces.s=x.NONE,a.hasSideSurface=!1),s&&s.constructor===G&&"w"===a.direction&&(s.surfaces.w=x.NONE,a.hasSideSurface=!1),i&&i.constructor===G&&"n"===a.direction&&(i.surfaces.n=x.NONE,a.hasSideSurface=!1),o&&o.constructor===G&&"e"===a.direction&&(o.surfaces.e=x.NONE,a.hasSideSurface=!1),r&&r.constructor===e&&"n"===r.direction&&"s"===a.direction&&(r.hasSideSurface=!1,a.hasSideSurface=!1),s&&s.constructor===e&&"e"===s.direction&&"w"===a.direction&&(s.hasSideSurface=!1,a.hasSideSurface=!1),i&&i.constructor===e&&"s"===i.direction&&"n"===a.direction&&(i.hasSideSurface=!1,a.hasSideSurface=!1),o&&o.constructor===e&&"w"===o.direction&&"e"===a.direction&&(o.hasSideSurface=!1,a.hasSideSurface=!1)},this.hookBeforeRemove=function(t){var n=t.n,r=t.e,s=t.s,i=t.w,o=t.b;o&&o.constructor===G&&(o.surfaces.t=x.SOLID),n&&n.constructor===G&&"s"===a.direction&&(n.surfaces.s=x.SOLID),r&&r.constructor===G&&"w"===a.direction&&(r.surfaces.w=x.SOLID),s&&s.constructor===G&&"n"===a.direction&&(s.surfaces.n=x.SOLID),i&&i.constructor===G&&"e"===a.direction&&(i.surfaces.e=x.SOLID),n&&n.constructor===e&&"n"===n.direction&&"s"===a.direction&&(n.hasSideSurface=!0),r&&r.constructor===e&&"e"===r.direction&&"w"===a.direction&&(r.hasSideSurface=!0),s&&s.constructor===e&&"s"===s.direction&&"n"===a.direction&&(s.hasSideSurface=!0),i&&i.constructor===e&&"w"===i.direction&&"e"===a.direction&&(i.hasSideSurface=!0)},this.setSurface=function(e,t){if(t===x.NONE)switch(e){case"n":"s"===a.direction&&(a.hasSideSurface=!1);break;case"s":"n"===a.direction&&(a.hasSideSurface=!1);break;case"e":"w"===a.direction&&(a.hasSideSurface=!1);break;case"w":"e"===a.direction&&(a.hasSideSurface=!1)}},t){var n=t.direction,r=t.hasSideSurface;this.direction=n,this.hasSideSurface=r}else this.direction="n",this.hasSideSurface=!0};k.typeName="ROOF";var G=function e(t){var a=this;if(Object(c.a)(this,e),this.hookAfterInsert=function(t){var n=t.n,r=t.e,s=t.s,i=t.w,o=t.t;n&&n.constructor===e&&(a.surfaces.n=x.NONE,n.surfaces.s=x.NONE),r&&r.constructor===e&&(a.surfaces.e=x.NONE,r.surfaces.w=x.NONE),s&&s.constructor===e&&(a.surfaces.s=x.NONE,s.surfaces.n=x.NONE),i&&i.constructor===e&&(a.surfaces.w=x.NONE,i.surfaces.e=x.NONE),o&&o.constructor===k&&(a.surfaces.t=x.NONE),n&&n.constructor===k&&"n"===n.direction&&(a.surfaces.n=x.NONE,n.hasSideSurface=!1),r&&r.constructor===k&&"e"===r.direction&&(a.surfaces.e=x.NONE,r.hasSideSurface=!1),s&&s.constructor===k&&"s"===s.direction&&(a.surfaces.s=x.NONE,s.hasSideSurface=!1),i&&i.constructor===k&&"w"===i.direction&&(a.surfaces.w=x.NONE,i.hasSideSurface=!1)},this.hookBeforeRemove=function(t){var a=t.n,n=t.e,r=t.s,s=t.w,i=t.t;a&&a.constructor===e&&(a.surfaces.s=x.SOLID),n&&n.constructor===e&&(n.surfaces.w=x.SOLID),r&&r.constructor===e&&(r.surfaces.n=x.SOLID),s&&s.constructor===e&&(s.surfaces.e=x.SOLID),i&&i.constructor===e&&(i.surfaces.b=x.SOLID),a&&a.constructor===k&&"n"===a.direction&&(a.hasSideSurface=!0),n&&n.constructor===k&&"e"===n.direction&&(n.hasSideSurface=!0),r&&r.constructor===k&&"s"===r.direction&&(r.hasSideSurface=!0),s&&s.constructor===k&&"w"===s.direction&&(s.hasSideSurface=!0)},this.setSurface=function(e,t){a.surfaces[e]=t},this.hasAccessToOutside=function(e){var t=e.n,n=e.s,r=e.e,s=e.w;return a.surfaces.e===x.NONE&&null===r||(a.surfaces.w===x.NONE&&null===s||(a.surfaces.n===x.NONE&&null===t||a.surfaces.s===x.NONE&&null===n))},this.hasAccessInDirection=function(e){return a.surfaces[e]===x.NONE},t){var n=t.surfaces;this.surfaces=n}else this.surfaces={n:x.SOLID,e:x.SOLID,s:x.SOLID,w:x.SOLID,t:x.SOLID,b:x.SOLID}};G.typeName="CUBE";var C=function e(){Object(c.a)(this,e)};C.typeName="FOLIAGE";var D=function e(){Object(c.a)(this,e)};D.typeName="TRUNK";var j=Object.freeze({CUBE:G,TRUNK:D,FOLIAGE:C,ROOF:k}),M=function e(t){var a=this;Object(c.a)(this,e),this.getAll=function(){return a.objects},this.getAt=function(e){return a.objects[e.z][e.y][e.x]},this.clear=function(){a.objects=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax)},this.add=function(e,t,n){var r,s=I(a.objects,t);switch(e){case m.TRUNK:if(t.z<SETTINGS.zMax-1){var i=t.x,o=t.y,c=t.z,l={x:i,y:o,z:c+=1};return a.remove(t),a.remove(l),a._setCell(t,new D(t)),a._setCell(l,new C(l)),!0}return!1;case m.CUBE:return r=new G,a.remove(t),a._setCell(t,r),r.hookAfterInsert(s),!0;case m.ROOF:return r=new k,a.remove(t),a._setCell(t,r),r.hookAfterInsert(n,s),!0;default:return!1}},this.remove=function(e){var t=a._getCell(e);if(t)switch(t.constructor){case D:if(e.z<SETTINGS.zMax-1){a._setCell(e,null);var n=e.x,r=e.y,s=e.z;s+=1,a._setCell({x:n,y:r,z:s},null)}break;case C:if(e.z>0){a._setCell(e,null);var i=e.x,o=e.y,c=e.z;c-=1,a._setCell({x:i,y:o,z:c},null)}break;default:if(t&&t.hookBeforeRemove){var l=I(a.objects,e);t.hookBeforeRemove(l)}a._setCell(e,null)}},this.setSurface=function(e,t,n,r){var s=a._getCell(t),i=a.getCardinalSide(e,n);s&&s.setSurface&&s.setSurface(i,r);var o=I(a.objects,t)[i];o&&o.setSurface&&o.setSurface(function(e){switch(e){case"n":return"s";case"s":return"n";case"e":return"w";case"w":return"e";case"t":return"b";case"b":return"t";default:return null}}(i),r)},this.getObjects=function(){for(var e=[],t=0;t<SETTINGS.zMax;t+=1)for(var n=0;n<SETTINGS.yMax;n+=1)for(var r=0;r<SETTINGS.xMax;r+=1){var s=a.objects[t][n][r];if(s){var i=null;switch(s.constructor){case G:i=m.CUBE;break;case k:i=m.ROOF;break;case C:i=m.FOLIAGE;break;case D:i=m.TRUNK}e.push({object:s,type:i,position:{x:r,y:n,z:t}})}}return e},this.getBuildings=function(){return a._buildings?a._buildings:[]},this.calculateAttributes=function(e){var t=a.getObjects();if(a._objects=t,t){a.calculateObjectAttributes(t,e),a.calculateAccess(t);var n=a.findBuildings(t);a._buildings=a.calculateBuildingAttributes(n)}},this.calculateObjectAttributes=function(e,t){e.forEach(function(e){var n=e.position,r=e.object,s=n.x,i=n.y,o=n.z,c=t.getAt({x:s,y:i}),l=I(a.objects,{x:s,y:i,z:o}).b;switch(r.constructor){case G:r.area=100,r.height=10*(o+1-c),r.ground=10*(o-c);break;case k:r.height=10*(o+1-c),r.noBase=l&&l.constructor===G?0:1,r.ground=10*(o-c);break;case C:case D:r.height=10*(o+1-c),r.ground=10*(o-c)}})},this.calculateAccess=function(e){e.forEach(function(e){e.type===m.CUBE&&(e.object.distToAccess=1/0)});var t=e.filter(function(e){if(e.type===m.CUBE){var t=e.position,n=e.object,r=t.x,s=t.y,i=t.z,o=I(a.objects,{x:r,y:s,z:i});return n.hasAccessToOutside(o)}return!1});t.forEach(function(e){!function e(t,n){var r=t.x,s=t.y,i=t.z;if(!(r<0||s<0||r>=SETTINGS.xMax||s>=SETTINGS.yMax)){var o=a.objects[i][s][r];if(o&&n<o.distToAccess){o.distToAccess=n;var c=n+10;o.hasAccessInDirection("n")&&e({x:r,y:s+1,z:i},c),o.hasAccessInDirection("s")&&e({x:r,y:s-1,z:i},c),o.hasAccessInDirection("e")&&e({x:r+1,y:s,z:i},c),o.hasAccessInDirection("w")&&e({x:r-1,y:s,z:i},c),o.hasAccessInDirection("t")&&e({x:r,y:s,z:i+1},c),o.hasAccessInDirection("b")&&e({x:r,y:s,z:i-1},c)}}}(e.position,10)})},this.calculateBuildingAttributes=function(e){var t=[];return Object.keys(e).forEach(function(a){var n=e[a],r=!0,s=0,i=1/0,o=0,c=0;n.forEach(function(e){e.constructor===G&&(o+=100,e.distToAccess>c&&(c=e.distToAccess)),10===e.height&&(r=!1),e.height>s&&(s=e.height),e.ground<i&&(i=e.ground)}),t.push({area:o,floating:r?1:0,height:s,ground:i,maxDistToAccess:c})}),t},this.findBuildings=function(e){var t=e.filter(function(e){return e.type===m.CUBE||e.type===m.ROOF}),n={};t.forEach(function(e){e.object.buildingIndex=null});var r=0;return t.forEach(function(e){var t=e.position;null===e.object.buildingIndex&&(n[r]=[],function e(t,r){var s=t.x,i=t.y,o=t.z;if(!(s<0||i<0||o<0||s>=SETTINGS.xMax||i>=SETTINGS.yMax||o>=SETTINGS.zMax)){var c=a.objects[o][i][s];c&&null===c.buildingIndex&&(c.buildingIndex=r,n[r].push(c),[{x:s,y:i+1,z:o},{x:s,y:i-1,z:o},{x:s+1,y:i,z:o},{x:s-1,y:i,z:o},{x:s,y:i,z:o+1},{x:s,y:i,z:o-1}].forEach(function(t){return e(t,r)}))}}(t,r),r+=1)}),n},this.getCardinalSide=function(e,t){var a;if("t"===t||"b"===t)switch(e){case v.NORTH:case v.SOUTH:case v.EAST:case v.WEST:a=t;break;case v.BOTTOM:a="t"===t?"s":"n";break;case v.TOP:a="t"===t?"n":"s";break;default:throw new Error("camera ".concat(e," is not recognized!"))}else switch(e){case v.NORTH:"l"===t?a="w":"r"===t&&(a="e");break;case v.SOUTH:"l"===t?a="e":"r"===t&&(a="w");break;case v.EAST:"l"===t?a="n":"r"===t&&(a="s");break;case v.WEST:"l"===t?a="s":"r"===t&&(a="n");break;case v.BOTTOM:case v.TOP:"l"===t?a="w":"r"===t&&(a="e");break;default:throw new Error("camera ".concat(e," is not recognized!"))}return a},this.getSlice=function(e,t){var n,r,s;switch(e){case v.NORTH:return a._getYSlice(t);case v.SOUTH:return n=a._getYSlice(t),g.a.hflip(n);case v.EAST:return r=a._getXSlice(t),g.a.hflip(r);case v.WEST:return a._getXSlice(t);case v.BOTTOM:return s=a._getZSlice(t),g.a.vflip(s);case v.TOP:return a._getZSlice(t);default:throw new Error("camera ".concat(e," is not recognized!"))}},this.getBackgroundSlices=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17,r=t,s=[];switch(e){case v.NORTH:for(;r<SETTINGS.yMax-1;)r+=1,s.push(r);break;case v.SOUTH:for(;r>0;)r-=1,s.push(r);break;case v.EAST:for(;r<SETTINGS.xMax-1;)r+=1,s.push(r);break;case v.WEST:for(;r>0;)r-=1,s.push(r);break;case v.BOTTOM:for(;r<SETTINGS.zMax-1;)r+=1,s.push(r);break;case v.TOP:for(;r>0;)r-=1,s.push(r);break;default:throw new Error("camera ".concat(e," is not recognized!"))}return(s=s.slice(0,n)).map(function(t){return a.getSlice(e,t)})},this._getZSlice=function(e){return a.objects[e]},this._getXSlice=function(e){for(var t=N(SETTINGS.zMax,SETTINGS.yMax),n=0;n<SETTINGS.zMax;n+=1)for(var r=0;r<SETTINGS.yMax;r+=1)t[n][r]=a.objects[n][r][e];return t},this._getYSlice=function(e){for(var t=N(SETTINGS.zMax,SETTINGS.xMax),n=0;n<SETTINGS.zMax;n+=1)for(var r=0;r<SETTINGS.xMax;r+=1)t[n][r]=a.objects[n][e][r];return t},this._getCell=function(e){var t=e.x,n=e.y,r=e.z;return t>=0&&n>=0&&r>=0&&t<SETTINGS.xMax&&n<SETTINGS.yMax&&r<SETTINGS.zMax?a.objects[r][n][t]:null},this._setCell=function(e,t){var n=e.x,r=e.y,s=e.z;n>=0&&r>=0&&s>=0&&n<SETTINGS.xMax&&r<SETTINGS.yMax&&s<SETTINGS.zMax&&(a.objects[s][r][n]=t)},this._addCube=function(e){var t=I(e),n=new G(e,t);a.addObject(e,n)},this.fill=function(){var e=function(e,t,n){a.add(t,e,n)};e({x:7,y:8,z:0},0),e({x:8,y:8,z:0},0),e({x:7,y:8,z:1},0),e({x:8,y:8,z:1},0),e({x:7,y:8,z:2},1,"w"),e({x:8,y:8,z:2},1,"e"),e({x:7,y:9,z:0},0),e({x:8,y:9,z:0},0),e({x:12,y:8,z:1},2),a.setSurface(0,{x:7,y:8,z:0},"l",1),a.setSurface(0,{x:8,y:8,z:1},"b",1)},this.objects=t||O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax)};M.freeze=function(e){for(var t=e.objects,a=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),n=0;n<SETTINGS.zMax;n+=1)for(var r=0;r<SETTINGS.xMax;r+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=t[n][r][s];if(i){var o=JSON.stringify(i),c=JSON.parse(o);c.typeName=i.constructor.typeName,a[n][r][s]=c}}return{objects:a}},M.thaw=function(e){for(var t=e.objects,a=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),n=0;n<SETTINGS.zMax;n+=1)for(var r=0;r<SETTINGS.xMax;r+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=t[n][r][s];if(i){var o;o=new(0,j[i.typeName])(i),a[n][r][s]=o}}return new M(a)};var R=M,_=function e(t){var a=this;Object(c.a)(this,e),this.clear=function(){a.heights=N(SETTINGS.yMax,SETTINGS.xMax,0)},this.increase=function(e){var t=a.heights[e.y][e.x]+1;t<SETTINGS.zMax&&(a.heights[e.y][e.x]=t)},this.decrease=function(e){var t=a.heights[e.y][e.x]-1;t>=0&&(a.heights[e.y][e.x]=t)},this.getAt=function(e){return a.heights[e.y][e.x]},this.getSlice=function(e,t){var n;switch(e){case v.NORTH:n=a.heights;break;case v.SOUTH:n=g.a.hflip(a.heights);break;case v.EAST:n=g.a.hflip(g.a.transpose(a.heights));break;case v.WEST:n=g.a.transpose(a.heights);break;case v.BOTTOM:case v.TOP:return null;default:throw new Error("camera ".concat(e," is not recognized!"))}for(var r,s,i,o=[],c=[],l=[],u=0;u<n[t].length;u+=1){var S={topLeft:A(r=n,(s=u)-1,(i=t)+1),top:A(r,s,i+1),topRight:A(r,s+1,i+1),left:A(r,s-1,i),center:A(r,s,i),right:A(r,s+1,i),bottomLeft:A(r,s-1,i-1),bottom:A(r,s,i-1),bottomRight:A(r,s+1,i-1)},h=S.topLeft,d=S.top,T=S.topRight,f=S.left,E=S.center,p=S.right,m=S.bottomLeft,w=S.bottom,y=S.bottomRight;l.push([Math.max(m,w,h,d,f,E),Math.max(w,y,d,T,E,p)]),o.push([Math.max(h,d,f,E),Math.max(d,T,E,p)]),c.push([Math.max(m,w,f,E),Math.max(w,y,E,p)])}return{all:l,front:c,back:o}},this.getBackgroundSlices=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:17,r=t,s=[];switch(e){case v.NORTH:for(;r<SETTINGS.yMax-1;)r+=1,s.push(r);break;case v.SOUTH:for(;r>0;)r-=1,s.push(r);break;case v.EAST:for(;r<SETTINGS.xMax-1;)r+=1,s.push(r);break;case v.WEST:for(;r>0;)r-=1,s.push(r);break;case v.BOTTOM:case v.TOP:break;default:throw new Error("camera ".concat(e," is not recognized!"))}return(s=s.slice(0,n)).map(function(t){return a.getSlice(e,t)})},this.getCorners=function(){for(var e=a.heights.length+1,t=N(e,e,0),n=0;n<e;n+=1)for(var r=0;r<e;r+=1){var s=b(a.heights,r,n),i=s.topLeft,o=s.topRight,c=s.bottomLeft,l=s.bottomRight;t[n][r]=Math.max(i,o,c,l)}return t},this.getHighestNonZeroPoint=function(){var e=0,t=null;return a.heights.forEach(function(a,n){return a.forEach(function(a,r){a>e&&(e=a,t={x:r,y:n,z:a})})}),t},this.fill=function(){a.heights[8][12]=1},this.heights=t||N(SETTINGS.yMax,SETTINGS.xMax,0)};_.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},_.thaw=function(e){var t=e.heights;return new _(t)};var z=_;var L=function e(t){var a=this;Object(c.a)(this,e),this.onUpdate=function(){a._design.calculateAttributes(a.topo),a._monitor.checkDesign(a._design)&&new Audio("data:audio/wav;base64,//uQRAAAAWMSLwUIYAAsYkXgoQwAEaYLWfkWgAI0wWs/ItAAAGDgYtAgAyN+QWaAAihwMWm4G8QQRDiMcCBcH3Cc+CDv/7xA4Tvh9Rz/y8QADBwMWgQAZG/ILNAARQ4GLTcDeIIIhxGOBAuD7hOfBB3/94gcJ3w+o5/5eIAIAAAVwWgQAVQ2ORaIQwEMAJiDg95G4nQL7mQVWI6GwRcfsZAcsKkJvxgxEjzFUgfHoSQ9Qq7KNwqHwuB13MA4a1q/DmBrHgPcmjiGoh//EwC5nGPEmS4RcfkVKOhJf+WOgoxJclFz3kgn//dBA+ya1GhurNn8zb//9NNutNuhz31f////9vt///z+IdAEAAAK4LQIAKobHItEIYCGAExBwe8jcToF9zIKrEdDYIuP2MgOWFSE34wYiR5iqQPj0JIeoVdlG4VD4XA67mAcNa1fhzA1jwHuTRxDUQ//iYBczjHiTJcIuPyKlHQkv/LHQUYkuSi57yQT//uggfZNajQ3Vmz+Zt//+mm3Wm3Q576v////+32///5/EOgAAADVghQAAAAA//uQZAUAB1WI0PZugAAAAAoQwAAAEk3nRd2qAAAAACiDgAAAAAAABCqEEQRLCgwpBGMlJkIz8jKhGvj4k6jzRnqasNKIeoh5gI7BJaC1A1AoNBjJgbyApVS4IDlZgDU5WUAxEKDNmmALHzZp0Fkz1FMTmGFl1FMEyodIavcCAUHDWrKAIA4aa2oCgILEBupZgHvAhEBcZ6joQBxS76AgccrFlczBvKLC0QI2cBoCFvfTDAo7eoOQInqDPBtvrDEZBNYN5xwNwxQRfw8ZQ5wQVLvO8OYU+mHvFLlDh05Mdg7BT6YrRPpCBznMB2r//xKJjyyOh+cImr2/4doscwD6neZjuZR4AgAABYAAAABy1xcdQtxYBYYZdifkUDgzzXaXn98Z0oi9ILU5mBjFANmRwlVJ3/6jYDAmxaiDG3/6xjQQCCKkRb/6kg/wW+kSJ5//rLobkLSiKmqP/0ikJuDaSaSf/6JiLYLEYnW/+kXg1WRVJL/9EmQ1YZIsv/6Qzwy5qk7/+tEU0nkls3/zIUMPKNX/6yZLf+kFgAfgGyLFAUwY//uQZAUABcd5UiNPVXAAAApAAAAAE0VZQKw9ISAAACgAAAAAVQIygIElVrFkBS+Jhi+EAuu+lKAkYUEIsmEAEoMeDmCETMvfSHTGkF5RWH7kz/ESHWPAq/kcCRhqBtMdokPdM7vil7RG98A2sc7zO6ZvTdM7pmOUAZTnJW+NXxqmd41dqJ6mLTXxrPpnV8avaIf5SvL7pndPvPpndJR9Kuu8fePvuiuhorgWjp7Mf/PRjxcFCPDkW31srioCExivv9lcwKEaHsf/7ow2Fl1T/9RkXgEhYElAoCLFtMArxwivDJJ+bR1HTKJdlEoTELCIqgEwVGSQ+hIm0NbK8WXcTEI0UPoa2NbG4y2K00JEWbZavJXkYaqo9CRHS55FcZTjKEk3NKoCYUnSQ0rWxrZbFKbKIhOKPZe1cJKzZSaQrIyULHDZmV5K4xySsDRKWOruanGtjLJXFEmwaIbDLX0hIPBUQPVFVkQkDoUNfSoDgQGKPekoxeGzA4DUvnn4bxzcZrtJyipKfPNy5w+9lnXwgqsiyHNeSVpemw4bWb9psYeq//uQZBoABQt4yMVxYAIAAAkQoAAAHvYpL5m6AAgAACXDAAAAD59jblTirQe9upFsmZbpMudy7Lz1X1DYsxOOSWpfPqNX2WqktK0DMvuGwlbNj44TleLPQ+Gsfb+GOWOKJoIrWb3cIMeeON6lz2umTqMXV8Mj30yWPpjoSa9ujK8SyeJP5y5mOW1D6hvLepeveEAEDo0mgCRClOEgANv3B9a6fikgUSu/DmAMATrGx7nng5p5iimPNZsfQLYB2sDLIkzRKZOHGAaUyDcpFBSLG9MCQALgAIgQs2YunOszLSAyQYPVC2YdGGeHD2dTdJk1pAHGAWDjnkcLKFymS3RQZTInzySoBwMG0QueC3gMsCEYxUqlrcxK6k1LQQcsmyYeQPdC2YfuGPASCBkcVMQQqpVJshui1tkXQJQV0OXGAZMXSOEEBRirXbVRQW7ugq7IM7rPWSZyDlM3IuNEkxzCOJ0ny2ThNkyRai1b6ev//3dzNGzNb//4uAvHT5sURcZCFcuKLhOFs8mLAAEAt4UWAAIABAAAAAB4qbHo0tIjVkUU//uQZAwABfSFz3ZqQAAAAAngwAAAE1HjMp2qAAAAACZDgAAAD5UkTE1UgZEUExqYynN1qZvqIOREEFmBcJQkwdxiFtw0qEOkGYfRDifBui9MQg4QAHAqWtAWHoCxu1Yf4VfWLPIM2mHDFsbQEVGwyqQoQcwnfHeIkNt9YnkiaS1oizycqJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=").play()},this.clear=function(){a._design.clear(),a._topo.clear(),a._monitor.clearConstraints(),a.onUpdate()},this.design={add:function(e,t,n){a._design.add(e,t,n),a.onUpdate()},remove:function(e){a._design.remove(e),a.onUpdate()},setSurface:function(e,t,n,r){a._design.setSurface(e,t,n,r),a.onUpdate()},getAll:function(){return a._design.getAll()},getAt:function(e){return a._design.getAt(e)},getObjects:function(){return a._design.getObjects()},getSlice:function(e,t){return a._design.getSlice(e,t)},getBackgroundSlices:function(e,t,n){return a._design.getBackgroundSlices(e,t,n)}},this.topo={increase:function(e){a._topo.increase(e),a.onUpdate()},decrease:function(e){a._topo.decrease(e),a.onUpdate()},getCorners:function(){return a._topo.getCorners()},getAt:function(e){return a._topo.getAt(e)},getSlice:function(e,t){return a._topo.getSlice(e,t)},getBackgroundSlices:function(e,t,n){return a._topo.getBackgroundSlices(e,t,n)},getHighestNonZeroPoint:function(){return a._topo.getHighestNonZeroPoint()}},this.monitor={addConstraint:function(e){a._monitor.addConstraint(e)&&setTimeout(a.onUpdate,4e3)},clearConstraints:function(){a._monitor.clearConstraints(),a.onUpdate()},getMessages:function(){return a._monitor.getMessages()},setMessages:function(e){return a._monitor.setMessages(e)}},this.save=function(){var t=e.freeze(a);localStorage.setItem(a._id,JSON.stringify(t)),localStorage.setItem("".concat(a._id,"_date"),Date.now())},this._id=t};L.create=function(e){var t=new L(e);return t._design=new R,t._topo=new z,t._monitor=new E,t},L.freeze=function(e){var t=e._id,a=e._design,n=e._topo,r=e._monitor;return{id:t,design:R.freeze(a),topo:z.freeze(n),monitor:E.freeze(r)}},L.thaw=function(e){var t=e.id,a=e.design,n=e.topo,r=e.monitor,s=(e.date,new L(t));return s._design=R.thaw(a),s._topo=z.thaw(n),s._monitor=E.thaw(r),s.onUpdate(),s};var U=L,P=function e(){var t=this;Object(c.a)(this,e),this.getIDList=function(){var e=localStorage.getItem("U5SessionIDList");return e=(e=e?e.split(","):[]).filter(function(e){return!!localStorage.getItem(e)}),console.log(e),e},this.get=function(e){var a=JSON.parse(localStorage.getItem(e)),n=U.thaw(a),r=t.getIDList();return(r=r.filter(function(t){return t!==e})).push(e),t._setIDList(r),n},this.remove=function(e){var a=t.getIDList();return a=a.filter(function(t){return t!==e}),t._setIDList(a),a},this.last=function(){var e=t.getIDList().pop();if(!e)return t.newSession();var a=JSON.parse(localStorage.getItem(e));return U.thaw(a)},this.newSession=function(){var e=t._getNextID(),a=t.getIDList();return a.push(e),t._setIDList(a),U.create(e)},this.test=function(){var e=t._getNextID(),a=t.getIDList();a.push(e),t._setIDList(a);var n=localStorage.getItem("U5SessionTestData");return n.id=e,U.thaw(n)},this._setIDList=function(e){return localStorage.setItem("U5SessionIDList",e)},this._getNextID=function(){var e=localStorage.getItem("U5SessionIDCount");return e||(e=0),e=parseInt(e,10)+1,localStorage.setItem("U5SessionIDCount",e),"U5Session_".concat(e)}},V=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(s)))).state={active:0},a.handleKeyDown=function(e){var t=a.state.active,n=(new P).getIDList();switch(console.log(e.keyCode),e.keyCode){case 38:a.setState({active:Math.max(0,t-1)});break;case 40:a.setState({active:Math.min(n.length,t+1)});break;case 13:a.refs.sessions.getElementsByTagName("BUTTON")[t].click()}e.preventDefault()},a.onButtonClick=function(e){var t=a.props.onSelectSession,n=new P;t("new"===e?n.newSession():"last"===e?n.last():n.get(e))},a.getButton=function(e,t){var n=a.state.active,s=localStorage.getItem("".concat(e,"_date")),i="";s&&(i=new Date(parseInt(s,10)).toLocaleString());var o=i;return r.a.createElement("li",{key:e,style:{paddingTop:"4px"}},r.a.createElement("button",{type:"button",onClick:function(){return a.onButtonClick(e)}},o,n-1===t?"_":""))},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this,t=this.state.active,a=(new P).getIDList();a.reverse();var n=a.slice(0,8);return r.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left",padding:"80px"}},r.a.createElement("p",null,"Select a session to use"),r.a.createElement("ul",{style:{lineHeight:"28px"},ref:"sessions"},r.a.createElement("li",{key:"new"},r.a.createElement("button",{type:"button",onClick:function(){return e.onButtonClick("new")}},"START NEW SESSION",0===t?"_":"")),r.a.createElement("br",null),r.a.createElement("div",null,"Open Previous Sessions:"),n.map(this.getButton)))}}]),t}(r.a.Component),W=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=[],t=this.props,a=t.actions,n=t.onClick,s=t.action;return a&&a.forEach(function(t){e.push(r.a.createElement("button",{type:"button",key:t.label,onClick:function(e){e.preventDefault(),n(t)},style:{display:"block",whiteSpace:"pre"}},t.label+(t.id===s.id?"_":"")))}),r.a.createElement("div",null,e)}}]),t}(r.a.PureComponent),B=a(24),F={STEPOUT:{id:0,label:"STEP OUT"},STEPIN:{id:1,label:"STEP  IN"},ADDCUBE:{id:2,label:"ADD CUBE"},REMOVE:{id:3,label:"DELETE"},ROTATELT:{id:4,label:"LOOKLEFT"},ROTATERT:{id:5,label:"LOOKRGHT"},ADDTREE:{id:6,label:"ADD TREE"},ADD_ROOF_NORTH:{id:7,label:"ADDROOFN"},ADD_ROOF_SOUTH:{id:8,label:"ADDROOFS"},WALKTHRU:{id:9,label:"WALKTHRU"},SPEAK_CONSTRAINT:{id:11,label:"SPEAK"},INCREASE_HEIGHT:{id:12,label:"INCRS HT"},DECREASE_HEIGHT:{id:13,label:"DECRS HT"},SOLID_SURFACE:{id:14,label:"SOLIDSRF"},PARTITION_SURFACE:{id:15,label:"PARTTION"},TRANSPARENT_SURFACE:{id:16,label:"TRANSPNT"},NO_SURFACE:{id:17,label:"NO SRF"},HAS_ACCESS:{id:18,label:"HASACCSS"},NO_ACCESS:{id:19,label:"NO ACCSS"},ADD_ROOF_WEST:{id:20,label:"ADDROOFW"},ADD_ROOF_EAST:{id:21,label:"ADDROOFE"},ADDROOF:{id:22,label:"ADD ROOF"},isAdd:function(e){return[2,6,7,8,20,21].includes(e.id)}},H=F;function K(e){switch(e){case"DRAW":return[F.STEPOUT,F.STEPIN,F.ROTATELT,F.ROTATERT,F.ADDCUBE,F.ADDTREE,F.ADDROOF,F.REMOVE,F.SPEAK_CONSTRAINT];case"CALC":return[];case"TOPO":return[F.INCREASE_HEIGHT,F.DECREASE_HEIGHT];case"SURF":return[F.STEPOUT,F.STEPIN,F.ROTATELT,F.ROTATERT,F.SOLID_SURFACE,F.NO_SURFACE]}return[]}var Q=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={value:""},a.handleKeyDown=function(e){13===e.keyCode&&a.handleSubmit()},a.handleChange=function(e){var t=e.target.value;a.setState({value:t})},a.handleSubmit=function(){var e=a.props.onSubmit,t=a.state.value;a.setState({value:""}),e(t)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.input=document.getElementById("speak"),this.input.addEventListener("keydown",this.handleKeyDown),this.input.focus()}},{key:"componentDidUpdate",value:function(){this.refs.input.focus()}},{key:"componentWillUnmount",value:function(){this.input.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.state.value;return r.a.createElement("div",null,r.a.createElement("input",{ref:"input",type:"text",id:"speak",autoComplete:"off",autoFocus:!0,spellCheck:"false",value:e,onChange:this.handleChange}))}}]),t}(r.a.PureComponent),Z=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={textMessages:[]},a.onMessage=function(e){a.setState(function(t){return{textMessages:[].concat(Object(B.a)(t.textMessages),[e])}})},a.componentDidUpdate=function(){a.scrollElement()},a.scrollElement=function(){window.requestAnimationFrame(function(){var e=document.getElementById("topContainer");e&&(e.scrollTop=e.scrollHeight+100)})},a.onSpeak=function(e){var t=a.props.session;t.monitor.addConstraint(e);var n=t.monitor.getMessages();a.setState({textMessages:n.slice()})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.session;!function a(){var n=t.monitor.getMessages();e.setState({textMessages:n}),e.pollTimeout=setTimeout(a,100)}()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){var e=this.props.action,t=this.state.textMessages,a=null;e===H.SPEAK_CONSTRAINT&&(a=r.a.createElement("div",null,r.a.createElement(Q,{onSubmit:this.onSpeak}))),console.log("textMessages",t);var n=t.map(function(e){return r.a.createElement("div",{className:"mono-text",key:e},e)});return r.a.createElement("div",{id:"topContainer",style:{overflow:"hidden",height:"75px"}},n,a)}}]),t}(r.a.PureComponent),Y=a(7),q=a(15),X=function e(t){var a=this;Object(c.a)(this,e),this.draw=function(e,t){var n,r,s=new Y.createjs.Shape;n=1,s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),t&&s.graphics.setStrokeDash([4,8],0),e.all.forEach(function(e){var t=Object(q.a)(e,2),a=t[0],i=t[1];r=SETTINGS.h-1-a*SETTINGS.r,s.graphics.moveTo(n,r),n+=SETTINGS.r,r=SETTINGS.h-1-i*SETTINGS.r,s.graphics.lineTo(n,r)}),s.graphics.endStroke(),a.stage.addChild(s)},this.stage=t},J=function e(t){var a=this;Object(c.a)(this,e),this.drawSlice=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.camera=e;for(var r=0;r<t.length;r+=1)for(var s=t[r],i=0;i<s.length;i+=1){var o=s[i];if(o)switch(o.constructor){case G:a.drawCube(o,e,a.stage,i,r,n);break;case k:a.drawRoof(o,e,a.stage,i,r,n);break;case C:n||a.drawFoliage(e,a.stage,i,r,n);break;case D:n||a.drawTrunk(e,a.stage,i,r,n)}}},this.drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var n=e[t],r=0;r<n.length;r+=1){var s=new Y.createjs.Shape,i=(r+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(i,o,2,-2),a.stage.addChild(s)}},this.drawCircle=function(e,t){var n=new Y.createjs.Shape;n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var r=(e+.5)*SETTINGS.r+1,s=SETTINGS.h-(t+.45)*SETTINGS.r-1;n.graphics.drawCircle(r,s,.4*SETTINGS.r),a.stage.addChild(n)},this.drawCube=function(e,t,n,r,s){var i,o,c,l,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],S=e.surfaces;switch(t){case v.NORTH:i=S.w===x.SOLID,o=S.t===x.SOLID,c=S.e===x.SOLID,l=S.b===x.SOLID;break;case v.SOUTH:i=S.e===x.SOLID,o=S.t===x.SOLID,c=S.w===x.SOLID,l=S.b===x.SOLID;break;case v.EAST:i=S.n===x.SOLID,o=S.t===x.SOLID,c=S.s===x.SOLID,l=S.b===x.SOLID;break;case v.WEST:i=S.s===x.SOLID,o=S.t===x.SOLID,c=S.n===x.SOLID,l=S.b===x.SOLID;break;case v.TOP:i=S.w===x.SOLID,o=S.n===x.SOLID,c=S.e===x.SOLID,l=S.s===x.SOLID;break;case v.BOTTOM:i=S.w===x.SOLID,o=S.s===x.SOLID,c=S.e===x.SOLID,l=S.n===x.SOLID;break;default:return}a._drawCubeSquare(n,r,s,u,i,o,c,l)},this._drawCubeSquare=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=new Y.createjs.Shape;c.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var l=t*SETTINGS.r+1,u=SETTINGS.r,S=SETTINGS.h-a*SETTINGS.r-1,h=-SETTINGS.r;n&&c.graphics.setStrokeDash([4,8],0),r&&c.graphics.moveTo(l,S).lineTo(l,S+h),s&&c.graphics.moveTo(l,S+h).lineTo(l+u,S+h),i&&c.graphics.moveTo(l+u,S+h).lineTo(l+u,S),o&&c.graphics.moveTo(l+u,S).lineTo(l,S),e.addChild(c)},this.drawRoof=function(e,t,n,r,s){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5];switch(t){case v.NORTH:"n"===e.direction||"s"===e.direction?a._drawRoofSquare(n,r,s,i):"w"===e.direction?a._drawRoofSlantLeft(e,n,r,s,i):"e"===e.direction&&a._drawRoofSlantRight(e,n,r,s,i);break;case v.SOUTH:"n"===e.direction||"s"===e.direction?a._drawRoofSquare(n,r,s,i):"e"===e.direction?a._drawRoofSlantLeft(e,n,r,s,i):"w"===e.direction&&a._drawRoofSlantRight(e,n,r,s,i);break;case v.EAST:"e"===e.direction||"w"===e.direction?a._drawRoofSquare(n,r,s,i):"s"===e.direction?a._drawRoofSlantRight(e,n,r,s,i):"n"===e.direction&&a._drawRoofSlantLeft(e,n,r,s,i);break;case v.WEST:"e"===e.direction||"w"===e.direction?a._drawRoofSquare(n,r,s,i):"n"===e.direction?a._drawRoofSlantRight(e,n,r,s,i):"s"===e.direction&&a._drawRoofSlantLeft(e,n,r,s,i);break;case v.TOP:case v.BOTTOM:a._drawRoofSquare(n,r,s,i)}},this._drawRoofSquare=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=new Y.createjs.Shape;r.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var s=t*SETTINGS.r+1,i=SETTINGS.r,o=SETTINGS.h-a*SETTINGS.r-1,c=-SETTINGS.r;n&&r.graphics.setStrokeDash([3,7],0),r.graphics.drawRect(s,o,i,c),e.addChild(r)},this._drawRoofSlantLeft=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Y.createjs.Shape;r&&s.graphics.setStrokeDash([4,8],0);var i=a*SETTINGS.r+1,o=SETTINGS.h-n*SETTINGS.r-1;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),s.graphics.moveTo(i,o),i+=SETTINGS.r,o-=SETTINGS.r,s.graphics.lineTo(i,o),e.hasSideSurface&&(s.graphics.moveTo(i,o),o+=SETTINGS.r,s.graphics.lineTo(i,o)),s.graphics.endStroke(),t.addChild(s)},this._drawRoofSlantRight=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Y.createjs.Shape;r&&s.graphics.setStrokeDash([4,8],0);var i=a*SETTINGS.r+1,o=SETTINGS.h-(n+1)*SETTINGS.r-1;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),s.graphics.moveTo(i,o),i+=SETTINGS.r,o+=SETTINGS.r,s.graphics.lineTo(i,o),e.hasSideSurface&&(i-=SETTINGS.r,o-=SETTINGS.r,s.graphics.moveTo(i,o),o+=SETTINGS.r,s.graphics.lineTo(i,o)),s.graphics.endStroke(),t.addChild(s)},this.drawFoliage=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Y.createjs.Shape;r&&s.graphics.setStrokeDash([SETTINGS.stroke,7],0),s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var i=(a+.5)*SETTINGS.r+1,o=SETTINGS.h-(n+.45)*SETTINGS.r-1;s.graphics.drawCircle(i,o,.4*SETTINGS.r),t.addChild(s)},this.drawTrunk=function(e,t,a,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=new Y.createjs.Shape;r&&s.graphics.setStrokeDash([4,8],0),s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var i=(a+.5)*SETTINGS.r+1,o=SETTINGS.h-n*SETTINGS.r-1;switch(e){case v.NORTH:case v.SOUTH:case v.WEST:case v.EAST:s.graphics.moveTo(i,o).lineTo(i,o-SETTINGS.r);break;case v.TOP:case v.BOTTOM:break;default:throw new Error("camera ".concat(e," is not recognized!"))}t.addChild(s)},this.stage=t},$=function e(t,a){var n=this;Object(c.a)(this,e),this.draw=function(e,t){var a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];n.stage.removeAllChildren();var r=n.session.topo.getSlice(e,t);(r&&n.topoRenderer.draw(r),n.drawBackground)&&(n.session.topo.getBackgroundSlices(e,t,SETTINGS.clippingMax).forEach(function(e){return n.topoRenderer.draw(e,a)}),n.session.design.getBackgroundSlices(e,t,SETTINGS.clippingMax).forEach(function(t){return n.designRenderer.drawSlice(e,t,a)}));var s=n.session.design.getSlice(e,t);n.designRenderer.drawSlice(e,s),n.designRenderer.drawGridPoints(s),n.stage.update()},this.drawTopCompressedView=function(){n.stage.removeAllChildren();var e=n.session.design.getBackgroundSlices(v.TOP,SETTINGS.zMax);e.reverse();for(var t=N(SETTINGS.xMax,SETTINGS.yMax,null),a=function(a){for(var n=function(n){var r=null;e.forEach(function(e){var t=e[a][n];t&&(r=t)}),t[a][n]=r},r=0;r<SETTINGS.xMax;r+=1)n(r)},r=0;r<SETTINGS.yMax;r+=1)a(r);n.drawGridPoints(t),n.designRenderer.drawSlice(v.TOP,t),n.stage.update()},this.drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var a=e[t],r=0;r<a.length;r+=1){var s=new Y.createjs.Shape,i=(r+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(i,o,2,-2),n.stage.addChild(s)}},this.update=function(){n.stage.update()},this.clear=function(){n.stage.removeAllChildren(),n.stage.update()},this._drawTopoSlice=function(e){var t,a=new Y.createjs.Shape,r=1;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),e.forEach(function(e){var n=e.startHeight,s=e.endHeight;t=SETTINGS.h-1-n*SETTINGS.r,a.graphics.moveTo(r,t),r+=SETTINGS.r,t=SETTINGS.h-1-s*SETTINGS.r,a.graphics.lineTo(r,t)}),a.graphics.endStroke(),n.stage.addChild(a)},this._drawSlice=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];n.camera=e;for(var r=0;r<t.length;r+=1)for(var s=t[r],i=0;i<s.length;i+=1){var o=s[i];o&&o.draw2D(e,n.stage,i,r,a)}},this._drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var a=e[t],r=0;r<a.length;r+=1){var s=new Y.createjs.Shape,i=(r+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;s.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(i,o,2,-2),n.stage.addChild(s)}},this.drawCircle=function(e,t){var a=new Y.createjs.Shape;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var r=(e+.5)*SETTINGS.r+1,s=SETTINGS.h-(t+.45)*SETTINGS.r-1;a.graphics.drawCircle(r,s,.4*SETTINGS.r),n.stage.addChild(a)},this.animateX=function(e,t,a,r){if(t>=e.length)r();else{var s=e[t],i=n.drawX(s.xNoise,s.yNoise);n.update(),setTimeout(function(){n.stage.removeChild(i),n.animateX(e,t+1,a,r)},a)}},this.drawX=function(e,t){var a=new Y.createjs.Shape;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var r=(e+.2)*SETTINGS.r,s=SETTINGS.h-(t+.2)*SETTINGS.r;a.graphics.moveTo(r,s).lineTo(r+.6*SETTINGS.r,s-.6*SETTINGS.r);var i=(e+1-.2)*SETTINGS.r,o=SETTINGS.h-(t+.2)*SETTINGS.r;return a.graphics.moveTo(i,o).lineTo(i-.6*SETTINGS.r,o-.6*SETTINGS.r),n.stage.addChild(a)},this.session=a,this.stage=new Y.createjs.Stage(t),this.designRenderer=new J(this.stage),this.topoRenderer=new X(this.stage),this.drawBackground=!0},ee=function e(t,a){var n=this;Object(c.a)(this,e),this.addListener=function(e){return n.views.push(e)},this.removeListener=function(e){return n.views.filter(function(t){return t!==e})},this.doAction=function(e,t,a,r){var s=n.getRelativePosition(t,a);switch(e){case H.STEPOUT:n.previousSlice();break;case H.STEPIN:n.nextSlice();break;case H.ADDCUBE:n.addObject(s,m.CUBE);break;case H.REMOVE:n.removeObject(s);break;case H.ROTATELT:n.rotateLeft();break;case H.ROTATERT:n.rotateRight();break;case H.ADDTREE:n.addObject(s,m.TRUNK);break;case H.ADDROOF:var i=n.session.design.getAt(s);i&&"ROOF"===i.constructor.typeName?"e"===i.direction?n.addObject(s,m.ROOF,"n"):"n"===i.direction?n.addObject(s,m.ROOF,"w"):"w"===i.direction?n.addObject(s,m.ROOF,"s"):"s"===i.direction&&n.addObject(s,m.ROOF,"e"):n.addObject(s,m.ROOF,"e");break;case H.ADD_ROOF_EAST:n.addObject(s,m.ROOF,"e");break;case H.ADD_ROOF_WEST:n.addObject(s,m.ROOF,"w");break;case H.ADD_ROOF_NORTH:n.addObject(s,m.ROOF,"n");break;case H.ADD_ROOF_SOUTH:n.addObject(s,m.ROOF,"s");break;case H.EDITTOPO:n.setTopoHeight(s);break;case H.NO_SURFACE:n.setSurface(n.cameraView.camera,s,r,x.NONE);break;case H.SOLID_SURFACE:n.setSurface(n.cameraView.camera,s,r,x.SOLID);break;case H.TRANSPARENT_SURFACE:n.setSurface(n.cameraView.camera,s,r,x.TRANS);break;case H.PARTITION_SURFACE:n.setSurface(n.cameraView.camera,s,r,x.PART)}},this.addObject=function(e,t,a){e&&(n.session.design.add(t,e,a),n.updateViews())},this.removeObject=function(e){e&&(n.session.design.remove(e),n.updateViews())},this.setSurface=function(e,t,a,r){t&&(n.session.design.setSurface(e,t,a,r),n.updateViews())},this.nextSlice=function(){switch(n.cameraView.camera){case v.NORTH:n._setSliceYAxis(n.cameraView.slices.y+1);break;case v.SOUTH:n._setSliceYAxis(n.cameraView.slices.y-1);break;case v.EAST:n._setSliceXAxis(n.cameraView.slices.x+1);break;case v.WEST:n._setSliceXAxis(n.cameraView.slices.x-1);break;case v.TOP:n._setSliceZAxis(n.cameraView.slices.z-1);break;case v.BOTTOM:n._setSliceZAxis(n.cameraView.slices.z+1);break;default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}},this.previousSlice=function(){switch(n.cameraView.camera){case v.NORTH:n._setSliceYAxis(n.cameraView.slices.y-1);break;case v.SOUTH:n._setSliceYAxis(n.cameraView.slices.y+1);break;case v.EAST:n._setSliceXAxis(n.cameraView.slices.x-1);break;case v.WEST:n._setSliceXAxis(n.cameraView.slices.x+1);break;case v.TOP:n._setSliceZAxis(n.cameraView.slices.z+1);break;case v.BOTTOM:n._setSliceZAxis(n.cameraView.slices.z-1);break;default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}},this.north=function(){return n._setCamera("NORTH")},this.south=function(){return n._setCamera("SOUTH")},this.east=function(){return n._setCamera("EAST")},this.west=function(){return n._setCamera("WEST")},this.top=function(){return n._setCamera("TOP")},this.bottom=function(){return n._setCamera("BOTTOM")},this.rotateLeft=function(){switch(n.cameraView.camera){case v.NORTH:n._setCamera("EAST");break;case v.EAST:n._setCamera("SOUTH");break;case v.SOUTH:n._setCamera("WEST");break;case v.WEST:n._setCamera("NORTH")}},this.rotateRight=function(){switch(n.cameraView.camera){case v.NORTH:n._setCamera("WEST");break;case v.WEST:n._setCamera("SOUTH");break;case v.SOUTH:n._setCamera("EAST");break;case v.EAST:n._setCamera("NORTH")}},this._setSliceZAxis=function(e){e>=0&&e<n.zMax&&(n.cameraView.slices.z=e,n.updateViews())},this._setSliceXAxis=function(e){e>=0&&e<n.xMax&&(n.cameraView.slices.x=e,n.updateViews())},this._setSliceYAxis=function(e){e>=0&&e<n.yMax&&(n.cameraView.slices.y=e,n.updateViews())},this._setCamera=function(e){n.cameraView.camera=v[e];var t=SETTINGS.xMax-1,a=SETTINGS.yMax-1,r=SETTINGS.zMax-1,s=0,i=0,o=0,c=n.session.design.getObjects(),l=n.session.topo.getHighestNonZeroPoint();if(c.length>0)switch(c.forEach(function(e){var n=e.position,c=n.x,l=n.y,u=n.z;c<t&&(t=c),c>s&&(s=c),l<a&&(a=l),l>i&&(i=l),u<r&&(r=u),u>o&&(o=u)}),n.cameraView.camera){case v.NORTH:n.cameraView.slices.y=a;break;case v.SOUTH:n.cameraView.slices.y=i;break;case v.EAST:n.cameraView.slices.x=t;break;case v.WEST:n.cameraView.slices.x=s;break;case v.TOP:n.cameraView.slices.z=o;break;case v.BOTTOM:n.cameraView.slices.z=r;break;default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}else if(l){var u=l.x,S=l.y,h=l.z;switch(n.cameraView.camera){case v.NORTH:case v.SOUTH:n.cameraView.slices.y=S;break;case v.EAST:case v.WEST:n.cameraView.slices.x=u;break;case v.TOP:case v.BOTTOM:n.cameraView.slices.z=h;break;default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}}n.updateViews()},this.updateViews=function(){var e;switch(n.cameraView.camera){case v.NORTH:case v.SOUTH:e=n.cameraView.slices.y;break;case v.EAST:case v.WEST:e=n.cameraView.slices.x;break;case v.TOP:case v.BOTTOM:e=n.cameraView.slices.z;break;default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}n.views.forEach(function(t){return t.draw(n.cameraView.camera,e,n.isBackgroundDashed)})},this.getRelativePosition=function(e,t){switch(n.cameraView.camera){case v.NORTH:case v.SOUTH:case v.EAST:case v.WEST:if(t>=n.zMax)return null}switch(n.cameraView.camera){case v.NORTH:return{x:e,y:n.cameraView.slices.y,z:t};case v.SOUTH:return{x:n.gridSize-1-e,y:n.cameraView.slices.y,z:t};case v.EAST:return{x:n.cameraView.slices.x,y:n.gridSize-1-e,z:t};case v.WEST:return{x:n.cameraView.slices.x,y:e,z:t};case v.BOTTOM:return{x:e,y:n.gridSize-1-t,z:n.cameraView.slices.z};case v.TOP:return{x:e,y:t,z:n.cameraView.slices.z};default:throw new Error("camera ".concat(n.cameraView.camera," is not recognized!"))}},this.session=t,this.gridSize=SETTINGS.gridSize,this.xMax=SETTINGS.xMax,this.yMax=SETTINGS.yMax,this.zMax=SETTINGS.zMax,this.cameraView=a,this.views=[],this.isBackgroundDashed=!0,this.north()},te=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={controller:null},a.wire=function(){var e=a.props,t=e.session,n=e.cameraView;if(!a.isWired&&t){a.isWired=!0;var r=new ee(t,n);a.view=new $(a.canvas,t),r.addListener(a.view),r.updateViews(),a.setState({controller:r})}},a.handleKeyDown=function(e){var t=a.state.controller;if(a.props.action!==H.SPEAK_CONSTRAINT)switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},a.handleClick=function(e){var t=a.state.controller,n=a.props.action,r=w(e.offsetX,e.offsetY);r&&t.doAction(n,r.x,r.y)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("draw"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.action,n=t.session;if(a!==e.action)switch(a){case H.ADDCUBE:n.monitor.setMessages(["Click to add a cube."]);break;case H.ADDTREE:n.monitor.setMessages(["Click to add a tree."]);break;case H.ADDROOF:n.monitor.setMessages(["Click to add a roof."]);break;case H.REMOVE:n.monitor.setMessages(["Click to remove an object."]);break;default:n.monitor.setMessages([])}this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return r.a.createElement("div",null,r.a.createElement("canvas",{id:"draw",width:t,height:a}))}}]),t}(r.a.Component),ae=[0,60,110,150,180,205,225,240],ne=function e(t){var a=this;Object(c.a)(this,e),this.drawSquare=function(e,t,n){var r=new Y.createjs.Shape;r.graphics.beginStroke(SETTINGS.color).setStrokeStyle(1);var s=e*SETTINGS.r+1,i=SETTINGS.r,o=SETTINGS.h-t*SETTINGS.r-1,c=-SETTINGS.r,l=ae[n],u="rgba(".concat(l,", ").concat(l,", ").concat(l,", 0.7)");r.graphics.beginFill(u),r.graphics.drawRect(s,o,i,c),r.graphics.endFill(),a.stage.addChild(r);var S=new Y.createjs.Text(n,"bold 24px Andale Mono",SETTINGS.color);S.x=s+i/2-7,S.y=o+c/2-11,a.stage.addChild(S)},this.stage=t},re=function e(t,a){var n=this;Object(c.a)(this,e),this.draw=function(){n.stage.removeAllChildren();for(var e=0;e<SETTINGS.yMax;e+=1)for(var t=0;t<SETTINGS.xMax;t+=1)n.renderer.drawSquare(t,e,n.session.topo.getAt({x:t,y:e}));n.stage.update()},this.session=a,this.stage=new Y.createjs.Stage(t),this.renderer=new ne(this.stage)},se=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).wire=function(){var e=a.props.session;!a.isWired&&e&&(a.isWired=!0,a.view=new re(a.canvas,e),a.view.draw())},a.handleClick=function(e){var t=a.props,n=t.session,r=t.action,s=w(e.offsetX,e.offsetY);s&&(r===H.DECREASE_HEIGHT?n.topo.decrease(s):n.topo.increase(s),a.view.draw())},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.action,n=t.session;if(a!==e.action)switch(a){case H.INCREASE_HEIGHT:n.monitor.setMessages(["Click the grid to increase elevation in the topography."]);break;case H.DECREASE_HEIGHT:n.monitor.setMessages(["Click the grid to decrease elevation in the topography."]);break;default:n.monitor.setMessages([])}this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return r.a.createElement("div",null,r.a.createElement("canvas",{id:"display",width:t,height:a}))}}]),t}(r.a.Component),ie=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={controller:null},a.wire=function(){var e=a.props,t=e.session,n=e.cameraView;if(!a.isWired&&t){a.isWired=!0;var r=new ee(t,n);a.view=new $(a.canvas,t),r.addListener(a.view),r.updateViews(),a.setState({controller:r})}},a.handleKeyDown=function(e){var t=a.state.controller;switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},a.handleClick=function(e){var t=a.state.controller,n=a.props.action,r=function(e,t){var a=SETTINGS,n=a.w,r=a.h,s=a.gridSize;if(0===e||e===n-1||0===t||t===r-1)return null;var i,o=(t-1)/r,c=(e-1)/n*s,l=Math.floor(c),u=c-l,S=s-o*s,h=Math.floor(S),d=S-h,T=1-d,f=d,E=u,p=1-u,g=Math.min(T,f,E,p);return T===g?i="t":f===g?i="b":E===g?i="l":p===g&&(i="r"),{x:l,y:h,side:i}}(e.offsetX,e.offsetY);if(r){var s=r.x,i=r.y,o=r.side;t.doAction(n,s,i,o)}},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("surface"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("click",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(e){var t=this.props,a=t.action,n=t.session;if(a!==e.action)switch(a){case H.SOLID_SURFACE:n.monitor.setMessages(["Click to add surfaces on cubes to close off access."]);break;case H.NO_SURFACE:n.monitor.setMessages(["Click to remove surfaces on cubes to add access."])}this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("click",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return r.a.createElement("div",null,r.a.createElement("canvas",{id:"surface",width:t,height:a}))}}]),t}(r.a.Component),oe=function e(t,a){var n=this;Object(c.a)(this,e),this.addListener=function(e){return n.views.push(e)},this.removeListener=function(e){return n.views.filter(function(t){return t!==e})},this.run=function(e){n.path=e,n.i=0,setTimeout(function(){return n.animateCameraPath()},500)},this.animateCameraPath=function(){if(n.i<n.path.length-2){n.i+=1;var e=n.path[n.i],t=n.path[n.i+1];n.views.forEach(function(a){return a.setCameraPosition(e,t)}),setTimeout(function(){return n.animateCameraPath()},150)}else n.onWalkthroughEnd()},this.session=t,this.views=[],this.onWalkthroughEnd=a},ce=function e(){var t=this;Object(c.a)(this,e),this.draw=function(e,a,n){if(a){if(n){var r=t._getArrows(n);t._addArrows(e,r)}for(var s=!!n,i=N(SETTINGS.xMax+1,SETTINGS.yMax+1,null),o=0;o<=SETTINGS.yMax;o+=1)for(var c=0;c<=SETTINGS.xMax;c+=1){var l={x:c,y:o,z:a[o][c]-.5},u=t._getAdjustedPoint(l);if(u.z-=.5,i[o][c]=u,o>0){var S=i[o-1][c];t._addLine(e,u,S,s)}if(c>0){var h=i[o][c-1];t._addLine(e,u,h,s)}}}},this._addArrows=function(e,a){a.forEach(function(a){var n=new o.c;a.forEach(function(e){var a=t._getAdjustedPoint(e),r=a.x,s=a.y,i=a.z;n.vertices.push(new o.j(r,s,i))});var r=new o.d(n,new o.e({color:60928}));e.add(r)})},this._getArrows=function(e){var t,a=e.slices,n=a.x,r=a.y,s=a.z;switch(e.camera){case v.TOP:case v.BOTTOM:t=[[{x:-1,y:0,z:s},{x:0,y:0,z:s},{x:0,y:-1,z:s},{x:-1,y:0,z:s}],[{x:SETTINGS.xMax+1,y:SETTINGS.yMax,z:s},{x:SETTINGS.xMax,y:SETTINGS.yMax,z:s},{x:SETTINGS.xMax,y:SETTINGS.yMax+1,z:s},{x:SETTINGS.xMax+1,y:SETTINGS.yMax,z:s}],[{x:SETTINGS.xMax+1,y:0,z:s},{x:SETTINGS.xMax,y:0,z:s},{x:SETTINGS.xMax,y:-1,z:s},{x:SETTINGS.xMax+1,y:0,z:s}],[{x:-1,y:SETTINGS.yMax,z:s},{x:0,y:SETTINGS.yMax,z:s},{x:0,y:SETTINGS.yMax+1,z:s},{x:-1,y:SETTINGS.yMax,z:s}]];break;case v.WEST:t=[[{x:(n-=.5)+1,y:-1,z:-.5},{x:n,y:-.5,z:-.5},{x:n+1,y:0,z:-.5},{x:n+1,y:-1,z:-.5}],[{x:n+1,y:SETTINGS.yMax+1,z:-.5},{x:n,y:SETTINGS.yMax+.5,z:-.5},{x:n+1,y:SETTINGS.yMax,z:-.5},{x:n+1,y:SETTINGS.yMax+1,z:-.5}]];break;case v.EAST:t=[[{x:n+=.5,y:-1,z:-.5},{x:n+1,y:-.5,z:-.5},{x:n,y:0,z:-.5},{x:n,y:-1,z:-.5}],[{x:n,y:SETTINGS.yMax+1,z:-.5},{x:n+1,y:SETTINGS.yMax+.5,z:-.5},{x:n,y:SETTINGS.yMax,z:-.5},{x:n,y:SETTINGS.yMax+1,z:-.5}]];break;case v.NORTH:t=[[{x:-1,y:r+=.5,z:-.5},{x:-.5,y:r+1,z:-.5},{x:0,y:r,z:-.5},{x:-1,y:r,z:-.5}],[{x:SETTINGS.xMax+1,y:r,z:-.5},{x:SETTINGS.xMax+.5,y:r+1,z:-.5},{x:SETTINGS.xMax,y:r,z:-.5},{x:SETTINGS.xMax+1,y:r,z:-.5}]];break;case v.SOUTH:t=[[{x:-1,y:(r-=.5)+1,z:-.5},{x:-.5,y:r,z:-.5},{x:0,y:r+1,z:-.5},{x:-1,y:r+1,z:-.5}],[{x:SETTINGS.xMax+1,y:r+1,z:-.5},{x:SETTINGS.xMax+.5,y:r,z:-.5},{x:SETTINGS.xMax,y:r+1,z:-.5},{x:SETTINGS.xMax+1,y:r+1,z:-.5}]];break;default:t=[]}return t},this._addLine=function(e,t,a,n){var r,s=new o.c;s.vertices.push(new o.j(t.x,t.y,t.z)),s.vertices.push(new o.j(a.x,a.y,a.z)),r=n?new o.d(s,new o.e({color:6710886})):new o.d(s,SETTINGS.material),e.add(r)},this._getAdjustedPoint=function(e){var t=e.x,a=e.y,n=e.z;return{x:t*SETTINGS.r,y:n*SETTINGS.r+SETTINGS.r/2,z:-a*SETTINGS.r}}},le=function e(){var t=this;Object(c.a)(this,e),this.draw=function(e,a){if(a)for(var n=0;n<SETTINGS.zMax;n+=1)for(var r=0;r<SETTINGS.yMax;r+=1)for(var s=0;s<SETTINGS.xMax;s+=1){var i=a[n][r][s],o={x:s,y:r,z:n};if(i)switch(i.constructor){case G:t.drawCube(e,i,o);break;case k:t.drawRoof(e,i,o);break;case C:t.drawFoliage(e,o);break;case D:t.drawTrunk(e,o)}}},this.drawCube=function(e,a,n){var r=t._getCubeFaces(a),s={x:n.x*SETTINGS.r,y:n.z*SETTINGS.r,z:-n.y*SETTINGS.r};r.position.x=s.x,r.position.y=s.y,r.position.z=s.z,e.add(r)},this._getCubeFaces=function(e){var t=new o.c;return e.surfaces.t===x.SOLID&&t.vertices.push(new o.j(0,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,0)),e.surfaces.b===x.SOLID&&t.vertices.push(new o.j(0,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(0,0,-SETTINGS.r),new o.j(0,0,-SETTINGS.r),new o.j(0,0,0)),e.surfaces.n===x.SOLID&&t.vertices.push(new o.j(0,0,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,0,-SETTINGS.r)),e.surfaces.s===x.SOLID&&t.vertices.push(new o.j(0,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(0,SETTINGS.r,0),new o.j(0,SETTINGS.r,0),new o.j(0,0,0)),e.surfaces.e===x.SOLID&&t.vertices.push(new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,0,0)),e.surfaces.w===x.SOLID&&t.vertices.push(new o.j(0,0,0),new o.j(0,SETTINGS.r,0),new o.j(0,SETTINGS.r,0),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,SETTINGS.r,-SETTINGS.r),new o.j(0,0,-SETTINGS.r),new o.j(0,0,-SETTINGS.r),new o.j(0,0,0)),new o.f(t,SETTINGS.material)},this.drawRoof=function(e,a,n){var r=t._getRoof(a),s={x:n.x*SETTINGS.r,y:n.z*SETTINGS.r,z:-n.y*SETTINGS.r};switch(a.direction){case"n":break;case"e":r.rotation.y=1.5*Math.PI,s.z-=SETTINGS.r;break;case"s":r.rotation.y=Math.PI,s.x+=SETTINGS.r,s.z-=SETTINGS.r;break;case"w":r.rotation.y=.5*Math.PI,s.x+=SETTINGS.r;break;default:return}r.position.x=s.x,r.position.y=s.y,r.position.z=s.z,e.add(r)},this._getRoof=function(e){var t=new o.c;return e.hasSideSurface&&t.vertices.push(new o.j(0,SETTINGS.r,0),new o.j(0,0,0),new o.j(0,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,0,0),new o.j(SETTINGS.r,SETTINGS.r,0)),t.vertices.push(new o.j(0,0,-SETTINGS.r),new o.j(0,SETTINGS.r,0),new o.j(0,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,SETTINGS.r,0),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(SETTINGS.r,0,-SETTINGS.r),new o.j(0,0,-SETTINGS.r)),new o.f(t,SETTINGS.material)},this.drawFoliage=function(e,t){var a=t.x,n=t.y,r=t.z,s=new o.i(SETTINGS.r/2,5,5),i=new o.b(s),c=new o.f(i,SETTINGS.material),l=a*SETTINGS.r,u=r*SETTINGS.r,S=-n*SETTINGS.r;c.position.x=l+SETTINGS.r/2,c.position.y=u+SETTINGS.r/2,c.position.z=S-SETTINGS.r/2,e.add(c)},this.drawTrunk=function(e,a){var n=a.x,r=a.y,s=a.z,i={x:(n+.5)*SETTINGS.r,y:s*SETTINGS.r,z:(-r-.5)*SETTINGS.r},o={x:i.x,y:i.y+SETTINGS.r,z:i.z};t._addLine(e,i,o)},this._addLine=function(e,t,a){var n=new o.c;n.vertices.push(new o.j(t.x,t.y,t.z)),n.vertices.push(new o.j(a.x,a.y,a.z));var r=new o.d(n,SETTINGS.material);e.add(r)}},ue=function e(t,a,n){var r=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:75;Object(c.a)(this,e),this.draw=function(){for(;r.scene.children.length>0;)r.scene.remove(r.scene.children[0]);r.designRenderer3D=new le;var e=r.session.design.getAll();r.designRenderer3D.draw(r.scene,e),r.topoRenderer3D=new ce;var t=r.session.topo.getCorners();r.topoRenderer3D.draw(r.scene,t,r.cameraView)},this.render=function(){r.draw(),r.renderer.render(r.scene,r.camera)},this.setCameraPosition=function(e,t){r.hasPosition=!0;var a=r.getAdjustedPoint(e),n=a.x,s=a.y,i=a.z;r.camera.position.x=n,r.camera.position.y=s,r.camera.position.z=i;var o=r.getAdjustedPoint(t);r.camera.lookAt(o.x,o.y,o.z),r.render()},this.getAdjustedPoint=function(e){var t=e.x,a=e.y,n=e.z;return{x:t*SETTINGS.r+SETTINGS.r/2,y:n*SETTINGS.r+.75*SETTINGS.r,z:-a*SETTINGS.r-SETTINGS.r/2}},this.container=t,this.target=null,this.session=a,this.hasPosition=!1,this.scene=new o.h,this.scene.background=new o.a(0),this.camera=new o.g(s,SETTINGS.w/SETTINGS.h,1,8e3),this.scene.add(this.camera),this.renderer=new o.k({antialias:!0}),this.renderer.setPixelRatio(.6),this.renderer.setSize(SETTINGS.w,SETTINGS.h),this.container.appendChild(this.renderer.domElement),this.cameraView=n,this.draw()},Se=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).wire=function(){var e=a.props,t=e.session,n=e.path,r=e.onWalkthroughEnd;!a.isWired&&t&&n&&(a.isWired=!0,a.controller=new oe(t,r),a.view=new ue(a.container,t),a.controller.addListener(a.view))},a.run=function(e){a.controller.run(e)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.container=document.getElementById("display3D"),this.wire();var e=this.props.path;this.run(e)}},{key:"componentDidUpdate",value:function(){this.wire();var e=this.props.path;this.run(e)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return r.a.createElement("div",{id:"display3D",style:{width:t,height:a}})}}]),t}(r.a.Component),he=a(35);function de(e,t,a){var n=function(e,t){if(t>1&&e.length<2)return e;for(var a=[],n=1;n<e.length;n+=1)for(var r=e[n-1],s=e[n],i=(s.x-r.x)/t,o=(s.y-r.y)/t,c=(s.z-r.z)/t,l=0;l<t;l+=1){var u=r.x+l*i,S=r.y+l*o,h=r.z+l*c;a.push({x:u,y:S,z:h})}return a.push(e[e.length-1]),a}(function(e,t,a){for(var n=new he.Grid(3*SETTINGS.xMax,3*SETTINGS.yMax),r=e.topo.getCorners(),s=0;s<SETTINGS.yMax;s+=1)for(var i=0;i<SETTINGS.xMax;i+=1){var o=Math.floor(i),c=Math.floor(s),l=e.topo.getAt({x:o,y:c}),u=Math.max(r[s][i],r[s][i+1],r[s+1][i],r[s+1][i+1]);if(l!==u){console.log("z comp",l,u);for(var S=!1,h=l;h<u+1;h+=1)e.design.getAt({x:o,y:c,z:h})&&(S=!0);S&&(n.setWalkableAt(3*i,3*s,!1),n.setWalkableAt(3*i+2,3*s,!1),n.setWalkableAt(3*i+2,3*s+2,!1),n.setWalkableAt(3*i,3*s+2,!1),n.setWalkableAt(3*i,3*s+1,!1),n.setWalkableAt(3*i+2,3*s+1,!1),n.setWalkableAt(3*i+1,3*s+2,!1),n.setWalkableAt(3*i+1,3*s,!1))}else{var d=e.design.getAt({x:o,y:c,z:l});d&&(n.setWalkableAt(3*i,3*s,!1),n.setWalkableAt(3*i+2,3*s,!1),n.setWalkableAt(3*i+2,3*s+2,!1),n.setWalkableAt(3*i,3*s+2,!1),"CUBE"===d.constructor.typeName?(d.hasAccessInDirection("w")||n.setWalkableAt(3*i,3*s+1,!1),d.hasAccessInDirection("e")||n.setWalkableAt(3*i+2,3*s+1,!1),d.hasAccessInDirection("n")||n.setWalkableAt(3*i+1,3*s+2,!1),d.hasAccessInDirection("s")||n.setWalkableAt(3*i+1,3*s,!1)):(n.setWalkableAt(3*i,3*s+1,!1),n.setWalkableAt(3*i+2,3*s+1,!1),n.setWalkableAt(3*i+1,3*s+2,!1),n.setWalkableAt(3*i+1,3*s,!1)))}}for(var T=new he.AStarFinder({allowDiagonal:!0,dontCrossCorners:!0}).findPath(3*t.x+1,3*t.y+1,3*a.x+1,3*a.y+1,n),f=[],E=null,p=null,g=0;g<T.length;g+=1){var m=Object(q.a)(T[g],2),v=m[0],w=m[1],A=Math.floor(v/3),y=Math.floor(w/3);A===E&&y===p||(E=A,p=y,f.push({x:E,y:p}))}return f}(e,t,a).map(function(t){var a=t.x,n=t.y;return{x:a,y:n,z:e.topo.getAt({x:a,y:n})}}),3);return function(e,t){for(var a=1;a<e.length-1;a+=1){var n=2*Math.random()*t-t,r=2*Math.random()*t-t,s=e[a];s.xNoise=s.x+n,s.yNoise=s.y+r}}(n,.1),n}var Te=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={hasStart:!1},a.wire=function(){var e=a.props.session;!a.isWired&&e&&(a.isWired=!0,a.view=new $(a.canvas,e),a.view.drawTopCompressedView())},a.handleClick=function(e){var t=a.state.hasStart,n=a.props,r=n.onSelectPath,s=n.session,i=w(e.offsetX,e.offsetY);if(i&&!s.design.getAt({x:i.x,y:i.y,z:0}))if(t){if(a.start.x!==i.x||a.start.y!==i.y){s.monitor.setMessages([]),a.view.drawCircle(i.x,i.y),a.view.update(),a.end=i;var o=de(s,a.start,a.end);if(!o||0===o.length)return a.start=null,a.end=null,a.setState({hasStart:!1}),void r(o,-1);a.view.animateX(o,0,75,function(){a.start=null,a.end=null,a.setState({hasStart:!1});var e=(o.length-1)/3*10;r(o,e)})}}else a.setState({hasStart:!0}),a.view.drawCircle(i.x,i.y),a.view.update(),a.start=i},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.start=null,this.end=null,this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,a=e.h;return r.a.createElement("div",null,r.a.createElement("canvas",{id:"display",width:t,height:a}))}}]),t}(r.a.Component),fe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={path:null,distance:null},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentWillUnmount",value:function(){this.props.session.monitor.setMessages([])}},{key:"render",value:function(){var e=this,t=this.state,a=t.path,n=t.distance,s=this.props.session;return-1===n?s.monitor.setMessages(["".concat(SETTINGS.userName,", No path could be found.")]):n&&s.monitor.setMessages(["".concat(SETTINGS.userName,", I have arrived at the destination point"),"the trip distance (in feet) is ".concat(n,".")]),r.a.createElement("div",null,a?r.a.createElement(Se,{session:s,path:a,onWalkthroughEnd:function(){setTimeout(function(){return e.setState({path:null})},500)}}):r.a.createElement(Te,{session:s,onSelectPath:function(t,a){return e.setState({path:t,distance:a})}}))}}]),t}(r.a.Component),Ee=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(s)))).onMenuClick=function(e){(0,a.props.setAction)(e)},a.getDisplay=function(){var e=a.props,t=e.session,n=e.cameraView,s=e.action,i=e.displayType;if(!t||!s)return null;switch(i){case"DRAW":return r.a.createElement(te,{action:s,session:t,cameraView:n});case"CALC":return r.a.createElement(fe,{session:t});case"TOPO":return r.a.createElement(se,{action:s,session:t});case"SURF":return r.a.createElement(ie,{action:s,session:t,cameraView:n})}return null},a.getActions=function(){return K(a.props.displayType)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"render",value:function(){var e=this.props,t=e.action,a=e.session,n=this.getActions();return r.a.createElement("div",null,r.a.createElement("div",{style:{width:"864px",height:"100%",float:"left"}},r.a.createElement("div",{style:{width:"864px",height:"160px"}},r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement(Z,{session:a,action:t}))),r.a.createElement("div",{style:{width:"852px",height:"852px",padding:"5px"}},this.getDisplay())),r.a.createElement("div",{style:{width:"160px",height:"100%",float:"left"}},r.a.createElement("div",{style:{padding:"20px"}},r.a.createElement(W,{actions:n,onClick:this.onMenuClick,action:t}))))}}]),t}(r.a.Component);var pe=function(e){var t,a=e.displayType;switch(a){case"START":t=r.a.createElement("div",null,r.a.createElement("p",null,"Select START NEW SESSION to create a new project"),r.a.createElement("p",null,"Open a previously saved project by clicking on one of the links."),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"60%"}})),r.a.createElement("br",null),r.a.createElement("p",null,"Press the PANIC button to return to the start page at any time."));break;case"TOPO":t=r.a.createElement("div",null,r.a.createElement("p",null,"Click on the grid to change the elevation of the topography at that location."),r.a.createElement("p",null,"When INCRS HT is selected, clicking on the grid will increase the elevation. When DECRS HT is selected, the elevation will decrease."),r.a.createElement("p",null,"The maximum elevation is 6, and the minimum is 0."),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center",marginTop:"10px",marginBottom:"40px"}},r.a.createElement("img",{src:"./imgs/topoHelp.gif",style:{width:"60%"},alt:"topo help"})),r.a.createElement("p",null,"Press the PANIC button to return to the TOPO page at any time."));break;case"DRAW":t=r.a.createElement("div",null,r.a.createElement("p",null,"The DRAW page allows placing or removing objects (ADD CUBE/TREE/ROOF, DELETE), moving or rotating the view (STEP OUT, STEP  IN, LOOKLEFT, LOOKRGHT), and adding design constraints (SPEAK)."),r.a.createElement("p",null,"Select actions from the text links in the top right. The active link will determine the effect of clicks in the design."),r.a.createElement("p",null,"The design is 7 units high with a topography of 17 by 17 units. A unit represents 10 ft."),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"60%"}})),r.a.createElement("br",null),r.a.createElement("p",null,"Press the PANIC button to return to the DRAW page at any time."));break;case"SURF":t=r.a.createElement("div",null,r.a.createElement("p",null,"The SURF page allows placing or removing surfaces on cubes (SOLIDSRF, NO SRF) and moving or rotating the view (STEP OUT, STEP  IN, LOOKLEFT, LOOKRGHT)."),r.a.createElement("p",null,"Select actions from the text links in the top right. The active link will determine the effect of clicks in the design."),r.a.createElement("p",null,"Surfaces determine access through buildings."),r.a.createElement("p",null,"The design is 7 units high with a topography of 17 by 17 units. A unit represents 10 ft."),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"60%"}})),r.a.createElement("br",null),r.a.createElement("p",null,"Press the PANIC button to return to the SURF page at any time."));break;case"CALC":t=r.a.createElement("div",null,r.a.createElement("p",null,"The CALC page allows the user to calculate circulation through the design and to see a 3D walkthrough."),r.a.createElement("p",null,"First, select a start and end point on the top-down view of the design. Circles will be placed representing the start and end."),r.a.createElement("p",null,"After selection, an X will find its way through the design. Once a path has been calculated, a 3D walkthrough will be rendered."),r.a.createElement("p",null,"The circulation path can only move through open ground or surfaces that have been removed."),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"60%"}})),r.a.createElement("br",null),r.a.createElement("p",null,"Press the PANIC button to return to the CALC page at any time."));break;default:t="Press START to return to the start menu"}return r.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left",padding:"80px"}},r.a.createElement("h3",null,"Help for: ".concat(a," Page")),r.a.createElement("div",null,t))},ge=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={constraints:[],systemConstraints:[],buildings:[],objects:[]},a.getStringsFromConstraints=function(e){var t;return t=0===parseInt(e.type,10)?"room":1===parseInt(e.type,10)?"roof":"structure",'"'.concat(e.text,'":\n').concat(e.fn," ").concat(e.prop," of ").concat(t," ").concat(e.comp," ").concat(e.value," == ").concat(e.result,"\n\n")},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function t(){var a=e.props.session,n=a._monitor.constraints.slice(),r=a._monitor.systemConstraints.slice(),s=a._design._buildings,i=a._design.getObjects();e.setState({constraints:n,systemConstraints:r,buildings:s,objects:i}),e.pollTimeout=setTimeout(t,500)}()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){var e=this,t=this.state,a=t.constraints,n=t.systemConstraints,s=t.buildings;return r.a.createElement("div",null,r.a.createElement("div",null,r.a.createElement("h3",null,"User Constraints:"),r.a.createElement("div",null,a.map(function(t){return r.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),r.a.createElement("div",{style:{marginTop:"20px"}},r.a.createElement("h3",null,"System Constraints:"),r.a.createElement("div",null,n.map(function(t){return r.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),r.a.createElement("div",{style:{marginTop:"20px"}},r.a.createElement("h3",null,"Buildings:"),r.a.createElement("div",null,JSON.stringify(s))))}}]),t}(r.a.Component),me=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).startPoll=function(){var e=a.props,t=e.session,n=e.cameraView;clearTimeout(a.pollTimeout);var r={},s=0,i=0;!function e(){a.pollTimeout=setTimeout(function(){if(t){var o=t.design.getObjects().length,c=t._topo.heights.reduce(function(e,t){return e+t});n.camera===r.camera&&n.slices.x===r.slices.x&&n.slices.y===r.slices.y&&n.slices.z===r.slices.z&&o===s&&c===i||(a.view.render(),r={camera:n.camera,slices:{x:n.slices.x,y:n.slices.y,z:n.slices.z}},s=o,i=c)}e()},100)}()},a.nextRotation=function(){a.location=(a.location+1)%a.origins.length,a.view.setCameraPosition(a.origins[a.location],a.target)},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){this.container=document.getElementById("debuggingDisplay3D");var e=this.props,t=e.session,a=e.cameraView,n=e.size;this.view=new ue(this.container,t,a,20),this.view.renderer.setSize(n-1,n-1),this.target={x:8,y:8,z:0};var r=2*Math.PI/8;this.origins=[];for(var s=0;s<8;s+=1){var i={x:63*Math.cos(s*r+-.5*Math.PI)+8,y:63*Math.sin(s*r+-.5*Math.PI)+8,z:35};this.origins.push(i)}this.location=-1,this.nextRotation()}},{key:"componentWillUnmount",value:function(){this.pollTimeout&&clearTimeout(this.pollTimeout)}},{key:"render",value:function(){return this.startPoll(),r.a.createElement("div",null,r.a.createElement("div",{id:"debuggingDisplay3D",style:{textAlign:"center"}}),r.a.createElement("button",{type:"button",style:{border:"1px solid #E8E8DA",margin:"10px",padding:"4px 10px",color:"#E8E8DA"},onMouseDown:this.nextRotation},"Toggle Rotate"))}}]),t}(r.a.Component),ve=function(){function e(t){var a=this;Object(c.a)(this,e),this.buttonCache={},this.onButtonPress=t,this.eventListener=function(){return a._loop()},window.addEventListener("gamepadconnected",this.eventListener)}return Object(l.a)(e,[{key:"remove",value:function(){window.removeEventListener("gamepadconnected",this.eventListener),this.controlPadTimeout&&clearTimeout(this.controlPadTimeout)}},{key:"_loop",value:function(){var e=this;this.controlPadTimeout&&clearTimeout(this.controlPadTimeout);var t=navigator.getGamepads();t&&t.length>0&&t[0]&&t[0].buttons&&t[0].buttons.forEach(function(t,a){t.pressed&&!e.buttonCache[a]&&e.onButtonPress(a),e.buttonCache[a]=t.pressed}),this.controlPadTimeout=setTimeout(function(){return e._loop()},20)}}]),e}(),we={w:852,h:852,color:"#E8E8DA",gridSize:17,xMax:17,yMax:17,zMax:7,r:50,material:new o.e({color:15263962}),stroke:3.5,clippingMax:1,userName:"Ted"};window.SETTINGS=we;var Ae={action:H.INCREASE_HEIGHT,displayType:"TOPO"},ye=function(){return{camera:0,slices:{x:0,y:8,z:0}}},Ie=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,s=new Array(n),i=0;i<n;i++)s[i]=arguments[i];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(s)))).state={debugView:0,session:null,cameraView:ye(),restartIndex:0,isPanic:!1,displayType:null,action:null,aboutToRestart:!1},a.handleKeyDown=function(e){var t=a.state,n=t.action,r=t.aboutToRestart,s=t.session;if(r)return 89===e.keyCode&&r&&a.restart(),s.monitor.setMessages([]),void a.setState({aboutToRestart:!1});if(n!==H.SPEAK_CONSTRAINT)if(e.keyCode>=48&&e.keyCode<=57)e.keyCode>=49&&e.keyCode<=52?a.handleActions(e.keyCode-49):e.keyCode>=53&&e.keyCode<=56?a.handleActions(e.keyCode-53+16):57===e.keyCode?a.handleActions(4):48===e.keyCode&&a.handleActions(5);else switch(e.keyCode){case 112:a.setState({debugView:0});break;case 113:a.setState({debugView:1});break;case 114:a.setState({debugView:2});break;case 115:a.setState({debugView:3})}},a.handleControlPadButtonPress=function(e){console.log("Control Pad: ".concat(e," pressed"));a.handleActions({1:0,0:1,2:2,3:3,10:16,11:18}[e])},a.startSession=function(e){var t=ye();a.setState(Object(d.a)({session:e,cameraView:t},Ae))},a.restart=function(){var e=a.state.restartIndex,t=a.props.onRestart,n=(new P).newSession();a.setState(Object(d.a)({session:n,cameraView:ye(),restartIndex:e+1,isPanic:!1},Ae)),t()},a.renderDebug=function(){var e=a.state,t=e.session,n=e.cameraView;switch(e.debugView){case 1:return r.a.createElement("div",null,a.renderSessionPage(),r.a.createElement("div",{style:{position:"absolute",right:"20px",top:"20px",color:"#000",border:"1px solid #E8E8DA",width:"500px"}},r.a.createElement(me,{key:"debug3d_".concat(t._id),session:t,cameraView:n,size:500})),r.a.createElement("div",{style:{position:"absolute",left:"20px",top:"20px",width:"500px",wordWrap:"break-word",border:"1px solid #E8E8DA",padding:"10px 10px 40px 10px",fontSize:"16px"}},r.a.createElement(ge,{key:"debug_con_".concat(t._id),session:t})));case 2:return r.a.createElement("div",{style:{width:"100%"}},r.a.createElement(me,{key:"debug3d_".concat(t._id),session:t,cameraView:n,size:962}));case 3:return r.a.createElement(ge,{key:"debug_con_".concat(t._id),session:t});default:return null}},a.renderSessionPage=function(){var e=a.state,t=e.session,n=e.action,s=e.displayType,i=e.cameraView;return r.a.createElement(Ee,{key:"session_".concat(t._id),session:t,action:n,displayType:s,cameraView:i,setAction:function(e){return a.setState({action:e})}})},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",this.handleKeyDown),this.controlPad=new ve(function(t){return e.handleControlPadButtonPress(t)}),this.startSession((new P).newSession())}},{key:"componentDidUpdate",value:function(e,t){var a=this.state,n=a.displayType,r=a.session;if(n!==t.displayType)switch(n){case"TOPO":r.monitor.setMessages(["Click the grid to increase elevation in the topography."]);break;case"DRAW":r.monitor.setMessages(["Click to add a cube."]);break;case"SURF":r.monitor.setMessages(["Click to remove surfaces on cubes to add access."]);break;case"CALC":r.monitor.setMessages(["Select a start and end point for the path."])}}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.controlPad.remove()}},{key:"handleActions",value:function(e){var t=this.state,a=t.session,n=t.isPanic,r=t.displayType;if(console.log("Do action ".concat(e)),17===e)return console.log("procedural -> RESTA."),a.monitor.setMessages(["Are you sure you want to restart (y)?"]),void this.setState({aboutToRestart:!0});if(19===e)return console.log("theraputic -> PANIC"),void this.setState({isPanic:!n});if(this.setState({isPanic:!1}),a){var s=K(r);switch(e){case 16:console.log("graphical -> START"),this.setState({displayType:"START"});break;case 0:console.log("graphical -> TOPO"),this.setState({displayType:"TOPO",action:H.INCREASE_HEIGHT});break;case 1:console.log("graphical -> DRAW"),this.setState({displayType:"DRAW",action:H.ADDCUBE});break;case 2:console.log("graphical -> SURF"),this.setState({displayType:"SURF",action:H.NO_SURFACE});break;case 3:console.log("operational -> circul."),this.setState({displayType:"CALC"});break;case 4:console.log("symbolic -> 0"),s&&s.length>0&&this.setState({action:s[0]});break;case 5:console.log("symbolic -> 1"),s&&s.length>1&&this.setState({action:s[1]});break;case 18:console.log("procedural -> STORE"),a.save(),a.monitor.setMessages(["Session saved."])}}}},{key:"renderContent",value:function(){var e=this.state,t=e.session,a=e.restartIndex,n=e.displayType,s=e.isPanic,i=e.debugView;return s?r.a.createElement(pe,{displayType:n}):null===t||"START"===n?r.a.createElement(V,{key:a,onSelectSession:this.startSession}):0!==i?this.renderDebug():this.renderSessionPage()}},{key:"render",value:function(){return r.a.createElement("div",{className:"app"},this.renderContent())}}]),t}(r.a.Component),be=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.onDismiss;setTimeout(function(){document.addEventListener("keydown",t),document.addEventListener("mousedown",t),e.controlPad=new ve(t)},0)}},{key:"componentWillUnmount",value:function(){var e=this.props.onDismiss;document.removeEventListener("keydown",e),document.removeEventListener("mousedown",e),this.controlPad.remove()}},{key:"render",value:function(){var e=this.props.children;return r.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left",padding:"80px"}},e)}}]),t}(r.a.Component),Ne=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={hasUserName:!1,hasFinishedInstructions:!1},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"setUserName",value:function(e){window.SETTINGS.userName=e,this.setState({hasUserName:!0})}},{key:"renderAskUserName",value:function(){var e=this;return r.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left",padding:"80px"}},r.a.createElement("div",null,"What is your name?"),r.a.createElement(Q,{onSubmit:function(t){return e.setUserName(t)}}))}},{key:"renderInstructions",value:function(){var e=this;return r.a.createElement(be,{onDismiss:function(){return e.setState({hasFinishedInstructions:!0})}},r.a.createElement("div",null,"Welcome ".concat(window.SETTINGS.userName,"! Use URBAN5 to:")),r.a.createElement("br",null),r.a.createElement("ul",null,r.a.createElement("li",null,"define a topography"),r.a.createElement("li",null,"create design constraints"),r.a.createElement("li",null,"add objects"),r.a.createElement("li",null,"edit surfaces"),r.a.createElement("li",null,"calculate circulation")),r.a.createElement("br",null),r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"60%"}})))}},{key:"render",value:function(){var e,t=this.state,a=t.hasUserName,n=t.hasFinishedInstructions,s=this.props.onRestart;return e=a?n?r.a.createElement(Ie,{onRestart:s}):this.renderInstructions():this.renderAskUserName(),r.a.createElement("div",{className:"app"},e)}}]),t}(r.a.Component);var Oe=function(e){function t(){var e,a;Object(c.a)(this,t);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(a=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(r)))).state={isDemo:!0},a.goToDemo=function(){return a.setState({isDemo:!0})},a.handleKeyDown=function(e){27===e.keyCode?a.setState({isDemo:!0}):a.setDemoTimer()},a}return Object(h.a)(t,e),Object(l.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",function(t){return e.handleKeyDown(t)}),document.addEventListener("mousedown",function(){return e.setDemoTimer()}),this.controlPad=new ve(function(){return e.setDemoTimer()})}},{key:"componentWillUnmount",value:function(){var e=this;this.resetTimer&&clearTimeout(this.resetTimer),document.removeEventListener("keydown",function(t){return e.handleKeyDown(t)}),document.removeEventListener("mousedown",function(){return e.setDemoTimer()}),this.controlPad.remove()}},{key:"setDemoTimer",value:function(){this.setState({isDemo:!1}),this.resetTimer&&clearTimeout(this.resetTimer),this.resetTimer=setTimeout(this.goToDemo,6e5)}},{key:"render",value:function(){var e=this,t=this.state.isDemo;return r.a.createElement("div",{className:"app"},t?r.a.createElement("div",{style:{width:"1024px",height:"100%",float:"left",padding:"20px"}},r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("img",{src:"./imgs/long.gif",alt:"Usage Demo",style:{width:"852px"}}))):r.a.createElement(Ne,{onRestart:function(){return e.setState({isDemo:!0})}}))}}]),t}(r.a.Component),xe={w:852,h:852,color:"#E8E8DA",gridSize:17,xMax:17,yMax:17,zMax:7,r:50,material:new o.e({color:15263962}),stroke:3.5,clippingMax:1,userName:"Ted"};window.SETTINGS=xe,i.a.render(r.a.createElement(Oe,null),document.getElementById("root"))}},[[25,2,1]]]);
//# sourceMappingURL=main.4e7d8b1a.chunk.js.map