(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(e,t,r){"use strict";r.d(t,"a",function(){return E});var a=r(10),n=r.n(a);n.a.plugin({words:{"less than":"Comparative","fewer than":"Comparative","more than":"Comparative","greater than":"Comparative",building:"Noun",structure:"Noun",no:"Expression"}});function i(e){var t={};return Object.keys(e).forEach(function(r){e[r].forEach(function(e){t[e]=r})}),t}var s=i({"===":["equals","same"],">":["greater","more","bigger","taller","larger","above","exceeding","over","further","farther"],"<":["fewer","less","smaller","shorter","below","under","lower","beneath"],">=":["minimum","min","littlest","least","smallest"],"<=":["maximum","max","biggest","most","largest","greatest"]}),o=i({area:["area","square footage","sf","space","floor","floorspace","size","expanse","breadth","field"],height:["tall","height","elevation","taller","shorter","ceiling","peak","stature","crest","tip","zenith"],distToAccess:["access","entry","entrance","ingress","path","route","exit","way","door"]}),c=i({Structure:["structure","building","structures","buildings","house","home","domicile","complex","design"],0:["cube","room","area","cubes","rooms","areas","elements"],1:["roof","roofs","rooves","covering","ceiling","gable","crown"],2:["tree","plant","bush","trees","plants","bushes","canopy"]}),u=i({no:["not","none"]}),S=function(e){return!e.has("no")},l=function(e){var t=e.values().numbers(),r=null;if(t.length>0){for(var a=0;!t[a]&&a<t.length-1;)a+=1;r=t[a].toString()}return r},h=function(e){var t=null;return Object.keys(o).forEach(function(r){e.has(r)&&(t=o[r])}),t},T=function(e){var t="0";return Object.keys(c).forEach(function(r){e.has(r)&&(t=c[r])}),t},d=function(e){var t=null;return Object.keys(s).forEach(function(r){e.has(r)&&(t=s[r])}),t},f=function(e,t){var r=null;return e?">"===t||">="===t?r="MIN":"<"===t||"<="===t?r="MAX":"==="===t&&(r="SUM"):">"===t||">="===t?r="MAX":"<"===t||"<="===t?r="MIN":"==="===t&&(r="SUM"),r};function E(e){console.log("Original text: "+e);var t=e.toLowerCase().replace(/[.,-\/#!$%^&*;:{}=\-_`()]/g,"").trim();t=n()(t).normalize().out(),Object.keys(u).forEach(function(e){var r=u[e];t=t.replace(new RegExp("".concat(e," "),"g"),"".concat(r," "))}),console.log("Cleaned text: "+t);var r=n()(t),a=r.out("tags").map(function(e){return"[".concat(e.text,": ").concat(e.tags.join(","),"]")}).join("");console.log("pos: "+a);var i=S(r),s=l(r),o=T(r),c=h(r),E=d(r),p={text:e,result:i,fn:f(i,E),type:o,prop:c,comp:E,value:s};return console.log("Constraint result: \n".concat(JSON.stringify(p))),p}},16:function(e,t,r){e.exports=r(26)},21:function(e,t,r){},23:function(e,t,r){},26:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r.n(a),i=r(13),s=r.n(i),o=(r(21),r(2)),c=r(3),u=r(5),S=r(4),l=r(6),h=(r(23),r(0)),T=function(e){function t(){return Object(o.a)(this,t),Object(u.a)(this,Object(S.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=[],t=this.props,r=t.actions,a=t.onClick,i=t.action;return r&&r.forEach(function(t){e.push(n.a.createElement("button",{type:"button",key:t.label,onClick:function(e){e.preventDefault(),a(t)},style:{display:"block"}},t.label+(t.id===i.id?"_":"")))}),n.a.createElement("div",null,e)}}]),t}(n.a.PureComponent),d=r(15),f={STEPOUT:{id:0,label:"STEP OUT"},STEPIN:{id:1,label:"STEP  IN"},ADDCUBE:{id:2,label:"ADD CUBE"},REMOVE:{id:3,label:"RE  MOVE"},ROTATELT:{id:4,label:"ROTATELT"},ROTATERT:{id:5,label:"ROTATERT"},ADDTREE:{id:6,label:"ADD TREE"},ADD_ROOF_NORTH:{id:7,label:"ADDROOFN"},ADD_ROOF_SOUTH:{id:8,label:"ADDROOFS"},WALKTHRU:{id:9,label:"WALKTHRU"},SPEAK_CONSTRAINT:{id:11,label:"SPEAK"},INCREASE_HEIGHT:{id:12,label:"INCRS HT"},DECREASE_HEIGHT:{id:13,label:"DECRS HT"},SOLID_SURFACE:{id:14,label:"SOLIDSRF"},PARTITION_SURFACE:{id:15,label:"PARTTION"},TRANSPARENT_SURFACE:{id:16,label:"TRANSPNT"},NO_SURFACE:{id:17,label:"NO SRF"},HAS_ACCESS:{id:18,label:"HASACCSS"},NO_ACCESS:{id:19,label:"NO ACCSS"},ADD_ROOF_WEST:{id:20,label:"ADDROOFW"},ADD_ROOF_EAST:{id:21,label:"ADDROOFE"},isAdd:function(e){return[2,6,7,8,20,21].includes(e.id)}},E=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={value:""},r.handleKeyDown=function(e){13===e.keyCode&&r.handleSubmit(),e.keyCode},r.handleChange=function(e){var t=e.target.value;r.setState({value:t})},r.handleSubmit=function(){(0,r.props.onSubmit)(r.state.value),r.setState({value:""})},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.input=document.getElementById("speak"),this.input.addEventListener("keydown",this.handleKeyDown),this.input.focus()}},{key:"componentWillUnmount",value:function(){this.input.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.state.value;return n.a.createElement("div",null,n.a.createElement("input",{type:"text",id:"speak",autoComplete:"off",spellCheck:"false",value:e,onChange:this.handleChange}))}}]),t}(n.a.PureComponent),p=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={textMessages:[]},r.onMessage=function(e){r.setState(function(t){return{textMessages:[].concat(Object(d.a)(t.textMessages),[e])}})},r.componentDidUpdate=function(){r.scrollElement()},r.scrollElement=function(){window.requestAnimationFrame(function(){var e=document.getElementById("topContainer");void 0!==e&&(e.scrollTop=e.scrollHeight+100)})},r.onSpeak=function(e){var t=r.props.session;t.monitor.addConstraint(e);var a=t.monitor.getMessages();r.setState({textMessages:a.slice()})},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.session;!function r(){var a=t.monitor.getMessages();e.setState({textMessages:a}),setTimeout(r,100)}()}},{key:"render",value:function(){var e=this.props.action,t=this.state.textMessages,r=null;e===f.SPEAK_CONSTRAINT&&(r=n.a.createElement(E,{onSubmit:this.onSpeak}));var a=t.map(function(e){return n.a.createElement("div",{className:"mono-text",key:e},e)});return n.a.createElement("div",{id:"topContainer",style:{overflow:"hidden",height:"75px"}},a,r)}}]),t}(n.a.PureComponent),v=r(7),g={NORTH:0,EAST:1,SOUTH:2,WEST:3,TOP:4,BOTTOM:5};function w(e,t,r){return t>=0&&e.length>0&&e[0].length&&t<e[0].length&&r>=0&&r<e.length?e[r][t]:null}function m(e,t,r,a){return e.length>0&&e[0].length&&e[0][0].length&&t>=0&&t<e[0][0].length&&r>=0&&r<e[0].length&&a>=0&&a<e.length?e[a][r][t]:null}function I(e,t){var r=t.x,a=t.y,n=t.z;return{w:m(e,r-1,a,n),n:m(e,r,a+1,n),e:m(e,r+1,a,n),s:m(e,r,a-1,n),t:m(e,r,a,n+1),b:m(e,r,a,n-1)}}function b(e,t,r){return{topLeft:w(e,t-1,r),topRight:w(e,t,r),bottomLeft:w(e,t-1,r-1),bottomRight:w(e,t,r-1)}}function N(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=new Array(e),n=0;n<e;n+=1){a[n]=new Array(t);for(var i=0;i<t;i+=1)a[n][i]=r}return a}function O(e,t,r){for(var a=new Array(r),n=0;n<a.length;n+=1)a[n]=N(t,e,null);return a}var y=r(11),x=function e(t){var r=this;Object(o.a)(this,e),this.draw=function(e){var t,a,n=new v.createjs.Shape;t=1,n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),e.front.forEach(function(e){var r=Object(y.a)(e,2),i=r[0],s=r[1];a=SETTINGS.h-1-i*SETTINGS.r,n.graphics.moveTo(t,a),t+=SETTINGS.r,a=SETTINGS.h-1-s*SETTINGS.r,n.graphics.lineTo(t,a)}),n.graphics.endStroke(),t=1,n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),n.graphics.setStrokeDash([4,8],0),e.back.forEach(function(e){var r=Object(y.a)(e,2),i=r[0],s=r[1];a=SETTINGS.h-1-i*SETTINGS.r,n.graphics.moveTo(t,a),t+=SETTINGS.r,a=SETTINGS.h-1-s*SETTINGS.r,n.graphics.lineTo(t,a)}),n.graphics.endStroke(),r.stage.addChild(n)},this.stage=t},k=Object.freeze({SOLID:0,TRANS:1,PART:2,NONE:3}),G=function e(t){var r=this;Object(o.a)(this,e),this.drawSlice=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r.camera=e;for(var n=0;n<t.length;n+=1)for(var i=t[n],s=0;s<i.length;s+=1){var o=i[s];if(o)switch(o.constructor.name){case"Cube":r.drawCube(o,e,r.stage,s,n,a);break;case"Roof":r.drawRoof(o,e,r.stage,s,n,a);break;case"Foliage":a||r.drawFoliage(e,r.stage,s,n,a);break;case"Trunk":a||r.drawTrunk(e,r.stage,s,n,a)}}},this.drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var a=e[t],n=0;n<a.length;n+=1){var i=new v.createjs.Shape,s=(n+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(s,o,2,-2),r.stage.addChild(i)}},this.drawCircle=function(e,t){var a=new v.createjs.Shape;a.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var n=(e+.5)*SETTINGS.r+1,i=SETTINGS.h-(t+.45)*SETTINGS.r-1;a.graphics.drawCircle(n,i,.4*SETTINGS.r),r.stage.addChild(a)},this.drawCube=function(e,t,a,n,i){var s,o,c,u,S=arguments.length>5&&void 0!==arguments[5]&&arguments[5],l=e.surfaces;switch(t){case g.NORTH:s=l.w===k.SOLID,o=l.t===k.SOLID,c=l.e===k.SOLID,u=l.b===k.SOLID;break;case g.SOUTH:s=l.e===k.SOLID,o=l.t===k.SOLID,c=l.w===k.SOLID,u=l.b===k.SOLID;break;case g.EAST:s=l.n===k.SOLID,o=l.t===k.SOLID,c=l.s===k.SOLID,u=l.b===k.SOLID;break;case g.WEST:s=l.s===k.SOLID,o=l.t===k.SOLID,c=l.n===k.SOLID,u=l.b===k.SOLID;break;case g.TOP:s=l.w===k.SOLID,o=l.n===k.SOLID,c=l.e===k.SOLID,u=l.s===k.SOLID;break;case g.BOTTOM:s=l.w===k.SOLID,o=l.s===k.SOLID,c=l.e===k.SOLID,u=l.n===k.SOLID;break;default:return}r._drawCubeSquare(a,n,i,S,s,o,c,u)},this._drawCubeSquare=function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],s=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],o=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],c=new v.createjs.Shape;c.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var u=t*SETTINGS.r+1,S=SETTINGS.r,l=SETTINGS.h-r*SETTINGS.r-1,h=-SETTINGS.r;a&&c.graphics.setStrokeDash([4,8],0),n&&c.graphics.moveTo(u,l).lineTo(u,l+h),i&&c.graphics.moveTo(u,l+h).lineTo(u+S,l+h),s&&c.graphics.moveTo(u+S,l+h).lineTo(u+S,l),o&&c.graphics.moveTo(u+S,l).lineTo(u,l),e.addChild(c)},this.drawRoof=function(e,t,a,n,i){var s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];switch(t){case g.NORTH:"n"===e.direction||"s"===e.direction?r._drawRoofSquare(a,n,i,s):"w"===e.direction?r._drawRoofSlantLeft(e,a,n,i,s):"e"===e.direction&&r._drawRoofSlantRight(e,a,n,i,s);break;case g.SOUTH:"n"===e.direction||"s"===e.direction?r._drawRoofSquare(a,n,i,s):"e"===e.direction?r._drawRoofSlantLeft(e,a,n,i,s):"w"===e.direction&&r._drawRoofSlantRight(e,a,n,i,s);break;case g.EAST:"e"===e.direction||"w"===e.direction?r._drawRoofSquare(a,n,i,s):"s"===e.direction?r._drawRoofSlantRight(e,a,n,i,s):"n"===e.direction&&r._drawRoofSlantLeft(e,a,n,i,s);break;case g.WEST:"e"===e.direction||"w"===e.direction?r._drawRoofSquare(a,n,i,s):"n"===e.direction?r._drawRoofSlantRight(e,a,n,i,s):"s"===e.direction&&r._drawRoofSlantLeft(e,a,n,i,s);break;case g.TOP:case g.BOTTOM:r._drawRoofSquare(a,n,i,s)}},this._drawRoofSquare=function(e,t,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=new v.createjs.Shape;n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var i=t*SETTINGS.r+1,s=SETTINGS.r,o=SETTINGS.h-r*SETTINGS.r-1,c=-SETTINGS.r;a&&n.graphics.setStrokeDash([3,7],0),n.graphics.drawRect(i,o,s,c),e.addChild(n)},this._drawRoofSlantLeft=function(e,t,r,a){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new v.createjs.Shape;n&&i.graphics.setStrokeDash([4,8],0);var s=r*SETTINGS.r+1,o=SETTINGS.h-a*SETTINGS.r-1;i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),i.graphics.moveTo(s,o),s+=SETTINGS.r,o-=SETTINGS.r,i.graphics.lineTo(s,o),e.hasSideSurface&&(i.graphics.moveTo(s,o),o+=SETTINGS.r,i.graphics.lineTo(s,o)),i.graphics.endStroke(),t.addChild(i)},this._drawRoofSlantRight=function(e,t,r,a){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new v.createjs.Shape;n&&i.graphics.setStrokeDash([4,8],0);var s=r*SETTINGS.r+1,o=SETTINGS.h-(a+1)*SETTINGS.r-1;i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),i.graphics.moveTo(s,o),s+=SETTINGS.r,o+=SETTINGS.r,i.graphics.lineTo(s,o),e.hasSideSurface&&(s-=SETTINGS.r,o-=SETTINGS.r,i.graphics.moveTo(s,o),o+=SETTINGS.r,i.graphics.lineTo(s,o)),i.graphics.endStroke(),t.addChild(i)},this.drawFoliage=function(e,t,r,a){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new v.createjs.Shape;n&&i.graphics.setStrokeDash([SETTINGS.stroke,7],0),i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var s=(r+.5)*SETTINGS.r+1,o=SETTINGS.h-(a+.45)*SETTINGS.r-1;i.graphics.drawCircle(s,o,.4*SETTINGS.r),t.addChild(i)},this.drawTrunk=function(e,t,r,a){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=new v.createjs.Shape;n&&i.graphics.setStrokeDash([4,8],0),i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var s=(r+.5)*SETTINGS.r+1,o=SETTINGS.h-a*SETTINGS.r-1;switch(e){case g.NORTH:case g.SOUTH:case g.WEST:case g.EAST:i.graphics.moveTo(s,o).lineTo(s,o-SETTINGS.r);break;case g.TOP:case g.BOTTOM:break;default:throw new Error("camera ".concat(e," is not recognized!"))}t.addChild(i)},this.stage=t},_=function e(t,r){var a=this;Object(o.a)(this,e),this.draw=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];a.stage.removeAllChildren();var n=a.session.topo.getSlice(e,t);(n&&a.topoRenderer.draw(n),a.drawBackground)&&a.session.design.getBackgroundSlices(e,t).forEach(function(t){return a.designRenderer.drawSlice(e,t,r)});var i=a.session.design.getSlice(e,t);a.designRenderer.drawSlice(e,i),a.designRenderer.drawGridPoints(i),a.stage.update()},this.drawTopCompressedView=function(){a.stage.removeAllChildren();var e=a.session.design.getBackgroundSlices(g.TOP,SETTINGS.zMax);e.reverse();for(var t=N(SETTINGS.xMax,SETTINGS.yMax,null),r=function(r){for(var a=function(a){var n=null;e.forEach(function(e){var t=e[r][a];t&&(n=t)}),t[r][a]=n},n=0;n<SETTINGS.xMax;n+=1)a(n)},n=0;n<SETTINGS.yMax;n+=1)r(n);a.designRenderer.drawSlice(g.TOP,t),a.stage.update()},this.update=function(){a.stage.update()},this.clear=function(){a.stage.removeAllChildren(),a.stage.update()},this._drawTopoSlice=function(e){var t,r=new v.createjs.Shape,n=1;r.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke),e.forEach(function(e){var a=e.startHeight,i=e.endHeight;t=SETTINGS.h-1-a*SETTINGS.r,r.graphics.moveTo(n,t),n+=SETTINGS.r,t=SETTINGS.h-1-i*SETTINGS.r,r.graphics.lineTo(n,t)}),r.graphics.endStroke(),a.stage.addChild(r)},this._drawSlice=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];a.camera=e;for(var n=0;n<t.length;n+=1)for(var i=t[n],s=0;s<i.length;s+=1){var o=i[s];o&&o.draw2D(e,a.stage,s,n,r)}},this._drawGridPoints=function(e){for(var t=0;t<e.length;t+=1)for(var r=e[t],n=0;n<r.length;n+=1){var i=new v.createjs.Shape,s=(n+.5)*SETTINGS.r,o=SETTINGS.h-(t+.5)*SETTINGS.r;i.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke-1).drawRect(s,o,2,-2),a.stage.addChild(i)}},this.drawCircle=function(e,t){var r=new v.createjs.Shape;r.graphics.beginStroke(SETTINGS.color).setStrokeStyle(SETTINGS.stroke);var n=(e+.5)*SETTINGS.r+1,i=SETTINGS.h-(t+.45)*SETTINGS.r-1;r.graphics.drawCircle(n,i,.4*SETTINGS.r),a.stage.addChild(r)},this.session=r,this.stage=new v.createjs.Stage(t),this.designRenderer=new G(this.stage),this.topoRenderer=new x(this.stage),this.drawBackground=!0},C={CUBE:0,ROOF:1,TRUNK:2,FOLIAGE:3,PERSON:4},j=function e(t,r){var a=this;Object(o.a)(this,e),this.addListener=function(e){return a.views.push(e)},this.removeListener=function(e){return a.views.filter(function(t){return t!==e})},this.doAction=function(e,t,r,n){var i=a.getRelativePosition(t,r);switch(e){case f.STEPOUT:a.previousSlice();break;case f.STEPIN:a.nextSlice();break;case f.ADDCUBE:a.addObject(i,C.CUBE);break;case f.REMOVE:a.removeObject(i);break;case f.ROTATELT:a.rotateLeft();break;case f.ADDTREE:a.addObject(i,C.TRUNK);break;case f.ADD_ROOF_EAST:a.addObject(i,C.ROOF,"e");break;case f.ADD_ROOF_WEST:a.addObject(i,C.ROOF,"w");break;case f.ADD_ROOF_NORTH:a.addObject(i,C.ROOF,"n");break;case f.ADD_ROOF_SOUTH:a.addObject(i,C.ROOF,"s");break;case f.EDITTOPO:a.setTopoHeight(i);break;case f.NO_SURFACE:a.setSurface(a.cameraView.camera,i,n,k.NONE);break;case f.SOLID_SURFACE:a.setSurface(a.cameraView.camera,i,n,k.SOLID);break;case f.TRANSPARENT_SURFACE:a.setSurface(a.cameraView.camera,i,n,k.TRANS);break;case f.PARTITION_SURFACE:a.setSurface(a.cameraView.camera,i,n,k.PART)}},this.addObject=function(e,t,r){e&&(a.session.design.add(t,e,r),a.updateViews())},this.removeObject=function(e){e&&(a.session.design.remove(e),a.updateViews())},this.setSurface=function(e,t,r,n){t&&(a.session.design.setSurface(e,t,r,n),a.updateViews())},this.nextSlice=function(){switch(a.cameraView.camera){case g.NORTH:a._setSliceYAxis(a.cameraView.slices.y+1);break;case g.SOUTH:a._setSliceYAxis(a.cameraView.slices.y-1);break;case g.EAST:a._setSliceXAxis(a.cameraView.slices.x+1);break;case g.WEST:a._setSliceXAxis(a.cameraView.slices.x-1);break;case g.TOP:a._setSliceZAxis(a.cameraView.slices.z-1);break;case g.BOTTOM:a._setSliceZAxis(a.cameraView.slices.z+1);break;default:throw new Error("camera ".concat(a.cameraView.camera," is not recognized!"))}},this.previousSlice=function(){switch(a.cameraView.camera){case g.NORTH:a._setSliceYAxis(a.cameraView.slices.y-1);break;case g.SOUTH:a._setSliceYAxis(a.cameraView.slices.y+1);break;case g.EAST:a._setSliceXAxis(a.cameraView.slices.x-1);break;case g.WEST:a._setSliceXAxis(a.cameraView.slices.x+1);break;case g.TOP:a._setSliceZAxis(a.cameraView.slices.z+1);break;case g.BOTTOM:a._setSliceZAxis(a.cameraView.slices.z-1);break;default:throw new Error("camera ".concat(a.cameraView.camera," is not recognized!"))}},this.north=function(){return a._setCamera("NORTH")},this.south=function(){return a._setCamera("SOUTH")},this.east=function(){return a._setCamera("EAST")},this.west=function(){return a._setCamera("WEST")},this.top=function(){return a._setCamera("TOP")},this.bottom=function(){return a._setCamera("BOTTOM")},this.rotateLeft=function(){switch(a.cameraView.camera){case g.NORTH:a._setCamera("EAST");break;case g.EAST:a._setCamera("SOUTH");break;case g.SOUTH:a._setCamera("WEST");break;case g.WEST:a._setCamera("NORTH")}},this.rotateRight=function(){switch(a.cameraView.camera){case g.NORTH:a._setCamera("WEST");break;case g.WEST:a._setCamera("SOUTH");break;case g.SOUTH:a._setCamera("EAST");break;case g.EAST:a._setCamera("NORTH")}},this._setSliceZAxis=function(e){e>=0&&e<a.zMax&&(a.cameraView.slices.z=e,a.updateViews())},this._setSliceXAxis=function(e){e>=0&&e<a.xMax&&(a.cameraView.slices.x=e,a.updateViews())},this._setSliceYAxis=function(e){e>=0&&e<a.yMax&&(a.cameraView.slices.y=e,a.updateViews())},this._setCamera=function(e){a.cameraView.camera=g[e],a.updateViews()},this.updateViews=function(){var e;switch(a.cameraView.camera){case g.NORTH:case g.SOUTH:e=a.cameraView.slices.y;break;case g.EAST:case g.WEST:e=a.cameraView.slices.x;break;case g.TOP:case g.BOTTOM:e=a.cameraView.slices.z;break;default:throw new Error("camera ".concat(a.cameraView.camera," is not recognized!"))}a.views.forEach(function(t){return t.draw(a.cameraView.camera,e,a.isBackgroundDashed)})},this.getRelativePosition=function(e,t){switch(a.cameraView.camera){case g.NORTH:case g.SOUTH:case g.EAST:case g.WEST:if(t>=a.zMax)return null}switch(a.cameraView.camera){case g.NORTH:return{x:e,y:a.cameraView.slices.y,z:t};case g.SOUTH:return{x:a.gridSize-1-e,y:a.cameraView.slices.y,z:t};case g.EAST:return{x:a.cameraView.slices.x,y:a.gridSize-1-e,z:t};case g.WEST:return{x:a.cameraView.slices.x,y:e,z:t};case g.BOTTOM:return{x:e,y:a.gridSize-1-t,z:a.cameraView.slices.z};case g.TOP:return{x:e,y:t,z:a.cameraView.slices.z};default:throw new Error("camera ".concat(a.cameraView.camera," is not recognized!"))}},this.session=t,this.gridSize=SETTINGS.gridSize,this.xMax=SETTINGS.xMax,this.yMax=SETTINGS.yMax,this.zMax=SETTINGS.zMax,this.cameraView=r,this.views=[],this.isBackgroundDashed=!0,this.updateViews()};function A(e,t){var r=SETTINGS,a=r.w,n=r.h;return 0===e||e===a-1||0===t||t===n-1?null:function(e,t){var r=SETTINGS.gridSize;return{x:Math.floor(e*r),y:r-1-Math.floor(t*r)}}((e-1)/a,(t-1)/n)}var D=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={controller:null},r.wire=function(){var e=r.props,t=e.session,a=e.cameraView;if(!r.isWired&&t){r.isWired=!0;var n=new j(t,a);r.view=new _(r.canvas,t),n.addListener(r.view),n.updateViews(),r.setState({controller:n})}},r.handleKeyDown=function(e){var t=r.state.controller;if(r.props.action!==f.SPEAK_CONSTRAINT)switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 67:t.bottom();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},r.handleClick=function(e){var t=r.state.controller,a=r.props.action;console.log(a);var n=A(e.offsetX,e.offsetY);n&&t.doAction(a,n.x,n.y)},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("draw"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,r=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"draw",width:t,height:r}))}}]),t}(n.a.Component),R=function e(t){var r=this;Object(o.a)(this,e),this.drawSquare=function(e,t,a){var n=new v.createjs.Shape;n.graphics.beginStroke(SETTINGS.color).setStrokeStyle(1);var i=e*SETTINGS.r+1,s=SETTINGS.r,o=SETTINGS.h-t*SETTINGS.r-1,c=-SETTINGS.r;n.graphics.drawRect(i,o,s,c),r.stage.addChild(n);var u=new v.createjs.Text(a,"bold 17px Andale Mono",SETTINGS.color);u.x=i+s/2-5,u.y=o+c/2-6,r.stage.addChild(u)},this.stage=t},z=function e(t,r){var a=this;Object(o.a)(this,e),this.draw=function(){a.stage.removeAllChildren();for(var e=0;e<SETTINGS.yMax;e+=1)for(var t=0;t<SETTINGS.xMax;t+=1)a.renderer.drawSquare(t,e,a.session.topo.getAt({x:t,y:e}));a.stage.update()},this.session=r,this.stage=new v.createjs.Stage(t),this.renderer=new R(this.stage)},M=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).wire=function(){var e=r.props.session;!r.isWired&&e&&(r.isWired=!0,r.view=new z(r.canvas,e),r.view.draw())},r.handleClick=function(e){var t=r.props,a=t.session,n=t.action,i=A(e.offsetX,e.offsetY);i&&(n===f.DECREASE_HEIGHT?a.topo.decrease(i):a.topo.increase(i),r.view.draw())},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,r=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"display",width:t,height:r}))}}]),t}(n.a.Component),L=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={controller:null},r.wire=function(){var e=r.props,t=e.session,a=e.cameraView;if(!r.isWired&&t){r.isWired=!0;var n=new j(t,a);r.view=new _(r.canvas,t),n.addListener(r.view),n.updateViews(),r.setState({controller:n})}},r.handleKeyDown=function(e){var t=r.state.controller;switch(e.keyCode){case 87:t.south();break;case 88:t.north();break;case 65:t.east();break;case 68:t.west();break;case 83:t.top();break;case 67:t.bottom();break;case 38:t.nextSlice();break;case 40:t.previousSlice()}},r.handleClick=function(e){var t=r.state.controller,a=r.props.action,n=function(e,t){var r=SETTINGS,a=r.w,n=r.h,i=r.gridSize;if(0===e||e===a-1||0===t||t===n-1)return null;var s,o=(t-1)/n,c=(e-1)/a*i,u=Math.floor(c),S=c-u,l=i-o*i,h=Math.floor(l),T=l-h,d=1-T,f=T,E=S,p=1-S,v=Math.min(d,f,E,p);return d===v?s="t":f===v?s="b":E===v?s="l":p===v&&(s="r"),{x:u,y:h,side:s}}(e.offsetX,e.offsetY);if(n){var i=n.x,s=n.y,o=n.side;t.doAction(a,i,s,o)}},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("surface"),document.addEventListener("keydown",this.handleKeyDown),this.canvas.addEventListener("click",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown),this.canvas.removeEventListener("click",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,r=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"surface",width:t,height:r}))}}]),t}(n.a.Component),U=function e(t,r){var a=this;Object(o.a)(this,e),this.addListener=function(e){return a.views.push(e)},this.removeListener=function(e){return a.views.filter(function(t){return t!==e})},this.run=function(e){a.path=e,a.i=0,setTimeout(function(){return a.animateCameraPath()},500)},this.animateCameraPath=function(){if(a.i<a.path.length-2){a.i+=1;var e=a.path[a.i],t=a.path[a.i+1];a.views.forEach(function(r){return r.setCameraPosition(e,t)}),setTimeout(function(){return a.animateCameraPath()},300)}else a.onWalkthroughEnd()},this.session=t,this.views=[],this.onWalkthroughEnd=r},V=function e(){var t=this;Object(o.a)(this,e),this.draw=function(e,r,a){if(r)for(var n=N(SETTINGS.xMax+1,SETTINGS.yMax+1,null),i=0;i<=SETTINGS.yMax;i+=1)for(var s=0;s<=SETTINGS.xMax;s+=1){var o={x:s,y:i,z:r[i][s]-.5},c=t._getAdjustedPoint(o);c.z-=.5,n[i][s]=c;var u=!1;if(a&&(a.camera===g.NORTH||a.camera===g.SOUTH?a.slices.y===i-1&&(u=!0):a.camera!==g.WEST&&a.camera!==g.EAST||a.slices.x===s-1&&(u=!0)),i>0){var S=n[i-1][s];t._addLine(e,c,S,u)}if(s>0){var l=n[i][s-1];t._addLine(e,c,l,u)}}},this._addLine=function(e,t,r,a){var n,i=new h.c;i.vertices.push(new h.j(t.x,t.y,t.z)),i.vertices.push(new h.j(r.x,r.y,r.z)),n=a?new h.d(i,new h.e({color:60928})):new h.d(i,SETTINGS.material),e.add(n)},this._getAdjustedPoint=function(e){var t=e.x,r=e.y,a=e.z;return{x:t*SETTINGS.r,y:a*SETTINGS.r+SETTINGS.r/2,z:-r*SETTINGS.r}}},P=function e(){var t=this;Object(o.a)(this,e),this.draw=function(e,r){if(r)for(var a=0;a<SETTINGS.zMax;a+=1)for(var n=0;n<SETTINGS.yMax;n+=1)for(var i=0;i<SETTINGS.xMax;i+=1){var s=r[a][n][i],o={x:i,y:n,z:a};if(s)switch(s.constructor.name){case"Cube":t.drawCube(e,s,o);break;case"Roof":t.drawRoof(e,s,o);break;case"Foliage":t.drawFoliage(e,o);break;case"Trunk":t.drawTrunk(e,o)}}},this.drawCube=function(e,r,a){var n=t._getCubeFaces(r),i={x:a.x*SETTINGS.r,y:a.z*SETTINGS.r,z:-a.y*SETTINGS.r};n.position.x=i.x,n.position.y=i.y,n.position.z=i.z,e.add(n)},this._getCubeFaces=function(e){var t=new h.c;return e.surfaces.t===k.SOLID&&t.vertices.push(new h.j(0,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,0)),e.surfaces.b===k.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,0)),e.surfaces.n===k.SOLID&&t.vertices.push(new h.j(0,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,0,-SETTINGS.r)),e.surfaces.s===k.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,0,0)),e.surfaces.e===k.SOLID&&t.vertices.push(new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,SETTINGS.r,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,0)),e.surfaces.w===k.SOLID&&t.vertices.push(new h.j(0,0,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,SETTINGS.r,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r),new h.j(0,0,0)),new h.f(t,SETTINGS.material)},this.drawRoof=function(e,r,a){var n=t._getRoof(r),i={x:a.x*SETTINGS.r,y:a.z*SETTINGS.r,z:-a.y*SETTINGS.r};switch(r.direction){case"n":break;case"e":n.rotation.y=1.5*Math.PI,i.z-=SETTINGS.r;break;case"s":n.rotation.y=Math.PI,i.x+=SETTINGS.r,i.z-=SETTINGS.r;break;case"w":n.rotation.y=.5*Math.PI,i.x+=SETTINGS.r;break;default:return}n.position.x=i.x,n.position.y=i.y,n.position.z=i.z,e.add(n)},this._getRoof=function(e){var t=new h.c;return e.hasSideSurface&&t.vertices.push(new h.j(0,SETTINGS.r,0),new h.j(0,0,0),new h.j(0,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,0,0),new h.j(SETTINGS.r,SETTINGS.r,0)),t.vertices.push(new h.j(0,0,-SETTINGS.r),new h.j(0,SETTINGS.r,0),new h.j(0,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,SETTINGS.r,0),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(SETTINGS.r,0,-SETTINGS.r),new h.j(0,0,-SETTINGS.r)),new h.f(t,SETTINGS.material)},this.drawFoliage=function(e,t){var r=t.x,a=t.y,n=t.z,i=new h.i(SETTINGS.r/2,5,5),s=new h.b(i),o=new h.f(s,SETTINGS.material),c=r*SETTINGS.r,u=n*SETTINGS.r,S=-a*SETTINGS.r;o.position.x=c+SETTINGS.r/2,o.position.y=u+SETTINGS.r/2,o.position.z=S-SETTINGS.r/2,e.add(o)},this.drawTrunk=function(e,r){var a=r.x,n=r.y,i=r.z,s={x:(a+.5)*SETTINGS.r,y:i*SETTINGS.r,z:(-n-.5)*SETTINGS.r},o={x:s.x,y:s.y+SETTINGS.r,z:s.z};t._addLine(e,s,o)},this._addLine=function(e,t,r){var a=new h.c;a.vertices.push(new h.j(t.x,t.y,t.z)),a.vertices.push(new h.j(r.x,r.y,r.z));var n=new h.d(a,SETTINGS.material);e.add(n)}},H=function e(t,r,a){var n=this;Object(o.a)(this,e),this.draw=function(){for(;n.scene.children.length>0;)n.scene.remove(n.scene.children[0]);n.designRenderer3D=new P;var e=n.session.design.getAll();n.designRenderer3D.draw(n.scene,e),n.topoRenderer3D=new V;var t=n.session.topo.getCorners();n.topoRenderer3D.draw(n.scene,t,n.cameraView)},this.render=function(){n.draw(),n.renderer.render(n.scene,n.camera)},this.setCameraPosition=function(e,t){n.hasPosition=!0;var r=n.getAdjustedPoint(e),a=r.x,i=r.y,s=r.z;n.camera.position.x=a,n.camera.position.y=i,n.camera.position.z=s;var o=n.getAdjustedPoint(t);n.camera.lookAt(o.x,o.y,o.z),n.render()},this.getAdjustedPoint=function(e){var t=e.x,r=e.y,a=e.z;return{x:t*SETTINGS.r,y:a*SETTINGS.r+SETTINGS.r/2,z:-r*SETTINGS.r}},this.container=t,this.target=null,this.session=r,this.hasPosition=!1,this.scene=new h.h,this.scene.background=new h.a(0),this.camera=new h.g(75,SETTINGS.w/SETTINGS.h,1,2e3),this.scene.add(this.camera),this.renderer=new h.k({antialias:!0}),this.renderer.setPixelRatio(.6),this.renderer.setSize(SETTINGS.w,SETTINGS.h),this.container.appendChild(this.renderer.domElement),this.cameraView=a,this.draw()},B=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).wire=function(){var e=r.props,t=e.session,a=e.path,n=e.onWalkthroughEnd;!r.isWired&&t&&a&&(r.isWired=!0,r.controller=new U(t,n),r.view=new H(r.container,t),r.controller.addListener(r.view))},r.run=function(e){r.controller.run(e)},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.container=document.getElementById("display3D"),this.wire();var e=this.props.path;this.run(e)}},{key:"componentDidUpdate",value:function(){this.wire();var e=this.props.path;this.run(e)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,r=e.h;return n.a.createElement("div",{id:"display3D",style:{width:t,height:r}})}}]),t}(n.a.Component),W=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={hasStart:!1},r.wire=function(){var e=r.props.session;!r.isWired&&e&&(r.isWired=!0,r.view=new _(r.canvas,e),r.view.drawTopCompressedView())},r.handleClick=function(e){var t=r.state.hasStart,a=r.props,n=a.onSelectStart,i=a.onSelectEnd,s=A(e.offsetX,e.offsetY);s&&(t?(r.view.drawCircle(s.x,s.y),r.view.update(),setTimeout(function(){i(s)},1e3)):(n(s),r.setState({hasStart:!0}),r.view.drawCircle(s.x,s.y),r.view.update()))},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this.isWired=!1,this.canvas=document.getElementById("display"),this.canvas.addEventListener("mousedown",this.handleClick),this.wire()}},{key:"componentDidUpdate",value:function(){this.wire()}},{key:"componentWillUnmount",value:function(){this.canvas.removeEventListener("mousedown",this.handleClick)}},{key:"render",value:function(){var e=SETTINGS,t=e.w,r=e.h;return n.a.createElement("div",null,n.a.createElement("canvas",{id:"display",width:t,height:r}))}}]),t}(n.a.Component),F=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={path:null,start:null},r.doWalkthrough=function(e){var t=r.props.session,a=r.state.start,n=r.calculatePath(a,e,t);r.setState({path:n})},r.calculatePath=function(e,t){for(var r=(t.x-e.x)/15,a=(t.y-e.y)/15,n=[],i=0;i<15;i+=1)n.push({x:e.x+i*r,y:e.y+i*a,z:0});return n},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.state.path,r=this.props.session;return n.a.createElement("div",null,t?n.a.createElement(B,{session:r,path:t,onWalkthroughEnd:function(){return e.setState({path:null})}}):n.a.createElement(W,{session:r,onSelectStart:function(t){return e.setState({start:t})},onSelectEnd:function(t){return e.doWalkthrough(t)}}))}}]),t}(n.a.Component),K=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,i=new Array(a),s=0;s<a;s++)i[s]=arguments[s];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(i)))).state={action:f.ADDCUBE,displayType:"DRAW"},r.onMenuClick=function(e){r.setState({action:e})},r.handleKeyDown=function(e){var t=r.state.action,a=r.props.session;if(t===f.SPEAK_CONSTRAINT);else switch(console.log(e.keyCode),e.keyCode){case 66:r.setState({displayType:"DRAW",action:f.ADDCUBE});break;case 86:r.setState({displayType:"CALC"});break;case 67:r.setState({displayType:"TOPO",action:f.INCREASE_HEIGHT});break;case 78:r.setState({displayType:"SURF",action:f.NO_SURFACE});break;case 191:a.monitor.clearConstraints();break;case 220:a.clear(),location.reload()}},r.getDisplay=function(){var e=r.state,t=e.action,a=e.displayType,i=r.props,s=i.session,o=i.cameraView;if(!s||!t)return null;switch(a){case"DRAW":return n.a.createElement(D,{action:t,session:s,cameraView:o});case"CALC":return n.a.createElement(F,{session:s});case"TOPO":return n.a.createElement(M,{action:t,session:s});case"SURF":return n.a.createElement(L,{action:t,session:s,cameraView:o})}return null},r.getActions=function(){switch(r.state.displayType){case"DRAW":return[f.ADDCUBE,f.ADDTREE,f.ADD_ROOF_EAST,f.ADD_ROOF_WEST,f.ADD_ROOF_NORTH,f.ADD_ROOF_SOUTH,f.REMOVE,f.SPEAK_CONSTRAINT];case"CALC":return[];case"TOPO":return[f.INCREASE_HEIGHT,f.DECREASE_HEIGHT];case"SURF":return[f.SOLID_SURFACE,f.NO_SURFACE]}return[]},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"render",value:function(){var e=this.state.action,t=this.getActions(),r=this.props.session;return n.a.createElement("div",null,n.a.createElement("div",{style:{width:"864px",height:"100%",float:"left"}},n.a.createElement("div",{style:{width:"864px",height:"160px"}},n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement(p,{session:r,action:e}))),n.a.createElement("div",{style:{width:"852px",height:"852px",padding:"5px"}},this.getDisplay())),n.a.createElement("div",{style:{width:"160px",height:"100%",float:"left"}},n.a.createElement("div",{style:{padding:"20px"}},n.a.createElement(T,{actions:t,onClick:this.onMenuClick,action:e}))))}}]),t}(n.a.Component),X=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={constraints:[],systemConstraints:[],buildings:[],objects:[]},r.getStringsFromConstraints=function(e){var t;return t=0===parseInt(e.type)?"room":1===parseInt(e.type)?"roof":"structure",'"'.concat(e.text,'":\n').concat(e.fn," ").concat(e.prop," of ").concat(t," ").concat(e.comp," ").concat(e.value," == ").concat(e.result,"\n\n")},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;!function t(){var r=e.props.session,a=r._monitor.constraints.slice(),n=r._monitor.systemConstraints.slice(),i=r._design._buildings,s=r._design.getObjects();e.setState({constraints:a,systemConstraints:n,buildings:i,objects:s}),setTimeout(t,500)}()}},{key:"render",value:function(){var e=this,t=this.state,r=t.constraints,a=t.systemConstraints,i=t.buildings;return n.a.createElement("div",{style:{position:"absolute",left:"20px",top:"20px",width:"500px",wordWrap:"break-word",border:"1px solid #E8E8DA",padding:"10px 10px 40px 10px",fontSize:"16px"}},n.a.createElement("div",null,n.a.createElement("h3",null,"User Constraints:"),n.a.createElement("div",null,r.map(function(t){return n.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),n.a.createElement("div",{style:{marginTop:"20px"}},n.a.createElement("h3",null,"System Constraints:"),n.a.createElement("div",null,a.map(function(t){return n.a.createElement("div",{key:t.text,style:{whiteSpace:"pre"}},e.getStringsFromConstraints(t))}))),n.a.createElement("div",{style:{marginTop:"20px"}},n.a.createElement("h3",null,"Buildings:"),n.a.createElement("div",null,JSON.stringify(i))))}}]),t}(n.a.Component),q=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).size=500,r.nextRotation=function(){r.location=(r.location+1)%r.origins.length,r.view.setCameraPosition(r.origins[r.location],r.target)},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.container=document.getElementById("debuggingDisplay3D");var t=this.props,r=t.session,a=t.cameraView;this.view=new H(this.container,r,a),this.view.renderer.setSize(this.size-1,this.size-1),this.target={x:8,y:8,z:0};this.origins=[{x:-3,y:-3,z:6},{x:8,y:-10,z:6},{x:20,y:-3,z:6},{x:28,y:8,z:6},{x:20,y:20,z:6},{x:8,y:28,z:6},{x:-3,y:20,z:6},{x:-8,y:8,z:6}],this.location=-1,this.nextRotation();var n={},i=0,s=0;!function t(){setTimeout(function(){var o=r._design._objects.length,c=r._topo.heights.reduce(function(e,t){return e+t});a.camera===n.camera&&a.slices.x===n.slices.x&&a.slices.y===n.slices.y&&o===i&&c===s||(e.view.render(),n={camera:a.camera,slices:{x:a.slices.x,y:a.slices.y,z:a.slices.z}},i=o,s=c),t()},100)}()}},{key:"render",value:function(){return n.a.createElement("div",{style:{position:"absolute",right:"20px",top:"20px",color:"#000",border:"1px solid #E8E8DA",width:this.size+"px"}},n.a.createElement("div",{id:"debuggingDisplay3D",style:{width:this.size+"px",height:this.size+"px"}}),n.a.createElement("button",{style:{border:"1px solid #E8E8DA",margin:"10px",padding:"4px 10px",color:"#E8E8DA"},onMouseDown:this.nextRotation},"Toggle Rotate"))}}]),t}(n.a.Component),J=r(9),Y=function e(){var t=this;Object(o.a)(this,e),this.getMessages=function(){return t.messages},this.addConstraint=function(e){var r=J.a.create(e);if(t.messages.push(e),r&&"Constraint"===r.constructor.name){var a=[];return t.constraints.forEach(function(e){e.isSameType(r)||a.push(e)}),a.push(r),t.constraints=a,t.messages.push("I have understood."),!0}return t.messages.push("I am sorry I do not understand."),!1},this.clearConstraints=function(){t.constraints=[],t.messages.push("Cleared constraints")},this.checkDesign=function(e){var r=t.checkConflicts(e),a=t.checkIncompatibilities(e),n=[];r.length>3?n.push("Don't you think you should stop, Ted?"):r.length>2?n.push("Ted, many conflicts are occurring."):r.length>0?n.push("Ted, a conflict has occurred, you said: ".concat(r[0].constraint.text,". The present status is ").concat(r[0].value,".")):0===r.length&&t.conflicts.length>0&&n.push("Conflicts were resolved."),a.length>0?n.push("Not structurally possible at this time."):0===a.length&&t.incompatibilities.length>0&&n.push("Incompatibilities were resolved."),console.log("Messages: [".concat(n.join(","),"]")),t.messages=n,t.conflicts=r,t.incompatibilities=a},this.checkConflicts=function(e){var r=[];return t.constraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated constraint!"),r.push({constraint:t,value:t.isViolated(e).value}))}),r},this.checkIncompatibilities=function(e){var r=[];return t.systemConstraints.forEach(function(t){t.isViolated(e).result&&(console.log("violated system constraint!"),r.push({constraint:t,value:t.isViolated(e).value}))}),r},this.constraints=[],this.systemConstraints=[new J.a({text:"no building below ground",result:!1,fn:"MIN",type:"Structure",prop:"ground",comp:"<",value:"0"}),new J.a({text:"no roof without base",result:!1,fn:"SUM",type:1,prop:"noBase",comp:">",value:"0"}),new J.a({text:"no building floating",result:!1,fn:"SUM",type:"Structure",prop:"floating",comp:">",value:"0"})],this.conflicts=[],this.incompatibilities=[],this.messages=[]};Y.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},Y.thaw=function(e){var t=e.constraints,r=e.conflicts,a=e.incompatibilities,n=e.messages,i=new Y;return i.constraints=t.map(function(e){return new J.a(e)}),i.conflicts=r,i.incompatibilities=a,i.messages=n,i};var Z=Y,$=r(8),Q=r.n($),ee=function e(t){var r=this;if(Object(o.a)(this,e),this.hookAfterInsert=function(e){var t=e.n,a=e.e,n=e.s,i=e.w,s=e.t;t&&"Cube"===t.constructor.name&&(r.surfaces.n=k.NONE,t.surfaces.s=k.NONE),a&&"Cube"===a.constructor.name&&(r.surfaces.e=k.NONE,a.surfaces.w=k.NONE),n&&"Cube"===n.constructor.name&&(r.surfaces.s=k.NONE,n.surfaces.n=k.NONE),i&&"Cube"===i.constructor.name&&(r.surfaces.w=k.NONE,i.surfaces.e=k.NONE),s&&"Roof"===s.constructor.name&&(r.surfaces.t=k.NONE),t&&"Roof"===t.constructor.name&&"n"===t.direction&&(r.surfaces.n=k.NONE,t.hasSideSurface=!1),a&&"Roof"===a.constructor.name&&"e"===a.direction&&(r.surfaces.e=k.NONE,a.hasSideSurface=!1),n&&"Roof"===n.constructor.name&&"s"===n.direction&&(r.surfaces.s=k.NONE,n.hasSideSurface=!1),i&&"Roof"===i.constructor.name&&"w"===i.direction&&(r.surfaces.w=k.NONE,i.hasSideSurface=!1)},this.hookBeforeRemove=function(e){var t=e.n,r=e.e,a=e.s,n=e.w,i=e.t;t&&"Cube"===t.constructor.name&&(t.surfaces.s=k.SOLID),r&&"Cube"===r.constructor.name&&(r.surfaces.w=k.SOLID),a&&"Cube"===a.constructor.name&&(a.surfaces.n=k.SOLID),n&&"Cube"===n.constructor.name&&(n.surfaces.e=k.SOLID),i&&"Cube"===i.constructor.name&&(i.surfaces.b=k.SOLID),t&&"Roof"===t.constructor.name&&"n"===t.direction&&(t.hasSideSurface=!0),r&&"Roof"===r.constructor.name&&"e"===r.direction&&(r.hasSideSurface=!0),a&&"Roof"===a.constructor.name&&"s"===a.direction&&(a.hasSideSurface=!0),n&&"Roof"===n.constructor.name&&"w"===n.direction&&(n.hasSideSurface=!0)},this.setSurface=function(e,t){r.surfaces[e]=t},this.hasAccessToOutside=function(e){var t=e.n,a=e.s,n=e.e,i=e.w;return r.surfaces.e===k.NONE&&null===n||(r.surfaces.w===k.NONE&&null===i||(r.surfaces.n===k.NONE&&null===t||r.surfaces.s===k.NONE&&null===a))},this.hasAccessInDirection=function(e){return r.surfaces[e]===k.NONE},t){var a=t.surfaces;this.surfaces=a}else this.surfaces={n:k.SOLID,e:k.SOLID,s:k.SOLID,w:k.SOLID,t:k.SOLID,b:k.SOLID}},te=function e(t){var r=this;if(Object(o.a)(this,e),this.hookAfterInsert=function(e,t){r.direction=e;var a=t.n,n=t.e,i=t.s,s=t.w,o=t.b;o&&"Cube"===o.constructor.name&&(o.surfaces.t=k.NONE),a&&"Cube"===a.constructor.name&&"s"===r.direction&&(a.surfaces.s=k.NONE,r.hasSideSurface=!1),n&&"Cube"===n.constructor.name&&"w"===r.direction&&(n.surfaces.w=k.NONE,r.hasSideSurface=!1),i&&"Cube"===i.constructor.name&&"n"===r.direction&&(i.surfaces.n=k.NONE,r.hasSideSurface=!1),s&&"Cube"===s.constructor.name&&"e"===r.direction&&(s.surfaces.e=k.NONE,r.hasSideSurface=!1),a&&"Roof"===a.constructor.name&&"n"===a.direction&&"s"===r.direction&&(a.hasSideSurface=!1,r.hasSideSurface=!1),n&&"Roof"===n.constructor.name&&"e"===n.direction&&"w"===r.direction&&(n.hasSideSurface=!1,r.hasSideSurface=!1),i&&"Roof"===i.constructor.name&&"s"===i.direction&&"n"===r.direction&&(i.hasSideSurface=!1,r.hasSideSurface=!1),s&&"Roof"===s.constructor.name&&"w"===s.direction&&"e"===r.direction&&(s.hasSideSurface=!1,r.hasSideSurface=!1)},this.hookBeforeRemove=function(e){var t=e.n,a=e.e,n=e.s,i=e.w,s=e.b;s&&"Cube"===s.constructor.name&&(s.surfaces.t=k.SOLID),t&&"Cube"===t.constructor.name&&"s"===r.direction&&(t.surfaces.s=k.SOLID),a&&"Cube"===a.constructor.name&&"w"===r.direction&&(a.surfaces.w=k.SOLID),n&&"Cube"===n.constructor.name&&"n"===r.direction&&(n.surfaces.n=k.SOLID),i&&"Cube"===i.constructor.name&&"e"===r.direction&&(i.surfaces.e=k.SOLID),t&&"Roof"===t.constructor.name&&"n"===t.direction&&"s"===r.direction&&(t.hasSideSurface=!0),a&&"Roof"===a.constructor.name&&"e"===a.direction&&"w"===r.direction&&(a.hasSideSurface=!0),n&&"Roof"===n.constructor.name&&"s"===n.direction&&"n"===r.direction&&(n.hasSideSurface=!0),i&&"Roof"===i.constructor.name&&"w"===i.direction&&"e"===r.direction&&(i.hasSideSurface=!0)},this.setSurface=function(e,t){if(t===k.NONE)switch(e){case"n":"s"===r.direction&&(r.hasSideSurface=!1);break;case"s":"n"===r.direction&&(r.hasSideSurface=!1);break;case"e":"w"===r.direction&&(r.hasSideSurface=!1);break;case"w":"e"===r.direction&&(r.hasSideSurface=!1)}},t){var a=t.direction,n=t.hasSideSurface;this.direction=a,this.hasSideSurface=n}else this.direction="n",this.hasSideSurface=!0},re=function e(){Object(o.a)(this,e)},ae=function e(){Object(o.a)(this,e)},ne=function e(t){var r=this;Object(o.a)(this,e),this.getAll=function(){return r.objects},this.clear=function(){r.objects=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax)},this.add=function(e,t,a){var n,i=I(r.objects,t);switch(e){case C.TRUNK:if(t.y<SETTINGS.yMax-1){var s=t.x,o=t.y,c=t.z,u={x:s,y:o,z:c+=1};return r._setCell(t,new ae(t)),r._setCell(u,new re(u)),!0}return!1;case C.CUBE:return n=new ee,r._setCell(t,n),n.hookAfterInsert(i),!0;case C.ROOF:return n=new te,r._setCell(t,n),n.hookAfterInsert(a,i),!0;default:return!1}},this.remove=function(e){var t=r._getCell(e);if(t)switch(t.constructor.name){case"Trunk":if(e.z<SETTINGS.zMax-1){r._setCell(e,null);var a=e.x,n=e.y,i=e.z;i+=1,r._setCell({x:a,y:n,z:i},null)}break;case"Foliage":if(e.z>0){r._setCell(e,null);var s=e.x,o=e.y,c=e.z;c-=1,r._setCell({x:s,y:o,z:c},null)}break;default:if(t&&t.hookBeforeRemove){var u=I(r.objects,e);t.hookBeforeRemove(u)}r._setCell(e,null)}},this.setSurface=function(e,t,a,n){var i=r._getCell(t),s=r.getCardinalSide(e,a);i&&i.setSurface&&i.setSurface(s,n);var o=I(r.objects,t)[s];o&&o.setSurface&&o.setSurface(function(e){switch(e){case"n":return"s";case"s":return"n";case"e":return"w";case"w":return"e";case"t":return"b";case"b":return"t";default:return null}}(s),n)},this.getObjects=function(){for(var e=[],t=0;t<SETTINGS.zMax;t+=1)for(var a=0;a<SETTINGS.yMax;a+=1)for(var n=0;n<SETTINGS.xMax;n+=1){var i=r.objects[t][a][n];if(i){var s=null;switch(i.constructor.name){case"Cube":s=C.CUBE;break;case"Roof":s=C.ROOF;break;case"Foliage":s=C.FOLIAGE;break;case"Trunk":s=C.TRUNK}e.push({object:i,type:s,position:{x:n,y:a,z:t}})}}return e},this.getBuildings=function(){return r._buildings?r._buildings:[]},this.calculateAttributes=function(e){var t=r.getObjects();if(r._objects=t,t){r.calculateObjectAttributes(t,e),r.calculateAccess(t);var a=r.findBuildings(t);r._buildings=r.calculateBuildingAttributes(a)}},this.calculateObjectAttributes=function(e,t){e.forEach(function(e){var a=e.position,n=e.object,i=a.x,s=a.y,o=a.z,c=t.getAt({x:i,y:s}),u=I(r.objects,{x:i,y:s,z:o}).b;switch(n.constructor.name){case"Cube":n.area=100,n.height=10*(o+1-c),n.ground=10*(o-c);break;case"Roof":n.height=10*(o+1-c),n.noBase=u&&"Cube"===u.constructor.name?0:1,n.ground=10*(o-c);break;case"Foliage":case"Trunk":n.height=10*(o+1-c),n.ground=10*(o-c)}})},this.calculateAccess=function(e){e.forEach(function(e){e.type===C.CUBE&&(e.object.distToAccess=1/0)});var t=e.filter(function(e){if(e.type===C.CUBE){var t=e.position,a=e.object,n=t.x,i=t.y,s=t.z,o=I(r.objects,{x:n,y:i,z:s});return a.hasAccessToOutside(o)}return!1});t.forEach(function(e){!function e(t,a){var n=t.x,i=t.y,s=t.z;if(!(n<0||i<0||n>=SETTINGS.xMax||i>=SETTINGS.yMax)){var o=r.objects[s][i][n];if(o&&a<o.distToAccess){o.distToAccess=a;var c=a+10;o.hasAccessInDirection("n")&&e({x:n,y:i+1,z:s},c),o.hasAccessInDirection("s")&&e({x:n,y:i-1,z:s},c),o.hasAccessInDirection("e")&&e({x:n+1,y:i,z:s},c),o.hasAccessInDirection("w")&&e({x:n-1,y:i,z:s},c),o.hasAccessInDirection("t")&&e({x:n,y:i,z:s+1},c),o.hasAccessInDirection("b")&&e({x:n,y:i,z:s-1},c)}}}(e.position,10)})},this.calculateBuildingAttributes=function(e){var t=[];return Object.keys(e).forEach(function(r){var a=e[r],n=!0,i=0,s=1/0,o=0,c=0;a.forEach(function(e){"Cube"===e.constructor.name&&(o+=100,e.distToAccess>c&&(c=e.distToAccess)),10===e.height&&(n=!1),e.height>i&&(i=e.height),e.ground<s&&(s=e.ground)}),t.push({area:o,floating:n?1:0,height:i,ground:s,maxDistToAccess:c})}),t},this.findBuildings=function(e){var t=e.filter(function(e){return e.type===C.CUBE||e.type===C.ROOF}),a={};t.forEach(function(e){e.object.buildingIndex=null});var n=0;return t.forEach(function(e){var t=e.position;null===e.object.buildingIndex&&(a[n]=[],function e(t,n){var i=t.x,s=t.y,o=t.z;if(!(i<0||s<0||o<0||i>=SETTINGS.xMax||s>=SETTINGS.yMax||o>=SETTINGS.zMax)){var c=r.objects[o][s][i];c&&null===c.buildingIndex&&(c.buildingIndex=n,a[n].push(c),[{x:i,y:s+1,z:o},{x:i,y:s-1,z:o},{x:i+1,y:s,z:o},{x:i-1,y:s,z:o},{x:i,y:s,z:o+1},{x:i,y:s,z:o-1}].forEach(function(t){return e(t,n)}))}}(t,n),n+=1)}),a},this.getCardinalSide=function(e,t){var r;if("t"===t||"b"===t)switch(e){case g.NORTH:case g.SOUTH:case g.EAST:case g.WEST:r=t;break;case g.BOTTOM:r="t"===t?"s":"n";break;case g.TOP:r="t"===t?"n":"s";break;default:throw new Error("camera ".concat(e," is not recognized!"))}else switch(e){case g.NORTH:"l"===t?r="w":"r"===t&&(r="e");break;case g.SOUTH:"l"===t?r="e":"r"===t&&(r="w");break;case g.EAST:"l"===t?r="n":"r"===t&&(r="s");break;case g.WEST:"l"===t?r="s":"r"===t&&(r="n");break;case g.BOTTOM:case g.TOP:"l"===t?r="w":"r"===t&&(r="e");break;default:throw new Error("camera ".concat(e," is not recognized!"))}return r},this.getSlice=function(e,t){var a,n,i;switch(e){case g.NORTH:return r._getYSlice(t);case g.SOUTH:return a=r._getYSlice(t),Q.a.hflip(a);case g.EAST:return n=r._getXSlice(t),Q.a.hflip(n);case g.WEST:return r._getXSlice(t);case g.BOTTOM:return i=r._getZSlice(t),Q.a.vflip(i);case g.TOP:return r._getZSlice(t);default:throw new Error("camera ".concat(e," is not recognized!"))}},this.getBackgroundSlices=function(e,t){var a=t,n=[];switch(e){case g.NORTH:for(;a<SETTINGS.yMax-1;)a+=1,n.push(a);break;case g.SOUTH:for(;a>0;)a-=1,n.push(a);break;case g.EAST:for(;a<SETTINGS.xMax-1;)a+=1,n.push(a);break;case g.WEST:for(;a>0;)a-=1,n.push(a);break;case g.BOTTOM:for(;a<SETTINGS.zMax-1;)a+=1,n.push(a);break;case g.TOP:for(;a>0;)a-=1,n.push(a);break;default:throw new Error("camera ".concat(e," is not recognized!"))}return n.map(function(t){return r.getSlice(e,t)})},this._getZSlice=function(e){return r.objects[e]},this._getXSlice=function(e){for(var t=N(SETTINGS.zMax,SETTINGS.yMax),a=0;a<SETTINGS.zMax;a+=1)for(var n=0;n<SETTINGS.yMax;n+=1)t[a][n]=r.objects[a][n][e];return t},this._getYSlice=function(e){for(var t=N(SETTINGS.zMax,SETTINGS.xMax),a=0;a<SETTINGS.zMax;a+=1)for(var n=0;n<SETTINGS.xMax;n+=1)t[a][n]=r.objects[a][e][n];return t},this._getCell=function(e){var t=e.x,a=e.y,n=e.z;return t>=0&&a>=0&&n>=0&&t<SETTINGS.xMax&&a<SETTINGS.yMax&&n<SETTINGS.zMax?r.objects[n][a][t]:null},this._setCell=function(e,t){var a=e.x,n=e.y,i=e.z;a>=0&&n>=0&&i>=0&&a<SETTINGS.xMax&&n<SETTINGS.yMax&&i<SETTINGS.zMax&&(r.objects[i][n][a]=t)},this._addCube=function(e){var t=I(e),a=new ee(e,t);r.addObject(e,a)},this.fill=function(){var e=function(e,t,a){r.add(t,e,a)};e({x:11,y:3,z:0},0),e({x:11,y:3,z:1},0),e({x:11,y:3,z:2},1,"w"),e({x:12,y:3,z:0},0),e({x:12,y:3,z:1},0),e({x:12,y:3,z:2},1,"e"),e({x:13,y:3,z:0},0),e({x:13,y:3,z:1},1,"e"),e({x:14,y:3,z:0},0),e({x:15,y:3,z:0},0),e({x:16,y:3,z:0},2),e({x:9,y:13,z:0},0),e({x:9,y:13,z:1},1,"s"),e({x:9,y:14,z:0},0),e({x:9,y:14,z:1},1,"n"),e({x:13,y:5,z:4},1,"e"),e({x:5,y:0,z:1},1,"e"),e({x:7,y:0,z:0},0),e({x:9,y:0,z:0},0),e({x:10,y:0,z:0},0),e({x:1,y:1,z:2},0),e({x:2,y:1,z:2},0),e({x:1,y:2,z:2},0),e({x:2,y:2,z:2},0),e({x:1,y:2,z:3},0),e({x:2,y:2,z:3},0),e({x:4,y:2,z:5},1,"s"),e({x:4,y:2,z:5},1,"n"),e({x:4,y:2,z:5},1,"s"),e({x:4,y:2,z:5},1,"n")},t?this.objects=t:(this.objects=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),this.fill())};ne.freeze=function(e){for(var t=e.objects,r=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),a=0;a<SETTINGS.zMax;a+=1)for(var n=0;n<SETTINGS.xMax;n+=1)for(var i=0;i<SETTINGS.xMax;i+=1){var s=t[a][n][i];if(s){var o=JSON.stringify(s),c=JSON.parse(o);c.type=s.constructor.name,r[a][n][i]=c}}return{objects:r}},ne.thaw=function(e){for(var t=e.objects,r=O(SETTINGS.xMax,SETTINGS.yMax,SETTINGS.zMax),a=0;a<SETTINGS.zMax;a+=1)for(var n=0;n<SETTINGS.xMax;n+=1)for(var i=0;i<SETTINGS.xMax;i+=1){var s=t[a][n][i];if(s){var o=null;switch(s.type){case"Cube":o=new ee(s);break;case"Roof":o=new te(s);break;case"Foliage":o=new re(s);break;case"Trunk":o=new ae(s)}r[a][n][i]=o}}return new ne(r)};var ie=ne,se=function e(t){var r=this;Object(o.a)(this,e),this.clear=function(){r.heights=N(SETTINGS.yMax,SETTINGS.xMax,0)},this.increase=function(e){var t=r.heights[e.y][e.x]+1;t<=SETTINGS.zMax&&(r.heights[e.y][e.x]=t)},this.decrease=function(e){var t=r.heights[e.y][e.x]-1;t>=0&&(r.heights[e.y][e.x]=t)},this.getAt=function(e){return r.heights[e.y][e.x]},this.getSlice=function(e,t){var a;switch(e){case g.NORTH:a=r.heights;break;case g.SOUTH:a=Q.a.hflip(r.heights);break;case g.EAST:a=Q.a.hflip(Q.a.transpose(r.heights));break;case g.WEST:a=Q.a.transpose(r.heights);break;case g.BOTTOM:case g.TOP:return null;default:throw new Error("camera ".concat(e," is not recognized!"))}for(var n,i,s,o=[],c=[],u=0;u<a[t].length;u+=1){var S={topLeft:w(n=a,(i=u)-1,(s=t)+1),top:w(n,i,s+1),topRight:w(n,i+1,s+1),left:w(n,i-1,s),center:w(n,i,s),right:w(n,i+1,s),bottomLeft:w(n,i-1,s-1),bottom:w(n,i,s-1),bottomRight:w(n,i+1,s-1)},l=S.topLeft,h=S.top,T=S.topRight,d=S.left,f=S.center,E=S.right,p=S.bottomLeft,v=S.bottom,m=S.bottomRight;o.push([Math.max(l,h,d,f),Math.max(h,T,f,E)]),c.push([Math.max(p,v,d,f),Math.max(v,m,f,E)])}return{front:c,back:o}},this.getCorners=function(){for(var e=r.heights.length+1,t=N(e,e,0),a=0;a<e;a+=1)for(var n=0;n<e;n+=1){var i=b(r.heights,n,a),s=i.topLeft,o=i.topRight,c=i.bottomLeft,u=i.bottomRight;t[a][n]=Math.max(s,o,c,u)}return t},this.heights=t||N(SETTINGS.yMax,SETTINGS.xMax,0)};se.freeze=function(e){var t=JSON.stringify(e);return JSON.parse(t)},se.thaw=function(e){var t=e.heights;return new se(t)};var oe=se,ce=function e(t){var r=this;Object(o.a)(this,e),this.onUpdate=function(){r._design.calculateAttributes(r.topo),r._monitor.checkDesign(r._design),r.save()},this.clear=function(){r._design.clear(),r._topo.clear(),r._monitor.clearConstraints(),r.onUpdate()},this.design={add:function(e,t,a){r._design.add(e,t,a),r.onUpdate()},remove:function(e){r._design.remove(e),r.onUpdate()},setSurface:function(e,t,a,n){r._design.setSurface(e,t,a,n),r.onUpdate()},getAll:function(){return r._design.getAll()},getSlice:function(e,t){return r._design.getSlice(e,t)},getBackgroundSlices:function(e,t){return r._design.getBackgroundSlices(e,t)}},this.topo={increase:function(e){r._topo.increase(e),r.onUpdate()},decrease:function(e){r._topo.decrease(e),r.onUpdate()},getCorners:function(){return r._topo.getCorners()},getAt:function(e){return r._topo.getAt(e)},getSlice:function(e,t){return r._topo.getSlice(e,t)}},this.monitor={addConstraint:function(e){r._monitor.addConstraint(e)&&r.onUpdate()},clearConstraints:function(){r._monitor.clearConstraints(),r.onUpdate()},getMessages:function(){return r._monitor.getMessages()}},this.save=function(){var t=e.freeze(r);localStorage.setItem(r._id,JSON.stringify(t))},this._id=t};ce.create=function(e){var t=new ce(e);return t._design=new ie,t._topo=new oe,t._monitor=new Z,t.save(),t},ce.freeze=function(e){var t=e._id,r=e._design,a=e._topo,n=e._monitor;return{id:t,design:ie.freeze(r),topo:oe.freeze(a),monitor:Z.freeze(n)}},ce.thaw=function(e){var t=e.id,r=e.design,a=e.topo,n=e.monitor,i=new ce(t);return i._design=ie.thaw(r),i._topo=oe.thaw(a),i._monitor=Z.thaw(n),i.onUpdate(),i};var ue=ce,Se={w:852,h:852,color:"#E8E8DA",gridSize:17,xMax:17,yMax:17,zMax:7,r:50,material:new h.e({color:15263962}),stroke:3.5};window.SETTINGS=Se;var le=(new function e(){var t=this;Object(o.a)(this,e),this.getIDList=function(){var e=localStorage.getItem("U5SessionIDList");return e=e?e.split(","):[],console.log(e),e},this.get=function(e){var r=JSON.parse(localStorage.getItem(e)),a=ue.thaw(r),n=t.getIDList();return(n=n.filter(function(t){return t!==e})).push(e),t._setIDList(n),a},this.remove=function(e){var r=t.getIDList();return r=r.filter(function(t){return t!==e}),t._setIDList(r),r},this.last=function(){var e=t.getIDList().pop();if(!e)return t.newSession();var r=JSON.parse(localStorage.getItem(e));return ue.thaw(r)},this.newSession=function(){var e=t._getNextID(),r=t.getIDList();return r.push(e),t._setIDList(r),ue.create(e)},this.test=function(){var e=t._getNextID(),r=t.getIDList();r.push(e),t._setIDList(r);var a=localStorage.getItem("U5SessionTestData");return a.id=e,ue.thaw(a)},this._setIDList=function(e){return localStorage.setItem("U5SessionIDList",e)},this._getNextID=function(){var e=localStorage.getItem("U5SessionIDCount");return e||(e=-1),e=parseInt(e,10)+1,localStorage.setItem("U5SessionIDCount",e),"U5Session_".concat(e)}}).last(),he={camera:0,slices:{x:0,y:0,z:6}},Te=function(e){function t(){var e,r;Object(o.a)(this,t);for(var a=arguments.length,n=new Array(a),i=0;i<a;i++)n[i]=arguments[i];return(r=Object(u.a)(this,(e=Object(S.a)(t)).call.apply(e,[this].concat(n)))).state={debug:!0},r}return Object(l.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;document.addEventListener("keydown",function(t){var r=e.state.debug;"p"===t.key&&e.setState({debug:!r})})}},{key:"render",value:function(){var e=this.state.debug;return n.a.createElement("div",{className:"app"},n.a.createElement(K,{session:le,cameraView:he}),e&&n.a.createElement("div",null,n.a.createElement(X,{session:le}),n.a.createElement(q,{session:le,cameraView:he})))}}]),t}(n.a.Component);s.a.render(n.a.createElement(Te,null),document.getElementById("root"))},9:function(module,__webpack_exports__,__webpack_require__){"use strict";var _Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2),_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(14),Constraint=function Constraint(data){var _this=this;if(Object(_Users_erikulberg_Desktop_urban5_node_modules_babel_runtime_helpers_esm_classCallCheck__WEBPACK_IMPORTED_MODULE_0__.a)(this,Constraint),this.isViolated=function(design){var objectsOfType;if("Structure"===_this.type)objectsOfType=design.getBuildings();else{var objects=design.getObjects();objectsOfType=objects.filter(function(e){return parseInt(_this.type)===e.type}),objectsOfType=objectsOfType.map(function(e){return e.object})}var propValues=objectsOfType.map(function(e){return e[_this.prop]});if(0===propValues.length)return!1;var calculatedValue=null;switch(_this.fn){case"SUM":calculatedValue=propValues.reduce(function(e,t){return t?e+t:e});break;case"MAX":calculatedValue=propValues.reduce(function(e,t){return t?Math.max(e,t):e});break;case"MIN":calculatedValue=propValues.reduce(function(e,t){return t?Math.min(e,t):e})}var calculatedResult=eval("".concat(calculatedValue," ").concat(_this.comp," ").concat(_this.value));console.log(_this.prop,calculatedValue,_this.comp,_this.value,calculatedResult,"expected",_this.result);var isViolated=calculatedResult!==_this.result;return{result:isViolated,value:calculatedValue}},this.isSameType=function(e){return e.fn===_this.fn&&JSON.stringify(e.type)===JSON.stringify(_this.type)&&e.prop===_this.prop},data){var text=data.text,result=data.result,fn=data.fn,type=data.type,prop=data.prop,comp=data.comp,value=data.value;this.text=text,this.result=result,this.fn=fn,this.type=type,this.prop=prop,this.comp=comp,this.value=value}},possibleConstraints=[{fn:"MAX",type:"Structure",prop:"height"},{fn:"MIN",type:"Structure",prop:"height"},{fn:"MAX",type:"0",prop:"distToAccess"},{fn:"MAX",type:"Structure",prop:"area"},{fn:"MIN",type:"Structure",prop:"area"}],hasError=function(e){if(!e)return!0;var t=e.fn,r=e.type,a=e.prop,n=e.value,i=e.comp,s=e.result;if(!t||!r||!a||!n||!i||null===s)return!0;var o=!1;return possibleConstraints.forEach(function(e){void 0!==e.fn&&e.fn!==t||void 0!==e.type&&e.type!==r||void 0!==e.prop&&e.prop!==a||void 0!==e.value&&e.value!==n||void 0!==e.comp&&e.comp!==i||void 0!==e.result&&e.result!==s||(o=!0)}),!o};Constraint.create=function(e){if(!e)return"No text provided";var t=Object(_helpers_TextToConstraint__WEBPACK_IMPORTED_MODULE_1__.a)(e);return hasError(t)?(console.log("Bad Constraint: ".concat(JSON.stringify(t))),null):new Constraint(t)},__webpack_exports__.a=Constraint}},[[16,2,1]]]);
//# sourceMappingURL=main.b28b38f9.chunk.js.map